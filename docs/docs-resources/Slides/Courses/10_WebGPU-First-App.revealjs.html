<!DOCTYPE html>
<html lang="en-EN"><head>
<script src="10_WebGPU-First-App_files/libs/clipboard/clipboard.min.js"></script>
<script src="10_WebGPU-First-App_files/libs/quarto-html/tabby.min.js"></script>
<script src="10_WebGPU-First-App_files/libs/quarto-html/popper.min.js"></script>
<script src="10_WebGPU-First-App_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="10_WebGPU-First-App_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="10_WebGPU-First-App_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="10_WebGPU-First-App_files/libs/quarto-html/quarto-syntax-highlighting-dark-befe23ebd2f54d8af2c8a89d1a1611f1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="10_WebGPU-First-App_files/libs/quarto-contrib/reveal-header-1.0.0/add_header.js" defer="true"></script>
<link href="10_WebGPU-First-App_files/libs/quarto-contrib/reveal-header-1.0.0/add_header.css" rel="stylesheet">
<link href="10_WebGPU-First-App_files/libs/quarto-contrib/grid-no-htext-1.0.0/grid_no_htext.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.34">

  <meta name="author" content="François-David Collin">
  <title>Your First WebGPU App</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="10_WebGPU-First-App_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="10_WebGPU-First-App_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
  </style>
  <link rel="stylesheet" href="10_WebGPU-First-App_files/libs/revealjs/dist/theme/quarto-d544bd66fbdc5badc5a277a2930e2a0b.css">
  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">
  <link href="10_WebGPU-First-App_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="10_WebGPU-First-App_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="10_WebGPU-First-App_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="10_WebGPU-First-App_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="10_WebGPU-First-App_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="10_WebGPU-First-App_files/libs/revealjs/plugin/reveal-attribution/attribution.css" rel="stylesheet">
  <link href="10_WebGPU-First-App_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script type="module" src="10_WebGPU-First-App_files/libs/quarto-ojs/quarto-ojs-runtime.js"></script>
  <link href="10_WebGPU-First-App_files/libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Your First WebGPU App</h1>
  <p class="subtitle">Rendering and Compute with WebGPU</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
François-David Collin 
</div>
<div class="quarto-title-author-email">
<a href="mailto:francois-david.collin@umontpellier.fr">francois-david.collin@umontpellier.fr</a>
</div>
        <p class="quarto-title-affiliation">
            CNRS
          </p>
        <p class="quarto-title-affiliation">
            IMAG
          </p>
        <p class="quarto-title-affiliation">
            Paul-Valéry Montpellier 3 University
          </p>
    </div>
</div>

</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/introduction" id="/toc-introduction">Introduction</a></li>
<li><a href="#/initialize-webgpu" id="/toc-initialize-webgpu">Initialize WebGPU</a></li>
<li><a href="#/draw-geometry" id="/toc-draw-geometry">Draw geometry</a></li>
<li><a href="#/shaders-wgsl" id="/toc-shaders-wgsl">Shaders (WGSL)</a></li>
<li><a href="#/render-pipeline-and-draw" id="/toc-render-pipeline-and-draw">Render pipeline and draw</a></li>
<li><a href="#/draw-a-grid-instancing" id="/toc-draw-a-grid-instancing">Draw a grid (instancing)</a></li>
</ul>
</nav>
</section>
<section>
<section id="introduction" class="title-slide slide level1 center">
<h1>Introduction</h1>

</section>
<section id="what-is-webgpu" class="slide level2 center">
<h2>What is WebGPU?</h2>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<ul>
<li class="fragment">Modern, cross-platform GPU API for the web</li>
<li class="fragment">Successor to WebGL; maps to Metal, Vulkan, Direct3D 12</li>
<li class="fragment">Two main capabilities:
<ul>
<li class="fragment">Rendering: draw 2D/3D graphics</li>
<li class="fragment">Compute: massively parallel general-purpose workloads</li>
</ul></li>
</ul>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img data-src="../images/webgpu-logo-transparent.png" class="noinvert"></p>
</div>
</div>
</div>
<aside class="notes">
<p>Position WebGPU vs WebGL (modern API mapping to Metal/Vulkan/D3D12). Emphasize compute shaders and how the web finally gains first-class GPGPU.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="what-youll-build" class="slide level2 center">
<h2>What you’ll build</h2>
<ul>
<li>Mini pipeline to render a square, the building block for a Game of Life simulation</li>
<li>Learn the primitives: device, canvas context, buffers, shaders, pipeline, draw</li>
</ul>
<aside class="notes">
<p>Set expectations: we start with a single square, then scale to an instanced grid and outline the compute step.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="requirements" class="slide level2 center">
<h2>Requirements</h2>
<ul>
<li>Chrome 113+ (or a browser with WebGPU enabled)</li>
<li>Basic HTML/JS</li>
</ul>
<p>Links: https://gpuweb.github.io/gpuweb/ • https://codelabs.developers.google.com/your-first-webgpu-app</p>
</section></section>
<section>
<section id="initialize-webgpu" class="title-slide slide level1 center">
<h1>Initialize WebGPU</h1>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Observable helper setup</strong></p>
</div>
<div class="callout-content">
<p>To keep the live Observable notebooks concise, we reuse a few shared helpers for WebGPU device access and rendering. They are hidden from the final slides but power the interactive demos below.</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="53" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 52;"><span id="cb1-53"><a href="" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> {</span>
<span id="cb1-54"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="bu">navigator</span><span class="op">.</span><span class="at">gpu</span>) {</span>
<span id="cb1-55"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"WebGPU not supported on this browser."</span>)<span class="op">;</span></span>
<span id="cb1-56"><a href="" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-57"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adapter <span class="op">=</span> <span class="cf">await</span> <span class="bu">navigator</span><span class="op">.</span><span class="at">gpu</span><span class="op">.</span><span class="fu">requestAdapter</span>()<span class="op">;</span></span>
<span id="cb1-58"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>adapter) {</span>
<span id="cb1-59"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"No appropriate GPUAdapter found."</span>)<span class="op">;</span></span>
<span id="cb1-60"><a href="" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-61"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="cf">await</span> adapter<span class="op">.</span><span class="fu">requestDevice</span>()<span class="op">;</span></span>
<span id="cb1-62"><a href="" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-63"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="" aria-hidden="true" tabindex="-1"></a>presentationFormat <span class="op">=</span> <span class="bu">navigator</span><span class="op">.</span><span class="at">gpu</span><span class="op">.</span><span class="fu">getPreferredCanvasFormat</span>()</span>
<span id="cb1-65"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-66"><a href="" aria-hidden="true" tabindex="-1"></a>createCanvas <span class="op">=</span> (w <span class="op">=</span> <span class="dv">640</span><span class="op">,</span> h <span class="op">=</span> <span class="dv">480</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb1-67"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> c <span class="op">=</span> DOM<span class="op">.</span><span class="fu">canvas</span>(w<span class="op">,</span> h)<span class="op">;</span></span>
<span id="cb1-68"><a href="" aria-hidden="true" tabindex="-1"></a>  c<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">maxWidth</span> <span class="op">=</span> <span class="st">"100%"</span><span class="op">;</span></span>
<span id="cb1-69"><a href="" aria-hidden="true" tabindex="-1"></a>  c<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">border</span> <span class="op">=</span> <span class="st">"1px solid #ddd"</span><span class="op">;</span></span>
<span id="cb1-70"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> c<span class="op">;</span></span>
<span id="cb1-71"><a href="" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-72"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-73"><a href="" aria-hidden="true" tabindex="-1"></a>setupContext <span class="op">=</span> (canvas<span class="op">,</span> device<span class="op">,</span> format) <span class="kw">=&gt;</span> {</span>
<span id="cb1-74"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctx <span class="op">=</span> canvas<span class="op">.</span><span class="fu">getContext</span>(<span class="st">"webgpu"</span>)<span class="op">;</span></span>
<span id="cb1-75"><a href="" aria-hidden="true" tabindex="-1"></a>  ctx<span class="op">.</span><span class="fu">configure</span>({ device<span class="op">,</span> format })<span class="op">;</span></span>
<span id="cb1-76"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ctx<span class="op">;</span></span>
<span id="cb1-77"><a href="" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-78"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-79"><a href="" aria-hidden="true" tabindex="-1"></a>beginPass <span class="op">=</span> (device<span class="op">,</span> context<span class="op">,</span> clearColor <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]) <span class="kw">=&gt;</span> {</span>
<span id="cb1-80"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> encoder <span class="op">=</span> device<span class="op">.</span><span class="fu">createCommandEncoder</span>()<span class="op">;</span></span>
<span id="cb1-81"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> view <span class="op">=</span> context<span class="op">.</span><span class="fu">getCurrentTexture</span>()<span class="op">.</span><span class="fu">createView</span>()<span class="op">;</span></span>
<span id="cb1-82"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pass <span class="op">=</span> encoder<span class="op">.</span><span class="fu">beginRenderPass</span>({</span>
<span id="cb1-83"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">colorAttachments</span><span class="op">:</span> [{</span>
<span id="cb1-84"><a href="" aria-hidden="true" tabindex="-1"></a>      view<span class="op">,</span></span>
<span id="cb1-85"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">loadOp</span><span class="op">:</span> <span class="st">"clear"</span><span class="op">,</span></span>
<span id="cb1-86"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">clearValue</span><span class="op">:</span> { <span class="dt">r</span><span class="op">:</span> clearColor[<span class="dv">0</span>]<span class="op">,</span> <span class="dt">g</span><span class="op">:</span> clearColor[<span class="dv">1</span>]<span class="op">,</span> <span class="dt">b</span><span class="op">:</span> clearColor[<span class="dv">2</span>]<span class="op">,</span> <span class="dt">a</span><span class="op">:</span> clearColor[<span class="dv">3</span>] }<span class="op">,</span></span>
<span id="cb1-87"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">storeOp</span><span class="op">:</span> <span class="st">"store"</span></span>
<span id="cb1-88"><a href="" aria-hidden="true" tabindex="-1"></a>    }]</span>
<span id="cb1-89"><a href="" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb1-90"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> { encoder<span class="op">,</span> pass }<span class="op">;</span></span>
<span id="cb1-91"><a href="" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-92"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-93"><a href="" aria-hidden="true" tabindex="-1"></a>endPass <span class="op">=</span> ({ device<span class="op">,</span> encoder<span class="op">,</span> pass }) <span class="kw">=&gt;</span> {</span>
<span id="cb1-94"><a href="" aria-hidden="true" tabindex="-1"></a>  pass<span class="op">.</span><span class="fu">end</span>()<span class="op">;</span></span>
<span id="cb1-95"><a href="" aria-hidden="true" tabindex="-1"></a>  device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">submit</span>([encoder<span class="op">.</span><span class="fu">finish</span>()])<span class="op">;</span></span>
<span id="cb1-96"><a href="" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-97"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-98"><a href="" aria-hidden="true" tabindex="-1"></a>renderToCanvas <span class="op">=</span> ({</span>
<span id="cb1-99"><a href="" aria-hidden="true" tabindex="-1"></a>  width <span class="op">=</span> <span class="dv">640</span><span class="op">,</span></span>
<span id="cb1-100"><a href="" aria-hidden="true" tabindex="-1"></a>  height <span class="op">=</span> <span class="dv">480</span><span class="op">,</span></span>
<span id="cb1-101"><a href="" aria-hidden="true" tabindex="-1"></a>  clearColor <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb1-102"><a href="" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb1-103"><a href="" aria-hidden="true" tabindex="-1"></a>  draw <span class="op">=</span> { <span class="dt">vertexCount</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">instanceCount</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">firstVertex</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">firstInstance</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb1-104"><a href="" aria-hidden="true" tabindex="-1"></a>  render <span class="op">=</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb1-105"><a href="" aria-hidden="true" tabindex="-1"></a>} <span class="op">=</span> {}) <span class="kw">=&gt;</span> {</span>
<span id="cb1-106"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> <span class="fu">createCanvas</span>(width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb1-107"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctx <span class="op">=</span> <span class="fu">setupContext</span>(canvas<span class="op">,</span> device<span class="op">,</span> presentationFormat)<span class="op">;</span></span>
<span id="cb1-108"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { encoder<span class="op">,</span> pass } <span class="op">=</span> <span class="fu">beginPass</span>(device<span class="op">,</span> ctx<span class="op">,</span> clearColor)<span class="op">;</span></span>
<span id="cb1-109"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (render <span class="op">&amp;&amp;</span> <span class="kw">typeof</span> render <span class="op">===</span> <span class="st">"function"</span>) {</span>
<span id="cb1-110"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">render</span>(pass)<span class="op">;</span></span>
<span id="cb1-111"><a href="" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (pipeline) {</span>
<span id="cb1-112"><a href="" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">setPipeline</span>(pipeline)<span class="op">;</span></span>
<span id="cb1-113"><a href="" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">draw</span>(</span>
<span id="cb1-114"><a href="" aria-hidden="true" tabindex="-1"></a>      draw<span class="op">.</span><span class="at">vertexCount</span> <span class="op">??</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb1-115"><a href="" aria-hidden="true" tabindex="-1"></a>      draw<span class="op">.</span><span class="at">instanceCount</span> <span class="op">??</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb1-116"><a href="" aria-hidden="true" tabindex="-1"></a>      draw<span class="op">.</span><span class="at">firstVertex</span> <span class="op">??</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-117"><a href="" aria-hidden="true" tabindex="-1"></a>      draw<span class="op">.</span><span class="at">firstInstance</span> <span class="op">??</span> <span class="dv">0</span></span>
<span id="cb1-118"><a href="" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb1-119"><a href="" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-120"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">endPass</span>({ device<span class="op">,</span> encoder<span class="op">,</span> pass })<span class="op">;</span></span>
<span id="cb1-121"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> canvas<span class="op">;</span></span>
<span id="cb1-122"><a href="" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-123"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-124"><a href="" aria-hidden="true" tabindex="-1"></a>withBindings <span class="op">=</span> ({</span>
<span id="cb1-125"><a href="" aria-hidden="true" tabindex="-1"></a>  pipeline<span class="op">,</span></span>
<span id="cb1-126"><a href="" aria-hidden="true" tabindex="-1"></a>  bindGroups <span class="op">=</span> []<span class="op">,</span></span>
<span id="cb1-127"><a href="" aria-hidden="true" tabindex="-1"></a>  vertex <span class="op">=</span> []<span class="op">,</span></span>
<span id="cb1-128"><a href="" aria-hidden="true" tabindex="-1"></a>  index <span class="op">=</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb1-129"><a href="" aria-hidden="true" tabindex="-1"></a>  draw <span class="op">=</span> { <span class="dt">vertexCount</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">instanceCount</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">firstVertex</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">firstInstance</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb1-130"><a href="" aria-hidden="true" tabindex="-1"></a>  drawIndexed <span class="op">=</span> <span class="kw">null</span></span>
<span id="cb1-131"><a href="" aria-hidden="true" tabindex="-1"></a>} <span class="op">=</span> {}) <span class="kw">=&gt;</span> {</span>
<span id="cb1-132"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (pass) <span class="kw">=&gt;</span> {</span>
<span id="cb1-133"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (pipeline) pass<span class="op">.</span><span class="fu">setPipeline</span>(pipeline)<span class="op">;</span></span>
<span id="cb1-134"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> bindGroups<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-135"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> bg <span class="op">=</span> bindGroups[i]<span class="op">;</span></span>
<span id="cb1-136"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (bg) pass<span class="op">.</span><span class="fu">setBindGroup</span>(i<span class="op">,</span> bg)<span class="op">;</span></span>
<span id="cb1-137"><a href="" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-138"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> vb <span class="kw">of</span> vertex) {</span>
<span id="cb1-139"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (vb<span class="op">?.</span><span class="at">buffer</span>) pass<span class="op">.</span><span class="fu">setVertexBuffer</span>(vb<span class="op">.</span><span class="at">slot</span> <span class="op">??</span> <span class="dv">0</span><span class="op">,</span> vb<span class="op">.</span><span class="at">buffer</span><span class="op">,</span> vb<span class="op">.</span><span class="at">offset</span> <span class="op">??</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-140"><a href="" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-141"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (index<span class="op">?.</span><span class="at">buffer</span> <span class="op">&amp;&amp;</span> index<span class="op">.</span><span class="at">indexFormat</span>) {</span>
<span id="cb1-142"><a href="" aria-hidden="true" tabindex="-1"></a>      pass<span class="op">.</span><span class="fu">setIndexBuffer</span>(index<span class="op">.</span><span class="at">buffer</span><span class="op">,</span> index<span class="op">.</span><span class="at">indexFormat</span><span class="op">,</span> index<span class="op">.</span><span class="at">offset</span> <span class="op">??</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-143"><a href="" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-144"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (index <span class="op">&amp;&amp;</span> drawIndexed) {</span>
<span id="cb1-145"><a href="" aria-hidden="true" tabindex="-1"></a>      pass<span class="op">.</span><span class="fu">drawIndexed</span>(</span>
<span id="cb1-146"><a href="" aria-hidden="true" tabindex="-1"></a>        drawIndexed<span class="op">.</span><span class="at">indexCount</span><span class="op">,</span></span>
<span id="cb1-147"><a href="" aria-hidden="true" tabindex="-1"></a>        drawIndexed<span class="op">.</span><span class="at">instanceCount</span> <span class="op">??</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb1-148"><a href="" aria-hidden="true" tabindex="-1"></a>        drawIndexed<span class="op">.</span><span class="at">firstIndex</span> <span class="op">??</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-149"><a href="" aria-hidden="true" tabindex="-1"></a>        drawIndexed<span class="op">.</span><span class="at">baseVertex</span> <span class="op">??</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-150"><a href="" aria-hidden="true" tabindex="-1"></a>        drawIndexed<span class="op">.</span><span class="at">firstInstance</span> <span class="op">??</span> <span class="dv">0</span></span>
<span id="cb1-151"><a href="" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb1-152"><a href="" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-153"><a href="" aria-hidden="true" tabindex="-1"></a>      pass<span class="op">.</span><span class="fu">draw</span>(</span>
<span id="cb1-154"><a href="" aria-hidden="true" tabindex="-1"></a>        draw<span class="op">.</span><span class="at">vertexCount</span> <span class="op">??</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb1-155"><a href="" aria-hidden="true" tabindex="-1"></a>        draw<span class="op">.</span><span class="at">instanceCount</span> <span class="op">??</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb1-156"><a href="" aria-hidden="true" tabindex="-1"></a>        draw<span class="op">.</span><span class="at">firstVertex</span> <span class="op">??</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-157"><a href="" aria-hidden="true" tabindex="-1"></a>        draw<span class="op">.</span><span class="at">firstInstance</span> <span class="op">??</span> <span class="dv">0</span></span>
<span id="cb1-158"><a href="" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb1-159"><a href="" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-160"><a href="" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb1-161"><a href="" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-8" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="minimal-html-page-1" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Minimal HTML page (1)</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode html code-with-copy" data-id="quarto-animate-code"><code class="sourceCode html hljs"><span id="cb2-1" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!doctype</span> html<span class="dt">&gt;</span></span>
<span id="cb2-2" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="cb2-4" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb2-5" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> charset</span><span class="op">=</span><span class="st">"utf-8"</span><span class="dt">&gt;</span></span>
<span id="cb2-6" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>WebGPU Life<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb2-7" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="cb2-8" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb2-9" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">canvas</span><span class="ot"> width</span><span class="op">=</span><span class="st">"512"</span><span class="ot"> height</span><span class="op">=</span><span class="st">"512"</span><span class="dt">&gt;&lt;/</span><span class="kw">canvas</span><span class="dt">&gt;</span></span>
<span id="cb2-10" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">"module"</span><span class="dt">&gt;</span></span>
<span id="cb2-11" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> canvas <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"canvas"</span>)<span class="op">;</span> </span>
<span id="cb2-12" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb2-13" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb2-14" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="cb2-15" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="minimal-html-page" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Minimal HTML page</h2>
<div class="sourceCode" id="annotated-cell-2"><pre class="sourceCode html code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode html hljs"><span id="annotated-cell-2-1" class="hljs-ln-code"><a href="#annotated-cell-2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!doctype</span> html<span class="dt">&gt;</span></span>
<span id="annotated-cell-2-2" class="hljs-ln-code"><a href="#annotated-cell-2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-2-3" class="hljs-ln-code"><a href="#annotated-cell-2-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">html</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-2-4" class="hljs-ln-code"><a href="#annotated-cell-2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-2-5" class="hljs-ln-code"><a href="#annotated-cell-2-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">meta</span><span class="ot"> charset</span><span class="op">=</span><span class="st">"utf-8"</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-2-6" class="hljs-ln-code"><a href="#annotated-cell-2-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>WebGPU Life<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-2-7" class="hljs-ln-code"><a href="#annotated-cell-2-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">head</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-2-8" class="hljs-ln-code"><a href="#annotated-cell-2-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-2-9" class="hljs-ln-code"><a href="#annotated-cell-2-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">canvas</span><span class="ot"> width</span><span class="op">=</span><span class="st">"512"</span><span class="ot"> height</span><span class="op">=</span><span class="st">"512"</span><span class="dt">&gt;&lt;/</span><span class="kw">canvas</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-2-10" class="hljs-ln-code"><a href="#annotated-cell-2-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">"module"</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-2-11" class="hljs-ln-code"><a href="#annotated-cell-2-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> canvas <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">"canvas"</span>)<span class="op">;</span> </span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-2" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-2-12" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-2-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Your WebGPU code will begin here!</span></span>
<span id="annotated-cell-2-13" class="hljs-ln-code"><a href="#annotated-cell-2-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="annotated-cell-2-14" class="hljs-ln-code"><a href="#annotated-cell-2-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-2-15" class="hljs-ln-code"><a href="#annotated-cell-2-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">body</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-2-16" class="hljs-ln-code"><a href="#annotated-cell-2-16" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">html</span><span class="dt">&gt;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="12" data-code-annotation="1">This is where we will add our WebGPU code in the next steps.</span>
</dd>
</dl>
<aside class="notes">
<p>Basic HTML5 page with a canvas and a script module. We will fill in the script.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="check-support-and-prepare-canvas-2" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Check support and prepare canvas (2)</h2>
<div class="sourceCode" id="annotated-cell-3"><pre class="sourceCode html code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode html hljs"><span id="annotated-cell-3-1" class="hljs-ln-code"><a href="#annotated-cell-3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">canvas</span><span class="ot"> id</span><span class="op">=</span><span class="st">"gfx"</span><span class="ot"> width</span><span class="op">=</span><span class="st">"512"</span><span class="ot"> height</span><span class="op">=</span><span class="st">"512"</span><span class="dt">&gt;&lt;/</span><span class="kw">canvas</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-3-2" class="hljs-ln-code"><a href="#annotated-cell-3-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">"module"</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-3-3" class="hljs-ln-code"><a href="#annotated-cell-3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="bu">navigator</span><span class="op">.</span><span class="at">gpu</span>) {</span>
<span id="annotated-cell-3-4" class="hljs-ln-code"><a href="#annotated-cell-3-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"WebGPU not supported on this browser."</span>)<span class="op">;</span></span>
<span id="annotated-cell-3-5" class="hljs-ln-code"><a href="#annotated-cell-3-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-3-6" class="hljs-ln-code"><a href="#annotated-cell-3-6" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-3" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-3-7" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-3-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> adapter <span class="op">=</span> <span class="cf">await</span> <span class="bu">navigator</span><span class="op">.</span><span class="at">gpu</span><span class="op">.</span><span class="fu">requestAdapter</span>()<span class="op">;</span></span>
<span id="annotated-cell-3-8" class="hljs-ln-code"><a href="#annotated-cell-3-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>adapter) {</span>
<span id="annotated-cell-3-9" class="hljs-ln-code"><a href="#annotated-cell-3-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"No appropriate GPUAdapter found."</span>)<span class="op">;</span></span>
<span id="annotated-cell-3-10" class="hljs-ln-code"><a href="#annotated-cell-3-10" aria-hidden="true" tabindex="-1"></a>}</span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="7" data-code-annotation="1">Request a GPU adapter (the physical GPU).</span>
</dd>
</dl>
<aside class="notes">
<p>Key contracts: navigator.gpu, adapter-&gt;device, canvas.getContext(“webgpu”), getPreferredCanvasFormat(). Mention single device driving multiple canvases.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="check-support-and-prepare-canvas-1" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Check support and prepare canvas (1)</h2>
<div class="sourceCode" id="annotated-cell-4"><pre class="sourceCode html code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode html hljs"><span id="annotated-cell-4-1" class="hljs-ln-code"><a href="#annotated-cell-4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">canvas</span><span class="ot"> id</span><span class="op">=</span><span class="st">"gfx"</span><span class="ot"> width</span><span class="op">=</span><span class="st">"512"</span><span class="ot"> height</span><span class="op">=</span><span class="st">"512"</span><span class="dt">&gt;&lt;/</span><span class="kw">canvas</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-4-2" class="hljs-ln-code"><a href="#annotated-cell-4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">"module"</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-4-3" class="hljs-ln-code"><a href="#annotated-cell-4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="bu">navigator</span><span class="op">.</span><span class="at">gpu</span>) {</span>
<span id="annotated-cell-4-4" class="hljs-ln-code"><a href="#annotated-cell-4-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"WebGPU not supported on this browser."</span>)<span class="op">;</span></span>
<span id="annotated-cell-4-5" class="hljs-ln-code"><a href="#annotated-cell-4-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-4-6" class="hljs-ln-code"><a href="#annotated-cell-4-6" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-4" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-4-7" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> adapter <span class="op">=</span> <span class="cf">await</span> <span class="bu">navigator</span><span class="op">.</span><span class="at">gpu</span><span class="op">.</span><span class="fu">requestAdapter</span>()<span class="op">;</span></span>
<span id="annotated-cell-4-8" class="hljs-ln-code"><a href="#annotated-cell-4-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>adapter) {</span>
<span id="annotated-cell-4-9" class="hljs-ln-code"><a href="#annotated-cell-4-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"No appropriate GPUAdapter found."</span>)<span class="op">;</span></span>
<span id="annotated-cell-4-10" class="hljs-ln-code"><a href="#annotated-cell-4-10" aria-hidden="true" tabindex="-1"></a>}</span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-4" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-4-11" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-4-11" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> device <span class="op">=</span> <span class="cf">await</span> adapter<span class="op">.</span><span class="fu">requestDevice</span>()<span class="op">;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="7" data-code-annotation="1">Request a GPU adapter (the physical GPU).</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="11" data-code-annotation="2">Request a logical device from the adapter.</span>
</dd>
</dl>
<aside class="notes">
<p>Key contracts: navigator.gpu, adapter-&gt;device, canvas.getContext(“webgpu”), getPreferredCanvasFormat(). Mention single device driving multiple canvases.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="check-support-and-prepare-canvas" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Check support and prepare canvas</h2>
<div class="sourceCode" id="annotated-cell-5"><pre class="sourceCode html code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode html hljs"><span id="annotated-cell-5-1" class="hljs-ln-code"><a href="#annotated-cell-5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">canvas</span><span class="ot"> id</span><span class="op">=</span><span class="st">"gfx"</span><span class="ot"> width</span><span class="op">=</span><span class="st">"512"</span><span class="ot"> height</span><span class="op">=</span><span class="st">"512"</span><span class="dt">&gt;&lt;/</span><span class="kw">canvas</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-5-2" class="hljs-ln-code"><a href="#annotated-cell-5-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> type=</span><span class="st">"module"</span><span class="dt">&gt;</span></span>
<span id="annotated-cell-5-3" class="hljs-ln-code"><a href="#annotated-cell-5-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="bu">navigator</span><span class="op">.</span><span class="at">gpu</span>) {</span>
<span id="annotated-cell-5-4" class="hljs-ln-code"><a href="#annotated-cell-5-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"WebGPU not supported on this browser."</span>)<span class="op">;</span></span>
<span id="annotated-cell-5-5" class="hljs-ln-code"><a href="#annotated-cell-5-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-5-6" class="hljs-ln-code"><a href="#annotated-cell-5-6" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-5" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-5-7" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> adapter <span class="op">=</span> <span class="cf">await</span> <span class="bu">navigator</span><span class="op">.</span><span class="at">gpu</span><span class="op">.</span><span class="fu">requestAdapter</span>()<span class="op">;</span></span>
<span id="annotated-cell-5-8" class="hljs-ln-code"><a href="#annotated-cell-5-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="op">!</span>adapter) {</span>
<span id="annotated-cell-5-9" class="hljs-ln-code"><a href="#annotated-cell-5-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="st">"No appropriate GPUAdapter found."</span>)<span class="op">;</span></span>
<span id="annotated-cell-5-10" class="hljs-ln-code"><a href="#annotated-cell-5-10" aria-hidden="true" tabindex="-1"></a>}</span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-5" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-5-11" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> device <span class="op">=</span> <span class="cf">await</span> adapter<span class="op">.</span><span class="fu">requestDevice</span>()<span class="op">;</span></span>
<span id="annotated-cell-5-12" class="hljs-ln-code"><a href="#annotated-cell-5-12" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-5" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-5-13" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-5-13" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> canvas <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">"gfx"</span>)<span class="op">;</span></span>
<span id="annotated-cell-5-14" class="hljs-ln-code"><a href="#annotated-cell-5-14" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> context <span class="op">=</span> canvas<span class="op">.</span><span class="fu">getContext</span>(<span class="st">"webgpu"</span>)<span class="op">;</span></span>
<span id="annotated-cell-5-15" class="hljs-ln-code"><a href="#annotated-cell-5-15" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> canvasFormat <span class="op">=</span> <span class="bu">navigator</span><span class="op">.</span><span class="at">gpu</span><span class="op">.</span><span class="fu">getPreferredCanvasFormat</span>()<span class="op">;</span></span>
<span id="annotated-cell-5-16" class="hljs-ln-code"><a href="#annotated-cell-5-16" aria-hidden="true" tabindex="-1"></a>context<span class="op">.</span><span class="fu">configure</span>({ device<span class="op">,</span> <span class="dt">format</span><span class="op">:</span> canvasFormat })<span class="op">;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="7" data-code-annotation="1">Request a GPU adapter (the physical GPU).</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="11" data-code-annotation="2">Request a logical device from the adapter.</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="13" data-code-annotation="3">Get the WebGPU context from the canvas and configure it with the device and preferred format.</span>
</dd>
</dl>
<aside class="notes">
<p>Key contracts: navigator.gpu, adapter-&gt;device, canvas.getContext(“webgpu”), getPreferredCanvasFormat(). Mention single device driving multiple canvases.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="clear-the-canvas-5" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Clear the canvas (5)</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode js code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb3-1" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> encoder <span class="op">=</span> device<span class="op">.</span><span class="fu">createCommandEncoder</span>()<span class="op">;</span> <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">1</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li>Create a command encoder to record GPU commands.</li>
</ol>
<aside class="notes">
<p>In order to do that—or pretty much anything else in WebGPU—you need to provide some commands to the GPU instructing it what to do.</p>
<p>To do this, have the device create a <code>GPUCommandEncoder</code>, which provides an interface for recording GPU commands.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="clear-the-canvas-4" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Clear the canvas (4)</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode js code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb4-1" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> encoder <span class="op">=</span> device<span class="op">.</span><span class="fu">createCommandEncoder</span>()<span class="op">;</span> <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">1</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span>
<span id="cb4-2" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> pass <span class="op">=</span> encoder<span class="op">.</span><span class="fu">beginRenderPass</span>({ <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">2</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span>
<span id="cb4-3" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">colorAttachments</span><span class="op">:</span> [{</span>
<span id="cb4-4" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">view</span><span class="op">:</span> context<span class="op">.</span><span class="fu">getCurrentTexture</span>()<span class="op">.</span><span class="fu">createView</span>()<span class="op">,</span></span>
<span id="cb4-5" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">loadOp</span><span class="op">:</span> <span class="st">"clear"</span><span class="op">,</span></span>
<span id="cb4-6" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">storeOp</span><span class="op">:</span> <span class="st">"store"</span><span class="op">,</span></span>
<span id="cb4-7" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>  }]<span class="op">,</span></span>
<span id="cb4-8" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li>Create a command encoder to record GPU commands.</li>
<li>Begin a render pass with a color attachment that clears the canvas to dark blue.</li>
</ol>
<aside class="notes">
<ul>
<li><p>Render passes in WebGPU execute all drawing commands.</p></li>
<li><p>Each pass starts with <code>beginRenderPass()</code>, specifying output textures.</p></li>
<li><p>For this app, a single color attachment is used: <code>context.getCurrentTexture()</code>.</p></li>
<li><p>The attachment matches the canvas size and format.</p></li>
<li><p>The <code>colorAttachment</code> requires a <code>GPUTextureView</code> (not <code>GPUTexture</code>); use createView() to get it.</p></li>
<li><p><code>loadOp</code>: “clear” clears the texture at the start of the render pass.</p></li>
<li><p><code>storeOp</code>: “store” saves the results after the render pass ends.</p></li>
<li><p>Starting the render pass with <code>loadOp</code>: “clear” is enough to clear the canvas, even if no drawing commands are issued.</p></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="clear-the-canvas-3" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Clear the canvas (3)</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode js code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb5-1" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> encoder <span class="op">=</span> device<span class="op">.</span><span class="fu">createCommandEncoder</span>()<span class="op">;</span> <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">1</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span>
<span id="cb5-2" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> pass <span class="op">=</span> encoder<span class="op">.</span><span class="fu">beginRenderPass</span>({ <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">2</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span>
<span id="cb5-3" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">colorAttachments</span><span class="op">:</span> [{</span>
<span id="cb5-4" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">view</span><span class="op">:</span> context<span class="op">.</span><span class="fu">getCurrentTexture</span>()<span class="op">.</span><span class="fu">createView</span>()<span class="op">,</span></span>
<span id="cb5-5" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">loadOp</span><span class="op">:</span> <span class="st">"clear"</span><span class="op">,</span></span>
<span id="cb5-6" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">storeOp</span><span class="op">:</span> <span class="st">"store"</span><span class="op">,</span></span>
<span id="cb5-7" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  }]<span class="op">,</span></span>
<span id="cb5-8" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb5-9" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>pass<span class="op">.</span><span class="fu">end</span>()<span class="op">;</span> <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">3</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li>Create a command encoder to record GPU commands.</li>
<li>Begin a render pass with a color attachment that clears the canvas to dark blue.</li>
<li>End the render pass.</li>
</ol>
<aside class="notes">
<ul>
<li>These calls only record commands; the GPU does nothing yet.</li>
<li>Commands are stored in a command encoder for later execution.</li>
<li>You must finish recording and submit the command buffer to actually run them.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="clear-the-canvas-2" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Clear the canvas (2)</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode js code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb6-1" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> encoder <span class="op">=</span> device<span class="op">.</span><span class="fu">createCommandEncoder</span>()<span class="op">;</span> <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">1</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span>
<span id="cb6-2" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> pass <span class="op">=</span> encoder<span class="op">.</span><span class="fu">beginRenderPass</span>({ <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">2</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span>
<span id="cb6-3" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">colorAttachments</span><span class="op">:</span> [{</span>
<span id="cb6-4" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">view</span><span class="op">:</span> context<span class="op">.</span><span class="fu">getCurrentTexture</span>()<span class="op">.</span><span class="fu">createView</span>()<span class="op">,</span></span>
<span id="cb6-5" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">loadOp</span><span class="op">:</span> <span class="st">"clear"</span><span class="op">,</span></span>
<span id="cb6-6" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">storeOp</span><span class="op">:</span> <span class="st">"store"</span><span class="op">,</span></span>
<span id="cb6-7" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  }]<span class="op">,</span></span>
<span id="cb6-8" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-9" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>pass<span class="op">.</span><span class="fu">end</span>()<span class="op">;</span> <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">3</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span>
<span id="cb6-10" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> commandBuffer <span class="op">=</span> encoder<span class="op">.</span><span class="fu">finish</span>()<span class="op">;</span> <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">4</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li>Create a command encoder to record GPU commands.</li>
<li>Begin a render pass with a color attachment that clears the canvas to dark blue.</li>
<li>End the render pass.</li>
<li>Finish recording commands and get a command buffer.</li>
</ol>
<aside class="notes">
<ul>
<li>These calls only record commands; the GPU does nothing yet.</li>
<li>Call <code>finish()</code> on the encoder to create a <code>GPUCommandBuffer</code>.</li>
<li>The command buffer is an opaque handle to the recorded commands.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="clear-the-canvas-1" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Clear the canvas (1)</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode js code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb7-1" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> encoder <span class="op">=</span> device<span class="op">.</span><span class="fu">createCommandEncoder</span>()<span class="op">;</span></span>
<span id="cb7-2" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> pass <span class="op">=</span> encoder<span class="op">.</span><span class="fu">beginRenderPass</span>({</span>
<span id="cb7-3" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">colorAttachments</span><span class="op">:</span> [{</span>
<span id="cb7-4" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">view</span><span class="op">:</span> context<span class="op">.</span><span class="fu">getCurrentTexture</span>()<span class="op">.</span><span class="fu">createView</span>()<span class="op">,</span></span>
<span id="cb7-5" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">loadOp</span><span class="op">:</span> <span class="st">"clear"</span><span class="op">,</span></span>
<span id="cb7-6" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">storeOp</span><span class="op">:</span> <span class="st">"store"</span><span class="op">,</span></span>
<span id="cb7-7" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  }]<span class="op">,</span></span>
<span id="cb7-8" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb7-9" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>pass<span class="op">.</span><span class="fu">end</span>()<span class="op">;</span></span>
<span id="cb7-10" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> commandBuffer <span class="op">=</span> encoder<span class="op">.</span><span class="fu">finish</span>()<span class="op">;</span> <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">4</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span>
<span id="cb7-11" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">submit</span>([commandBuffer])<span class="op">;</span> <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">5</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li>Create a command encoder to record GPU commands.</li>
<li>Begin a render pass with a color attachment that clears the canvas to dark blue.</li>
<li>End the render pass.</li>
<li>Finish recording commands and get a command buffer.</li>
<li>Submit the command buffer to the GPU queue for execution.</li>
</ol>
<aside class="notes">
<ul>
<li>Submit the command buffer to the GPU using <code>device.queue.submit()</code>.</li>
<li>The queue executes GPU commands in order and synchronizes them.</li>
<li><code>submit()</code> accepts an array of command buffers; here, only one is used.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="clear-the-canvas" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Clear the canvas</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode js code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb8-1" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> encoder <span class="op">=</span> device<span class="op">.</span><span class="fu">createCommandEncoder</span>()<span class="op">;</span> <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">1</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span>
<span id="cb8-2" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> pass <span class="op">=</span> encoder<span class="op">.</span><span class="fu">beginRenderPass</span>({ <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">2</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span>
<span id="cb8-3" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">colorAttachments</span><span class="op">:</span> [{</span>
<span id="cb8-4" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">view</span><span class="op">:</span> context<span class="op">.</span><span class="fu">getCurrentTexture</span>()<span class="op">.</span><span class="fu">createView</span>()<span class="op">,</span></span>
<span id="cb8-5" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">loadOp</span><span class="op">:</span> <span class="st">"clear"</span><span class="op">,</span></span>
<span id="cb8-6" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">storeOp</span><span class="op">:</span> <span class="st">"store"</span><span class="op">,</span></span>
<span id="cb8-7" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  }]<span class="op">,</span></span>
<span id="cb8-8" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb8-9" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>pass<span class="op">.</span><span class="fu">end</span>()<span class="op">;</span> <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">3</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span>
<span id="cb8-10" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">// Finish the command buffer and immediately submit it.</span></span>
<span id="cb8-11" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">submit</span>([cencoder<span class="op">.</span><span class="fu">finish</span>()])<span class="op">;</span> <span class="op">&lt;!--</span> <span class="op">&lt;</span><span class="dv">4</span><span class="op">&gt;</span> <span class="op">--&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li>Create a command encoder to record GPU commands.</li>
<li>Begin a render pass with a color attachment that clears the canvas to dark blue.</li>
<li>End the render pass.</li>
<li>Submit the command buffer to the GPU queue for execution.</li>
</ol>
<aside class="notes">
<ul>
<li>Command buffers are single-use; after submission, they cannot be reused.</li>
<li>To issue more GPU commands, create and submit a new command buffer.</li>
<li>Common practice is to create and submit the command buffer in one step, as shown in the sample code.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="clear-the-canvas---result-1" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Clear the canvas - Result (1)</h2>
<p>Add a color to the clear operation</p>
<details class="code-fold hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb9" data-startfrom="453" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 452;"><span id="cb9-453"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">renderToCanvas</span>({ <span class="dt">width</span><span class="op">:</span> <span class="dv">512</span><span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">512</span> })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="quarto-layout-panel" data-layout="[[60,-10,30]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" data-id="code1" style="flex-basis: 60.0%;justify-content: flex-start;">
<div class="sourceCode" id="cb10"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb10-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> pass <span class="op">=</span> encoder<span class="op">.</span><span class="fu">beginRenderPass</span>({</span>
<span id="cb10-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">colorAttachments</span><span class="op">:</span> [{</span>
<span id="cb10-3"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">view</span><span class="op">:</span> context<span class="op">.</span><span class="fu">getCurrentTexture</span>()<span class="op">.</span><span class="fu">createView</span>()<span class="op">,</span></span>
<span id="cb10-4"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">loadOp</span><span class="op">:</span> <span class="st">"clear"</span><span class="op">,</span></span>
<span id="cb10-5"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">storeOp</span><span class="op">:</span> <span class="st">"store"</span><span class="op">,</span></span>
<span id="cb10-6"><a href="" aria-hidden="true" tabindex="-1"></a>  }]<span class="op">,</span></span>
<span id="cb10-7"><a href="" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 10.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" data-id="ojs1" style="flex-basis: 30.0%;justify-content: flex-start;">
<div class="cell">
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="clear-the-canvas---result" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Clear the canvas - Result</h2>
<p>Add a color to the clear operation</p>
<details class="code-fold hidden">
<summary>Code</summary>
<div class="sourceCode cell-code hidden" id="cb11" data-startfrom="486" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 485;"><span id="cb11-486"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">renderToCanvas</span>({</span>
<span id="cb11-487"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">512</span><span class="op">,</span></span>
<span id="cb11-488"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">height</span><span class="op">:</span> <span class="dv">512</span><span class="op">,</span></span>
<span id="cb11-489"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">clearColor</span><span class="op">:</span> [<span class="fl">0.02</span><span class="op">,</span> <span class="fl">0.06</span><span class="op">,</span> <span class="fl">0.15</span><span class="op">,</span> <span class="fl">1.0</span>]</span>
<span id="cb11-490"><a href="" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="quarto-layout-panel" data-layout="[[60,-10,30]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" data-id="code1" style="flex-basis: 60.0%;justify-content: flex-start;">
<div class="sourceCode" id="annotated-cell-49"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated"><code class="sourceCode javascript"><span id="annotated-cell-49-1"><a href="#annotated-cell-49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> pass <span class="op">=</span> encoder<span class="op">.</span><span class="fu">beginRenderPass</span>({</span>
<span id="annotated-cell-49-2"><a href="#annotated-cell-49-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">colorAttachments</span><span class="op">:</span> [{</span>
<span id="annotated-cell-49-3"><a href="#annotated-cell-49-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">view</span><span class="op">:</span> context<span class="op">.</span><span class="fu">getCurrentTexture</span>()<span class="op">.</span><span class="fu">createView</span>()<span class="op">,</span></span>
<span id="annotated-cell-49-4"><a href="#annotated-cell-49-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">loadOp</span><span class="op">:</span> <span class="st">"clear"</span><span class="op">,</span></span>
<span id="annotated-cell-49-5"><a href="#annotated-cell-49-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">storeOp</span><span class="op">:</span> <span class="st">"store"</span><span class="op">,</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-49" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-49-6" class="code-annotation-target"><a href="#annotated-cell-49-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clearValue</span><span class="op">:</span> { <span class="dt">r</span><span class="op">:</span> <span class="fl">0.02</span><span class="op">,</span> <span class="dt">g</span><span class="op">:</span> <span class="fl">0.06</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span> <span class="fl">0.15</span><span class="op">,</span> <span class="dt">a</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="annotated-cell-49-7"><a href="#annotated-cell-49-7" aria-hidden="true" tabindex="-1"></a>  }]<span class="op">,</span></span>
<span id="annotated-cell-49-8"><a href="#annotated-cell-49-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-49" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-49" data-code-lines="6" data-code-annotation="1">Dark blue RGBA clear color.</span>
</dd>
</dl>
</div>
<div class="quarto-figure-spacer quarto-layout-cell" style="flex-basis: 10.0%;justify-content: flex-start;">
<p>&nbsp;</p>
</div>
<div class="quarto-layout-cell" data-id="ojs1" style="flex-basis: 30.0%;justify-content: flex-start;">
<div class="cell">
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="draw-geometry" class="title-slide slide level1 center">
<h1>Draw geometry</h1>

</section>
<section id="coordinate-system" class="slide level2 center">
<h2>Coordinate system</h2>
<div class="quarto-layout-panel" data-layout="[[70,30]]">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 70.0%;justify-content: flex-start;">
<ul>
<li class="fragment">🟦 GPUs mainly draw triangles (primitives: points, lines, triangles)</li>
<li class="fragment">📐 Vertices define triangle corners in X, Y (and Z for 3D) coordinates</li>
<li class="fragment">🗺️ WebGPU uses “clip space”: X/Y range from -1 (left/bottom) to +1 (right/top), center is (0,0)</li>
<li class="fragment">🧮 Vertex shaders transform vertices to clip space and apply effects</li>
<li class="fragment">🎨 Fragment shaders decide pixel colors for each triangle</li>
<li class="fragment">🖼️ Final result is shown on screen as a texture</li>
<li class="fragment">🕹️ You control the math and effects via shaders!</li>
</ul>
</div>
<div class="quarto-layout-cell" style="flex-basis: 30.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="../images/axes1-transparent.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="coordinate-system-1" class="slide level2 center">
<h2>Coordinate system (1)</h2>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<ul>
<li class="fragment">🟩 Game of Life grid: visualize cells as colored squares (active) or empty (inactive)</li>
<li class="fragment">🟦 Each square needs 4 corner points (coordinates in normalized device space)</li>
<li class="fragment">🧮 Use TypedArrays (e.g., Float32Array) to store vertex positions for the GPU</li>
<li class="fragment">💡 TypedArrays ensure correct memory layout for GPU APIs like WebGPU</li>
<li class="fragment">📌 Place the vertex array declaration near the top, after context.configure()</li>
</ul>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="../images/axes2-transparent.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="define-vertices-two-triangles-one-square" class="slide level2 center">
<h2>Define vertices (two triangles = one square)</h2>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="sourceCode" id="cb12"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb12-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">//   X,    Y</span></span>
<span id="cb12-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> vertices <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float32Array</span>([</span>
<span id="cb12-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span><span class="fl">0.8</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.8</span><span class="op">,</span>  <span class="co">// tri1</span></span>
<span id="cb12-4"><a href="" aria-hidden="true" tabindex="-1"></a>   <span class="fl">0.8</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.8</span><span class="op">,</span></span>
<span id="cb12-5"><a href="" aria-hidden="true" tabindex="-1"></a>   <span class="fl">0.8</span><span class="op">,</span>  <span class="fl">0.8</span><span class="op">,</span></span>
<span id="cb12-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span><span class="fl">0.8</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.8</span><span class="op">,</span>  <span class="co">// tri2</span></span>
<span id="cb12-7"><a href="" aria-hidden="true" tabindex="-1"></a>   <span class="fl">0.8</span><span class="op">,</span>  <span class="fl">0.8</span><span class="op">,</span></span>
<span id="cb12-8"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span><span class="fl">0.8</span><span class="op">,</span>  <span class="fl">0.8</span><span class="op">,</span></span>
<span id="cb12-9"><a href="" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<ul>
<li class="fragment">🧩 Index Buffers let you reuse vertex data by specifying which vertices form triangles.</li>
<li class="fragment">✏️ Avoids duplicating vertex coordinates—just “connect the dots” using indices.</li>
<li class="fragment">🚦 Useful for complex shapes, but skipped here for simplicity.</li>
<li class="fragment">📚 Recommended for advanced geometry in real-world apps.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="../images/axes3-transparent.png" class="quarto-figure quarto-figure-center"></p>
</figure>
</div>
</div>
</div>
</div>
<aside class="notes">
<p>GPU draws triangles; duplicate two corners to make two triangles for one quad. Clip space coordinates [-1,1].</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="create-a-vertex-buffer-2" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Create a vertex buffer (2)</h2>
<div class="sourceCode" id="annotated-cell-12"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-12" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-12-1" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> vertexBuffer <span class="op">=</span> device<span class="op">.</span><span class="fu">createBuffer</span>({</span>
<span id="annotated-cell-12-2" class="hljs-ln-code"><a href="#annotated-cell-12-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell vertices"</span><span class="op">,</span></span>
<span id="annotated-cell-12-3" class="hljs-ln-code"><a href="#annotated-cell-12-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">size</span><span class="op">:</span> vertices<span class="op">.</span><span class="at">byteLength</span><span class="op">,</span></span>
<span id="annotated-cell-12-4" class="hljs-ln-code"><a href="#annotated-cell-12-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">usage</span><span class="op">:</span> GPUBufferUsage<span class="op">.</span><span class="at">VERTEX</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span><span class="op">,</span></span>
<span id="annotated-cell-12-5" class="hljs-ln-code"><a href="#annotated-cell-12-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="annotated-cell-12-6" class="hljs-ln-code"><a href="#annotated-cell-12-6" aria-hidden="true" tabindex="-1"></a>device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">writeBuffer</span>(vertexBuffer<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> vertices)<span class="op">;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-12" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="1" data-code-annotation="1">GPU buffer in device-visible memory</span>
</dd>
</dl>
<aside class="notes">
<ul>
<li>🖥️ GPU can’t use JavaScript arrays directly for drawing.</li>
<li>📦 Use <code>GPUBuffer</code> objects to store data in GPU memory.</li>
<li>🚀 Buffers are optimized for fast GPU access and flagged for specific uses.</li>
<li>🧮 Think of <code>GPUBuffer</code> as a GPU-visible <code>TypedArray</code>.</li>
<li>🛠️ Create a buffer with <code>device.createBuffer()</code> after defining your vertex array.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="create-a-vertex-buffer-1" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Create a vertex buffer (1)</h2>
<div class="sourceCode" id="annotated-cell-13"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-13" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-13-1" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> vertexBuffer <span class="op">=</span> device<span class="op">.</span><span class="fu">createBuffer</span>({</span>
<span id="annotated-cell-13-2" class="hljs-ln-code"><a href="#annotated-cell-13-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell vertices"</span><span class="op">,</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-13" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-13-3" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-13-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">size</span><span class="op">:</span> vertices<span class="op">.</span><span class="at">byteLength</span><span class="op">,</span></span>
<span id="annotated-cell-13-4" class="hljs-ln-code"><a href="#annotated-cell-13-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">usage</span><span class="op">:</span> GPUBufferUsage<span class="op">.</span><span class="at">VERTEX</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span><span class="op">,</span></span>
<span id="annotated-cell-13-5" class="hljs-ln-code"><a href="#annotated-cell-13-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="annotated-cell-13-6" class="hljs-ln-code"><a href="#annotated-cell-13-6" aria-hidden="true" tabindex="-1"></a>device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">writeBuffer</span>(vertexBuffer<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> vertices)<span class="op">;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-13" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="1" data-code-annotation="1">GPU buffer in device-visible memory</span>
</dd>
<dt data-target-cell="annotated-cell-13" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-13" data-code-lines="3" data-code-annotation="2">Exact byte size from TypedArray.byteLength</span>
</dd>
</dl>
<aside class="notes">
<ul>
<li>Assign a descriptive label to every WebGPU object for easier debugging.</li>
<li>Specify the buffer size in bytes; use <code>TypedArray.byteLength</code> for accuracy.</li>
<li>For vertex buffers, size equals number of floats × 4 (bytes per float).</li>
<li>Labels appear in error messages, helping identify issues quickly.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="create-a-vertex-buffer" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Create a vertex buffer</h2>
<div class="sourceCode" id="annotated-cell-14"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-14" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-14-1" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> vertexBuffer <span class="op">=</span> device<span class="op">.</span><span class="fu">createBuffer</span>({</span>
<span id="annotated-cell-14-2" class="hljs-ln-code"><a href="#annotated-cell-14-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell vertices"</span><span class="op">,</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-14" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-14-3" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-14-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">size</span><span class="op">:</span> vertices<span class="op">.</span><span class="at">byteLength</span><span class="op">,</span></span>
<span id="annotated-cell-14-4" class="hljs-ln-code"><a href="#annotated-cell-14-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">usage</span><span class="op">:</span> GPUBufferUsage<span class="op">.</span><span class="at">VERTEX</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span><span class="op">,</span></span>
<span id="annotated-cell-14-5" class="hljs-ln-code"><a href="#annotated-cell-14-5" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-14" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-14-6" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-14-6" aria-hidden="true" tabindex="-1"></a>device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">writeBuffer</span>(vertexBuffer<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> vertices)<span class="op">;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-14" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="1" data-code-annotation="1">GPU buffer in device-visible memory</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="3" data-code-annotation="2">Exact byte size from TypedArray.byteLength</span>
</dd>
<dt data-target-cell="annotated-cell-14" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-14" data-code-lines="6" data-code-annotation="3">Upload vertex data from CPU to GPU</span>
</dd>
</dl>
<aside class="notes">
<ul>
<li>Use <code>GPUBufferUsage</code> flags to specify buffer purpose (e.g., <code>VERTEX</code>, <code>COPY_DST</code>).</li>
<li><code>GPUBuffer</code> objects are opaque and mostly immutable (size and usage can’t change).</li>
<li>Buffer memory is zero-initialized on creation.</li>
<li>Update buffer contents using <code>device.queue.writeBuffer()</code> with a <code>TypedArray</code>.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="byte-sized-maths" class="slide level2 center">
<h2>Byte-sized maths</h2>
<ul>
<li>Float32Array: 4 bytes per float</li>
<li>vertices.length = 12 (6 vertices × 2 components)</li>
<li>vertices.byteLength = 48 (12 × 4 bytes)</li>
</ul>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Important</strong></p>
</div>
<div class="callout-content">
<p>Get comfortable with this kind of byte-size math. Working with a GPU requires a fair amount of it!</p>
</div>
</div>
</div>
</section>
<section id="describe-vertex-layout-2" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Describe vertex layout (2)</h2>
<div class="sourceCode" id="annotated-cell-15"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="annotated-cell-15-1" class="hljs-ln-code"><a href="#annotated-cell-15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> vertexBufferLayout <span class="op">=</span> {</span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-15" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-15-2" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-15-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">arrayStride</span><span class="op">:</span> <span class="dv">2</span> <span class="op">*</span> <span class="dv">4</span><span class="op">,</span> <span class="co">// 2 float32 per vertex</span></span>
<span id="annotated-cell-15-3" class="hljs-ln-code"><a href="#annotated-cell-15-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">attributes</span><span class="op">:</span> [{</span>
<span id="annotated-cell-15-4" class="hljs-ln-code"><a href="#annotated-cell-15-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">shaderLocation</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="annotated-cell-15-5" class="hljs-ln-code"><a href="#annotated-cell-15-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">offset</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="annotated-cell-15-6" class="hljs-ln-code"><a href="#annotated-cell-15-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> <span class="st">"float32x2"</span><span class="op">,</span></span>
<span id="annotated-cell-15-7" class="hljs-ln-code"><a href="#annotated-cell-15-7" aria-hidden="true" tabindex="-1"></a>  }]<span class="op">,</span></span>
<span id="annotated-cell-15-8" class="hljs-ln-code"><a href="#annotated-cell-15-8" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-15" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-15" data-code-lines="2" data-code-annotation="1">Stride in bytes between successive vertices</span>
</dd>
</dl>
<aside class="notes">
<ul>
<li>Define vertex layout using <code>GPUVertexBufferLayout</code>.</li>
<li><code>arrayStride</code> specifies the byte distance between vertices (2 floats × 4 bytes = 8 bytes).</li>
<li>Each vertex consists of two 32-bit floats (x, y).</li>
<li>This layout tells WebGPU how to interpret buffer data for the vertex shader.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="describe-vertex-layout-1" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Describe vertex layout (1)</h2>
<div class="sourceCode" id="annotated-cell-16"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="annotated-cell-16-1" class="hljs-ln-code"><a href="#annotated-cell-16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> vertexBufferLayout <span class="op">=</span> {</span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-16" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-16-2" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-16-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">arrayStride</span><span class="op">:</span> <span class="dv">2</span> <span class="op">*</span> <span class="dv">4</span><span class="op">,</span> <span class="co">// 2 float32 per vertex</span></span>
<span id="annotated-cell-16-3" class="hljs-ln-code"><a href="#annotated-cell-16-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">attributes</span><span class="op">:</span> [{</span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-16" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-16-4" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-16-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">shaderLocation</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="annotated-cell-16-5" class="hljs-ln-code"><a href="#annotated-cell-16-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">offset</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="annotated-cell-16-6" class="hljs-ln-code"><a href="#annotated-cell-16-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> <span class="st">"float32x2"</span><span class="op">,</span></span>
<span id="annotated-cell-16-7" class="hljs-ln-code"><a href="#annotated-cell-16-7" aria-hidden="true" tabindex="-1"></a>  }]<span class="op">,</span></span>
<span id="annotated-cell-16-8" class="hljs-ln-code"><a href="#annotated-cell-16-8" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-16" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="2" data-code-annotation="1">Stride in bytes between successive vertices</span>
</dd>
<dt data-target-cell="annotated-cell-16" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-16" data-code-lines="4" data-code-annotation="2">Matches <code>@location(0)</code> in the vertex shader</span>
</dd>
</dl>
<aside class="notes">
<ul>
<li><code>shaderLocation</code> links a buffer attribute to a vertex shader input.</li>
<li>Must be a unique number (0-15) for each attribute.</li>
<li>Defines how vertex data maps to shader variables.</li>
<li>Values are set now, but used when creating the pipeline.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="describe-vertex-layout" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Describe vertex layout</h2>
<div class="sourceCode" id="annotated-cell-17"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="annotated-cell-17-1" class="hljs-ln-code"><a href="#annotated-cell-17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> vertexBufferLayout <span class="op">=</span> {</span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-17" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-17-2" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-17-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">arrayStride</span><span class="op">:</span> <span class="dv">2</span> <span class="op">*</span> <span class="dv">4</span><span class="op">,</span> <span class="co">// 2 float32 per vertex</span></span>
<span id="annotated-cell-17-3" class="hljs-ln-code"><a href="#annotated-cell-17-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">attributes</span><span class="op">:</span> [{</span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-17" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-17-4" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-17-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">shaderLocation</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="annotated-cell-17-5" class="hljs-ln-code"><a href="#annotated-cell-17-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">offset</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-17" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-17-6" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-17-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> <span class="st">"float32x2"</span><span class="op">,</span></span>
<span id="annotated-cell-17-7" class="hljs-ln-code"><a href="#annotated-cell-17-7" aria-hidden="true" tabindex="-1"></a>  }]<span class="op">,</span></span>
<span id="annotated-cell-17-8" class="hljs-ln-code"><a href="#annotated-cell-17-8" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-17" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="2" data-code-annotation="1">Stride in bytes between successive vertices</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="4" data-code-annotation="2">Matches <code>@location(0)</code> in the vertex shader</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="6" data-code-annotation="3">Two float32 values per vertex (x,y)</span>
</dd>
</dl>
<aside class="notes">
<ul>
<li>The attributes array defines how each piece of vertex data is mapped for the GPU.</li>
<li>Each attribute specifies its format (e.g., “float32x2” for two 32-bit floats).</li>
<li>The offset indicates where in the vertex structure the attribute starts (important for multiple attributes).</li>
<li>This example uses a single attribute for position; more complex cases may include color, normals, etc.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="shaders-wgsl" class="title-slide slide level1 center">
<h1>Shaders (WGSL)</h1>

</section>
<section id="vertex-shader-5" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Vertex shader (5)</h2>
<div class="sourceCode" id="annotated-cell-18"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-18" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-18-1" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cellShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="annotated-cell-18-2" class="hljs-ln-code"><a href="#annotated-cell-18-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell shader"</span><span class="op">,</span></span>
<span id="annotated-cell-18-3" class="hljs-ln-code"><a href="#annotated-cell-18-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="annotated-cell-18-4" class="hljs-ln-code"><a href="#annotated-cell-18-4" aria-hidden="true" tabindex="-1"></a><span class="vs">    // Your shader code will go here </span></span>
<span id="annotated-cell-18-5" class="hljs-ln-code"><a href="#annotated-cell-18-5" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span></span>
<span id="annotated-cell-18-6" class="hljs-ln-code"><a href="#annotated-cell-18-6" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-18" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-18" data-code-lines="1,3" data-code-annotation="1">Create a shader module from WGSL code</span>
</dd>
</dl>
<aside class="notes">
<ul>
<li>Shaders are small GPU programs for vertex, fragment, or compute stages.</li>
<li>WebGPU shaders use WGSL (WebGPU Shading Language), similar to Rust.</li>
<li>Shaders are provided as strings and compiled via <code>device.createShaderModule()</code>.</li>
<li>WGSL enforces strict typing and cross-platform compatibility.</li>
<li>Shader compiler errors are common but provide detailed messages in the console.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="vertex-shader-4" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Vertex shader (4)</h2>
<div class="sourceCode" id="annotated-cell-19"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="annotated-cell-19-1" class="hljs-ln-code"><a href="#annotated-cell-19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cellShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="annotated-cell-19-2" class="hljs-ln-code"><a href="#annotated-cell-19-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell shader"</span><span class="op">,</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-19" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-19-3" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-19-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="annotated-cell-19-4" class="hljs-ln-code"><a href="#annotated-cell-19-4" aria-hidden="true" tabindex="-1"></a><span class="vs">    @vertex</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-19" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-19-5" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-19-5" aria-hidden="true" tabindex="-1"></a><span class="vs">    fn vertexMain() {</span></span>
<span id="annotated-cell-19-6" class="hljs-ln-code"><a href="#annotated-cell-19-6" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="annotated-cell-19-7" class="hljs-ln-code"><a href="#annotated-cell-19-7" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">,</span></span>
<span id="annotated-cell-19-8" class="hljs-ln-code"><a href="#annotated-cell-19-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-19" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="3" data-code-annotation="1">Create a shader module from WGSL code</span>
</dd>
<dt data-target-cell="annotated-cell-19" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-19" data-code-lines="5" data-code-annotation="2">Define a vertex shader function marked with <code>@vertex</code></span>
</dd>
</dl>
<aside class="notes">
<ul>
<li>The vertex shader is the first stage of the GPU pipeline and processes each vertex in the vertex buffer.</li>
<li>It runs once per vertex, potentially in parallel, but each invocation only sees one vertex at a time.</li>
<li>Vertex shaders cannot communicate with each other; they only output data for their assigned vertex.</li>
<li>In WGSL, a vertex shader function must be marked with @vertex and return a 4D vector (vec4f) representing the vertex position in clip space.</li>
<li>Vectors (vec2f, vec3f, vec4f) are fundamental types in WGSL for representing positions and other data.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="vertex-shader-3" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Vertex shader (3)</h2>
<div class="sourceCode" id="annotated-cell-20"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="annotated-cell-20-1" class="hljs-ln-code"><a href="#annotated-cell-20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cellShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="annotated-cell-20-2" class="hljs-ln-code"><a href="#annotated-cell-20-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell shader"</span><span class="op">,</span></span>
<span id="annotated-cell-20-3" class="hljs-ln-code"><a href="#annotated-cell-20-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="annotated-cell-20-4" class="hljs-ln-code"><a href="#annotated-cell-20-4" aria-hidden="true" tabindex="-1"></a><span class="vs">    @vertex</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-20" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-20-5" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-20-5" aria-hidden="true" tabindex="-1"></a><span class="vs">    fn vertexMain() -&gt; @builtin(position) vec4f {</span></span>
<span id="annotated-cell-20-6" class="hljs-ln-code"><a href="#annotated-cell-20-6" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="annotated-cell-20-7" class="hljs-ln-code"><a href="#annotated-cell-20-7" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">,</span></span>
<span id="annotated-cell-20-8" class="hljs-ln-code"><a href="#annotated-cell-20-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-20" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="5" data-code-annotation="1">Mark it with the <code>@builtin(position)</code> attribute. A <span class="math inline">\Rightarrow</span> symbol is used to indicate that this is what the function returns.</span>
</dd>
</dl>
<aside class="notes">
<ul>
<li>Vertex shaders must return the final position in clip space as a 4D vector.</li>
<li>WGSL provides vector types: vec2f, vec3f, vec4f.</li>
<li>The output position uses vec4f (x, y, z, w).</li>
<li>Vectors are fundamental types in shader programming.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="vertex-shader-2" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Vertex shader (2)</h2>
<div class="sourceCode" id="annotated-cell-21"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="annotated-cell-21-1" class="hljs-ln-code"><a href="#annotated-cell-21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cellShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="annotated-cell-21-2" class="hljs-ln-code"><a href="#annotated-cell-21-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="annotated-cell-21-3" class="hljs-ln-code"><a href="#annotated-cell-21-3" aria-hidden="true" tabindex="-1"></a><span class="vs">    @vertex</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-21" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-21-4" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-21-4" aria-hidden="true" tabindex="-1"></a><span class="vs">    fn vertexMain() -&gt; @builtin(position) vec4f {</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-21" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-21-5" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-21-5" aria-hidden="true" tabindex="-1"></a><span class="vs">      return vec4f(0, 0, 0, 1);</span></span>
<span id="annotated-cell-21-6" class="hljs-ln-code"><a href="#annotated-cell-21-6" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="annotated-cell-21-7" class="hljs-ln-code"><a href="#annotated-cell-21-7" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">,</span></span>
<span id="annotated-cell-21-8" class="hljs-ln-code"><a href="#annotated-cell-21-8" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-21" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="4" data-code-annotation="1">Mark it with the <code>@builtin(position)</code> attribute. A <span class="math inline">\Rightarrow</span> symbol is used to indicate that this is what the function returns.</span>
</dd>
<dt data-target-cell="annotated-cell-21" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-21" data-code-lines="5" data-code-annotation="2">Return the center of clip space (0,0) with W=1</span>
</dd>
</dl>
<aside class="notes">
<ul>
<li>Vertex shaders must return a vec4f (x, y, z, w) representing position in clip space.</li>
<li>The w component is for homogeneous coordinates; usually set to 1.</li>
<li>For this example, return (0, 0, 0, 1) for a valid but invisible vertex.</li>
<li>The GPU discards triangles that collapse to a single point.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="vertex-shader-1" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Vertex shader (1)</h2>
<div class="sourceCode" id="annotated-cell-22"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="annotated-cell-22-1" class="hljs-ln-code"><a href="#annotated-cell-22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cellShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="annotated-cell-22-2" class="hljs-ln-code"><a href="#annotated-cell-22-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="annotated-cell-22-3" class="hljs-ln-code"><a href="#annotated-cell-22-3" aria-hidden="true" tabindex="-1"></a><span class="vs">    @vertex</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-22" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-22-4" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-22-4" aria-hidden="true" tabindex="-1"></a><span class="vs">    fn vertexMain(@location(0) pos: vec2f) -&gt;</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-22" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-22-5" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-22-5" aria-hidden="true" tabindex="-1"></a><span class="vs">      @builtin(position) vec4f {</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-22" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-22-6" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-22-6" aria-hidden="true" tabindex="-1"></a><span class="vs">      return vec4f(0, 0, 0, 1);</span></span>
<span id="annotated-cell-22-7" class="hljs-ln-code"><a href="#annotated-cell-22-7" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="annotated-cell-22-8" class="hljs-ln-code"><a href="#annotated-cell-22-8" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">,</span></span>
<span id="annotated-cell-22-9" class="hljs-ln-code"><a href="#annotated-cell-22-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-22" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-22" data-code-lines="4" data-code-annotation="1">Mark it with the <code>@builtin(position)</code> attribute. A <span class="math inline">\Rightarrow</span> symbol is used to indicate that this is what the function returns.</span>
</dd>
<dt data-target-cell="annotated-cell-22" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-22" data-code-lines="6" data-code-annotation="2">Return the center of clip space (0,0) with W=1</span>
</dd>
<dt data-target-cell="annotated-cell-22" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-22" data-code-lines="5" data-code-annotation="3">Accept vertex position from buffer at <code>@location(0)</code></span>
</dd>
</dl>
<aside class="notes">
<ul>
<li>To use vertex data from a buffer in your WGSL vertex shader, declare a function argument with a <code>@location()</code> attribute matching the <code>shaderLocation</code> in your <code>vertexBufferLayout</code>.</li>
<li>The argument type should match the buffer format (e.g., float32x2 → vec2f in WGSL).</li>
<li>Name the argument meaningfully (e.g., pos for position).</li>
<li>To output a valid position, return a vec4f using the two position components and set z=0, w=1: return vec4f(pos, 0, 1).</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="vertex-shader" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Vertex shader</h2>
<div class="sourceCode" id="annotated-cell-23"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="annotated-cell-23-1" class="hljs-ln-code"><a href="#annotated-cell-23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cellShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="annotated-cell-23-2" class="hljs-ln-code"><a href="#annotated-cell-23-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="annotated-cell-23-3" class="hljs-ln-code"><a href="#annotated-cell-23-3" aria-hidden="true" tabindex="-1"></a><span class="vs">    @vertex</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-23" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-23-4" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-23-4" aria-hidden="true" tabindex="-1"></a><span class="vs">    fn vertexMain(@location(0) pos: vec2f) -&gt;</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-23" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-23-5" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-23-5" aria-hidden="true" tabindex="-1"></a><span class="vs">      @builtin(position) vec4f {</span></span>
<a class="code-annotation-anchor hljs-ln-code" data-target-cell="annotated-cell-23" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-23-6" class="code-annotation-target hljs-ln-code"><a href="#annotated-cell-23-6" aria-hidden="true" tabindex="-1"></a><span class="vs">      return vec4f(pos, 0, 1);</span></span>
<span id="annotated-cell-23-7" class="hljs-ln-code"><a href="#annotated-cell-23-7" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="annotated-cell-23-8" class="hljs-ln-code"><a href="#annotated-cell-23-8" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">,</span></span>
<span id="annotated-cell-23-9" class="hljs-ln-code"><a href="#annotated-cell-23-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span><div class="code-annotation-gutter-bg hljs-ln-code"></div><div class="code-annotation-gutter hljs-ln-code"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-23" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="4" data-code-annotation="1">Mark it with the <code>@builtin(position)</code> attribute. A <span class="math inline">\Rightarrow</span> symbol is used to indicate that this is what the function returns.</span>
</dd>
<dt data-target-cell="annotated-cell-23" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="6" data-code-annotation="2">Return the center of clip space (0,0) with W=1</span>
</dd>
<dt data-target-cell="annotated-cell-23" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-23" data-code-lines="5" data-code-annotation="3">Accept vertex position from buffer at <code>@location(0)</code></span>
</dd>
</dl>
<aside class="notes">

<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="fragment-shader" class="slide level2 center">
<h2>Fragment shader</h2>
<div class="sourceCode" id="annotated-cell-24"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated"><code class="sourceCode javascript"><span id="annotated-cell-24-1"><a href="#annotated-cell-24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cellShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="annotated-cell-24-2"><a href="#annotated-cell-24-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">code</span><span class="op">:</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="annotated-cell-24-3"><a href="#annotated-cell-24-3" aria-hidden="true" tabindex="-1"></a><span class="vs">    @vertex</span></span>
<span id="annotated-cell-24-4"><a href="#annotated-cell-24-4" aria-hidden="true" tabindex="-1"></a><span class="vs">    fn vertexMain(@location(0) pos: vec2f) -&gt; @builtin(position) vec4f {</span></span>
<span id="annotated-cell-24-5"><a href="#annotated-cell-24-5" aria-hidden="true" tabindex="-1"></a><span class="vs">      return vec4f(pos, 0.0, 1.0);</span></span>
<span id="annotated-cell-24-6"><a href="#annotated-cell-24-6" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="annotated-cell-24-7"><a href="#annotated-cell-24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-24-8"><a href="#annotated-cell-24-8" aria-hidden="true" tabindex="-1"></a><span class="vs">    @fragment</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-24-9" class="code-annotation-target"><a href="#annotated-cell-24-9" aria-hidden="true" tabindex="-1"></a><span class="vs">    fn fragmentMain() -&gt; @location(0) vec4f {</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-24" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-24-10" class="code-annotation-target"><a href="#annotated-cell-24-10" aria-hidden="true" tabindex="-1"></a><span class="vs">      return vec4f(1.0, 0.0, 0.0, 1.0);</span></span>
<span id="annotated-cell-24-11"><a href="#annotated-cell-24-11" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="annotated-cell-24-12"><a href="#annotated-cell-24-12" aria-hidden="true" tabindex="-1"></a><span class="vs">  `</span><span class="op">,</span></span>
<span id="annotated-cell-24-13"><a href="#annotated-cell-24-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-24" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="9" data-code-annotation="1">Output color to <code>colorAttachment</code> 0</span>
</dd>
<dt data-target-cell="annotated-cell-24" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-24" data-code-lines="10" data-code-annotation="2">Solid red</span>
</dd>
</dl>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>You can split your vertex and fragment shaders into separate shader modules.</p>
<p><span class="math inline">\Rightarrow</span> useful if you want to reuse a vertex shader with multiple fragment shaders.</p>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li>Fragment shaders run for every pixel inside drawn triangles, after vertex shaders.</li>
<li>They output a color (vec4f: red, green, blue, alpha) for each pixel.</li>
<li>The <code>@fragment</code> attribute marks a WGSL fragment shader function.</li>
<li>The returned color uses <code>@location(0)</code> to target the first color attachment.</li>
<li>Fragment shaders are highly parallel and flexible in their inputs/outputs.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="render-pipeline-and-draw" class="title-slide slide level1 center">
<h1>Render pipeline and draw</h1>

</section>
<section id="create-pipeline" class="slide level2 center">
<h2>Create pipeline</h2>
<div class="sourceCode" id="annotated-cell-25"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated"><code class="sourceCode javascript"><span id="annotated-cell-25-1"><a href="#annotated-cell-25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cellPipeline <span class="op">=</span> device<span class="op">.</span><span class="fu">createRenderPipeline</span>({</span>
<span id="annotated-cell-25-2"><a href="#annotated-cell-25-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"ellell pipeline"</span><span class="op">,</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-25" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-25-3" class="code-annotation-target"><a href="#annotated-cell-25-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layout</span><span class="op">:</span> <span class="st">"auto"</span><span class="op">,</span></span>
<span id="annotated-cell-25-4"><a href="#annotated-cell-25-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vertex</span><span class="op">:</span> { <span class="dt">module</span><span class="op">:</span> cellShaderModule<span class="op">,</span> <span class="dt">entryPoint</span><span class="op">:</span> <span class="st">"vertexMain"</span><span class="op">,</span></span>
<span id="annotated-cell-25-5"><a href="#annotated-cell-25-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">buffers</span><span class="op">:</span> [vertexBufferLayout] }<span class="op">,</span></span>
<span id="annotated-cell-25-6"><a href="#annotated-cell-25-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fragment</span><span class="op">:</span> { <span class="dt">module</span><span class="op">:</span> cellShaderModule<span class="op">,</span> <span class="dt">entryPoint</span><span class="op">:</span> <span class="st">"fragmentMain"</span><span class="op">,</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-25" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-25-7" class="code-annotation-target"><a href="#annotated-cell-25-7" aria-hidden="true" tabindex="-1"></a>              <span class="dt">targets</span><span class="op">:</span> [{ <span class="dt">format</span><span class="op">:</span> canvasFormat }] }<span class="op">,</span></span>
<span id="annotated-cell-25-8"><a href="#annotated-cell-25-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">primitive</span><span class="op">:</span> { <span class="dt">topology</span><span class="op">:</span> <span class="st">"triangle-list"</span> }<span class="op">,</span></span>
<span id="annotated-cell-25-9"><a href="#annotated-cell-25-9" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-25" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-25" data-code-lines="3" data-code-annotation="1">Let WebGPU infer bind group layout from shaders (no uniforms yet)</span>
</dd>
<dt data-target-cell="annotated-cell-25" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-25" data-code-lines="7" data-code-annotation="2">Match the canvas texture format</span>
</dd>
</dl>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<ul>
<li>The render pipeline object centralizes configuration, ensuring only valid combinations are used.</li>
<li>Validation occurs once at creation, making subsequent draw calls faster.</li>
<li>Bundling options reduces the number of JavaScript calls needed for rendering.</li>
<li>Improves efficiency and performance compared to WebGL, which validates settings on every draw.</li>
</ul>
</div>
</div>
</div>
<aside class="notes">
<ul>
<li>Shader modules must be used within a <code>GPURenderPipeline</code> to render.</li>
<li>The pipeline specifies shaders, vertex buffer layout, geometry type, and more.</li>
<li>Most pipeline options are optional; only a few are needed to start.</li>
<li>Use “<code>auto</code>” for layout if you have no uniforms or extra inputs.</li>
<li>Vertex stage requires the shader module, entry point, and buffer layout.</li>
<li>Fragment stage requires the shader module, entry point, and target formats.</li>
<li>Target formats must match the canvas/context format.</li>
<li>This setup covers the basics for rendering with WebGPU.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="draw-the-square" class="slide level2 center">
<h2>Draw the square</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb13-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">// After encoder.beginRenderPass()</span></span>
<span id="cb13-2"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="" aria-hidden="true" tabindex="-1"></a>pass<span class="op">.</span><span class="fu">setPipeline</span>(cellPipeline)<span class="op">;</span></span>
<span id="cb13-4"><a href="" aria-hidden="true" tabindex="-1"></a>pass<span class="op">.</span><span class="fu">setVertexBuffer</span>(<span class="dv">0</span><span class="op">,</span> vertexBuffer)<span class="op">;</span></span>
<span id="cb13-5"><a href="" aria-hidden="true" tabindex="-1"></a>pass<span class="op">.</span><span class="fu">draw</span>(vertices<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="dv">2</span>)<span class="op">;</span> <span class="co">// 6 vertices</span></span>
<span id="cb13-6"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">// before pass.end()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<ul>
<li><code>setPipeline()</code> selects the GPU pipeline (shaders, vertex layout, state).</li>
<li><code>setVertexBuffer()</code> binds the vertex buffer to the pipeline (index 0).</li>
<li><code>draw()</code> issues the draw call, rendering the specified number of vertices.</li>
<li>Calculating the vertex count from the array makes the code flexible for other shapes.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb14" data-startfrom="944" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 943;"><span id="cb14-944"><a href="" aria-hidden="true" tabindex="-1"></a>CELL_CLEAR_COLOR <span class="op">=</span> [<span class="fl">0.02</span><span class="op">,</span> <span class="fl">0.06</span><span class="op">,</span> <span class="fl">0.15</span><span class="op">,</span> <span class="fl">1.0</span>]</span>
<span id="cb14-945"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-946"><a href="" aria-hidden="true" tabindex="-1"></a>cellVertices <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float32Array</span>([</span>
<span id="cb14-947"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span><span class="fl">0.8</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.8</span><span class="op">,</span></span>
<span id="cb14-948"><a href="" aria-hidden="true" tabindex="-1"></a>   <span class="fl">0.8</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.8</span><span class="op">,</span></span>
<span id="cb14-949"><a href="" aria-hidden="true" tabindex="-1"></a>   <span class="fl">0.8</span><span class="op">,</span>  <span class="fl">0.8</span><span class="op">,</span></span>
<span id="cb14-950"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span><span class="fl">0.8</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.8</span><span class="op">,</span></span>
<span id="cb14-951"><a href="" aria-hidden="true" tabindex="-1"></a>   <span class="fl">0.8</span><span class="op">,</span>  <span class="fl">0.8</span><span class="op">,</span></span>
<span id="cb14-952"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="op">-</span><span class="fl">0.8</span><span class="op">,</span>  <span class="fl">0.8</span><span class="op">,</span></span>
<span id="cb14-953"><a href="" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb14-954"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-955"><a href="" aria-hidden="true" tabindex="-1"></a>createCellVertexBuffer <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb14-956"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> buffer <span class="op">=</span> device<span class="op">.</span><span class="fu">createBuffer</span>({</span>
<span id="cb14-957"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell vertices"</span><span class="op">,</span></span>
<span id="cb14-958"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> cellVertices<span class="op">.</span><span class="at">byteLength</span><span class="op">,</span></span>
<span id="cb14-959"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">usage</span><span class="op">:</span> GPUBufferUsage<span class="op">.</span><span class="at">VERTEX</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span><span class="op">,</span></span>
<span id="cb14-960"><a href="" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb14-961"><a href="" aria-hidden="true" tabindex="-1"></a>  device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">writeBuffer</span>(buffer<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> cellVertices)<span class="op">;</span></span>
<span id="cb14-962"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> buffer<span class="op">;</span></span>
<span id="cb14-963"><a href="" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-964"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-965"><a href="" aria-hidden="true" tabindex="-1"></a>cellVertexBufferLayout <span class="op">=</span> ({</span>
<span id="cb14-966"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">arrayStride</span><span class="op">:</span> (<span class="dv">2</span> <span class="op">*</span> <span class="bu">Float32Array</span><span class="op">.</span><span class="at">BYTES_PER_ELEMENT</span>)<span class="op">,</span></span>
<span id="cb14-967"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">attributes</span><span class="op">:</span> [{</span>
<span id="cb14-968"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">shaderLocation</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb14-969"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">offset</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb14-970"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> <span class="st">"float32x2"</span><span class="op">,</span></span>
<span id="cb14-971"><a href="" aria-hidden="true" tabindex="-1"></a>  }]</span>
<span id="cb14-972"><a href="" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb14-973"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-974"><a href="" aria-hidden="true" tabindex="-1"></a>createCellPipeline <span class="op">=</span> (shaderModule) <span class="kw">=&gt;</span> device<span class="op">.</span><span class="fu">createRenderPipeline</span>({</span>
<span id="cb14-975"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell pipeline"</span><span class="op">,</span></span>
<span id="cb14-976"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layout</span><span class="op">:</span> <span class="st">"auto"</span><span class="op">,</span></span>
<span id="cb14-977"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vertex</span><span class="op">:</span> { <span class="dt">module</span><span class="op">:</span> shaderModule<span class="op">,</span> <span class="dt">entryPoint</span><span class="op">:</span> <span class="st">"vertexMain"</span><span class="op">,</span> <span class="dt">buffers</span><span class="op">:</span> [cellVertexBufferLayout] }<span class="op">,</span></span>
<span id="cb14-978"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fragment</span><span class="op">:</span> { <span class="dt">module</span><span class="op">:</span> shaderModule<span class="op">,</span> <span class="dt">entryPoint</span><span class="op">:</span> <span class="st">"fragmentMain"</span><span class="op">,</span> <span class="dt">targets</span><span class="op">:</span> [{ <span class="dt">format</span><span class="op">:</span> presentationFormat }] }<span class="op">,</span></span>
<span id="cb14-979"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">primitive</span><span class="op">:</span> { <span class="dt">topology</span><span class="op">:</span> <span class="st">"triangle-list"</span> }<span class="op">,</span></span>
<span id="cb14-980"><a href="" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-4-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section>
<section id="the-square" class="slide level2 center">
<h2>The square</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb15" data-startfrom="1006" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1005;"><span id="cb15-1006"><a href="" aria-hidden="true" tabindex="-1"></a>vertexBuffer <span class="op">=</span> <span class="fu">createCellVertexBuffer</span>()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb16" data-startfrom="1010" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1009;"><span id="cb16-1010"><a href="" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-1011"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">renderToCanvas</span>({</span>
<span id="cb16-1012"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">512</span><span class="op">,</span></span>
<span id="cb16-1013"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">512</span><span class="op">,</span></span>
<span id="cb16-1014"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clearColor</span><span class="op">:</span> CELL_CLEAR_COLOR<span class="op">,</span></span>
<span id="cb16-1015"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="fu">withBindings</span>({</span>
<span id="cb16-1016"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">pipeline</span><span class="op">:</span> pipeline_square<span class="op">,</span></span>
<span id="cb16-1017"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">vertex</span><span class="op">:</span> [{ <span class="dt">slot</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">buffer</span><span class="op">:</span> vertexBuffer }]<span class="op">,</span></span>
<span id="cb16-1018"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">draw</span><span class="op">:</span> { <span class="dt">vertexCount</span><span class="op">:</span> cellVertices<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="dv">2</span> }</span>
<span id="cb16-1019"><a href="" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb16-1020"><a href="" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-1021"><a href="" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="annotated-cell-28" data-startfrom="985" data-source-offset="0"><pre class="sourceCode js code-annotation-code code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 984;"><span id="annotated-cell-28-985"><a href="#annotated-cell-28-985" aria-hidden="true" tabindex="-1"></a>pipeline_square <span class="op">=</span> {</span>
<span id="annotated-cell-28-986"><a href="#annotated-cell-28-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-28-987"><a href="#annotated-cell-28-987" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="annotated-cell-28-988"><a href="#annotated-cell-28-988" aria-hidden="true" tabindex="-1"></a>    <span class="dt">code</span><span class="op">:</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="annotated-cell-28-989"><a href="#annotated-cell-28-989" aria-hidden="true" tabindex="-1"></a><span class="vs">      @vertex</span></span>
<span id="annotated-cell-28-990"><a href="#annotated-cell-28-990" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn vertexMain(@location(0) pos: vec2f) -&gt; @builtin(position) vec4f {</span></span>
<span id="annotated-cell-28-991"><a href="#annotated-cell-28-991" aria-hidden="true" tabindex="-1"></a><span class="vs">        return vec4f(pos, 0.0, 1.0);</span></span>
<span id="annotated-cell-28-992"><a href="#annotated-cell-28-992" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-28-993"><a href="#annotated-cell-28-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-28-994"><a href="#annotated-cell-28-994" aria-hidden="true" tabindex="-1"></a><span class="vs">      @fragment</span></span>
<span id="annotated-cell-28-995"><a href="#annotated-cell-28-995" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn fragmentMain() -&gt; @location(0) vec4f {</span></span>
<span id="annotated-cell-28-996"><a href="#annotated-cell-28-996" aria-hidden="true" tabindex="-1"></a><span class="vs">        return vec4f(1.0, 0.0, 0.0, 1.0);</span></span>
<span id="annotated-cell-28-997"><a href="#annotated-cell-28-997" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-28-998"><a href="#annotated-cell-28-998" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">,</span></span>
<span id="annotated-cell-28-999"><a href="#annotated-cell-28-999" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-28-1000"><a href="#annotated-cell-28-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-28-1001"><a href="#annotated-cell-28-1001" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">createCellPipeline</span>(cellShaderModule)<span class="op">;</span></span>
<span id="annotated-cell-28-1002"><a href="#annotated-cell-28-1002" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
</section></section>
<section>
<section id="draw-a-grid-instancing" class="title-slide slide level1 center">
<h1>Draw a grid (instancing)</h1>

</section>
<section id="define-the-grid" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Define the grid</h2>
<ul>
<li class="fragment">Choose GRID_SIZE (power-of-two is convenient); treat grid as square</li>
<li class="fragment">Goal: draw GRID_SIZE × GRID_SIZE quads efficiently via instancing</li>
<li class="fragment">Pass common parameters via a small uniform buffer</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode js code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb17-1" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> GRID_SIZE <span class="op">=</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="cb17-2" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> cell <span class="op">=</span> <span class="fl">1.8</span> <span class="op">/</span> GRID_SIZE<span class="op">;</span> <span class="co">// leave a small gap between cells</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<ul>
<li>To render a grid, you need to know its dimensions (width and height); for simplicity, use a square grid with a power-of-two size.</li>
<li>Start with a small grid (e.g., 4x4) for easier math and demonstration; you can scale up later.</li>
<li>Rendering many squares requires making each cell smaller and drawing many instances.</li>
<li>You could manually define all square vertices, but this uses more memory and is less efficient.</li>
<li>A more GPU-friendly approach is to use instancing, letting the GPU efficiently draw multiple squares with minimal data.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="uniform-buffer-grid" class="slide level2 center" data-auto-animate="true">
<h2 data-id="quarto-animate-title">Uniform buffer (grid)</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode js code-with-copy" data-id="quarto-animate-code"><code class="sourceCode javascript hljs"><span id="cb18-1" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a uniform buffer that describes the grid.</span></span>
<span id="cb18-2" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> uniformArray <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float32Array</span>([GRID_SIZE<span class="op">,</span> GRID_SIZE])<span class="op">;</span></span>
<span id="cb18-3" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> uniformBuffer <span class="op">=</span> device<span class="op">.</span><span class="fu">createBuffer</span>({</span>
<span id="cb18-4" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Grid Uniforms"</span><span class="op">,</span></span>
<span id="cb18-5" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">size</span><span class="op">:</span> uniformArray<span class="op">.</span><span class="at">byteLength</span><span class="op">,</span></span>
<span id="cb18-6" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">usage</span><span class="op">:</span> GPUBufferUsage<span class="op">.</span><span class="at">UNIFORM</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span><span class="op">,</span></span>
<span id="cb18-7" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb18-8" class="hljs-ln-code"><a href="" aria-hidden="true" tabindex="-1"></a>device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">writeBuffer</span>(uniformBuffer<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> uniformArray)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li>Uniform buffers must be 16-byte aligned</li>
<li>Grid as two u32s</li>
<li>Cell size as two f32s</li>
</ol>
<aside class="notes">
<ul>
<li>Communicate grid size to the shader using uniforms instead of hard-coding.</li>
<li>Uniforms provide values that are constant for all shader invocations (e.g., grid size, time).</li>
<li>Uniforms are stored in <code>GPUBuffer</code> objects with <code>GPUBufferUsage.UNIFORM</code>.</li>
<li>Using uniforms allows dynamic changes without recreating shaders or pipelines.</li>
<li>Data types for uniforms can be float or integer, depending on shader needs.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="access-uniforms-in-a-shader" class="slide level2 center">
<h2>Access uniforms in a shader</h2>
<div class="sourceCode" id="annotated-cell-33"><pre class="sourceCode js code-annotation-code code-with-copy code-annotated"><code class="sourceCode javascript"><span id="annotated-cell-33-1"><a href="#annotated-cell-33-1" aria-hidden="true" tabindex="-1"></a><span class="co">// At the top of the `code` string in the createShaderModule() call</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-33-2" class="code-annotation-target"><a href="#annotated-cell-33-2" aria-hidden="true" tabindex="-1"></a>@<span class="fu">group</span>(<span class="dv">0</span>) @<span class="fu">binding</span>(<span class="dv">0</span>) <span class="kw">var</span><span class="op">&lt;</span>uniform<span class="op">&gt;</span> grid<span class="op">:</span> vec2f<span class="op">;</span></span>
<span id="annotated-cell-33-3"><a href="#annotated-cell-33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-33-4"><a href="#annotated-cell-33-4" aria-hidden="true" tabindex="-1"></a>@vertex</span>
<span id="annotated-cell-33-5"><a href="#annotated-cell-33-5" aria-hidden="true" tabindex="-1"></a>fn <span class="fu">vertexMain</span>(@<span class="fu">location</span>(<span class="dv">0</span>) pos<span class="op">:</span> vec2f) <span class="op">-&gt;</span></span>
<span id="annotated-cell-33-6"><a href="#annotated-cell-33-6" aria-hidden="true" tabindex="-1"></a>  @<span class="fu">builtin</span>(position) vec4f {</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-33" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-33-7" class="code-annotation-target"><a href="#annotated-cell-33-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">vec4f</span>(pos <span class="op">/</span> grid<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="annotated-cell-33-8"><a href="#annotated-cell-33-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-33-9"><a href="#annotated-cell-33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-33-10"><a href="#annotated-cell-33-10" aria-hidden="true" tabindex="-1"></a><span class="co">// ...fragmentMain is unchanged </span></span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-33" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="2" data-code-annotation="1">Declare a uniform variable (vec2f for two floats)</span>
</dd>
<dt data-target-cell="annotated-cell-33" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-33" data-code-lines="7" data-code-annotation="2">Use it to scale vertex positions</span>
</dd>
</dl>
<aside class="notes">
<ul>
<li>A uniform called <code>grid</code> (a 2D float vector) is defined in the shader and matches data in the uniform buffer.</li>
<li>The uniform is bound at <code>@group(0)</code> and <code>@binding(0)</code> in the shader.</li>
<li>The shader divides the vertex position by the <code>grid</code> vector, performing component-wise division.</li>
<li>This operation is common in GPU shaders for rendering and compute tasks.</li>
<li>Using a grid size of 4 makes the rendered square one-fourth its original size, allowing four squares per row or column.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="bind-group" class="slide level2 center">
<h2>Bind group</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb19-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> bindGroup <span class="op">=</span> device<span class="op">.</span><span class="fu">createBindGroup</span>({</span>
<span id="cb19-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell renderer bind group"</span><span class="op">,</span></span>
<span id="cb19-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layout</span><span class="op">:</span> cellPipeline<span class="op">.</span><span class="fu">getBindGroupLayout</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb19-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="dt">entries</span><span class="op">:</span> [{</span>
<span id="cb19-5"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">binding</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb19-6"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> uniformBuffer }</span>
<span id="cb19-7"><a href="" aria-hidden="true" tabindex="-1"></a>  }]<span class="op">,</span></span>
<span id="cb19-8"><a href="" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<ul>
<li>Declaring a uniform in the shader does not automatically connect it to a buffer; you must create a bind group.</li>
<li>A bind group is a collection of GPU resources (buffers, textures, etc.) made accessible to shaders.</li>
<li>Create a bind group using a layout that describes the resource types; with layout: “auto”, you can get it from the pipeline.</li>
<li>Each bind group entry specifies a binding index (matching <code>@binding</code> in the shader) and the resource to bind.</li>
<li>Bind groups are immutable handles; you can update buffer contents, but not the resources the group points to.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="bind-the-group" class="slide level2 center">
<h2>Bind the group</h2>
<div class="sourceCode" id="annotated-cell-35"><pre class="sourceCode js code-annotation-code code-with-copy"><code class="sourceCode javascript"><span id="annotated-cell-35-1"><a href="#annotated-cell-35-1" aria-hidden="true" tabindex="-1"></a>pass<span class="op">.</span><span class="fu">setPipeline</span>(cellPipeline)<span class="op">;</span></span>
<span id="annotated-cell-35-2"><a href="#annotated-cell-35-2" aria-hidden="true" tabindex="-1"></a>pass<span class="op">.</span><span class="fu">setVertexBuffer</span>(<span class="dv">0</span><span class="op">,</span> vertexBuffer)<span class="op">;</span></span>
<span id="annotated-cell-35-3"><a href="#annotated-cell-35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-35-4"><a href="#annotated-cell-35-4" aria-hidden="true" tabindex="-1"></a>pass<span class="op">.</span><span class="fu">setBindGroup</span>(<span class="dv">0</span><span class="op">,</span> bindGroup)<span class="op">;</span></span>
<span id="annotated-cell-35-5"><a href="#annotated-cell-35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-35-6"><a href="#annotated-cell-35-6" aria-hidden="true" tabindex="-1"></a>pass<span class="op">.</span><span class="fu">draw</span>(vertices<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="dv">2</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="binded-result" class="slide level2 center">
<h2>Binded result</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb20" data-startfrom="1137" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1136;"><span id="cb20-1137"><a href="" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createUniformBuffer</span>(GRID_SIZE) {</span>
<span id="cb20-1138"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> uniformArray <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float32Array</span>([GRID_SIZE<span class="op">,</span> GRID_SIZE])<span class="op">;</span></span>
<span id="cb20-1139"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> buffer <span class="op">=</span> device<span class="op">.</span><span class="fu">createBuffer</span>({</span>
<span id="cb20-1140"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Grid Uniforms"</span><span class="op">,</span></span>
<span id="cb20-1141"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> uniformArray<span class="op">.</span><span class="at">byteLength</span><span class="op">,</span></span>
<span id="cb20-1142"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">usage</span><span class="op">:</span> GPUBufferUsage<span class="op">.</span><span class="at">UNIFORM</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span><span class="op">,</span></span>
<span id="cb20-1143"><a href="" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb20-1144"><a href="" aria-hidden="true" tabindex="-1"></a>  device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">writeBuffer</span>(buffer<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> uniformArray)<span class="op">;</span></span>
<span id="cb20-1145"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> buffer<span class="op">;</span></span>
<span id="cb20-1146"><a href="" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb21" data-startfrom="1150" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1149;"><span id="cb21-1150"><a href="" aria-hidden="true" tabindex="-1"></a>renderGrid <span class="op">=</span> (pipeline<span class="op">,</span> GRID_SIZE<span class="op">,</span> instanceCount) <span class="kw">=&gt;</span> {</span>
<span id="cb21-1151"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> uniformBuffer <span class="op">=</span> <span class="fu">createUniformBuffer</span>(GRID_SIZE)<span class="op">;</span></span>
<span id="cb21-1152"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1153"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bindGroup <span class="op">=</span> device<span class="op">.</span><span class="fu">createBindGroup</span>({</span>
<span id="cb21-1154"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell renderer bind group"</span><span class="op">,</span></span>
<span id="cb21-1155"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">layout</span><span class="op">:</span> pipeline<span class="op">.</span><span class="fu">getBindGroupLayout</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb21-1156"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">entries</span><span class="op">:</span> [{ <span class="dt">binding</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> uniformBuffer } }]<span class="op">,</span></span>
<span id="cb21-1157"><a href="" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb21-1158"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-1159"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">renderToCanvas</span>({</span>
<span id="cb21-1160"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">512</span><span class="op">,</span></span>
<span id="cb21-1161"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">512</span><span class="op">,</span></span>
<span id="cb21-1162"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clearColor</span><span class="op">:</span> CELL_CLEAR_COLOR<span class="op">,</span></span>
<span id="cb21-1163"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="fu">withBindings</span>({</span>
<span id="cb21-1164"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">pipeline</span><span class="op">:</span> pipeline<span class="op">,</span></span>
<span id="cb21-1165"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">bindGroups</span><span class="op">:</span> [bindGroup]<span class="op">,</span></span>
<span id="cb21-1166"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">vertex</span><span class="op">:</span> [{ <span class="dt">slot</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">buffer</span><span class="op">:</span> vertexBuffer }]<span class="op">,</span></span>
<span id="cb21-1167"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">draw</span><span class="op">:</span> { <span class="dt">vertexCount</span><span class="op">:</span> cellVertices<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">instanceCount</span><span class="op">:</span> instanceCount }</span>
<span id="cb21-1168"><a href="" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb21-1169"><a href="" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb21-1170"><a href="" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="annotated-cell-38" data-startfrom="1175" data-source-offset="-0"><pre class="sourceCode js code-annotation-code code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1174;"><span id="annotated-cell-38-1175"><a href="#annotated-cell-38-1175" aria-hidden="true" tabindex="-1"></a>pipeline_grid1 <span class="op">=</span> {</span>
<span id="annotated-cell-38-1176"><a href="#annotated-cell-38-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-38-1177"><a href="#annotated-cell-38-1177" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="annotated-cell-38-1178"><a href="#annotated-cell-38-1178" aria-hidden="true" tabindex="-1"></a>    <span class="dt">code</span><span class="op">:</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="annotated-cell-38-1179"><a href="#annotated-cell-38-1179" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(0) var&lt;uniform&gt; grid: vec2f;</span></span>
<span id="annotated-cell-38-1180"><a href="#annotated-cell-38-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-38-1181"><a href="#annotated-cell-38-1181" aria-hidden="true" tabindex="-1"></a><span class="vs">      @vertex</span></span>
<span id="annotated-cell-38-1182"><a href="#annotated-cell-38-1182" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn vertexMain(@location(0) pos: vec2f) -&gt; @builtin(position) vec4f {</span></span>
<span id="annotated-cell-38-1183"><a href="#annotated-cell-38-1183" aria-hidden="true" tabindex="-1"></a><span class="vs">        return vec4f(pos / grid, 0.0, 1.0);</span></span>
<span id="annotated-cell-38-1184"><a href="#annotated-cell-38-1184" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-38-1185"><a href="#annotated-cell-38-1185" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-38-1186"><a href="#annotated-cell-38-1186" aria-hidden="true" tabindex="-1"></a><span class="vs">      @fragment</span></span>
<span id="annotated-cell-38-1187"><a href="#annotated-cell-38-1187" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn fragmentMain() -&gt; @location(0) vec4f {</span></span>
<span id="annotated-cell-38-1188"><a href="#annotated-cell-38-1188" aria-hidden="true" tabindex="-1"></a><span class="vs">        return vec4f(1.0, 0.0, 0.0, 1.0);</span></span>
<span id="annotated-cell-38-1189"><a href="#annotated-cell-38-1189" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-38-1190"><a href="#annotated-cell-38-1190" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">,</span></span>
<span id="annotated-cell-38-1191"><a href="#annotated-cell-38-1191" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-38-1192"><a href="#annotated-cell-38-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-38-1193"><a href="#annotated-cell-38-1193" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">createCellPipeline</span>(cellShaderModule)<span class="op">;</span></span>
<span id="annotated-cell-38-1194"><a href="#annotated-cell-38-1194" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-38-1195"><a href="#annotated-cell-38-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-38-1196"><a href="#annotated-cell-38-1196" aria-hidden="true" tabindex="-1"></a><span class="fu">renderGrid</span>(pipeline_grid1<span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-10-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-10-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
</section>
<section id="draw-a-grid-instancing-1" class="slide level2 center">
<h2>Draw a grid (instancing)</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="annotated-cell-39" data-startfrom="1202" data-source-offset="-0"><pre class="sourceCode js code-annotation-code code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1201;"><span id="annotated-cell-39-1202"><a href="#annotated-cell-39-1202" aria-hidden="true" tabindex="-1"></a>pipeline_grid2 <span class="op">=</span> {</span>
<span id="annotated-cell-39-1203"><a href="#annotated-cell-39-1203" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="annotated-cell-39-1204"><a href="#annotated-cell-39-1204" aria-hidden="true" tabindex="-1"></a>    <span class="dt">code</span><span class="op">:</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="annotated-cell-39-1205"><a href="#annotated-cell-39-1205" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(0) var&lt;uniform&gt; grid: vec2f;</span></span>
<span id="annotated-cell-39-1206"><a href="#annotated-cell-39-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-39-1207"><a href="#annotated-cell-39-1207" aria-hidden="true" tabindex="-1"></a><span class="vs">      @vertex</span></span>
<span id="annotated-cell-39-1208"><a href="#annotated-cell-39-1208" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn vertexMain(@location(0) pos: vec2f,</span></span>
<span id="annotated-cell-39-1209"><a href="#annotated-cell-39-1209" aria-hidden="true" tabindex="-1"></a><span class="vs">                    @builtin(instance_index) instance: u32) -&gt;</span></span>
<span id="annotated-cell-39-1210"><a href="#annotated-cell-39-1210" aria-hidden="true" tabindex="-1"></a><span class="vs">        @builtin(position) vec4f {</span></span>
<span id="annotated-cell-39-1211"><a href="#annotated-cell-39-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-39-1212"><a href="#annotated-cell-39-1212" aria-hidden="true" tabindex="-1"></a><span class="vs">        let i = f32(instance);</span></span>
<span id="annotated-cell-39-1213"><a href="#annotated-cell-39-1213" aria-hidden="true" tabindex="-1"></a><span class="vs">        // Compute the cell coordinate from the instance_index</span></span>
<span id="annotated-cell-39-1214"><a href="#annotated-cell-39-1214" aria-hidden="true" tabindex="-1"></a><span class="vs">        let cell = vec2f(i % grid.x, floor(i / grid.x));</span></span>
<span id="annotated-cell-39-1215"><a href="#annotated-cell-39-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-39-1216"><a href="#annotated-cell-39-1216" aria-hidden="true" tabindex="-1"></a><span class="vs">        let cellOffset = cell / grid * 2;</span></span>
<span id="annotated-cell-39-1217"><a href="#annotated-cell-39-1217" aria-hidden="true" tabindex="-1"></a><span class="vs">        let gridPos = (pos + 1) / grid - 1 + cellOffset;</span></span>
<span id="annotated-cell-39-1218"><a href="#annotated-cell-39-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-39-1219"><a href="#annotated-cell-39-1219" aria-hidden="true" tabindex="-1"></a><span class="vs">        return vec4f(gridPos, 0, 1);</span></span>
<span id="annotated-cell-39-1220"><a href="#annotated-cell-39-1220" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-39-1221"><a href="#annotated-cell-39-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-39-1222"><a href="#annotated-cell-39-1222" aria-hidden="true" tabindex="-1"></a><span class="vs">      @fragment</span></span>
<span id="annotated-cell-39-1223"><a href="#annotated-cell-39-1223" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn fragmentMain() -&gt; @location(0) vec4f {</span></span>
<span id="annotated-cell-39-1224"><a href="#annotated-cell-39-1224" aria-hidden="true" tabindex="-1"></a><span class="vs">        return vec4f(1.0, 0.0, 0.0, 1.0);</span></span>
<span id="annotated-cell-39-1225"><a href="#annotated-cell-39-1225" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-39-1226"><a href="#annotated-cell-39-1226" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">,</span></span>
<span id="annotated-cell-39-1227"><a href="#annotated-cell-39-1227" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-39-1228"><a href="#annotated-cell-39-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-39-1229"><a href="#annotated-cell-39-1229" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">createCellPipeline</span>(cellShaderModule)<span class="op">;</span></span>
<span id="annotated-cell-39-1230"><a href="#annotated-cell-39-1230" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="annotated-cell-39-1231"><a href="#annotated-cell-39-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-39-1232"><a href="#annotated-cell-39-1232" aria-hidden="true" tabindex="-1"></a><span class="fu">renderGrid</span>(pipeline_grid2<span class="op">,</span> <span class="dv">32</span><span class="op">,</span> <span class="dv">32</span><span class="op">*</span><span class="dv">32</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-11-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
</section>
<section id="color-the-grid" class="slide level2 center">
<h2>Color the grid</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb22" data-startfrom="1238" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1237;"><span id="cb22-1238"><a href="" aria-hidden="true" tabindex="-1"></a>pipeline_grid3 <span class="op">=</span> {</span>
<span id="cb22-1239"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="cb22-1240"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">code</span><span class="op">:</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="cb22-1241"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      struct VertexInput {</span></span>
<span id="cb22-1242"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        @location(0) pos: vec2f,</span></span>
<span id="cb22-1243"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        @builtin(instance_index) instance: u32,</span></span>
<span id="cb22-1244"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      };</span></span>
<span id="cb22-1245"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1246"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      struct VertexOutput {</span></span>
<span id="cb22-1247"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        @builtin(position) pos: vec4f,</span></span>
<span id="cb22-1248"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        @location(0) cell: vec2f, // New line!</span></span>
<span id="cb22-1249"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      };</span></span>
<span id="cb22-1250"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1251"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(0) var&lt;uniform&gt; grid: vec2f;</span></span>
<span id="cb22-1252"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1253"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      @vertex</span></span>
<span id="cb22-1254"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn vertexMain(input: VertexInput) -&gt; VertexOutput  {</span></span>
<span id="cb22-1255"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        let i = f32(input.instance);</span></span>
<span id="cb22-1256"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        let cell = vec2f(i % grid.x, floor(i / grid.x));</span></span>
<span id="cb22-1257"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        let cellOffset = cell / grid * 2;</span></span>
<span id="cb22-1258"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        let gridPos = (input.pos + 1) / grid - 1 + cellOffset;</span></span>
<span id="cb22-1259"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="cb22-1260"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        var output: VertexOutput;</span></span>
<span id="cb22-1261"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        output.pos = vec4f(gridPos, 0, 1);</span></span>
<span id="cb22-1262"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        output.cell = cell; // New line!</span></span>
<span id="cb22-1263"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        return output;</span></span>
<span id="cb22-1264"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb22-1265"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1266"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      @fragment</span></span>
<span id="cb22-1267"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn fragmentMain(input: VertexOutput) -&gt; @location(0) vec4f {</span></span>
<span id="cb22-1268"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        let c = input.cell / grid;</span></span>
<span id="cb22-1269"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        return vec4f(c, 1-c.x, 1);</span></span>
<span id="cb22-1270"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb22-1271"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">,</span></span>
<span id="cb22-1272"><a href="" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb22-1273"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1274"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">createCellPipeline</span>(cellShaderModule)<span class="op">;</span></span>
<span id="cb22-1275"><a href="" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-1276"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-1277"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">renderGrid</span>(pipeline_grid3<span class="op">,</span> <span class="dv">32</span><span class="op">,</span> <span class="dv">32</span><span class="op">*</span><span class="dv">32</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
</section>
<section id="cell-states-storage-buffer" class="slide level2 center">
<h2>Cell states (storage buffer)</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb23" data-startfrom="1282" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1281;"><span id="cb23-1282"><a href="" aria-hidden="true" tabindex="-1"></a>pipeline_storage <span class="op">=</span> {</span>
<span id="cb23-1283"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="cb23-1284"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">code</span><span class="op">:</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="cb23-1285"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      struct VertexInput {</span></span>
<span id="cb23-1286"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        @location(0) pos: vec2f,</span></span>
<span id="cb23-1287"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        @builtin(instance_index) instance: u32,</span></span>
<span id="cb23-1288"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      };</span></span>
<span id="cb23-1289"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1290"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      struct VertexOutput {</span></span>
<span id="cb23-1291"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        @builtin(position) pos: vec4f,</span></span>
<span id="cb23-1292"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        @location(0) cell: vec2f, // New line!</span></span>
<span id="cb23-1293"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      };</span></span>
<span id="cb23-1294"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1295"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(0) var&lt;uniform&gt; grid: vec2f;</span></span>
<span id="cb23-1296"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(1) var&lt;storage&gt; cellState: array&lt;u32&gt;; // New!          </span></span>
<span id="cb23-1297"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb23-1298"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      @vertex</span></span>
<span id="cb23-1299"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn vertexMain(@location(0) pos: vec2f,</span></span>
<span id="cb23-1300"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">                    @builtin(instance_index) instance: u32) -&gt; VertexOutput {</span></span>
<span id="cb23-1301"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        let i = f32(instance);</span></span>
<span id="cb23-1302"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        let cell = vec2f(i % grid.x, floor(i / grid.x));</span></span>
<span id="cb23-1303"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        let state = f32(cellState[instance]); // New line!</span></span>
<span id="cb23-1304"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1305"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        let cellOffset = cell / grid * 2;</span></span>
<span id="cb23-1306"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        // New: Scale the position by the cell's active state.</span></span>
<span id="cb23-1307"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        let gridPos = (pos*state+1) / grid - 1 + cellOffset;</span></span>
<span id="cb23-1308"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1309"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        var output: VertexOutput;</span></span>
<span id="cb23-1310"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        output.pos = vec4f(gridPos, 0, 1);</span></span>
<span id="cb23-1311"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        output.cell = cell;</span></span>
<span id="cb23-1312"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        return output;</span></span>
<span id="cb23-1313"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb23-1314"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1315"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      @fragment</span></span>
<span id="cb23-1316"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn fragmentMain(input: VertexOutput) -&gt; @location(0) vec4f {</span></span>
<span id="cb23-1317"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        let c = input.cell / grid;</span></span>
<span id="cb23-1318"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">        return vec4f(c, 1-c.x, 1);</span></span>
<span id="cb23-1319"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb23-1320"><a href="" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">,</span></span>
<span id="cb23-1321"><a href="" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb23-1322"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-1323"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">createCellPipeline</span>(cellShaderModule)<span class="op">;</span></span>
<span id="cb23-1324"><a href="" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb24" data-startfrom="1328" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1327;"><span id="cb24-1328"><a href="" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb24-1329"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> GRID_SIZE <span class="op">=</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="cb24-1330"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> uniformBuffer <span class="op">=</span> <span class="fu">createUniformBuffer</span>(GRID_SIZE)<span class="op">;</span></span>
<span id="cb24-1331"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1332"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create an array representing the active state of each cell.</span></span>
<span id="cb24-1333"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellStateArray <span class="op">=</span> <span class="kw">new</span> <span class="bu">Uint32Array</span>(GRID_SIZE <span class="op">*</span> GRID_SIZE)<span class="op">;</span></span>
<span id="cb24-1334"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1335"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create a storage buffer to hold the cell state.</span></span>
<span id="cb24-1336"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellStateStorage <span class="op">=</span> device<span class="op">.</span><span class="fu">createBuffer</span>({</span>
<span id="cb24-1337"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell State"</span><span class="op">,</span></span>
<span id="cb24-1338"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size</span><span class="op">:</span> cellStateArray<span class="op">.</span><span class="at">byteLength</span><span class="op">,</span></span>
<span id="cb24-1339"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">usage</span><span class="op">:</span> GPUBufferUsage<span class="op">.</span><span class="at">STORAGE</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span><span class="op">,</span></span>
<span id="cb24-1340"><a href="" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb24-1341"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1342"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mark every third cell of the grid as active.</span></span>
<span id="cb24-1343"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> cellStateArray<span class="op">.</span><span class="at">length</span><span class="op">;</span> i <span class="op">+=</span> <span class="dv">3</span>) {</span>
<span id="cb24-1344"><a href="" aria-hidden="true" tabindex="-1"></a>    cellStateArray[i] <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb24-1345"><a href="" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-1346"><a href="" aria-hidden="true" tabindex="-1"></a>  device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">writeBuffer</span>(cellStateStorage<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> cellStateArray)<span class="op">;</span></span>
<span id="cb24-1347"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1348"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bindGroup <span class="op">=</span> device<span class="op">.</span><span class="fu">createBindGroup</span>({</span>
<span id="cb24-1349"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell renderer bind group"</span><span class="op">,</span></span>
<span id="cb24-1350"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">layout</span><span class="op">:</span> pipeline_storage<span class="op">.</span><span class="fu">getBindGroupLayout</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb24-1351"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">entries</span><span class="op">:</span> [{</span>
<span id="cb24-1352"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">binding</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb24-1353"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> uniformBuffer }</span>
<span id="cb24-1354"><a href="" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb24-1355"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co">// New entry!</span></span>
<span id="cb24-1356"><a href="" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb24-1357"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">binding</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb24-1358"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> cellStateStorage }</span>
<span id="cb24-1359"><a href="" aria-hidden="true" tabindex="-1"></a>    }]<span class="op">,</span></span>
<span id="cb24-1360"><a href="" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb24-1361"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1362"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">renderToCanvas</span>({</span>
<span id="cb24-1363"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">512</span><span class="op">,</span></span>
<span id="cb24-1364"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">512</span><span class="op">,</span></span>
<span id="cb24-1365"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clearColor</span><span class="op">:</span> CELL_CLEAR_COLOR<span class="op">,</span></span>
<span id="cb24-1366"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="dt">render</span><span class="op">:</span> <span class="fu">withBindings</span>({</span>
<span id="cb24-1367"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">pipeline</span><span class="op">:</span> pipeline_storage<span class="op">,</span></span>
<span id="cb24-1368"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">bindGroups</span><span class="op">:</span> [bindGroup]<span class="op">,</span></span>
<span id="cb24-1369"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">vertex</span><span class="op">:</span> [{ <span class="dt">slot</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">buffer</span><span class="op">:</span> vertexBuffer }]<span class="op">,</span></span>
<span id="cb24-1370"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">draw</span><span class="op">:</span> { <span class="dt">vertexCount</span><span class="op">:</span> cellVertices<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">instanceCount</span><span class="op">:</span> GRID_SIZE<span class="op">*</span>GRID_SIZE }</span>
<span id="cb24-1371"><a href="" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb24-1372"><a href="" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb24-1373"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-1374"><a href="" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-14" data-nodetype="expression">

</div>
</div>
</div>
</section>
<section id="pingpong-buffers" class="slide level2 center">
<h2>Pingpong buffers</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb25" data-startfrom="1380" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1379;"><span id="cb25-1380"><a href="" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb25-1381"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> GRID_SIZE <span class="op">=</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="cb25-1382"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> uniformBuffer <span class="op">=</span> <span class="fu">createUniformBuffer</span>(GRID_SIZE)<span class="op">;</span></span>
<span id="cb25-1383"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1384"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create an array representing the active state of each cell.</span></span>
<span id="cb25-1385"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellStateArray <span class="op">=</span> <span class="kw">new</span> <span class="bu">Uint32Array</span>(GRID_SIZE <span class="op">*</span> GRID_SIZE)<span class="op">;</span></span>
<span id="cb25-1386"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1387"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create two storage buffers to hold the cell state.</span></span>
<span id="cb25-1388"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellStateStorage <span class="op">=</span> [</span>
<span id="cb25-1389"><a href="" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="fu">createBuffer</span>({</span>
<span id="cb25-1390"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell State A"</span><span class="op">,</span></span>
<span id="cb25-1391"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">size</span><span class="op">:</span> cellStateArray<span class="op">.</span><span class="at">byteLength</span><span class="op">,</span></span>
<span id="cb25-1392"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">usage</span><span class="op">:</span> GPUBufferUsage<span class="op">.</span><span class="at">STORAGE</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span><span class="op">,</span></span>
<span id="cb25-1393"><a href="" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb25-1394"><a href="" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="fu">createBuffer</span>({</span>
<span id="cb25-1395"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell State B"</span><span class="op">,</span></span>
<span id="cb25-1396"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">size</span><span class="op">:</span> cellStateArray<span class="op">.</span><span class="at">byteLength</span><span class="op">,</span></span>
<span id="cb25-1397"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">usage</span><span class="op">:</span> GPUBufferUsage<span class="op">.</span><span class="at">STORAGE</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span><span class="op">,</span></span>
<span id="cb25-1398"><a href="" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb25-1399"><a href="" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb25-1400"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1401"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mark every third cell of the first grid as active.</span></span>
<span id="cb25-1402"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> cellStateArray<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">+=</span><span class="dv">3</span>) {</span>
<span id="cb25-1403"><a href="" aria-hidden="true" tabindex="-1"></a>    cellStateArray[i] <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb25-1404"><a href="" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-1405"><a href="" aria-hidden="true" tabindex="-1"></a>  device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">writeBuffer</span>(cellStateStorage[<span class="dv">0</span>]<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> cellStateArray)<span class="op">;</span></span>
<span id="cb25-1406"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1407"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mark every other cell of the second grid as active.</span></span>
<span id="cb25-1408"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> cellStateArray<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb25-1409"><a href="" aria-hidden="true" tabindex="-1"></a>    cellStateArray[i] <span class="op">=</span> i <span class="op">%</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb25-1410"><a href="" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-1411"><a href="" aria-hidden="true" tabindex="-1"></a>  device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">writeBuffer</span>(cellStateStorage[<span class="dv">1</span>]<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> cellStateArray)<span class="op">;</span></span>
<span id="cb25-1412"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1413"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bindGroups <span class="op">=</span> [</span>
<span id="cb25-1414"><a href="" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="fu">createBindGroup</span>({</span>
<span id="cb25-1415"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell renderer bind group A"</span><span class="op">,</span></span>
<span id="cb25-1416"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">layout</span><span class="op">:</span> pipeline_storage<span class="op">.</span><span class="fu">getBindGroupLayout</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb25-1417"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">entries</span><span class="op">:</span> [{</span>
<span id="cb25-1418"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb25-1419"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> uniformBuffer }</span>
<span id="cb25-1420"><a href="" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> {</span>
<span id="cb25-1421"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb25-1422"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> cellStateStorage[<span class="dv">0</span>] }</span>
<span id="cb25-1423"><a href="" aria-hidden="true" tabindex="-1"></a>      }]<span class="op">,</span></span>
<span id="cb25-1424"><a href="" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb25-1425"><a href="" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="fu">createBindGroup</span>({</span>
<span id="cb25-1426"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell renderer bind group B"</span><span class="op">,</span></span>
<span id="cb25-1427"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">layout</span><span class="op">:</span> pipeline_storage<span class="op">.</span><span class="fu">getBindGroupLayout</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb25-1428"><a href="" aria-hidden="true" tabindex="-1"></a>      <span class="dt">entries</span><span class="op">:</span> [{</span>
<span id="cb25-1429"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb25-1430"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> uniformBuffer }</span>
<span id="cb25-1431"><a href="" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> {</span>
<span id="cb25-1432"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb25-1433"><a href="" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> cellStateStorage[<span class="dv">1</span>] }</span>
<span id="cb25-1434"><a href="" aria-hidden="true" tabindex="-1"></a>      }]<span class="op">,</span></span>
<span id="cb25-1435"><a href="" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb25-1436"><a href="" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb25-1437"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1438"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> <span class="fu">createCanvas</span>(<span class="dv">512</span><span class="op">,</span> <span class="dv">512</span>)<span class="op">;</span></span>
<span id="cb25-1439"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctx <span class="op">=</span> <span class="fu">setupContext</span>(canvas<span class="op">,</span> device<span class="op">,</span> presentationFormat)<span class="op">;</span></span>
<span id="cb25-1440"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1441"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> UPDATE_INTERVAL <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> <span class="co">// Update every 200ms (5 times/sec)</span></span>
<span id="cb25-1442"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> step <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// Track how many simulation steps have been run</span></span>
<span id="cb25-1443"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1444"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Move all of our rendering code into a function</span></span>
<span id="cb25-1445"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateGrid</span>() {</span>
<span id="cb25-1446"><a href="" aria-hidden="true" tabindex="-1"></a>    step<span class="op">++;</span> <span class="co">// Increment the step count</span></span>
<span id="cb25-1447"><a href="" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-1448"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Start a render pass </span></span>
<span id="cb25-1449"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { encoder<span class="op">,</span> pass } <span class="op">=</span> <span class="fu">beginPass</span>(device<span class="op">,</span> ctx<span class="op">,</span> CELL_CLEAR_COLOR)<span class="op">;</span></span>
<span id="cb25-1450"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1451"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw the grid.</span></span>
<span id="cb25-1452"><a href="" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">setPipeline</span>(pipeline_storage)<span class="op">;</span></span>
<span id="cb25-1453"><a href="" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">setBindGroup</span>(<span class="dv">0</span><span class="op">,</span> bindGroups[step <span class="op">%</span> <span class="dv">2</span>])<span class="op">;</span> <span class="co">// Updated!</span></span>
<span id="cb25-1454"><a href="" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">setVertexBuffer</span>(<span class="dv">0</span><span class="op">,</span> vertexBuffer)<span class="op">;</span></span>
<span id="cb25-1455"><a href="" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">draw</span>(cellVertices<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> GRID_SIZE <span class="op">*</span> GRID_SIZE)<span class="op">;</span></span>
<span id="cb25-1456"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1457"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="co">// End the render pass and submit the command buffer</span></span>
<span id="cb25-1458"><a href="" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">end</span>()<span class="op">;</span></span>
<span id="cb25-1459"><a href="" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">submit</span>([encoder<span class="op">.</span><span class="fu">finish</span>()])<span class="op">;</span></span>
<span id="cb25-1460"><a href="" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-1461"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1462"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Schedule updateGrid() to run repeatedly</span></span>
<span id="cb25-1463"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="pp">setInterval</span>(updateGrid<span class="op">,</span> UPDATE_INTERVAL)<span class="op">;</span></span>
<span id="cb25-1464"><a href="" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-1465"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> canvas<span class="op">;</span></span>
<span id="cb25-1466"><a href="" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-15" data-nodetype="expression">

</div>
</div>
</div>
</section>
<section id="run-the-simulation" class="slide level2 center">
<h2>Run the simulation</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="annotated-cell-44" data-startfrom="1472" data-source-offset="0"><pre class="sourceCode js code-annotation-code code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1471;"><span id="annotated-cell-44-1472"><a href="#annotated-cell-44-1472" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="annotated-cell-44-1473"><a href="#annotated-cell-44-1473" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1474"><a href="#annotated-cell-44-1474" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="annotated-cell-44-1475"><a href="#annotated-cell-44-1475" aria-hidden="true" tabindex="-1"></a>    <span class="dt">code</span><span class="op">:</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="annotated-cell-44-1476"><a href="#annotated-cell-44-1476" aria-hidden="true" tabindex="-1"></a><span class="vs">      struct VertexInput {</span></span>
<span id="annotated-cell-44-1477"><a href="#annotated-cell-44-1477" aria-hidden="true" tabindex="-1"></a><span class="vs">        @location(0) pos: vec2f,</span></span>
<span id="annotated-cell-44-1478"><a href="#annotated-cell-44-1478" aria-hidden="true" tabindex="-1"></a><span class="vs">        @builtin(instance_index) instance: u32,</span></span>
<span id="annotated-cell-44-1479"><a href="#annotated-cell-44-1479" aria-hidden="true" tabindex="-1"></a><span class="vs">      };</span></span>
<span id="annotated-cell-44-1480"><a href="#annotated-cell-44-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1481"><a href="#annotated-cell-44-1481" aria-hidden="true" tabindex="-1"></a><span class="vs">      struct VertexOutput {</span></span>
<span id="annotated-cell-44-1482"><a href="#annotated-cell-44-1482" aria-hidden="true" tabindex="-1"></a><span class="vs">        @builtin(position) pos: vec4f,</span></span>
<span id="annotated-cell-44-1483"><a href="#annotated-cell-44-1483" aria-hidden="true" tabindex="-1"></a><span class="vs">        @location(0) cell: vec2f, // New line!</span></span>
<span id="annotated-cell-44-1484"><a href="#annotated-cell-44-1484" aria-hidden="true" tabindex="-1"></a><span class="vs">      };</span></span>
<span id="annotated-cell-44-1485"><a href="#annotated-cell-44-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1486"><a href="#annotated-cell-44-1486" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(0) var&lt;uniform&gt; grid: vec2f;</span></span>
<span id="annotated-cell-44-1487"><a href="#annotated-cell-44-1487" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(1) var&lt;storage&gt; cellState: array&lt;u32&gt;; // New!          </span></span>
<span id="annotated-cell-44-1488"><a href="#annotated-cell-44-1488" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="annotated-cell-44-1489"><a href="#annotated-cell-44-1489" aria-hidden="true" tabindex="-1"></a><span class="vs">      @vertex</span></span>
<span id="annotated-cell-44-1490"><a href="#annotated-cell-44-1490" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn vertexMain(@location(0) pos: vec2f,</span></span>
<span id="annotated-cell-44-1491"><a href="#annotated-cell-44-1491" aria-hidden="true" tabindex="-1"></a><span class="vs">                    @builtin(instance_index) instance: u32) -&gt; VertexOutput {</span></span>
<span id="annotated-cell-44-1492"><a href="#annotated-cell-44-1492" aria-hidden="true" tabindex="-1"></a><span class="vs">        let i = f32(instance);</span></span>
<span id="annotated-cell-44-1493"><a href="#annotated-cell-44-1493" aria-hidden="true" tabindex="-1"></a><span class="vs">        let cell = vec2f(i % grid.x, floor(i / grid.x));</span></span>
<span id="annotated-cell-44-1494"><a href="#annotated-cell-44-1494" aria-hidden="true" tabindex="-1"></a><span class="vs">        let state = f32(cellState[instance]); // New line!</span></span>
<span id="annotated-cell-44-1495"><a href="#annotated-cell-44-1495" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1496"><a href="#annotated-cell-44-1496" aria-hidden="true" tabindex="-1"></a><span class="vs">        let cellOffset = cell / grid * 2;</span></span>
<span id="annotated-cell-44-1497"><a href="#annotated-cell-44-1497" aria-hidden="true" tabindex="-1"></a><span class="vs">        // New: Scale the position by the cell's active state.</span></span>
<span id="annotated-cell-44-1498"><a href="#annotated-cell-44-1498" aria-hidden="true" tabindex="-1"></a><span class="vs">        let gridPos = (pos*state+1) / grid - 1 + cellOffset;</span></span>
<span id="annotated-cell-44-1499"><a href="#annotated-cell-44-1499" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1500"><a href="#annotated-cell-44-1500" aria-hidden="true" tabindex="-1"></a><span class="vs">        var output: VertexOutput;</span></span>
<span id="annotated-cell-44-1501"><a href="#annotated-cell-44-1501" aria-hidden="true" tabindex="-1"></a><span class="vs">        output.pos = vec4f(gridPos, 0, 1);</span></span>
<span id="annotated-cell-44-1502"><a href="#annotated-cell-44-1502" aria-hidden="true" tabindex="-1"></a><span class="vs">        output.cell = cell;</span></span>
<span id="annotated-cell-44-1503"><a href="#annotated-cell-44-1503" aria-hidden="true" tabindex="-1"></a><span class="vs">        return output;</span></span>
<span id="annotated-cell-44-1504"><a href="#annotated-cell-44-1504" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-44-1505"><a href="#annotated-cell-44-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1506"><a href="#annotated-cell-44-1506" aria-hidden="true" tabindex="-1"></a><span class="vs">      @fragment</span></span>
<span id="annotated-cell-44-1507"><a href="#annotated-cell-44-1507" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn fragmentMain(input: VertexOutput) -&gt; @location(0) vec4f {</span></span>
<span id="annotated-cell-44-1508"><a href="#annotated-cell-44-1508" aria-hidden="true" tabindex="-1"></a><span class="vs">        let c = input.cell / grid;</span></span>
<span id="annotated-cell-44-1509"><a href="#annotated-cell-44-1509" aria-hidden="true" tabindex="-1"></a><span class="vs">        return vec4f(c, 1-c.x, 1);</span></span>
<span id="annotated-cell-44-1510"><a href="#annotated-cell-44-1510" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-44-1511"><a href="#annotated-cell-44-1511" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">,</span></span>
<span id="annotated-cell-44-1512"><a href="#annotated-cell-44-1512" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-44-1513"><a href="#annotated-cell-44-1513" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1514"><a href="#annotated-cell-44-1514" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1515"><a href="#annotated-cell-44-1515" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create the compute shader that will process the simulation.</span></span>
<span id="annotated-cell-44-1516"><a href="#annotated-cell-44-1516" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> WORKGROUP_SIZE <span class="op">=</span> <span class="dv">8</span><span class="op">;</span></span>
<span id="annotated-cell-44-1517"><a href="#annotated-cell-44-1517" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> simulationShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="annotated-cell-44-1518"><a href="#annotated-cell-44-1518" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Game of Life simulation shader"</span><span class="op">,</span></span>
<span id="annotated-cell-44-1519"><a href="#annotated-cell-44-1519" aria-hidden="true" tabindex="-1"></a>    <span class="dt">code</span><span class="op">:</span> <span class="vs">`</span></span>
<span id="annotated-cell-44-1520"><a href="#annotated-cell-44-1520" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(0) var&lt;uniform&gt; grid: vec2f;</span></span>
<span id="annotated-cell-44-1521"><a href="#annotated-cell-44-1521" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1522"><a href="#annotated-cell-44-1522" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(1) var&lt;storage&gt; cellStateIn: array&lt;u32&gt;;</span></span>
<span id="annotated-cell-44-1523"><a href="#annotated-cell-44-1523" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(2) var&lt;storage, read_write&gt; cellStateOut: array&lt;u32&gt;;</span></span>
<span id="annotated-cell-44-1524"><a href="#annotated-cell-44-1524" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span></span>
<span id="annotated-cell-44-1525"><a href="#annotated-cell-44-1525" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn cellIndex(cell: vec2u) -&gt; u32 {</span></span>
<span id="annotated-cell-44-1526"><a href="#annotated-cell-44-1526" aria-hidden="true" tabindex="-1"></a><span class="vs">        return cell.y * u32(grid.x) + cell.x;</span></span>
<span id="annotated-cell-44-1527"><a href="#annotated-cell-44-1527" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-44-1528"><a href="#annotated-cell-44-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1529"><a href="#annotated-cell-44-1529" aria-hidden="true" tabindex="-1"></a><span class="vs">      @compute @workgroup_size(</span><span class="sc">${</span>WORKGROUP_SIZE<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>WORKGROUP_SIZE<span class="sc">}</span><span class="vs">)</span></span>
<span id="annotated-cell-44-1530"><a href="#annotated-cell-44-1530" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn computeMain(@builtin(global_invocation_id) cell: vec3u) {</span></span>
<span id="annotated-cell-44-1531"><a href="#annotated-cell-44-1531" aria-hidden="true" tabindex="-1"></a><span class="vs">        // New lines. Flip the cell state every step.</span></span>
<span id="annotated-cell-44-1532"><a href="#annotated-cell-44-1532" aria-hidden="true" tabindex="-1"></a><span class="vs">        if (cellStateIn[cellIndex(cell.xy)] == 1) {</span></span>
<span id="annotated-cell-44-1533"><a href="#annotated-cell-44-1533" aria-hidden="true" tabindex="-1"></a><span class="vs">          cellStateOut[cellIndex(cell.xy)] = 0;</span></span>
<span id="annotated-cell-44-1534"><a href="#annotated-cell-44-1534" aria-hidden="true" tabindex="-1"></a><span class="vs">        } else {</span></span>
<span id="annotated-cell-44-1535"><a href="#annotated-cell-44-1535" aria-hidden="true" tabindex="-1"></a><span class="vs">          cellStateOut[cellIndex(cell.xy)] = 1;</span></span>
<span id="annotated-cell-44-1536"><a href="#annotated-cell-44-1536" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="annotated-cell-44-1537"><a href="#annotated-cell-44-1537" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-44-1538"><a href="#annotated-cell-44-1538" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span></span>
<span id="annotated-cell-44-1539"><a href="#annotated-cell-44-1539" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-44-1540"><a href="#annotated-cell-44-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1541"><a href="#annotated-cell-44-1541" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> GRID_SIZE <span class="op">=</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="annotated-cell-44-1542"><a href="#annotated-cell-44-1542" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> uniformBuffer <span class="op">=</span> <span class="fu">createUniformBuffer</span>(GRID_SIZE)<span class="op">;</span></span>
<span id="annotated-cell-44-1543"><a href="#annotated-cell-44-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1544"><a href="#annotated-cell-44-1544" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create an array representing the active state of each cell.</span></span>
<span id="annotated-cell-44-1545"><a href="#annotated-cell-44-1545" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellStateArray <span class="op">=</span> <span class="kw">new</span> <span class="bu">Uint32Array</span>(GRID_SIZE <span class="op">*</span> GRID_SIZE)<span class="op">;</span></span>
<span id="annotated-cell-44-1546"><a href="#annotated-cell-44-1546" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1547"><a href="#annotated-cell-44-1547" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create two storage buffers to hold the cell state.</span></span>
<span id="annotated-cell-44-1548"><a href="#annotated-cell-44-1548" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellStateStorage <span class="op">=</span> [</span>
<span id="annotated-cell-44-1549"><a href="#annotated-cell-44-1549" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="fu">createBuffer</span>({</span>
<span id="annotated-cell-44-1550"><a href="#annotated-cell-44-1550" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell State A"</span><span class="op">,</span></span>
<span id="annotated-cell-44-1551"><a href="#annotated-cell-44-1551" aria-hidden="true" tabindex="-1"></a>      <span class="dt">size</span><span class="op">:</span> cellStateArray<span class="op">.</span><span class="at">byteLength</span><span class="op">,</span></span>
<span id="annotated-cell-44-1552"><a href="#annotated-cell-44-1552" aria-hidden="true" tabindex="-1"></a>      <span class="dt">usage</span><span class="op">:</span> GPUBufferUsage<span class="op">.</span><span class="at">STORAGE</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span><span class="op">,</span></span>
<span id="annotated-cell-44-1553"><a href="#annotated-cell-44-1553" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="annotated-cell-44-1554"><a href="#annotated-cell-44-1554" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="fu">createBuffer</span>({</span>
<span id="annotated-cell-44-1555"><a href="#annotated-cell-44-1555" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell State B"</span><span class="op">,</span></span>
<span id="annotated-cell-44-1556"><a href="#annotated-cell-44-1556" aria-hidden="true" tabindex="-1"></a>      <span class="dt">size</span><span class="op">:</span> cellStateArray<span class="op">.</span><span class="at">byteLength</span><span class="op">,</span></span>
<span id="annotated-cell-44-1557"><a href="#annotated-cell-44-1557" aria-hidden="true" tabindex="-1"></a>      <span class="dt">usage</span><span class="op">:</span> GPUBufferUsage<span class="op">.</span><span class="at">STORAGE</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span><span class="op">,</span></span>
<span id="annotated-cell-44-1558"><a href="#annotated-cell-44-1558" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="annotated-cell-44-1559"><a href="#annotated-cell-44-1559" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="annotated-cell-44-1560"><a href="#annotated-cell-44-1560" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1561"><a href="#annotated-cell-44-1561" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mark every third cell of the first grid as active.</span></span>
<span id="annotated-cell-44-1562"><a href="#annotated-cell-44-1562" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> cellStateArray<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">+=</span><span class="dv">3</span>) {</span>
<span id="annotated-cell-44-1563"><a href="#annotated-cell-44-1563" aria-hidden="true" tabindex="-1"></a>    cellStateArray[i] <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="annotated-cell-44-1564"><a href="#annotated-cell-44-1564" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="annotated-cell-44-1565"><a href="#annotated-cell-44-1565" aria-hidden="true" tabindex="-1"></a>  device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">writeBuffer</span>(cellStateStorage[<span class="dv">0</span>]<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> cellStateArray)<span class="op">;</span></span>
<span id="annotated-cell-44-1566"><a href="#annotated-cell-44-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1567"><a href="#annotated-cell-44-1567" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mark every other cell of the second grid as active.</span></span>
<span id="annotated-cell-44-1568"><a href="#annotated-cell-44-1568" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> cellStateArray<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="annotated-cell-44-1569"><a href="#annotated-cell-44-1569" aria-hidden="true" tabindex="-1"></a>    cellStateArray[i] <span class="op">=</span> i <span class="op">%</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="annotated-cell-44-1570"><a href="#annotated-cell-44-1570" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="annotated-cell-44-1571"><a href="#annotated-cell-44-1571" aria-hidden="true" tabindex="-1"></a>  device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">writeBuffer</span>(cellStateStorage[<span class="dv">1</span>]<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> cellStateArray)<span class="op">;</span></span>
<span id="annotated-cell-44-1572"><a href="#annotated-cell-44-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1573"><a href="#annotated-cell-44-1573" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1574"><a href="#annotated-cell-44-1574" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create the bind group layout and pipeline layout.</span></span>
<span id="annotated-cell-44-1575"><a href="#annotated-cell-44-1575" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bindGroupLayout <span class="op">=</span> device<span class="op">.</span><span class="fu">createBindGroupLayout</span>({</span>
<span id="annotated-cell-44-1576"><a href="#annotated-cell-44-1576" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell Bind Group Layout"</span><span class="op">,</span></span>
<span id="annotated-cell-44-1577"><a href="#annotated-cell-44-1577" aria-hidden="true" tabindex="-1"></a>    <span class="dt">entries</span><span class="op">:</span> [{</span>
<span id="annotated-cell-44-1578"><a href="#annotated-cell-44-1578" aria-hidden="true" tabindex="-1"></a>      <span class="dt">binding</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="annotated-cell-44-1579"><a href="#annotated-cell-44-1579" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Fragment stage included because the `grid` uniform is also read in fragmentMain.</span></span>
<span id="annotated-cell-44-1580"><a href="#annotated-cell-44-1580" aria-hidden="true" tabindex="-1"></a>      <span class="dt">visibility</span><span class="op">:</span> GPUShaderStage<span class="op">.</span><span class="at">VERTEX</span> <span class="op">|</span> GPUShaderStage<span class="op">.</span><span class="at">FRAGMENT</span> <span class="op">|</span> GPUShaderStage<span class="op">.</span><span class="at">COMPUTE</span><span class="op">,</span></span>
<span id="annotated-cell-44-1581"><a href="#annotated-cell-44-1581" aria-hidden="true" tabindex="-1"></a>      <span class="dt">buffer</span><span class="op">:</span> {} <span class="co">// Grid uniform buffer</span></span>
<span id="annotated-cell-44-1582"><a href="#annotated-cell-44-1582" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> {</span>
<span id="annotated-cell-44-1583"><a href="#annotated-cell-44-1583" aria-hidden="true" tabindex="-1"></a>      <span class="dt">binding</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="annotated-cell-44-1584"><a href="#annotated-cell-44-1584" aria-hidden="true" tabindex="-1"></a>      <span class="dt">visibility</span><span class="op">:</span> GPUShaderStage<span class="op">.</span><span class="at">VERTEX</span> <span class="op">|</span> GPUShaderStage<span class="op">.</span><span class="at">COMPUTE</span><span class="op">,</span></span>
<span id="annotated-cell-44-1585"><a href="#annotated-cell-44-1585" aria-hidden="true" tabindex="-1"></a>      <span class="dt">buffer</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"read-only-storage"</span>} <span class="co">// Cell state input buffer</span></span>
<span id="annotated-cell-44-1586"><a href="#annotated-cell-44-1586" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> {</span>
<span id="annotated-cell-44-1587"><a href="#annotated-cell-44-1587" aria-hidden="true" tabindex="-1"></a>      <span class="dt">binding</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="annotated-cell-44-1588"><a href="#annotated-cell-44-1588" aria-hidden="true" tabindex="-1"></a>      <span class="dt">visibility</span><span class="op">:</span> GPUShaderStage<span class="op">.</span><span class="at">COMPUTE</span><span class="op">,</span></span>
<span id="annotated-cell-44-1589"><a href="#annotated-cell-44-1589" aria-hidden="true" tabindex="-1"></a>      <span class="dt">buffer</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"storage"</span>} <span class="co">// Cell state output buffer</span></span>
<span id="annotated-cell-44-1590"><a href="#annotated-cell-44-1590" aria-hidden="true" tabindex="-1"></a>    }]</span>
<span id="annotated-cell-44-1591"><a href="#annotated-cell-44-1591" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-44-1592"><a href="#annotated-cell-44-1592" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1593"><a href="#annotated-cell-44-1593" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create a bind group to pass the grid uniforms into the pipeline</span></span>
<span id="annotated-cell-44-1594"><a href="#annotated-cell-44-1594" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bindGroups <span class="op">=</span> [</span>
<span id="annotated-cell-44-1595"><a href="#annotated-cell-44-1595" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="fu">createBindGroup</span>({</span>
<span id="annotated-cell-44-1596"><a href="#annotated-cell-44-1596" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell renderer bind group A"</span><span class="op">,</span></span>
<span id="annotated-cell-44-1597"><a href="#annotated-cell-44-1597" aria-hidden="true" tabindex="-1"></a>      <span class="dt">layout</span><span class="op">:</span> bindGroupLayout<span class="op">,</span> <span class="co">// Updated Line</span></span>
<span id="annotated-cell-44-1598"><a href="#annotated-cell-44-1598" aria-hidden="true" tabindex="-1"></a>      <span class="dt">entries</span><span class="op">:</span> [{</span>
<span id="annotated-cell-44-1599"><a href="#annotated-cell-44-1599" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="annotated-cell-44-1600"><a href="#annotated-cell-44-1600" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> uniformBuffer }</span>
<span id="annotated-cell-44-1601"><a href="#annotated-cell-44-1601" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> {</span>
<span id="annotated-cell-44-1602"><a href="#annotated-cell-44-1602" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="annotated-cell-44-1603"><a href="#annotated-cell-44-1603" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> cellStateStorage[<span class="dv">0</span>] }</span>
<span id="annotated-cell-44-1604"><a href="#annotated-cell-44-1604" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> {</span>
<span id="annotated-cell-44-1605"><a href="#annotated-cell-44-1605" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="co">// New Entry</span></span>
<span id="annotated-cell-44-1606"><a href="#annotated-cell-44-1606" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> cellStateStorage[<span class="dv">1</span>] }</span>
<span id="annotated-cell-44-1607"><a href="#annotated-cell-44-1607" aria-hidden="true" tabindex="-1"></a>      }]<span class="op">,</span></span>
<span id="annotated-cell-44-1608"><a href="#annotated-cell-44-1608" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="annotated-cell-44-1609"><a href="#annotated-cell-44-1609" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="fu">createBindGroup</span>({</span>
<span id="annotated-cell-44-1610"><a href="#annotated-cell-44-1610" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell renderer bind group B"</span><span class="op">,</span></span>
<span id="annotated-cell-44-1611"><a href="#annotated-cell-44-1611" aria-hidden="true" tabindex="-1"></a>      <span class="dt">layout</span><span class="op">:</span> bindGroupLayout<span class="op">,</span> <span class="co">// Updated Line</span></span>
<span id="annotated-cell-44-1612"><a href="#annotated-cell-44-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1613"><a href="#annotated-cell-44-1613" aria-hidden="true" tabindex="-1"></a>      <span class="dt">entries</span><span class="op">:</span> [{</span>
<span id="annotated-cell-44-1614"><a href="#annotated-cell-44-1614" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="annotated-cell-44-1615"><a href="#annotated-cell-44-1615" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> uniformBuffer }</span>
<span id="annotated-cell-44-1616"><a href="#annotated-cell-44-1616" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> {</span>
<span id="annotated-cell-44-1617"><a href="#annotated-cell-44-1617" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="annotated-cell-44-1618"><a href="#annotated-cell-44-1618" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> cellStateStorage[<span class="dv">1</span>] }</span>
<span id="annotated-cell-44-1619"><a href="#annotated-cell-44-1619" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> {</span>
<span id="annotated-cell-44-1620"><a href="#annotated-cell-44-1620" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="co">// New Entry</span></span>
<span id="annotated-cell-44-1621"><a href="#annotated-cell-44-1621" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> cellStateStorage[<span class="dv">0</span>] }</span>
<span id="annotated-cell-44-1622"><a href="#annotated-cell-44-1622" aria-hidden="true" tabindex="-1"></a>      }]<span class="op">,</span></span>
<span id="annotated-cell-44-1623"><a href="#annotated-cell-44-1623" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="annotated-cell-44-1624"><a href="#annotated-cell-44-1624" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="annotated-cell-44-1625"><a href="#annotated-cell-44-1625" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1626"><a href="#annotated-cell-44-1626" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pipelineLayout <span class="op">=</span> device<span class="op">.</span><span class="fu">createPipelineLayout</span>({</span>
<span id="annotated-cell-44-1627"><a href="#annotated-cell-44-1627" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell Pipeline Layout"</span><span class="op">,</span></span>
<span id="annotated-cell-44-1628"><a href="#annotated-cell-44-1628" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bindGroupLayouts</span><span class="op">:</span> [ bindGroupLayout ]<span class="op">,</span></span>
<span id="annotated-cell-44-1629"><a href="#annotated-cell-44-1629" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-44-1630"><a href="#annotated-cell-44-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1631"><a href="#annotated-cell-44-1631" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellPipeline <span class="op">=</span> device<span class="op">.</span><span class="fu">createRenderPipeline</span>({</span>
<span id="annotated-cell-44-1632"><a href="#annotated-cell-44-1632" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell pipeline"</span><span class="op">,</span></span>
<span id="annotated-cell-44-1633"><a href="#annotated-cell-44-1633" aria-hidden="true" tabindex="-1"></a>    <span class="dt">layout</span><span class="op">:</span> pipelineLayout<span class="op">,</span></span>
<span id="annotated-cell-44-1634"><a href="#annotated-cell-44-1634" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vertex</span><span class="op">:</span> {</span>
<span id="annotated-cell-44-1635"><a href="#annotated-cell-44-1635" aria-hidden="true" tabindex="-1"></a>      <span class="dt">module</span><span class="op">:</span> cellShaderModule<span class="op">,</span></span>
<span id="annotated-cell-44-1636"><a href="#annotated-cell-44-1636" aria-hidden="true" tabindex="-1"></a>      <span class="dt">entryPoint</span><span class="op">:</span> <span class="st">"vertexMain"</span><span class="op">,</span></span>
<span id="annotated-cell-44-1637"><a href="#annotated-cell-44-1637" aria-hidden="true" tabindex="-1"></a>      <span class="dt">buffers</span><span class="op">:</span> [cellVertexBufferLayout]</span>
<span id="annotated-cell-44-1638"><a href="#annotated-cell-44-1638" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="annotated-cell-44-1639"><a href="#annotated-cell-44-1639" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fragment</span><span class="op">:</span> {</span>
<span id="annotated-cell-44-1640"><a href="#annotated-cell-44-1640" aria-hidden="true" tabindex="-1"></a>      <span class="dt">module</span><span class="op">:</span> cellShaderModule<span class="op">,</span></span>
<span id="annotated-cell-44-1641"><a href="#annotated-cell-44-1641" aria-hidden="true" tabindex="-1"></a>      <span class="dt">entryPoint</span><span class="op">:</span> <span class="st">"fragmentMain"</span><span class="op">,</span></span>
<span id="annotated-cell-44-1642"><a href="#annotated-cell-44-1642" aria-hidden="true" tabindex="-1"></a>      <span class="dt">targets</span><span class="op">:</span> [{ <span class="dt">format</span><span class="op">:</span> presentationFormat }]</span>
<span id="annotated-cell-44-1643"><a href="#annotated-cell-44-1643" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="annotated-cell-44-1644"><a href="#annotated-cell-44-1644" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-44-1645"><a href="#annotated-cell-44-1645" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1646"><a href="#annotated-cell-44-1646" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create a compute pipeline that updates the game state.</span></span>
<span id="annotated-cell-44-1647"><a href="#annotated-cell-44-1647" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> simulationPipeline <span class="op">=</span> device<span class="op">.</span><span class="fu">createComputePipeline</span>({</span>
<span id="annotated-cell-44-1648"><a href="#annotated-cell-44-1648" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Simulation pipeline"</span><span class="op">,</span></span>
<span id="annotated-cell-44-1649"><a href="#annotated-cell-44-1649" aria-hidden="true" tabindex="-1"></a>    <span class="dt">layout</span><span class="op">:</span> pipelineLayout<span class="op">,</span></span>
<span id="annotated-cell-44-1650"><a href="#annotated-cell-44-1650" aria-hidden="true" tabindex="-1"></a>    <span class="dt">compute</span><span class="op">:</span> {</span>
<span id="annotated-cell-44-1651"><a href="#annotated-cell-44-1651" aria-hidden="true" tabindex="-1"></a>      <span class="dt">module</span><span class="op">:</span> simulationShaderModule<span class="op">,</span></span>
<span id="annotated-cell-44-1652"><a href="#annotated-cell-44-1652" aria-hidden="true" tabindex="-1"></a>      <span class="dt">entryPoint</span><span class="op">:</span> <span class="st">"computeMain"</span><span class="op">,</span></span>
<span id="annotated-cell-44-1653"><a href="#annotated-cell-44-1653" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="annotated-cell-44-1654"><a href="#annotated-cell-44-1654" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-44-1655"><a href="#annotated-cell-44-1655" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1656"><a href="#annotated-cell-44-1656" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> <span class="fu">createCanvas</span>(<span class="dv">512</span><span class="op">,</span> <span class="dv">512</span>)<span class="op">;</span></span>
<span id="annotated-cell-44-1657"><a href="#annotated-cell-44-1657" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctx <span class="op">=</span> <span class="fu">setupContext</span>(canvas<span class="op">,</span> device<span class="op">,</span> presentationFormat)<span class="op">;</span></span>
<span id="annotated-cell-44-1658"><a href="#annotated-cell-44-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1659"><a href="#annotated-cell-44-1659" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> UPDATE_INTERVAL <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> <span class="co">// Update every 200ms (5 times/sec)</span></span>
<span id="annotated-cell-44-1660"><a href="#annotated-cell-44-1660" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> step <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// Track how many simulation steps have been run</span></span>
<span id="annotated-cell-44-1661"><a href="#annotated-cell-44-1661" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1662"><a href="#annotated-cell-44-1662" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Move all of our rendering code into a function</span></span>
<span id="annotated-cell-44-1663"><a href="#annotated-cell-44-1663" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateGrid</span>() {</span>
<span id="annotated-cell-44-1664"><a href="#annotated-cell-44-1664" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-44-1665"><a href="#annotated-cell-44-1665" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Start a render pass </span></span>
<span id="annotated-cell-44-1666"><a href="#annotated-cell-44-1666" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> encoder <span class="op">=</span> device<span class="op">.</span><span class="fu">createCommandEncoder</span>()<span class="op">;</span></span>
<span id="annotated-cell-44-1667"><a href="#annotated-cell-44-1667" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1668"><a href="#annotated-cell-44-1668" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> computePass <span class="op">=</span> encoder<span class="op">.</span><span class="fu">beginComputePass</span>()<span class="op">;</span></span>
<span id="annotated-cell-44-1669"><a href="#annotated-cell-44-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1670"><a href="#annotated-cell-44-1670" aria-hidden="true" tabindex="-1"></a>    computePass<span class="op">.</span><span class="fu">setPipeline</span>(simulationPipeline)<span class="op">;</span></span>
<span id="annotated-cell-44-1671"><a href="#annotated-cell-44-1671" aria-hidden="true" tabindex="-1"></a>    computePass<span class="op">.</span><span class="fu">setBindGroup</span>(<span class="dv">0</span><span class="op">,</span> bindGroups[step <span class="op">%</span> <span class="dv">2</span>])<span class="op">;</span></span>
<span id="annotated-cell-44-1672"><a href="#annotated-cell-44-1672" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1673"><a href="#annotated-cell-44-1673" aria-hidden="true" tabindex="-1"></a>    <span class="co">// New lines</span></span>
<span id="annotated-cell-44-1674"><a href="#annotated-cell-44-1674" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> workgroupCount <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(GRID_SIZE <span class="op">/</span> WORKGROUP_SIZE)<span class="op">;</span></span>
<span id="annotated-cell-44-1675"><a href="#annotated-cell-44-1675" aria-hidden="true" tabindex="-1"></a>    computePass<span class="op">.</span><span class="fu">dispatchWorkgroups</span>(workgroupCount<span class="op">,</span> workgroupCount)<span class="op">;</span></span>
<span id="annotated-cell-44-1676"><a href="#annotated-cell-44-1676" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1677"><a href="#annotated-cell-44-1677" aria-hidden="true" tabindex="-1"></a>    computePass<span class="op">.</span><span class="fu">end</span>()<span class="op">;</span></span>
<span id="annotated-cell-44-1678"><a href="#annotated-cell-44-1678" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1679"><a href="#annotated-cell-44-1679" aria-hidden="true" tabindex="-1"></a>    step<span class="op">++;</span> <span class="co">// Increment the step count</span></span>
<span id="annotated-cell-44-1680"><a href="#annotated-cell-44-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1681"><a href="#annotated-cell-44-1681" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> view <span class="op">=</span> ctx<span class="op">.</span><span class="fu">getCurrentTexture</span>()<span class="op">.</span><span class="fu">createView</span>()<span class="op">;</span></span>
<span id="annotated-cell-44-1682"><a href="#annotated-cell-44-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1683"><a href="#annotated-cell-44-1683" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pass <span class="op">=</span> encoder<span class="op">.</span><span class="fu">beginRenderPass</span>({</span>
<span id="annotated-cell-44-1684"><a href="#annotated-cell-44-1684" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorAttachments</span><span class="op">:</span> [{</span>
<span id="annotated-cell-44-1685"><a href="#annotated-cell-44-1685" aria-hidden="true" tabindex="-1"></a>        <span class="dt">view</span><span class="op">:</span> view<span class="op">,</span></span>
<span id="annotated-cell-44-1686"><a href="#annotated-cell-44-1686" aria-hidden="true" tabindex="-1"></a>        <span class="dt">loadOp</span><span class="op">:</span> <span class="st">"clear"</span><span class="op">,</span></span>
<span id="annotated-cell-44-1687"><a href="#annotated-cell-44-1687" aria-hidden="true" tabindex="-1"></a>        <span class="dt">storeOp</span><span class="op">:</span> <span class="st">"store"</span><span class="op">,</span></span>
<span id="annotated-cell-44-1688"><a href="#annotated-cell-44-1688" aria-hidden="true" tabindex="-1"></a>        <span class="dt">clearValue</span><span class="op">:</span> { <span class="dt">r</span><span class="op">:</span> <span class="fl">0.02</span><span class="op">,</span> <span class="dt">g</span><span class="op">:</span> <span class="fl">0.06</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span> <span class="fl">0.15</span><span class="op">,</span> <span class="dt">a</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="annotated-cell-44-1689"><a href="#annotated-cell-44-1689" aria-hidden="true" tabindex="-1"></a>      }]<span class="op">,</span></span>
<span id="annotated-cell-44-1690"><a href="#annotated-cell-44-1690" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="annotated-cell-44-1691"><a href="#annotated-cell-44-1691" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1692"><a href="#annotated-cell-44-1692" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1693"><a href="#annotated-cell-44-1693" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw the grid.</span></span>
<span id="annotated-cell-44-1694"><a href="#annotated-cell-44-1694" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">setPipeline</span>(cellPipeline)<span class="op">;</span></span>
<span id="annotated-cell-44-1695"><a href="#annotated-cell-44-1695" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">setBindGroup</span>(<span class="dv">0</span><span class="op">,</span> bindGroups[step <span class="op">%</span> <span class="dv">2</span>])<span class="op">;</span> <span class="co">// Updated!</span></span>
<span id="annotated-cell-44-1696"><a href="#annotated-cell-44-1696" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">setVertexBuffer</span>(<span class="dv">0</span><span class="op">,</span> vertexBuffer)<span class="op">;</span></span>
<span id="annotated-cell-44-1697"><a href="#annotated-cell-44-1697" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">draw</span>(cellVertices<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> GRID_SIZE <span class="op">*</span> GRID_SIZE)<span class="op">;</span></span>
<span id="annotated-cell-44-1698"><a href="#annotated-cell-44-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1699"><a href="#annotated-cell-44-1699" aria-hidden="true" tabindex="-1"></a>    <span class="co">// End the render pass and submit the command buffer</span></span>
<span id="annotated-cell-44-1700"><a href="#annotated-cell-44-1700" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">end</span>()<span class="op">;</span></span>
<span id="annotated-cell-44-1701"><a href="#annotated-cell-44-1701" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">submit</span>([encoder<span class="op">.</span><span class="fu">finish</span>()])<span class="op">;</span></span>
<span id="annotated-cell-44-1702"><a href="#annotated-cell-44-1702" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="annotated-cell-44-1703"><a href="#annotated-cell-44-1703" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1704"><a href="#annotated-cell-44-1704" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Schedule updateGrid() to run repeatedly</span></span>
<span id="annotated-cell-44-1705"><a href="#annotated-cell-44-1705" aria-hidden="true" tabindex="-1"></a>  <span class="pp">setInterval</span>(updateGrid<span class="op">,</span> UPDATE_INTERVAL)<span class="op">;</span></span>
<span id="annotated-cell-44-1706"><a href="#annotated-cell-44-1706" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1707"><a href="#annotated-cell-44-1707" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> canvas<span class="op">;</span></span>
<span id="annotated-cell-44-1708"><a href="#annotated-cell-44-1708" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-44-1709"><a href="#annotated-cell-44-1709" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-16" data-nodetype="expression">

</div>
</div>
</div>
</section>
<section id="run-the-simulation-final" class="slide level2 center">
<h2>Run the simulation (final)</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="annotated-cell-45" data-startfrom="1715" data-source-offset="0"><pre class="sourceCode js code-annotation-code code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1714;"><span id="annotated-cell-45-1715"><a href="#annotated-cell-45-1715" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="annotated-cell-45-1716"><a href="#annotated-cell-45-1716" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1717"><a href="#annotated-cell-45-1717" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="annotated-cell-45-1718"><a href="#annotated-cell-45-1718" aria-hidden="true" tabindex="-1"></a>    <span class="dt">code</span><span class="op">:</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="annotated-cell-45-1719"><a href="#annotated-cell-45-1719" aria-hidden="true" tabindex="-1"></a><span class="vs">      struct VertexInput {</span></span>
<span id="annotated-cell-45-1720"><a href="#annotated-cell-45-1720" aria-hidden="true" tabindex="-1"></a><span class="vs">        @location(0) pos: vec2f,</span></span>
<span id="annotated-cell-45-1721"><a href="#annotated-cell-45-1721" aria-hidden="true" tabindex="-1"></a><span class="vs">        @builtin(instance_index) instance: u32,</span></span>
<span id="annotated-cell-45-1722"><a href="#annotated-cell-45-1722" aria-hidden="true" tabindex="-1"></a><span class="vs">      };</span></span>
<span id="annotated-cell-45-1723"><a href="#annotated-cell-45-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1724"><a href="#annotated-cell-45-1724" aria-hidden="true" tabindex="-1"></a><span class="vs">      struct VertexOutput {</span></span>
<span id="annotated-cell-45-1725"><a href="#annotated-cell-45-1725" aria-hidden="true" tabindex="-1"></a><span class="vs">        @builtin(position) pos: vec4f,</span></span>
<span id="annotated-cell-45-1726"><a href="#annotated-cell-45-1726" aria-hidden="true" tabindex="-1"></a><span class="vs">        @location(0) cell: vec2f, // New line!</span></span>
<span id="annotated-cell-45-1727"><a href="#annotated-cell-45-1727" aria-hidden="true" tabindex="-1"></a><span class="vs">      };</span></span>
<span id="annotated-cell-45-1728"><a href="#annotated-cell-45-1728" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1729"><a href="#annotated-cell-45-1729" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(0) var&lt;uniform&gt; grid: vec2f;</span></span>
<span id="annotated-cell-45-1730"><a href="#annotated-cell-45-1730" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(1) var&lt;storage&gt; cellState: array&lt;u32&gt;; // New!          </span></span>
<span id="annotated-cell-45-1731"><a href="#annotated-cell-45-1731" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="annotated-cell-45-1732"><a href="#annotated-cell-45-1732" aria-hidden="true" tabindex="-1"></a><span class="vs">      @vertex</span></span>
<span id="annotated-cell-45-1733"><a href="#annotated-cell-45-1733" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn vertexMain(@location(0) pos: vec2f,</span></span>
<span id="annotated-cell-45-1734"><a href="#annotated-cell-45-1734" aria-hidden="true" tabindex="-1"></a><span class="vs">                    @builtin(instance_index) instance: u32) -&gt; VertexOutput {</span></span>
<span id="annotated-cell-45-1735"><a href="#annotated-cell-45-1735" aria-hidden="true" tabindex="-1"></a><span class="vs">        let i = f32(instance);</span></span>
<span id="annotated-cell-45-1736"><a href="#annotated-cell-45-1736" aria-hidden="true" tabindex="-1"></a><span class="vs">        let cell = vec2f(i % grid.x, floor(i / grid.x));</span></span>
<span id="annotated-cell-45-1737"><a href="#annotated-cell-45-1737" aria-hidden="true" tabindex="-1"></a><span class="vs">        let state = f32(cellState[instance]); // New line!</span></span>
<span id="annotated-cell-45-1738"><a href="#annotated-cell-45-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1739"><a href="#annotated-cell-45-1739" aria-hidden="true" tabindex="-1"></a><span class="vs">        let cellOffset = cell / grid * 2;</span></span>
<span id="annotated-cell-45-1740"><a href="#annotated-cell-45-1740" aria-hidden="true" tabindex="-1"></a><span class="vs">        // New: Scale the position by the cell's active state.</span></span>
<span id="annotated-cell-45-1741"><a href="#annotated-cell-45-1741" aria-hidden="true" tabindex="-1"></a><span class="vs">        let gridPos = (pos*state+1) / grid - 1 + cellOffset;</span></span>
<span id="annotated-cell-45-1742"><a href="#annotated-cell-45-1742" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1743"><a href="#annotated-cell-45-1743" aria-hidden="true" tabindex="-1"></a><span class="vs">        var output: VertexOutput;</span></span>
<span id="annotated-cell-45-1744"><a href="#annotated-cell-45-1744" aria-hidden="true" tabindex="-1"></a><span class="vs">        output.pos = vec4f(gridPos, 0, 1);</span></span>
<span id="annotated-cell-45-1745"><a href="#annotated-cell-45-1745" aria-hidden="true" tabindex="-1"></a><span class="vs">        output.cell = cell;</span></span>
<span id="annotated-cell-45-1746"><a href="#annotated-cell-45-1746" aria-hidden="true" tabindex="-1"></a><span class="vs">        return output;</span></span>
<span id="annotated-cell-45-1747"><a href="#annotated-cell-45-1747" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-45-1748"><a href="#annotated-cell-45-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1749"><a href="#annotated-cell-45-1749" aria-hidden="true" tabindex="-1"></a><span class="vs">      @fragment</span></span>
<span id="annotated-cell-45-1750"><a href="#annotated-cell-45-1750" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn fragmentMain(input: VertexOutput) -&gt; @location(0) vec4f {</span></span>
<span id="annotated-cell-45-1751"><a href="#annotated-cell-45-1751" aria-hidden="true" tabindex="-1"></a><span class="vs">        let c = input.cell / grid;</span></span>
<span id="annotated-cell-45-1752"><a href="#annotated-cell-45-1752" aria-hidden="true" tabindex="-1"></a><span class="vs">        return vec4f(c, 1-c.x, 1);</span></span>
<span id="annotated-cell-45-1753"><a href="#annotated-cell-45-1753" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-45-1754"><a href="#annotated-cell-45-1754" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span><span class="op">,</span></span>
<span id="annotated-cell-45-1755"><a href="#annotated-cell-45-1755" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-45-1756"><a href="#annotated-cell-45-1756" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1757"><a href="#annotated-cell-45-1757" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1758"><a href="#annotated-cell-45-1758" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create the compute shader that will process the simulation.</span></span>
<span id="annotated-cell-45-1759"><a href="#annotated-cell-45-1759" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> WORKGROUP_SIZE <span class="op">=</span> <span class="dv">8</span><span class="op">;</span></span>
<span id="annotated-cell-45-1760"><a href="#annotated-cell-45-1760" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> simulationShaderModule <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({</span>
<span id="annotated-cell-45-1761"><a href="#annotated-cell-45-1761" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Life simulation shader"</span><span class="op">,</span></span>
<span id="annotated-cell-45-1762"><a href="#annotated-cell-45-1762" aria-hidden="true" tabindex="-1"></a>    <span class="dt">code</span><span class="op">:</span> <span class="vs">`</span></span>
<span id="annotated-cell-45-1763"><a href="#annotated-cell-45-1763" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(0) var&lt;uniform&gt; grid: vec2f;</span></span>
<span id="annotated-cell-45-1764"><a href="#annotated-cell-45-1764" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1765"><a href="#annotated-cell-45-1765" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(1) var&lt;storage&gt; cellStateIn: array&lt;u32&gt;;</span></span>
<span id="annotated-cell-45-1766"><a href="#annotated-cell-45-1766" aria-hidden="true" tabindex="-1"></a><span class="vs">      @group(0) @binding(2) var&lt;storage, read_write&gt; cellStateOut: array&lt;u32&gt;;</span></span>
<span id="annotated-cell-45-1767"><a href="#annotated-cell-45-1767" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1768"><a href="#annotated-cell-45-1768" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn cellIndex(cell: vec2u) -&gt; u32 {</span></span>
<span id="annotated-cell-45-1769"><a href="#annotated-cell-45-1769" aria-hidden="true" tabindex="-1"></a><span class="vs">        return (cell.y % u32(grid.y)) * u32(grid.x) +</span></span>
<span id="annotated-cell-45-1770"><a href="#annotated-cell-45-1770" aria-hidden="true" tabindex="-1"></a><span class="vs">                (cell.x % u32(grid.x));</span></span>
<span id="annotated-cell-45-1771"><a href="#annotated-cell-45-1771" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-45-1772"><a href="#annotated-cell-45-1772" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1773"><a href="#annotated-cell-45-1773" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn cellActive(x: u32, y: u32) -&gt; u32 {</span></span>
<span id="annotated-cell-45-1774"><a href="#annotated-cell-45-1774" aria-hidden="true" tabindex="-1"></a><span class="vs">        return cellStateIn[cellIndex(vec2(x, y))];</span></span>
<span id="annotated-cell-45-1775"><a href="#annotated-cell-45-1775" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-45-1776"><a href="#annotated-cell-45-1776" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1777"><a href="#annotated-cell-45-1777" aria-hidden="true" tabindex="-1"></a><span class="vs">      @compute @workgroup_size(</span><span class="sc">${</span>WORKGROUP_SIZE<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>WORKGROUP_SIZE<span class="sc">}</span><span class="vs">)</span></span>
<span id="annotated-cell-45-1778"><a href="#annotated-cell-45-1778" aria-hidden="true" tabindex="-1"></a><span class="vs">      fn computeMain(@builtin(global_invocation_id) cell: vec3u) {</span></span>
<span id="annotated-cell-45-1779"><a href="#annotated-cell-45-1779" aria-hidden="true" tabindex="-1"></a><span class="vs">        // Determine how many active neighbors this cell has.</span></span>
<span id="annotated-cell-45-1780"><a href="#annotated-cell-45-1780" aria-hidden="true" tabindex="-1"></a><span class="vs">        let activeNeighbors = cellActive(cell.x+1, cell.y+1) +</span></span>
<span id="annotated-cell-45-1781"><a href="#annotated-cell-45-1781" aria-hidden="true" tabindex="-1"></a><span class="vs">                              cellActive(cell.x+1, cell.y) +</span></span>
<span id="annotated-cell-45-1782"><a href="#annotated-cell-45-1782" aria-hidden="true" tabindex="-1"></a><span class="vs">                              cellActive(cell.x+1, cell.y-1) +</span></span>
<span id="annotated-cell-45-1783"><a href="#annotated-cell-45-1783" aria-hidden="true" tabindex="-1"></a><span class="vs">                              cellActive(cell.x, cell.y-1) +</span></span>
<span id="annotated-cell-45-1784"><a href="#annotated-cell-45-1784" aria-hidden="true" tabindex="-1"></a><span class="vs">                              cellActive(cell.x-1, cell.y-1) +</span></span>
<span id="annotated-cell-45-1785"><a href="#annotated-cell-45-1785" aria-hidden="true" tabindex="-1"></a><span class="vs">                              cellActive(cell.x-1, cell.y) +</span></span>
<span id="annotated-cell-45-1786"><a href="#annotated-cell-45-1786" aria-hidden="true" tabindex="-1"></a><span class="vs">                              cellActive(cell.x-1, cell.y+1) +</span></span>
<span id="annotated-cell-45-1787"><a href="#annotated-cell-45-1787" aria-hidden="true" tabindex="-1"></a><span class="vs">                              cellActive(cell.x, cell.y+1);</span></span>
<span id="annotated-cell-45-1788"><a href="#annotated-cell-45-1788" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1789"><a href="#annotated-cell-45-1789" aria-hidden="true" tabindex="-1"></a><span class="vs">        let i = cellIndex(cell.xy);</span></span>
<span id="annotated-cell-45-1790"><a href="#annotated-cell-45-1790" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1791"><a href="#annotated-cell-45-1791" aria-hidden="true" tabindex="-1"></a><span class="vs">        // Conway's game of life rules:</span></span>
<span id="annotated-cell-45-1792"><a href="#annotated-cell-45-1792" aria-hidden="true" tabindex="-1"></a><span class="vs">        switch activeNeighbors {</span></span>
<span id="annotated-cell-45-1793"><a href="#annotated-cell-45-1793" aria-hidden="true" tabindex="-1"></a><span class="vs">          case 2: {</span></span>
<span id="annotated-cell-45-1794"><a href="#annotated-cell-45-1794" aria-hidden="true" tabindex="-1"></a><span class="vs">            cellStateOut[i] = cellStateIn[i];</span></span>
<span id="annotated-cell-45-1795"><a href="#annotated-cell-45-1795" aria-hidden="true" tabindex="-1"></a><span class="vs">          }</span></span>
<span id="annotated-cell-45-1796"><a href="#annotated-cell-45-1796" aria-hidden="true" tabindex="-1"></a><span class="vs">          case 3: {</span></span>
<span id="annotated-cell-45-1797"><a href="#annotated-cell-45-1797" aria-hidden="true" tabindex="-1"></a><span class="vs">            cellStateOut[i] = 1;</span></span>
<span id="annotated-cell-45-1798"><a href="#annotated-cell-45-1798" aria-hidden="true" tabindex="-1"></a><span class="vs">          }</span></span>
<span id="annotated-cell-45-1799"><a href="#annotated-cell-45-1799" aria-hidden="true" tabindex="-1"></a><span class="vs">          default: {</span></span>
<span id="annotated-cell-45-1800"><a href="#annotated-cell-45-1800" aria-hidden="true" tabindex="-1"></a><span class="vs">            cellStateOut[i] = 0;</span></span>
<span id="annotated-cell-45-1801"><a href="#annotated-cell-45-1801" aria-hidden="true" tabindex="-1"></a><span class="vs">          }</span></span>
<span id="annotated-cell-45-1802"><a href="#annotated-cell-45-1802" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="annotated-cell-45-1803"><a href="#annotated-cell-45-1803" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="annotated-cell-45-1804"><a href="#annotated-cell-45-1804" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span></span>
<span id="annotated-cell-45-1805"><a href="#annotated-cell-45-1805" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-45-1806"><a href="#annotated-cell-45-1806" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> GRID_SIZE <span class="op">=</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="annotated-cell-45-1807"><a href="#annotated-cell-45-1807" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> uniformBuffer <span class="op">=</span> <span class="fu">createUniformBuffer</span>(GRID_SIZE)<span class="op">;</span></span>
<span id="annotated-cell-45-1808"><a href="#annotated-cell-45-1808" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1809"><a href="#annotated-cell-45-1809" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create an array representing the active state of each cell.</span></span>
<span id="annotated-cell-45-1810"><a href="#annotated-cell-45-1810" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellStateArray <span class="op">=</span> <span class="kw">new</span> <span class="bu">Uint32Array</span>(GRID_SIZE <span class="op">*</span> GRID_SIZE)<span class="op">;</span></span>
<span id="annotated-cell-45-1811"><a href="#annotated-cell-45-1811" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1812"><a href="#annotated-cell-45-1812" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create two storage buffers to hold the cell state.</span></span>
<span id="annotated-cell-45-1813"><a href="#annotated-cell-45-1813" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellStateStorage <span class="op">=</span> [</span>
<span id="annotated-cell-45-1814"><a href="#annotated-cell-45-1814" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="fu">createBuffer</span>({</span>
<span id="annotated-cell-45-1815"><a href="#annotated-cell-45-1815" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell State A"</span><span class="op">,</span></span>
<span id="annotated-cell-45-1816"><a href="#annotated-cell-45-1816" aria-hidden="true" tabindex="-1"></a>      <span class="dt">size</span><span class="op">:</span> cellStateArray<span class="op">.</span><span class="at">byteLength</span><span class="op">,</span></span>
<span id="annotated-cell-45-1817"><a href="#annotated-cell-45-1817" aria-hidden="true" tabindex="-1"></a>      <span class="dt">usage</span><span class="op">:</span> GPUBufferUsage<span class="op">.</span><span class="at">STORAGE</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span><span class="op">,</span></span>
<span id="annotated-cell-45-1818"><a href="#annotated-cell-45-1818" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="annotated-cell-45-1819"><a href="#annotated-cell-45-1819" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="fu">createBuffer</span>({</span>
<span id="annotated-cell-45-1820"><a href="#annotated-cell-45-1820" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell State B"</span><span class="op">,</span></span>
<span id="annotated-cell-45-1821"><a href="#annotated-cell-45-1821" aria-hidden="true" tabindex="-1"></a>      <span class="dt">size</span><span class="op">:</span> cellStateArray<span class="op">.</span><span class="at">byteLength</span><span class="op">,</span></span>
<span id="annotated-cell-45-1822"><a href="#annotated-cell-45-1822" aria-hidden="true" tabindex="-1"></a>      <span class="dt">usage</span><span class="op">:</span> GPUBufferUsage<span class="op">.</span><span class="at">STORAGE</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span><span class="op">,</span></span>
<span id="annotated-cell-45-1823"><a href="#annotated-cell-45-1823" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="annotated-cell-45-1824"><a href="#annotated-cell-45-1824" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="annotated-cell-45-1825"><a href="#annotated-cell-45-1825" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1826"><a href="#annotated-cell-45-1826" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Set each cell to a random state, then copy the JavaScript array </span></span>
<span id="annotated-cell-45-1827"><a href="#annotated-cell-45-1827" aria-hidden="true" tabindex="-1"></a>  <span class="co">// into the storage buffer.</span></span>
<span id="annotated-cell-45-1828"><a href="#annotated-cell-45-1828" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> cellStateArray<span class="op">.</span><span class="at">length</span><span class="op">;</span> <span class="op">++</span>i) {</span>
<span id="annotated-cell-45-1829"><a href="#annotated-cell-45-1829" aria-hidden="true" tabindex="-1"></a>    cellStateArray[i] <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">random</span>() <span class="op">&gt;</span> <span class="fl">0.6</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="annotated-cell-45-1830"><a href="#annotated-cell-45-1830" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="annotated-cell-45-1831"><a href="#annotated-cell-45-1831" aria-hidden="true" tabindex="-1"></a>  device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">writeBuffer</span>(cellStateStorage[<span class="dv">0</span>]<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> cellStateArray)<span class="op">;</span></span>
<span id="annotated-cell-45-1832"><a href="#annotated-cell-45-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1833"><a href="#annotated-cell-45-1833" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mark every other cell of the second grid as active.</span></span>
<span id="annotated-cell-45-1834"><a href="#annotated-cell-45-1834" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> cellStateArray<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="annotated-cell-45-1835"><a href="#annotated-cell-45-1835" aria-hidden="true" tabindex="-1"></a>    cellStateArray[i] <span class="op">=</span> i <span class="op">%</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="annotated-cell-45-1836"><a href="#annotated-cell-45-1836" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="annotated-cell-45-1837"><a href="#annotated-cell-45-1837" aria-hidden="true" tabindex="-1"></a>  device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">writeBuffer</span>(cellStateStorage[<span class="dv">1</span>]<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> cellStateArray)<span class="op">;</span></span>
<span id="annotated-cell-45-1838"><a href="#annotated-cell-45-1838" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1839"><a href="#annotated-cell-45-1839" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1840"><a href="#annotated-cell-45-1840" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create the bind group layout and pipeline layout.</span></span>
<span id="annotated-cell-45-1841"><a href="#annotated-cell-45-1841" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bindGroupLayout <span class="op">=</span> device<span class="op">.</span><span class="fu">createBindGroupLayout</span>({</span>
<span id="annotated-cell-45-1842"><a href="#annotated-cell-45-1842" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell Bind Group Layout"</span><span class="op">,</span></span>
<span id="annotated-cell-45-1843"><a href="#annotated-cell-45-1843" aria-hidden="true" tabindex="-1"></a>    <span class="dt">entries</span><span class="op">:</span> [{</span>
<span id="annotated-cell-45-1844"><a href="#annotated-cell-45-1844" aria-hidden="true" tabindex="-1"></a>      <span class="dt">binding</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="annotated-cell-45-1845"><a href="#annotated-cell-45-1845" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Fragment stage included because the `grid` uniform is also read in fragmentMain.</span></span>
<span id="annotated-cell-45-1846"><a href="#annotated-cell-45-1846" aria-hidden="true" tabindex="-1"></a>      <span class="dt">visibility</span><span class="op">:</span> GPUShaderStage<span class="op">.</span><span class="at">VERTEX</span> <span class="op">|</span> GPUShaderStage<span class="op">.</span><span class="at">FRAGMENT</span> <span class="op">|</span> GPUShaderStage<span class="op">.</span><span class="at">COMPUTE</span><span class="op">,</span></span>
<span id="annotated-cell-45-1847"><a href="#annotated-cell-45-1847" aria-hidden="true" tabindex="-1"></a>      <span class="dt">buffer</span><span class="op">:</span> {} <span class="co">// Grid uniform buffer</span></span>
<span id="annotated-cell-45-1848"><a href="#annotated-cell-45-1848" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> {</span>
<span id="annotated-cell-45-1849"><a href="#annotated-cell-45-1849" aria-hidden="true" tabindex="-1"></a>      <span class="dt">binding</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="annotated-cell-45-1850"><a href="#annotated-cell-45-1850" aria-hidden="true" tabindex="-1"></a>      <span class="dt">visibility</span><span class="op">:</span> GPUShaderStage<span class="op">.</span><span class="at">VERTEX</span> <span class="op">|</span> GPUShaderStage<span class="op">.</span><span class="at">COMPUTE</span><span class="op">,</span></span>
<span id="annotated-cell-45-1851"><a href="#annotated-cell-45-1851" aria-hidden="true" tabindex="-1"></a>      <span class="dt">buffer</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"read-only-storage"</span>} <span class="co">// Cell state input buffer</span></span>
<span id="annotated-cell-45-1852"><a href="#annotated-cell-45-1852" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> {</span>
<span id="annotated-cell-45-1853"><a href="#annotated-cell-45-1853" aria-hidden="true" tabindex="-1"></a>      <span class="dt">binding</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="annotated-cell-45-1854"><a href="#annotated-cell-45-1854" aria-hidden="true" tabindex="-1"></a>      <span class="dt">visibility</span><span class="op">:</span> GPUShaderStage<span class="op">.</span><span class="at">COMPUTE</span><span class="op">,</span></span>
<span id="annotated-cell-45-1855"><a href="#annotated-cell-45-1855" aria-hidden="true" tabindex="-1"></a>      <span class="dt">buffer</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"storage"</span>} <span class="co">// Cell state output buffer</span></span>
<span id="annotated-cell-45-1856"><a href="#annotated-cell-45-1856" aria-hidden="true" tabindex="-1"></a>    }]</span>
<span id="annotated-cell-45-1857"><a href="#annotated-cell-45-1857" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-45-1858"><a href="#annotated-cell-45-1858" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1859"><a href="#annotated-cell-45-1859" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create a bind group to pass the grid uniforms into the pipeline</span></span>
<span id="annotated-cell-45-1860"><a href="#annotated-cell-45-1860" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bindGroups <span class="op">=</span> [</span>
<span id="annotated-cell-45-1861"><a href="#annotated-cell-45-1861" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="fu">createBindGroup</span>({</span>
<span id="annotated-cell-45-1862"><a href="#annotated-cell-45-1862" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell renderer bind group A"</span><span class="op">,</span></span>
<span id="annotated-cell-45-1863"><a href="#annotated-cell-45-1863" aria-hidden="true" tabindex="-1"></a>      <span class="dt">layout</span><span class="op">:</span> bindGroupLayout<span class="op">,</span> <span class="co">// Updated Line</span></span>
<span id="annotated-cell-45-1864"><a href="#annotated-cell-45-1864" aria-hidden="true" tabindex="-1"></a>      <span class="dt">entries</span><span class="op">:</span> [{</span>
<span id="annotated-cell-45-1865"><a href="#annotated-cell-45-1865" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="annotated-cell-45-1866"><a href="#annotated-cell-45-1866" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> uniformBuffer }</span>
<span id="annotated-cell-45-1867"><a href="#annotated-cell-45-1867" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> {</span>
<span id="annotated-cell-45-1868"><a href="#annotated-cell-45-1868" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="annotated-cell-45-1869"><a href="#annotated-cell-45-1869" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> cellStateStorage[<span class="dv">0</span>] }</span>
<span id="annotated-cell-45-1870"><a href="#annotated-cell-45-1870" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> {</span>
<span id="annotated-cell-45-1871"><a href="#annotated-cell-45-1871" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="co">// New Entry</span></span>
<span id="annotated-cell-45-1872"><a href="#annotated-cell-45-1872" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> cellStateStorage[<span class="dv">1</span>] }</span>
<span id="annotated-cell-45-1873"><a href="#annotated-cell-45-1873" aria-hidden="true" tabindex="-1"></a>      }]<span class="op">,</span></span>
<span id="annotated-cell-45-1874"><a href="#annotated-cell-45-1874" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="annotated-cell-45-1875"><a href="#annotated-cell-45-1875" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="fu">createBindGroup</span>({</span>
<span id="annotated-cell-45-1876"><a href="#annotated-cell-45-1876" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell renderer bind group B"</span><span class="op">,</span></span>
<span id="annotated-cell-45-1877"><a href="#annotated-cell-45-1877" aria-hidden="true" tabindex="-1"></a>      <span class="dt">layout</span><span class="op">:</span> bindGroupLayout<span class="op">,</span> <span class="co">// Updated Line</span></span>
<span id="annotated-cell-45-1878"><a href="#annotated-cell-45-1878" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1879"><a href="#annotated-cell-45-1879" aria-hidden="true" tabindex="-1"></a>      <span class="dt">entries</span><span class="op">:</span> [{</span>
<span id="annotated-cell-45-1880"><a href="#annotated-cell-45-1880" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="annotated-cell-45-1881"><a href="#annotated-cell-45-1881" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> uniformBuffer }</span>
<span id="annotated-cell-45-1882"><a href="#annotated-cell-45-1882" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> {</span>
<span id="annotated-cell-45-1883"><a href="#annotated-cell-45-1883" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="annotated-cell-45-1884"><a href="#annotated-cell-45-1884" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> cellStateStorage[<span class="dv">1</span>] }</span>
<span id="annotated-cell-45-1885"><a href="#annotated-cell-45-1885" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> {</span>
<span id="annotated-cell-45-1886"><a href="#annotated-cell-45-1886" aria-hidden="true" tabindex="-1"></a>        <span class="dt">binding</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="co">// New Entry</span></span>
<span id="annotated-cell-45-1887"><a href="#annotated-cell-45-1887" aria-hidden="true" tabindex="-1"></a>        <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> cellStateStorage[<span class="dv">0</span>] }</span>
<span id="annotated-cell-45-1888"><a href="#annotated-cell-45-1888" aria-hidden="true" tabindex="-1"></a>      }]<span class="op">,</span></span>
<span id="annotated-cell-45-1889"><a href="#annotated-cell-45-1889" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="annotated-cell-45-1890"><a href="#annotated-cell-45-1890" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="annotated-cell-45-1891"><a href="#annotated-cell-45-1891" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1892"><a href="#annotated-cell-45-1892" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pipelineLayout <span class="op">=</span> device<span class="op">.</span><span class="fu">createPipelineLayout</span>({</span>
<span id="annotated-cell-45-1893"><a href="#annotated-cell-45-1893" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell Pipeline Layout"</span><span class="op">,</span></span>
<span id="annotated-cell-45-1894"><a href="#annotated-cell-45-1894" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bindGroupLayouts</span><span class="op">:</span> [ bindGroupLayout ]<span class="op">,</span></span>
<span id="annotated-cell-45-1895"><a href="#annotated-cell-45-1895" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-45-1896"><a href="#annotated-cell-45-1896" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1897"><a href="#annotated-cell-45-1897" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cellPipeline <span class="op">=</span> device<span class="op">.</span><span class="fu">createRenderPipeline</span>({</span>
<span id="annotated-cell-45-1898"><a href="#annotated-cell-45-1898" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Cell pipeline"</span><span class="op">,</span></span>
<span id="annotated-cell-45-1899"><a href="#annotated-cell-45-1899" aria-hidden="true" tabindex="-1"></a>    <span class="dt">layout</span><span class="op">:</span> pipelineLayout<span class="op">,</span></span>
<span id="annotated-cell-45-1900"><a href="#annotated-cell-45-1900" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vertex</span><span class="op">:</span> {</span>
<span id="annotated-cell-45-1901"><a href="#annotated-cell-45-1901" aria-hidden="true" tabindex="-1"></a>      <span class="dt">module</span><span class="op">:</span> cellShaderModule<span class="op">,</span></span>
<span id="annotated-cell-45-1902"><a href="#annotated-cell-45-1902" aria-hidden="true" tabindex="-1"></a>      <span class="dt">entryPoint</span><span class="op">:</span> <span class="st">"vertexMain"</span><span class="op">,</span></span>
<span id="annotated-cell-45-1903"><a href="#annotated-cell-45-1903" aria-hidden="true" tabindex="-1"></a>      <span class="dt">buffers</span><span class="op">:</span> [cellVertexBufferLayout]</span>
<span id="annotated-cell-45-1904"><a href="#annotated-cell-45-1904" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="annotated-cell-45-1905"><a href="#annotated-cell-45-1905" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fragment</span><span class="op">:</span> {</span>
<span id="annotated-cell-45-1906"><a href="#annotated-cell-45-1906" aria-hidden="true" tabindex="-1"></a>      <span class="dt">module</span><span class="op">:</span> cellShaderModule<span class="op">,</span></span>
<span id="annotated-cell-45-1907"><a href="#annotated-cell-45-1907" aria-hidden="true" tabindex="-1"></a>      <span class="dt">entryPoint</span><span class="op">:</span> <span class="st">"fragmentMain"</span><span class="op">,</span></span>
<span id="annotated-cell-45-1908"><a href="#annotated-cell-45-1908" aria-hidden="true" tabindex="-1"></a>      <span class="dt">targets</span><span class="op">:</span> [{ <span class="dt">format</span><span class="op">:</span> presentationFormat }]</span>
<span id="annotated-cell-45-1909"><a href="#annotated-cell-45-1909" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="annotated-cell-45-1910"><a href="#annotated-cell-45-1910" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-45-1911"><a href="#annotated-cell-45-1911" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1912"><a href="#annotated-cell-45-1912" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create a compute pipeline that updates the game state.</span></span>
<span id="annotated-cell-45-1913"><a href="#annotated-cell-45-1913" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> simulationPipeline <span class="op">=</span> device<span class="op">.</span><span class="fu">createComputePipeline</span>({</span>
<span id="annotated-cell-45-1914"><a href="#annotated-cell-45-1914" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"Simulation pipeline"</span><span class="op">,</span></span>
<span id="annotated-cell-45-1915"><a href="#annotated-cell-45-1915" aria-hidden="true" tabindex="-1"></a>    <span class="dt">layout</span><span class="op">:</span> pipelineLayout<span class="op">,</span></span>
<span id="annotated-cell-45-1916"><a href="#annotated-cell-45-1916" aria-hidden="true" tabindex="-1"></a>    <span class="dt">compute</span><span class="op">:</span> {</span>
<span id="annotated-cell-45-1917"><a href="#annotated-cell-45-1917" aria-hidden="true" tabindex="-1"></a>      <span class="dt">module</span><span class="op">:</span> simulationShaderModule<span class="op">,</span></span>
<span id="annotated-cell-45-1918"><a href="#annotated-cell-45-1918" aria-hidden="true" tabindex="-1"></a>      <span class="dt">entryPoint</span><span class="op">:</span> <span class="st">"computeMain"</span><span class="op">,</span></span>
<span id="annotated-cell-45-1919"><a href="#annotated-cell-45-1919" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="annotated-cell-45-1920"><a href="#annotated-cell-45-1920" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="annotated-cell-45-1921"><a href="#annotated-cell-45-1921" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1922"><a href="#annotated-cell-45-1922" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> <span class="fu">createCanvas</span>(<span class="dv">512</span><span class="op">,</span> <span class="dv">512</span>)<span class="op">;</span></span>
<span id="annotated-cell-45-1923"><a href="#annotated-cell-45-1923" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ctx <span class="op">=</span> <span class="fu">setupContext</span>(canvas<span class="op">,</span> device<span class="op">,</span> presentationFormat)<span class="op">;</span></span>
<span id="annotated-cell-45-1924"><a href="#annotated-cell-45-1924" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1925"><a href="#annotated-cell-45-1925" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> UPDATE_INTERVAL <span class="op">=</span> <span class="dv">200</span><span class="op">;</span> <span class="co">// Update every 200ms (5 times/sec)</span></span>
<span id="annotated-cell-45-1926"><a href="#annotated-cell-45-1926" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> step <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> <span class="co">// Track how many simulation steps have been run</span></span>
<span id="annotated-cell-45-1927"><a href="#annotated-cell-45-1927" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1928"><a href="#annotated-cell-45-1928" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Move all of our rendering code into a function</span></span>
<span id="annotated-cell-45-1929"><a href="#annotated-cell-45-1929" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateGrid</span>() {</span>
<span id="annotated-cell-45-1930"><a href="#annotated-cell-45-1930" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="annotated-cell-45-1931"><a href="#annotated-cell-45-1931" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Start a render pass </span></span>
<span id="annotated-cell-45-1932"><a href="#annotated-cell-45-1932" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> encoder <span class="op">=</span> device<span class="op">.</span><span class="fu">createCommandEncoder</span>()<span class="op">;</span></span>
<span id="annotated-cell-45-1933"><a href="#annotated-cell-45-1933" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1934"><a href="#annotated-cell-45-1934" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> computePass <span class="op">=</span> encoder<span class="op">.</span><span class="fu">beginComputePass</span>()<span class="op">;</span></span>
<span id="annotated-cell-45-1935"><a href="#annotated-cell-45-1935" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1936"><a href="#annotated-cell-45-1936" aria-hidden="true" tabindex="-1"></a>    computePass<span class="op">.</span><span class="fu">setPipeline</span>(simulationPipeline)<span class="op">;</span></span>
<span id="annotated-cell-45-1937"><a href="#annotated-cell-45-1937" aria-hidden="true" tabindex="-1"></a>    computePass<span class="op">.</span><span class="fu">setBindGroup</span>(<span class="dv">0</span><span class="op">,</span> bindGroups[step <span class="op">%</span> <span class="dv">2</span>])<span class="op">;</span></span>
<span id="annotated-cell-45-1938"><a href="#annotated-cell-45-1938" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1939"><a href="#annotated-cell-45-1939" aria-hidden="true" tabindex="-1"></a>    <span class="co">// New lines</span></span>
<span id="annotated-cell-45-1940"><a href="#annotated-cell-45-1940" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> workgroupCount <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(GRID_SIZE <span class="op">/</span> WORKGROUP_SIZE)<span class="op">;</span></span>
<span id="annotated-cell-45-1941"><a href="#annotated-cell-45-1941" aria-hidden="true" tabindex="-1"></a>    computePass<span class="op">.</span><span class="fu">dispatchWorkgroups</span>(workgroupCount<span class="op">,</span> workgroupCount)<span class="op">;</span></span>
<span id="annotated-cell-45-1942"><a href="#annotated-cell-45-1942" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1943"><a href="#annotated-cell-45-1943" aria-hidden="true" tabindex="-1"></a>    computePass<span class="op">.</span><span class="fu">end</span>()<span class="op">;</span></span>
<span id="annotated-cell-45-1944"><a href="#annotated-cell-45-1944" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1945"><a href="#annotated-cell-45-1945" aria-hidden="true" tabindex="-1"></a>    step<span class="op">++;</span> <span class="co">// Increment the step count</span></span>
<span id="annotated-cell-45-1946"><a href="#annotated-cell-45-1946" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1947"><a href="#annotated-cell-45-1947" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> view <span class="op">=</span> ctx<span class="op">.</span><span class="fu">getCurrentTexture</span>()<span class="op">.</span><span class="fu">createView</span>()<span class="op">;</span></span>
<span id="annotated-cell-45-1948"><a href="#annotated-cell-45-1948" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1949"><a href="#annotated-cell-45-1949" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> pass <span class="op">=</span> encoder<span class="op">.</span><span class="fu">beginRenderPass</span>({</span>
<span id="annotated-cell-45-1950"><a href="#annotated-cell-45-1950" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorAttachments</span><span class="op">:</span> [{</span>
<span id="annotated-cell-45-1951"><a href="#annotated-cell-45-1951" aria-hidden="true" tabindex="-1"></a>        <span class="dt">view</span><span class="op">:</span> view<span class="op">,</span></span>
<span id="annotated-cell-45-1952"><a href="#annotated-cell-45-1952" aria-hidden="true" tabindex="-1"></a>        <span class="dt">loadOp</span><span class="op">:</span> <span class="st">"clear"</span><span class="op">,</span></span>
<span id="annotated-cell-45-1953"><a href="#annotated-cell-45-1953" aria-hidden="true" tabindex="-1"></a>        <span class="dt">storeOp</span><span class="op">:</span> <span class="st">"store"</span><span class="op">,</span></span>
<span id="annotated-cell-45-1954"><a href="#annotated-cell-45-1954" aria-hidden="true" tabindex="-1"></a>        <span class="dt">clearValue</span><span class="op">:</span> { <span class="dt">r</span><span class="op">:</span> <span class="fl">0.02</span><span class="op">,</span> <span class="dt">g</span><span class="op">:</span> <span class="fl">0.06</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span> <span class="fl">0.15</span><span class="op">,</span> <span class="dt">a</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="annotated-cell-45-1955"><a href="#annotated-cell-45-1955" aria-hidden="true" tabindex="-1"></a>      }]<span class="op">,</span></span>
<span id="annotated-cell-45-1956"><a href="#annotated-cell-45-1956" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="annotated-cell-45-1957"><a href="#annotated-cell-45-1957" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1958"><a href="#annotated-cell-45-1958" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1959"><a href="#annotated-cell-45-1959" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Draw the grid.</span></span>
<span id="annotated-cell-45-1960"><a href="#annotated-cell-45-1960" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">setPipeline</span>(cellPipeline)<span class="op">;</span></span>
<span id="annotated-cell-45-1961"><a href="#annotated-cell-45-1961" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">setBindGroup</span>(<span class="dv">0</span><span class="op">,</span> bindGroups[step <span class="op">%</span> <span class="dv">2</span>])<span class="op">;</span> <span class="co">// Updated!</span></span>
<span id="annotated-cell-45-1962"><a href="#annotated-cell-45-1962" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">setVertexBuffer</span>(<span class="dv">0</span><span class="op">,</span> vertexBuffer)<span class="op">;</span></span>
<span id="annotated-cell-45-1963"><a href="#annotated-cell-45-1963" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">draw</span>(cellVertices<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> GRID_SIZE <span class="op">*</span> GRID_SIZE)<span class="op">;</span></span>
<span id="annotated-cell-45-1964"><a href="#annotated-cell-45-1964" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1965"><a href="#annotated-cell-45-1965" aria-hidden="true" tabindex="-1"></a>    <span class="co">// End the render pass and submit the command buffer</span></span>
<span id="annotated-cell-45-1966"><a href="#annotated-cell-45-1966" aria-hidden="true" tabindex="-1"></a>    pass<span class="op">.</span><span class="fu">end</span>()<span class="op">;</span></span>
<span id="annotated-cell-45-1967"><a href="#annotated-cell-45-1967" aria-hidden="true" tabindex="-1"></a>    device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">submit</span>([encoder<span class="op">.</span><span class="fu">finish</span>()])<span class="op">;</span></span>
<span id="annotated-cell-45-1968"><a href="#annotated-cell-45-1968" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="annotated-cell-45-1969"><a href="#annotated-cell-45-1969" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1970"><a href="#annotated-cell-45-1970" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Schedule updateGrid() to run repeatedly</span></span>
<span id="annotated-cell-45-1971"><a href="#annotated-cell-45-1971" aria-hidden="true" tabindex="-1"></a>  <span class="pp">setInterval</span>(updateGrid<span class="op">,</span> UPDATE_INTERVAL)<span class="op">;</span></span>
<span id="annotated-cell-45-1972"><a href="#annotated-cell-45-1972" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1973"><a href="#annotated-cell-45-1973" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> canvas<span class="op">;</span></span>
<span id="annotated-cell-45-1974"><a href="#annotated-cell-45-1974" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-45-1975"><a href="#annotated-cell-45-1975" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-17" data-nodetype="expression">

</div>
</div>
</div>

<div class="reveal-header">
<div class="header-logo">
<img data-src="../images/logo-miashs-transparent.png">
</div>
<div class="sc-title">
<p> </p>
</div>
<div class="header-text">
<p> </p>
</div>
<div class="sb-title">
<p> </p>
</div>
</div>
</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../images/paulva_logo.svg" class="slide-logo"></p>
<div class="footer footer-default">
<p><span style="color:yellow;float:left;margin-left:7%;"><em>Your First WebGPU App</em></span><span style="color:grey;float:right;margin-right:12%;">Advanced Programming and Parallel Computing, Master 2 MIASHS</span></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="10_WebGPU-First-App_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="10_WebGPU-First-App_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="10_WebGPU-First-App_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="10_WebGPU-First-App_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="10_WebGPU-First-App_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="10_WebGPU-First-App_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="10_WebGPU-First-App_files/libs/revealjs/plugin/reveal-attribution/attribution.js"></script>
  <script src="10_WebGPU-First-App_files/libs/revealjs/plugin/reveal-animate/plugin.js"></script>
  <script src="10_WebGPU-First-App_files/libs/revealjs/plugin/reveal-animate/svg.min.js"></script>
  <script src="10_WebGPU-First-App_files/libs/revealjs/plugin/reveal-animate/js-yaml.min.js"></script>
  <script src="10_WebGPU-First-App_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="10_WebGPU-First-App_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="10_WebGPU-First-App_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="10_WebGPU-First-App_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'animate': {"autoplay":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'h/v',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'convex',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.15,

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, RevealAttribution, RevealAnimate, QuartoSupport,

          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script type="ojs-module-contents">
    eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRldmljZSA9IHtcbiAgaWYgKCFuYXZpZ2F0b3IuZ3B1KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiV2ViR1BVIG5vdCBzdXBwb3J0ZWQgb24gdGhpcyBicm93c2VyLlwiKTtcbiAgfVxuICBjb25zdCBhZGFwdGVyID0gYXdhaXQgbmF2aWdhdG9yLmdwdS5yZXF1ZXN0QWRhcHRlcigpO1xuICBpZiAoIWFkYXB0ZXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBhcHByb3ByaWF0ZSBHUFVBZGFwdGVyIGZvdW5kLlwiKTtcbiAgfVxuICByZXR1cm4gYXdhaXQgYWRhcHRlci5yZXF1ZXN0RGV2aWNlKCk7XG59XG5cbnByZXNlbnRhdGlvbkZvcm1hdCA9IG5hdmlnYXRvci5ncHUuZ2V0UHJlZmVycmVkQ2FudmFzRm9ybWF0KClcblxuY3JlYXRlQ2FudmFzID0gKHcgPSA2NDAsIGggPSA0ODApID0+IHtcbiAgY29uc3QgYyA9IERPTS5jYW52YXModywgaCk7XG4gIGMuc3R5bGUubWF4V2lkdGggPSBcIjEwMCVcIjtcbiAgYy5zdHlsZS5ib3JkZXIgPSBcIjFweCBzb2xpZCAjZGRkXCI7XG4gIHJldHVybiBjO1xufVxuXG5zZXR1cENvbnRleHQgPSAoY2FudmFzLCBkZXZpY2UsIGZvcm1hdCkgPT4ge1xuICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIndlYmdwdVwiKTtcbiAgY3R4LmNvbmZpZ3VyZSh7IGRldmljZSwgZm9ybWF0IH0pO1xuICByZXR1cm4gY3R4O1xufVxuXG5iZWdpblBhc3MgPSAoZGV2aWNlLCBjb250ZXh0LCBjbGVhckNvbG9yID0gWzAsIDAsIDAsIDFdKSA9PiB7XG4gIGNvbnN0IGVuY29kZXIgPSBkZXZpY2UuY3JlYXRlQ29tbWFuZEVuY29kZXIoKTtcbiAgY29uc3QgdmlldyA9IGNvbnRleHQuZ2V0Q3VycmVudFRleHR1cmUoKS5jcmVhdGVWaWV3KCk7XG4gIGNvbnN0IHBhc3MgPSBlbmNvZGVyLmJlZ2luUmVuZGVyUGFzcyh7XG4gICAgY29sb3JBdHRhY2htZW50czogW3tcbiAgICAgIHZpZXcsXG4gICAgICBsb2FkT3A6IFwiY2xlYXJcIixcbiAgICAgIGNsZWFyVmFsdWU6IHsgcjogY2xlYXJDb2xvclswXSwgZzogY2xlYXJDb2xvclsxXSwgYjogY2xlYXJDb2xvclsyXSwgYTogY2xlYXJDb2xvclszXSB9LFxuICAgICAgc3RvcmVPcDogXCJzdG9yZVwiXG4gICAgfV1cbiAgfSk7XG4gIHJldHVybiB7IGVuY29kZXIsIHBhc3MgfTtcbn1cblxuZW5kUGFzcyA9ICh7IGRldmljZSwgZW5jb2RlciwgcGFzcyB9KSA9PiB7XG4gIHBhc3MuZW5kKCk7XG4gIGRldmljZS5xdWV1ZS5zdWJtaXQoW2VuY29kZXIuZmluaXNoKCldKTtcbn1cblxucmVuZGVyVG9DYW52YXMgPSAoe1xuICB3aWR0aCA9IDY0MCxcbiAgaGVpZ2h0ID0gNDgwLFxuICBjbGVhckNvbG9yID0gWzAsIDAsIDAsIDFdLFxuICBwaXBlbGluZSA9IG51bGwsXG4gIGRyYXcgPSB7IHZlcnRleENvdW50OiAzLCBpbnN0YW5jZUNvdW50OiAxLCBmaXJzdFZlcnRleDogMCwgZmlyc3RJbnN0YW5jZTogMCB9LFxuICByZW5kZXIgPSBudWxsLFxufSA9IHt9KSA9PiB7XG4gIGNvbnN0IGNhbnZhcyA9IGNyZWF0ZUNhbnZhcyh3aWR0aCwgaGVpZ2h0KTtcbiAgY29uc3QgY3R4ID0gc2V0dXBDb250ZXh0KGNhbnZhcywgZGV2aWNlLCBwcmVzZW50YXRpb25Gb3JtYXQpO1xuICBjb25zdCB7IGVuY29kZXIsIHBhc3MgfSA9IGJlZ2luUGFzcyhkZXZpY2UsIGN0eCwgY2xlYXJDb2xvcik7XG4gIGlmIChyZW5kZXIgJiYgdHlwZW9mIHJlbmRlciA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgcmVuZGVyKHBhc3MpO1xuICB9IGVsc2UgaWYgKHBpcGVsaW5lKSB7XG4gICAgcGFzcy5zZXRQaXBlbGluZShwaXBlbGluZSk7XG4gICAgcGFzcy5kcmF3KFxuICAgICAgZHJhdy52ZXJ0ZXhDb3VudCA/PyAzLFxuICAgICAgZHJhdy5pbnN0YW5jZUNvdW50ID8/IDEsXG4gICAgICBkcmF3LmZpcnN0VmVydGV4ID8/IDAsXG4gICAgICBkcmF3LmZpcnN0SW5zdGFuY2UgPz8gMFxuICAgICk7XG4gIH1cbiAgZW5kUGFzcyh7IGRldmljZSwgZW5jb2RlciwgcGFzcyB9KTtcbiAgcmV0dXJuIGNhbnZhcztcbn1cblxud2l0aEJpbmRpbmdzID0gKHtcbiAgcGlwZWxpbmUsXG4gIGJpbmRHcm91cHMgPSBbXSxcbiAgdmVydGV4ID0gW10sXG4gIGluZGV4ID0gbnVsbCxcbiAgZHJhdyA9IHsgdmVydGV4Q291bnQ6IDMsIGluc3RhbmNlQ291bnQ6IDEsIGZpcnN0VmVydGV4OiAwLCBmaXJzdEluc3RhbmNlOiAwIH0sXG4gIGRyYXdJbmRleGVkID0gbnVsbFxufSA9IHt9KSA9PiB7XG4gIHJldHVybiAocGFzcykgPT4ge1xuICAgIGlmIChwaXBlbGluZSkgcGFzcy5zZXRQaXBlbGluZShwaXBlbGluZSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaW5kR3JvdXBzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBiZyA9IGJpbmRHcm91cHNbaV07XG4gICAgICBpZiAoYmcpIHBhc3Muc2V0QmluZEdyb3VwKGksIGJnKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCB2YiBvZiB2ZXJ0ZXgpIHtcbiAgICAgIGlmICh2Yj8uYnVmZmVyKSBwYXNzLnNldFZlcnRleEJ1ZmZlcih2Yi5zbG90ID8/IDAsIHZiLmJ1ZmZlciwgdmIub2Zmc2V0ID8/IDApO1xuICAgIH1cbiAgICBpZiAoaW5kZXg/LmJ1ZmZlciAmJiBpbmRleC5pbmRleEZvcm1hdCkge1xuICAgICAgcGFzcy5zZXRJbmRleEJ1ZmZlcihpbmRleC5idWZmZXIsIGluZGV4LmluZGV4Rm9ybWF0LCBpbmRleC5vZmZzZXQgPz8gMCk7XG4gICAgfVxuICAgIGlmIChpbmRleCAmJiBkcmF3SW5kZXhlZCkge1xuICAgICAgcGFzcy5kcmF3SW5kZXhlZChcbiAgICAgICAgZHJhd0luZGV4ZWQuaW5kZXhDb3VudCxcbiAgICAgICAgZHJhd0luZGV4ZWQuaW5zdGFuY2VDb3VudCA/PyAxLFxuICAgICAgICBkcmF3SW5kZXhlZC5maXJzdEluZGV4ID8/IDAsXG4gICAgICAgIGRyYXdJbmRleGVkLmJhc2VWZXJ0ZXggPz8gMCxcbiAgICAgICAgZHJhd0luZGV4ZWQuZmlyc3RJbnN0YW5jZSA/PyAwXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXNzLmRyYXcoXG4gICAgICAgIGRyYXcudmVydGV4Q291bnQgPz8gMyxcbiAgICAgICAgZHJhdy5pbnN0YW5jZUNvdW50ID8/IDEsXG4gICAgICAgIGRyYXcuZmlyc3RWZXJ0ZXggPz8gMCxcbiAgICAgICAgZHJhdy5maXJzdEluc3RhbmNlID8/IDBcbiAgICAgICk7XG4gICAgfVxuICB9O1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiXG5yZW5kZXJUb0NhbnZhcyh7IHdpZHRoOiA1MTIsIGhlaWdodDogNTEyIH0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbnJlbmRlclRvQ2FudmFzKHtcbiAgd2lkdGg6IDUxMixcbiAgaGVpZ2h0OiA1MTIsXG4gIGNsZWFyQ29sb3I6IFswLjAyLCAwLjA2LCAwLjE1LCAxLjBdXG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiQ0VMTF9DTEVBUl9DT0xPUiA9IFswLjAyLCAwLjA2LCAwLjE1LCAxLjBdXG5cbmNlbGxWZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkoW1xuICAtMC44LCAtMC44LFxuICAgMC44LCAtMC44LFxuICAgMC44LCAgMC44LFxuICAtMC44LCAtMC44LFxuICAgMC44LCAgMC44LFxuICAtMC44LCAgMC44LFxuXSlcblxuY3JlYXRlQ2VsbFZlcnRleEJ1ZmZlciA9ICgpID0+IHtcbiAgY29uc3QgYnVmZmVyID0gZGV2aWNlLmNyZWF0ZUJ1ZmZlcih7XG4gICAgbGFiZWw6IFwiQ2VsbCB2ZXJ0aWNlc1wiLFxuICAgIHNpemU6IGNlbGxWZXJ0aWNlcy5ieXRlTGVuZ3RoLFxuICAgIHVzYWdlOiBHUFVCdWZmZXJVc2FnZS5WRVJURVggfCBHUFVCdWZmZXJVc2FnZS5DT1BZX0RTVCxcbiAgfSk7XG4gIGRldmljZS5xdWV1ZS53cml0ZUJ1ZmZlcihidWZmZXIsIDAsIGNlbGxWZXJ0aWNlcyk7XG4gIHJldHVybiBidWZmZXI7XG59XG5cbmNlbGxWZXJ0ZXhCdWZmZXJMYXlvdXQgPSAoe1xuICBhcnJheVN0cmlkZTogKDIgKiBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQpLFxuICBhdHRyaWJ1dGVzOiBbe1xuICAgIHNoYWRlckxvY2F0aW9uOiAwLFxuICAgIG9mZnNldDogMCxcbiAgICBmb3JtYXQ6IFwiZmxvYXQzMngyXCIsXG4gIH1dXG59KVxuXG5jcmVhdGVDZWxsUGlwZWxpbmUgPSAoc2hhZGVyTW9kdWxlKSA9PiBkZXZpY2UuY3JlYXRlUmVuZGVyUGlwZWxpbmUoe1xuICBsYWJlbDogXCJDZWxsIHBpcGVsaW5lXCIsXG4gIGxheW91dDogXCJhdXRvXCIsXG4gIHZlcnRleDogeyBtb2R1bGU6IHNoYWRlck1vZHVsZSwgZW50cnlQb2ludDogXCJ2ZXJ0ZXhNYWluXCIsIGJ1ZmZlcnM6IFtjZWxsVmVydGV4QnVmZmVyTGF5b3V0XSB9LFxuICBmcmFnbWVudDogeyBtb2R1bGU6IHNoYWRlck1vZHVsZSwgZW50cnlQb2ludDogXCJmcmFnbWVudE1haW5cIiwgdGFyZ2V0czogW3sgZm9ybWF0OiBwcmVzZW50YXRpb25Gb3JtYXQgfV0gfSxcbiAgcHJpbWl0aXZlOiB7IHRvcG9sb2d5OiBcInRyaWFuZ2xlLWxpc3RcIiB9LFxufSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBpcGVsaW5lX3NxdWFyZSA9IHtcblxuICBjb25zdCBjZWxsU2hhZGVyTW9kdWxlID0gZGV2aWNlLmNyZWF0ZVNoYWRlck1vZHVsZSh7XG4gICAgY29kZTogLyogd2dzbCAqLyBgXG4gICAgICBAdmVydGV4XG4gICAgICBmbiB2ZXJ0ZXhNYWluKEBsb2NhdGlvbigwKSBwb3M6IHZlYzJmKSAtPiBAYnVpbHRpbihwb3NpdGlvbikgdmVjNGYge1xuICAgICAgICByZXR1cm4gdmVjNGYocG9zLCAwLjAsIDEuMCk7XG4gICAgICB9XG5cbiAgICAgIEBmcmFnbWVudFxuICAgICAgZm4gZnJhZ21lbnRNYWluKCkgLT4gQGxvY2F0aW9uKDApIHZlYzRmIHsgICAgICAgIC8vIDwxPlxuICAgICAgICByZXR1cm4gdmVjNGYoMS4wLCAwLjAsIDAuMCwgMS4wKTsgICAgICAgICAgICAgIC8vIDwyPlxuICAgICAgfVxuICAgIGAsXG4gIH0pO1xuXG4gIHJldHVybiBjcmVhdGVDZWxsUGlwZWxpbmUoY2VsbFNoYWRlck1vZHVsZSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZXJ0ZXhCdWZmZXIgPSBjcmVhdGVDZWxsVmVydGV4QnVmZmVyKCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIHJldHVybiByZW5kZXJUb0NhbnZhcyh7XG4gICAgd2lkdGg6IDUxMixcbiAgICBoZWlnaHQ6IDUxMixcbiAgICBjbGVhckNvbG9yOiBDRUxMX0NMRUFSX0NPTE9SLFxuICAgIHJlbmRlcjogd2l0aEJpbmRpbmdzKHtcbiAgICAgIHBpcGVsaW5lOiBwaXBlbGluZV9zcXVhcmUsXG4gICAgICB2ZXJ0ZXg6IFt7IHNsb3Q6IDAsIGJ1ZmZlcjogdmVydGV4QnVmZmVyIH1dLFxuICAgICAgZHJhdzogeyB2ZXJ0ZXhDb3VudDogY2VsbFZlcnRpY2VzLmxlbmd0aCAvIDIgfVxuICAgIH0pXG4gIH0pO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gY3JlYXRlVW5pZm9ybUJ1ZmZlcihHUklEX1NJWkUpIHtcbiAgY29uc3QgdW5pZm9ybUFycmF5ID0gbmV3IEZsb2F0MzJBcnJheShbR1JJRF9TSVpFLCBHUklEX1NJWkVdKTtcbiAgY29uc3QgYnVmZmVyID0gZGV2aWNlLmNyZWF0ZUJ1ZmZlcih7XG4gICAgbGFiZWw6IFwiR3JpZCBVbmlmb3Jtc1wiLFxuICAgIHNpemU6IHVuaWZvcm1BcnJheS5ieXRlTGVuZ3RoLFxuICAgIHVzYWdlOiBHUFVCdWZmZXJVc2FnZS5VTklGT1JNIHwgR1BVQnVmZmVyVXNhZ2UuQ09QWV9EU1QsXG4gIH0pO1xuICBkZXZpY2UucXVldWUud3JpdGVCdWZmZXIoYnVmZmVyLCAwLCB1bmlmb3JtQXJyYXkpO1xuICByZXR1cm4gYnVmZmVyO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVuZGVyR3JpZCA9IChwaXBlbGluZSwgR1JJRF9TSVpFLCBpbnN0YW5jZUNvdW50KSA9PiB7XG4gIGNvbnN0IHVuaWZvcm1CdWZmZXIgPSBjcmVhdGVVbmlmb3JtQnVmZmVyKEdSSURfU0laRSk7XG5cbiAgY29uc3QgYmluZEdyb3VwID0gZGV2aWNlLmNyZWF0ZUJpbmRHcm91cCh7XG4gICAgbGFiZWw6IFwiQ2VsbCByZW5kZXJlciBiaW5kIGdyb3VwXCIsXG4gICAgbGF5b3V0OiBwaXBlbGluZS5nZXRCaW5kR3JvdXBMYXlvdXQoMCksXG4gICAgZW50cmllczogW3sgYmluZGluZzogMCwgcmVzb3VyY2U6IHsgYnVmZmVyOiB1bmlmb3JtQnVmZmVyIH0gfV0sXG4gIH0pO1xuXG4gIHJldHVybiByZW5kZXJUb0NhbnZhcyh7XG4gICAgd2lkdGg6IDUxMixcbiAgICBoZWlnaHQ6IDUxMixcbiAgICBjbGVhckNvbG9yOiBDRUxMX0NMRUFSX0NPTE9SLFxuICAgIHJlbmRlcjogd2l0aEJpbmRpbmdzKHtcbiAgICAgIHBpcGVsaW5lOiBwaXBlbGluZSxcbiAgICAgIGJpbmRHcm91cHM6IFtiaW5kR3JvdXBdLFxuICAgICAgdmVydGV4OiBbeyBzbG90OiAwLCBidWZmZXI6IHZlcnRleEJ1ZmZlciB9XSxcbiAgICAgIGRyYXc6IHsgdmVydGV4Q291bnQ6IGNlbGxWZXJ0aWNlcy5sZW5ndGggLyAyLCBpbnN0YW5jZUNvdW50OiBpbnN0YW5jZUNvdW50IH1cbiAgICB9KVxuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwaXBlbGluZV9ncmlkMSA9IHtcblxuICBjb25zdCBjZWxsU2hhZGVyTW9kdWxlID0gZGV2aWNlLmNyZWF0ZVNoYWRlck1vZHVsZSh7XG4gICAgY29kZTogLyogd2dzbCAqLyBgXG4gICAgICBAZ3JvdXAoMCkgQGJpbmRpbmcoMCkgdmFyPHVuaWZvcm0+IGdyaWQ6IHZlYzJmO1xuXG4gICAgICBAdmVydGV4XG4gICAgICBmbiB2ZXJ0ZXhNYWluKEBsb2NhdGlvbigwKSBwb3M6IHZlYzJmKSAtPiBAYnVpbHRpbihwb3NpdGlvbikgdmVjNGYge1xuICAgICAgICByZXR1cm4gdmVjNGYocG9zIC8gZ3JpZCwgMC4wLCAxLjApO1xuICAgICAgfVxuXG4gICAgICBAZnJhZ21lbnRcbiAgICAgIGZuIGZyYWdtZW50TWFpbigpIC0+IEBsb2NhdGlvbigwKSB2ZWM0ZiB7ICAgICAgICAvLyA8MT5cbiAgICAgICAgcmV0dXJuIHZlYzRmKDEuMCwgMC4wLCAwLjAsIDEuMCk7ICAgICAgICAgICAgICAvLyA8Mj5cbiAgICAgIH1cbiAgICBgLFxuICB9KTtcblxuICByZXR1cm4gY3JlYXRlQ2VsbFBpcGVsaW5lKGNlbGxTaGFkZXJNb2R1bGUpO1xufVxuXG5yZW5kZXJHcmlkKHBpcGVsaW5lX2dyaWQxLCA0KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwaXBlbGluZV9ncmlkMiA9IHtcbiAgY29uc3QgY2VsbFNoYWRlck1vZHVsZSA9IGRldmljZS5jcmVhdGVTaGFkZXJNb2R1bGUoe1xuICAgIGNvZGU6IC8qIHdnc2wgKi8gYFxuICAgICAgQGdyb3VwKDApIEBiaW5kaW5nKDApIHZhcjx1bmlmb3JtPiBncmlkOiB2ZWMyZjtcblxuICAgICAgQHZlcnRleFxuICAgICAgZm4gdmVydGV4TWFpbihAbG9jYXRpb24oMCkgcG9zOiB2ZWMyZixcbiAgICAgICAgICAgICAgICAgICAgQGJ1aWx0aW4oaW5zdGFuY2VfaW5kZXgpIGluc3RhbmNlOiB1MzIpIC0+XG4gICAgICAgIEBidWlsdGluKHBvc2l0aW9uKSB2ZWM0ZiB7XG5cbiAgICAgICAgbGV0IGkgPSBmMzIoaW5zdGFuY2UpO1xuICAgICAgICAvLyBDb21wdXRlIHRoZSBjZWxsIGNvb3JkaW5hdGUgZnJvbSB0aGUgaW5zdGFuY2VfaW5kZXhcbiAgICAgICAgbGV0IGNlbGwgPSB2ZWMyZihpICUgZ3JpZC54LCBmbG9vcihpIC8gZ3JpZC54KSk7XG5cbiAgICAgICAgbGV0IGNlbGxPZmZzZXQgPSBjZWxsIC8gZ3JpZCAqIDI7XG4gICAgICAgIGxldCBncmlkUG9zID0gKHBvcyArIDEpIC8gZ3JpZCAtIDEgKyBjZWxsT2Zmc2V0O1xuXG4gICAgICAgIHJldHVybiB2ZWM0ZihncmlkUG9zLCAwLCAxKTtcbiAgICAgIH1cblxuICAgICAgQGZyYWdtZW50XG4gICAgICBmbiBmcmFnbWVudE1haW4oKSAtPiBAbG9jYXRpb24oMCkgdmVjNGYgeyAgICAgICAgLy8gPDE+XG4gICAgICAgIHJldHVybiB2ZWM0ZigxLjAsIDAuMCwgMC4wLCAxLjApOyAgICAgICAgICAgICAgLy8gPDI+XG4gICAgICB9XG4gICAgYCxcbiAgfSk7XG5cbiAgcmV0dXJuIGNyZWF0ZUNlbGxQaXBlbGluZShjZWxsU2hhZGVyTW9kdWxlKTtcbn1cblxucmVuZGVyR3JpZChwaXBlbGluZV9ncmlkMiwgMzIsIDMyKjMyKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwaXBlbGluZV9ncmlkMyA9IHtcbiAgY29uc3QgY2VsbFNoYWRlck1vZHVsZSA9IGRldmljZS5jcmVhdGVTaGFkZXJNb2R1bGUoe1xuICAgIGNvZGU6IC8qIHdnc2wgKi8gYFxuICAgICAgc3RydWN0IFZlcnRleElucHV0IHtcbiAgICAgICAgQGxvY2F0aW9uKDApIHBvczogdmVjMmYsXG4gICAgICAgIEBidWlsdGluKGluc3RhbmNlX2luZGV4KSBpbnN0YW5jZTogdTMyLFxuICAgICAgfTtcblxuICAgICAgc3RydWN0IFZlcnRleE91dHB1dCB7XG4gICAgICAgIEBidWlsdGluKHBvc2l0aW9uKSBwb3M6IHZlYzRmLFxuICAgICAgICBAbG9jYXRpb24oMCkgY2VsbDogdmVjMmYsIC8vIE5ldyBsaW5lIVxuICAgICAgfTtcblxuICAgICAgQGdyb3VwKDApIEBiaW5kaW5nKDApIHZhcjx1bmlmb3JtPiBncmlkOiB2ZWMyZjtcblxuICAgICAgQHZlcnRleFxuICAgICAgZm4gdmVydGV4TWFpbihpbnB1dDogVmVydGV4SW5wdXQpIC0+IFZlcnRleE91dHB1dCAge1xuICAgICAgICBsZXQgaSA9IGYzMihpbnB1dC5pbnN0YW5jZSk7XG4gICAgICAgIGxldCBjZWxsID0gdmVjMmYoaSAlIGdyaWQueCwgZmxvb3IoaSAvIGdyaWQueCkpO1xuICAgICAgICBsZXQgY2VsbE9mZnNldCA9IGNlbGwgLyBncmlkICogMjtcbiAgICAgICAgbGV0IGdyaWRQb3MgPSAoaW5wdXQucG9zICsgMSkgLyBncmlkIC0gMSArIGNlbGxPZmZzZXQ7XG4gICAgICAgIFxuICAgICAgICB2YXIgb3V0cHV0OiBWZXJ0ZXhPdXRwdXQ7XG4gICAgICAgIG91dHB1dC5wb3MgPSB2ZWM0ZihncmlkUG9zLCAwLCAxKTtcbiAgICAgICAgb3V0cHV0LmNlbGwgPSBjZWxsOyAvLyBOZXcgbGluZSFcbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICAgIH1cblxuICAgICAgQGZyYWdtZW50XG4gICAgICBmbiBmcmFnbWVudE1haW4oaW5wdXQ6IFZlcnRleE91dHB1dCkgLT4gQGxvY2F0aW9uKDApIHZlYzRmIHtcbiAgICAgICAgbGV0IGMgPSBpbnB1dC5jZWxsIC8gZ3JpZDtcbiAgICAgICAgcmV0dXJuIHZlYzRmKGMsIDEtYy54LCAxKTtcbiAgICAgIH1cbiAgICBgLFxuICB9KTtcblxuICByZXR1cm4gY3JlYXRlQ2VsbFBpcGVsaW5lKGNlbGxTaGFkZXJNb2R1bGUpO1xufVxuXG5yZW5kZXJHcmlkKHBpcGVsaW5lX2dyaWQzLCAzMiwgMzIqMzIpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBpcGVsaW5lX3N0b3JhZ2UgPSB7XG4gIGNvbnN0IGNlbGxTaGFkZXJNb2R1bGUgPSBkZXZpY2UuY3JlYXRlU2hhZGVyTW9kdWxlKHtcbiAgICBjb2RlOiAvKiB3Z3NsICovIGBcbiAgICAgIHN0cnVjdCBWZXJ0ZXhJbnB1dCB7XG4gICAgICAgIEBsb2NhdGlvbigwKSBwb3M6IHZlYzJmLFxuICAgICAgICBAYnVpbHRpbihpbnN0YW5jZV9pbmRleCkgaW5zdGFuY2U6IHUzMixcbiAgICAgIH07XG5cbiAgICAgIHN0cnVjdCBWZXJ0ZXhPdXRwdXQge1xuICAgICAgICBAYnVpbHRpbihwb3NpdGlvbikgcG9zOiB2ZWM0ZixcbiAgICAgICAgQGxvY2F0aW9uKDApIGNlbGw6IHZlYzJmLCAvLyBOZXcgbGluZSFcbiAgICAgIH07XG5cbiAgICAgIEBncm91cCgwKSBAYmluZGluZygwKSB2YXI8dW5pZm9ybT4gZ3JpZDogdmVjMmY7XG4gICAgICBAZ3JvdXAoMCkgQGJpbmRpbmcoMSkgdmFyPHN0b3JhZ2U+IGNlbGxTdGF0ZTogYXJyYXk8dTMyPjsgLy8gTmV3ISAgICAgICAgICBcbiAgICBcbiAgICAgIEB2ZXJ0ZXhcbiAgICAgIGZuIHZlcnRleE1haW4oQGxvY2F0aW9uKDApIHBvczogdmVjMmYsXG4gICAgICAgICAgICAgICAgICAgIEBidWlsdGluKGluc3RhbmNlX2luZGV4KSBpbnN0YW5jZTogdTMyKSAtPiBWZXJ0ZXhPdXRwdXQge1xuICAgICAgICBsZXQgaSA9IGYzMihpbnN0YW5jZSk7XG4gICAgICAgIGxldCBjZWxsID0gdmVjMmYoaSAlIGdyaWQueCwgZmxvb3IoaSAvIGdyaWQueCkpO1xuICAgICAgICBsZXQgc3RhdGUgPSBmMzIoY2VsbFN0YXRlW2luc3RhbmNlXSk7IC8vIE5ldyBsaW5lIVxuXG4gICAgICAgIGxldCBjZWxsT2Zmc2V0ID0gY2VsbCAvIGdyaWQgKiAyO1xuICAgICAgICAvLyBOZXc6IFNjYWxlIHRoZSBwb3NpdGlvbiBieSB0aGUgY2VsbCdzIGFjdGl2ZSBzdGF0ZS5cbiAgICAgICAgbGV0IGdyaWRQb3MgPSAocG9zKnN0YXRlKzEpIC8gZ3JpZCAtIDEgKyBjZWxsT2Zmc2V0O1xuXG4gICAgICAgIHZhciBvdXRwdXQ6IFZlcnRleE91dHB1dDtcbiAgICAgICAgb3V0cHV0LnBvcyA9IHZlYzRmKGdyaWRQb3MsIDAsIDEpO1xuICAgICAgICBvdXRwdXQuY2VsbCA9IGNlbGw7XG4gICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgICB9XG5cbiAgICAgIEBmcmFnbWVudFxuICAgICAgZm4gZnJhZ21lbnRNYWluKGlucHV0OiBWZXJ0ZXhPdXRwdXQpIC0+IEBsb2NhdGlvbigwKSB2ZWM0ZiB7XG4gICAgICAgIGxldCBjID0gaW5wdXQuY2VsbCAvIGdyaWQ7XG4gICAgICAgIHJldHVybiB2ZWM0ZihjLCAxLWMueCwgMSk7XG4gICAgICB9XG4gICAgYCxcbiAgfSk7XG5cbiAgcmV0dXJuIGNyZWF0ZUNlbGxQaXBlbGluZShjZWxsU2hhZGVyTW9kdWxlKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IEdSSURfU0laRSA9IDMyO1xuICBjb25zdCB1bmlmb3JtQnVmZmVyID0gY3JlYXRlVW5pZm9ybUJ1ZmZlcihHUklEX1NJWkUpO1xuXG4gIC8vIENyZWF0ZSBhbiBhcnJheSByZXByZXNlbnRpbmcgdGhlIGFjdGl2ZSBzdGF0ZSBvZiBlYWNoIGNlbGwuXG4gIGNvbnN0IGNlbGxTdGF0ZUFycmF5ID0gbmV3IFVpbnQzMkFycmF5KEdSSURfU0laRSAqIEdSSURfU0laRSk7XG5cbiAgLy8gQ3JlYXRlIGEgc3RvcmFnZSBidWZmZXIgdG8gaG9sZCB0aGUgY2VsbCBzdGF0ZS5cbiAgY29uc3QgY2VsbFN0YXRlU3RvcmFnZSA9IGRldmljZS5jcmVhdGVCdWZmZXIoe1xuICAgIGxhYmVsOiBcIkNlbGwgU3RhdGVcIixcbiAgICBzaXplOiBjZWxsU3RhdGVBcnJheS5ieXRlTGVuZ3RoLFxuICAgIHVzYWdlOiBHUFVCdWZmZXJVc2FnZS5TVE9SQUdFIHwgR1BVQnVmZmVyVXNhZ2UuQ09QWV9EU1QsXG4gIH0pO1xuXG4gIC8vIE1hcmsgZXZlcnkgdGhpcmQgY2VsbCBvZiB0aGUgZ3JpZCBhcyBhY3RpdmUuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgY2VsbFN0YXRlQXJyYXkubGVuZ3RoOyBpICs9IDMpIHtcbiAgICBjZWxsU3RhdGVBcnJheVtpXSA9IDE7XG4gIH1cbiAgZGV2aWNlLnF1ZXVlLndyaXRlQnVmZmVyKGNlbGxTdGF0ZVN0b3JhZ2UsIDAsIGNlbGxTdGF0ZUFycmF5KTtcblxuICBjb25zdCBiaW5kR3JvdXAgPSBkZXZpY2UuY3JlYXRlQmluZEdyb3VwKHtcbiAgICBsYWJlbDogXCJDZWxsIHJlbmRlcmVyIGJpbmQgZ3JvdXBcIixcbiAgICBsYXlvdXQ6IHBpcGVsaW5lX3N0b3JhZ2UuZ2V0QmluZEdyb3VwTGF5b3V0KDApLFxuICAgIGVudHJpZXM6IFt7XG4gICAgICBiaW5kaW5nOiAwLFxuICAgICAgcmVzb3VyY2U6IHsgYnVmZmVyOiB1bmlmb3JtQnVmZmVyIH1cbiAgICB9LFxuICAgIC8vIE5ldyBlbnRyeSFcbiAgICB7XG4gICAgICBiaW5kaW5nOiAxLFxuICAgICAgcmVzb3VyY2U6IHsgYnVmZmVyOiBjZWxsU3RhdGVTdG9yYWdlIH1cbiAgICB9XSxcbiAgfSk7XG5cbiAgcmV0dXJuIHJlbmRlclRvQ2FudmFzKHtcbiAgICB3aWR0aDogNTEyLFxuICAgIGhlaWdodDogNTEyLFxuICAgIGNsZWFyQ29sb3I6IENFTExfQ0xFQVJfQ09MT1IsXG4gICAgcmVuZGVyOiB3aXRoQmluZGluZ3Moe1xuICAgICAgcGlwZWxpbmU6IHBpcGVsaW5lX3N0b3JhZ2UsXG4gICAgICBiaW5kR3JvdXBzOiBbYmluZEdyb3VwXSxcbiAgICAgIHZlcnRleDogW3sgc2xvdDogMCwgYnVmZmVyOiB2ZXJ0ZXhCdWZmZXIgfV0sXG4gICAgICBkcmF3OiB7IHZlcnRleENvdW50OiBjZWxsVmVydGljZXMubGVuZ3RoIC8gMiwgaW5zdGFuY2VDb3VudDogR1JJRF9TSVpFKkdSSURfU0laRSB9XG4gICAgfSlcbiAgfSk7XG5cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IEdSSURfU0laRSA9IDMyO1xuICBjb25zdCB1bmlmb3JtQnVmZmVyID0gY3JlYXRlVW5pZm9ybUJ1ZmZlcihHUklEX1NJWkUpO1xuXG4gIC8vIENyZWF0ZSBhbiBhcnJheSByZXByZXNlbnRpbmcgdGhlIGFjdGl2ZSBzdGF0ZSBvZiBlYWNoIGNlbGwuXG4gIGNvbnN0IGNlbGxTdGF0ZUFycmF5ID0gbmV3IFVpbnQzMkFycmF5KEdSSURfU0laRSAqIEdSSURfU0laRSk7XG5cbiAgLy8gQ3JlYXRlIHR3byBzdG9yYWdlIGJ1ZmZlcnMgdG8gaG9sZCB0aGUgY2VsbCBzdGF0ZS5cbiAgY29uc3QgY2VsbFN0YXRlU3RvcmFnZSA9IFtcbiAgICBkZXZpY2UuY3JlYXRlQnVmZmVyKHtcbiAgICAgIGxhYmVsOiBcIkNlbGwgU3RhdGUgQVwiLFxuICAgICAgc2l6ZTogY2VsbFN0YXRlQXJyYXkuYnl0ZUxlbmd0aCxcbiAgICAgIHVzYWdlOiBHUFVCdWZmZXJVc2FnZS5TVE9SQUdFIHwgR1BVQnVmZmVyVXNhZ2UuQ09QWV9EU1QsXG4gICAgfSksXG4gICAgZGV2aWNlLmNyZWF0ZUJ1ZmZlcih7XG4gICAgICBsYWJlbDogXCJDZWxsIFN0YXRlIEJcIixcbiAgICAgIHNpemU6IGNlbGxTdGF0ZUFycmF5LmJ5dGVMZW5ndGgsXG4gICAgICB1c2FnZTogR1BVQnVmZmVyVXNhZ2UuU1RPUkFHRSB8IEdQVUJ1ZmZlclVzYWdlLkNPUFlfRFNULFxuICAgIH0pXG4gIF07XG5cbiAgLy8gTWFyayBldmVyeSB0aGlyZCBjZWxsIG9mIHRoZSBmaXJzdCBncmlkIGFzIGFjdGl2ZS5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjZWxsU3RhdGVBcnJheS5sZW5ndGg7IGkrPTMpIHtcbiAgICBjZWxsU3RhdGVBcnJheVtpXSA9IDE7XG4gIH1cbiAgZGV2aWNlLnF1ZXVlLndyaXRlQnVmZmVyKGNlbGxTdGF0ZVN0b3JhZ2VbMF0sIDAsIGNlbGxTdGF0ZUFycmF5KTtcblxuICAvLyBNYXJrIGV2ZXJ5IG90aGVyIGNlbGwgb2YgdGhlIHNlY29uZCBncmlkIGFzIGFjdGl2ZS5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjZWxsU3RhdGVBcnJheS5sZW5ndGg7IGkrKykge1xuICAgIGNlbGxTdGF0ZUFycmF5W2ldID0gaSAlIDI7XG4gIH1cbiAgZGV2aWNlLnF1ZXVlLndyaXRlQnVmZmVyKGNlbGxTdGF0ZVN0b3JhZ2VbMV0sIDAsIGNlbGxTdGF0ZUFycmF5KTtcblxuICBjb25zdCBiaW5kR3JvdXBzID0gW1xuICAgIGRldmljZS5jcmVhdGVCaW5kR3JvdXAoe1xuICAgICAgbGFiZWw6IFwiQ2VsbCByZW5kZXJlciBiaW5kIGdyb3VwIEFcIixcbiAgICAgIGxheW91dDogcGlwZWxpbmVfc3RvcmFnZS5nZXRCaW5kR3JvdXBMYXlvdXQoMCksXG4gICAgICBlbnRyaWVzOiBbe1xuICAgICAgICBiaW5kaW5nOiAwLFxuICAgICAgICByZXNvdXJjZTogeyBidWZmZXI6IHVuaWZvcm1CdWZmZXIgfVxuICAgICAgfSwge1xuICAgICAgICBiaW5kaW5nOiAxLFxuICAgICAgICByZXNvdXJjZTogeyBidWZmZXI6IGNlbGxTdGF0ZVN0b3JhZ2VbMF0gfVxuICAgICAgfV0sXG4gICAgfSksXG4gICAgZGV2aWNlLmNyZWF0ZUJpbmRHcm91cCh7XG4gICAgICBsYWJlbDogXCJDZWxsIHJlbmRlcmVyIGJpbmQgZ3JvdXAgQlwiLFxuICAgICAgbGF5b3V0OiBwaXBlbGluZV9zdG9yYWdlLmdldEJpbmRHcm91cExheW91dCgwKSxcbiAgICAgIGVudHJpZXM6IFt7XG4gICAgICAgIGJpbmRpbmc6IDAsXG4gICAgICAgIHJlc291cmNlOiB7IGJ1ZmZlcjogdW5pZm9ybUJ1ZmZlciB9XG4gICAgICB9LCB7XG4gICAgICAgIGJpbmRpbmc6IDEsXG4gICAgICAgIHJlc291cmNlOiB7IGJ1ZmZlcjogY2VsbFN0YXRlU3RvcmFnZVsxXSB9XG4gICAgICB9XSxcbiAgICB9KVxuICBdO1xuXG4gIGNvbnN0IGNhbnZhcyA9IGNyZWF0ZUNhbnZhcyg1MTIsIDUxMik7XG4gIGNvbnN0IGN0eCA9IHNldHVwQ29udGV4dChjYW52YXMsIGRldmljZSwgcHJlc2VudGF0aW9uRm9ybWF0KTtcblxuICBjb25zdCBVUERBVEVfSU5URVJWQUwgPSAyMDA7IC8vIFVwZGF0ZSBldmVyeSAyMDBtcyAoNSB0aW1lcy9zZWMpXG4gIGxldCBzdGVwID0gMDsgLy8gVHJhY2sgaG93IG1hbnkgc2ltdWxhdGlvbiBzdGVwcyBoYXZlIGJlZW4gcnVuXG5cbiAgLy8gTW92ZSBhbGwgb2Ygb3VyIHJlbmRlcmluZyBjb2RlIGludG8gYSBmdW5jdGlvblxuICBmdW5jdGlvbiB1cGRhdGVHcmlkKCkge1xuICAgIHN0ZXArKzsgLy8gSW5jcmVtZW50IHRoZSBzdGVwIGNvdW50XG4gICAgXG4gICAgLy8gU3RhcnQgYSByZW5kZXIgcGFzcyBcbiAgICBjb25zdCB7IGVuY29kZXIsIHBhc3MgfSA9IGJlZ2luUGFzcyhkZXZpY2UsIGN0eCwgQ0VMTF9DTEVBUl9DT0xPUik7XG5cbiAgICAvLyBEcmF3IHRoZSBncmlkLlxuICAgIHBhc3Muc2V0UGlwZWxpbmUocGlwZWxpbmVfc3RvcmFnZSk7XG4gICAgcGFzcy5zZXRCaW5kR3JvdXAoMCwgYmluZEdyb3Vwc1tzdGVwICUgMl0pOyAvLyBVcGRhdGVkIVxuICAgIHBhc3Muc2V0VmVydGV4QnVmZmVyKDAsIHZlcnRleEJ1ZmZlcik7XG4gICAgcGFzcy5kcmF3KGNlbGxWZXJ0aWNlcy5sZW5ndGggLyAyLCBHUklEX1NJWkUgKiBHUklEX1NJWkUpO1xuXG4gICAgLy8gRW5kIHRoZSByZW5kZXIgcGFzcyBhbmQgc3VibWl0IHRoZSBjb21tYW5kIGJ1ZmZlclxuICAgIHBhc3MuZW5kKCk7XG4gICAgZGV2aWNlLnF1ZXVlLnN1Ym1pdChbZW5jb2Rlci5maW5pc2goKV0pO1xuICB9XG5cbiAgLy8gU2NoZWR1bGUgdXBkYXRlR3JpZCgpIHRvIHJ1biByZXBlYXRlZGx5XG4gIHNldEludGVydmFsKHVwZGF0ZUdyaWQsIFVQREFURV9JTlRFUlZBTCk7XG5cbiAgcmV0dXJuIGNhbnZhcztcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG5cbiAgY29uc3QgY2VsbFNoYWRlck1vZHVsZSA9IGRldmljZS5jcmVhdGVTaGFkZXJNb2R1bGUoe1xuICAgIGNvZGU6IC8qIHdnc2wgKi8gYFxuICAgICAgc3RydWN0IFZlcnRleElucHV0IHtcbiAgICAgICAgQGxvY2F0aW9uKDApIHBvczogdmVjMmYsXG4gICAgICAgIEBidWlsdGluKGluc3RhbmNlX2luZGV4KSBpbnN0YW5jZTogdTMyLFxuICAgICAgfTtcblxuICAgICAgc3RydWN0IFZlcnRleE91dHB1dCB7XG4gICAgICAgIEBidWlsdGluKHBvc2l0aW9uKSBwb3M6IHZlYzRmLFxuICAgICAgICBAbG9jYXRpb24oMCkgY2VsbDogdmVjMmYsIC8vIE5ldyBsaW5lIVxuICAgICAgfTtcblxuICAgICAgQGdyb3VwKDApIEBiaW5kaW5nKDApIHZhcjx1bmlmb3JtPiBncmlkOiB2ZWMyZjtcbiAgICAgIEBncm91cCgwKSBAYmluZGluZygxKSB2YXI8c3RvcmFnZT4gY2VsbFN0YXRlOiBhcnJheTx1MzI+OyAvLyBOZXchICAgICAgICAgIFxuICAgIFxuICAgICAgQHZlcnRleFxuICAgICAgZm4gdmVydGV4TWFpbihAbG9jYXRpb24oMCkgcG9zOiB2ZWMyZixcbiAgICAgICAgICAgICAgICAgICAgQGJ1aWx0aW4oaW5zdGFuY2VfaW5kZXgpIGluc3RhbmNlOiB1MzIpIC0+IFZlcnRleE91dHB1dCB7XG4gICAgICAgIGxldCBpID0gZjMyKGluc3RhbmNlKTtcbiAgICAgICAgbGV0IGNlbGwgPSB2ZWMyZihpICUgZ3JpZC54LCBmbG9vcihpIC8gZ3JpZC54KSk7XG4gICAgICAgIGxldCBzdGF0ZSA9IGYzMihjZWxsU3RhdGVbaW5zdGFuY2VdKTsgLy8gTmV3IGxpbmUhXG5cbiAgICAgICAgbGV0IGNlbGxPZmZzZXQgPSBjZWxsIC8gZ3JpZCAqIDI7XG4gICAgICAgIC8vIE5ldzogU2NhbGUgdGhlIHBvc2l0aW9uIGJ5IHRoZSBjZWxsJ3MgYWN0aXZlIHN0YXRlLlxuICAgICAgICBsZXQgZ3JpZFBvcyA9IChwb3Mqc3RhdGUrMSkgLyBncmlkIC0gMSArIGNlbGxPZmZzZXQ7XG5cbiAgICAgICAgdmFyIG91dHB1dDogVmVydGV4T3V0cHV0O1xuICAgICAgICBvdXRwdXQucG9zID0gdmVjNGYoZ3JpZFBvcywgMCwgMSk7XG4gICAgICAgIG91dHB1dC5jZWxsID0gY2VsbDtcbiAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICAgIH1cblxuICAgICAgQGZyYWdtZW50XG4gICAgICBmbiBmcmFnbWVudE1haW4oaW5wdXQ6IFZlcnRleE91dHB1dCkgLT4gQGxvY2F0aW9uKDApIHZlYzRmIHtcbiAgICAgICAgbGV0IGMgPSBpbnB1dC5jZWxsIC8gZ3JpZDtcbiAgICAgICAgcmV0dXJuIHZlYzRmKGMsIDEtYy54LCAxKTtcbiAgICAgIH1cbiAgICBgLFxuICB9KTtcblxuXG4gIC8vIENyZWF0ZSB0aGUgY29tcHV0ZSBzaGFkZXIgdGhhdCB3aWxsIHByb2Nlc3MgdGhlIHNpbXVsYXRpb24uXG4gIGNvbnN0IFdPUktHUk9VUF9TSVpFID0gODtcbiAgY29uc3Qgc2ltdWxhdGlvblNoYWRlck1vZHVsZSA9IGRldmljZS5jcmVhdGVTaGFkZXJNb2R1bGUoe1xuICAgIGxhYmVsOiBcIkdhbWUgb2YgTGlmZSBzaW11bGF0aW9uIHNoYWRlclwiLFxuICAgIGNvZGU6IGBcbiAgICAgIEBncm91cCgwKSBAYmluZGluZygwKSB2YXI8dW5pZm9ybT4gZ3JpZDogdmVjMmY7XG5cbiAgICAgIEBncm91cCgwKSBAYmluZGluZygxKSB2YXI8c3RvcmFnZT4gY2VsbFN0YXRlSW46IGFycmF5PHUzMj47XG4gICAgICBAZ3JvdXAoMCkgQGJpbmRpbmcoMikgdmFyPHN0b3JhZ2UsIHJlYWRfd3JpdGU+IGNlbGxTdGF0ZU91dDogYXJyYXk8dTMyPjtcbiAgICAgICAgXG4gICAgICBmbiBjZWxsSW5kZXgoY2VsbDogdmVjMnUpIC0+IHUzMiB7XG4gICAgICAgIHJldHVybiBjZWxsLnkgKiB1MzIoZ3JpZC54KSArIGNlbGwueDtcbiAgICAgIH1cblxuICAgICAgQGNvbXB1dGUgQHdvcmtncm91cF9zaXplKCR7V09SS0dST1VQX1NJWkV9LCAke1dPUktHUk9VUF9TSVpFfSlcbiAgICAgIGZuIGNvbXB1dGVNYWluKEBidWlsdGluKGdsb2JhbF9pbnZvY2F0aW9uX2lkKSBjZWxsOiB2ZWMzdSkge1xuICAgICAgICAvLyBOZXcgbGluZXMuIEZsaXAgdGhlIGNlbGwgc3RhdGUgZXZlcnkgc3RlcC5cbiAgICAgICAgaWYgKGNlbGxTdGF0ZUluW2NlbGxJbmRleChjZWxsLnh5KV0gPT0gMSkge1xuICAgICAgICAgIGNlbGxTdGF0ZU91dFtjZWxsSW5kZXgoY2VsbC54eSldID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjZWxsU3RhdGVPdXRbY2VsbEluZGV4KGNlbGwueHkpXSA9IDE7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBgXG4gIH0pO1xuXG4gIGNvbnN0IEdSSURfU0laRSA9IDMyO1xuICBjb25zdCB1bmlmb3JtQnVmZmVyID0gY3JlYXRlVW5pZm9ybUJ1ZmZlcihHUklEX1NJWkUpO1xuXG4gIC8vIENyZWF0ZSBhbiBhcnJheSByZXByZXNlbnRpbmcgdGhlIGFjdGl2ZSBzdGF0ZSBvZiBlYWNoIGNlbGwuXG4gIGNvbnN0IGNlbGxTdGF0ZUFycmF5ID0gbmV3IFVpbnQzMkFycmF5KEdSSURfU0laRSAqIEdSSURfU0laRSk7XG5cbiAgLy8gQ3JlYXRlIHR3byBzdG9yYWdlIGJ1ZmZlcnMgdG8gaG9sZCB0aGUgY2VsbCBzdGF0ZS5cbiAgY29uc3QgY2VsbFN0YXRlU3RvcmFnZSA9IFtcbiAgICBkZXZpY2UuY3JlYXRlQnVmZmVyKHtcbiAgICAgIGxhYmVsOiBcIkNlbGwgU3RhdGUgQVwiLFxuICAgICAgc2l6ZTogY2VsbFN0YXRlQXJyYXkuYnl0ZUxlbmd0aCxcbiAgICAgIHVzYWdlOiBHUFVCdWZmZXJVc2FnZS5TVE9SQUdFIHwgR1BVQnVmZmVyVXNhZ2UuQ09QWV9EU1QsXG4gICAgfSksXG4gICAgZGV2aWNlLmNyZWF0ZUJ1ZmZlcih7XG4gICAgICBsYWJlbDogXCJDZWxsIFN0YXRlIEJcIixcbiAgICAgIHNpemU6IGNlbGxTdGF0ZUFycmF5LmJ5dGVMZW5ndGgsXG4gICAgICB1c2FnZTogR1BVQnVmZmVyVXNhZ2UuU1RPUkFHRSB8IEdQVUJ1ZmZlclVzYWdlLkNPUFlfRFNULFxuICAgIH0pXG4gIF07XG5cbiAgLy8gTWFyayBldmVyeSB0aGlyZCBjZWxsIG9mIHRoZSBmaXJzdCBncmlkIGFzIGFjdGl2ZS5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjZWxsU3RhdGVBcnJheS5sZW5ndGg7IGkrPTMpIHtcbiAgICBjZWxsU3RhdGVBcnJheVtpXSA9IDE7XG4gIH1cbiAgZGV2aWNlLnF1ZXVlLndyaXRlQnVmZmVyKGNlbGxTdGF0ZVN0b3JhZ2VbMF0sIDAsIGNlbGxTdGF0ZUFycmF5KTtcblxuICAvLyBNYXJrIGV2ZXJ5IG90aGVyIGNlbGwgb2YgdGhlIHNlY29uZCBncmlkIGFzIGFjdGl2ZS5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjZWxsU3RhdGVBcnJheS5sZW5ndGg7IGkrKykge1xuICAgIGNlbGxTdGF0ZUFycmF5W2ldID0gaSAlIDI7XG4gIH1cbiAgZGV2aWNlLnF1ZXVlLndyaXRlQnVmZmVyKGNlbGxTdGF0ZVN0b3JhZ2VbMV0sIDAsIGNlbGxTdGF0ZUFycmF5KTtcblxuXG4gIC8vIENyZWF0ZSB0aGUgYmluZCBncm91cCBsYXlvdXQgYW5kIHBpcGVsaW5lIGxheW91dC5cbiAgY29uc3QgYmluZEdyb3VwTGF5b3V0ID0gZGV2aWNlLmNyZWF0ZUJpbmRHcm91cExheW91dCh7XG4gICAgbGFiZWw6IFwiQ2VsbCBCaW5kIEdyb3VwIExheW91dFwiLFxuICAgIGVudHJpZXM6IFt7XG4gICAgICBiaW5kaW5nOiAwLFxuICAgICAgLy8gRnJhZ21lbnQgc3RhZ2UgaW5jbHVkZWQgYmVjYXVzZSB0aGUgYGdyaWRgIHVuaWZvcm0gaXMgYWxzbyByZWFkIGluIGZyYWdtZW50TWFpbi5cbiAgICAgIHZpc2liaWxpdHk6IEdQVVNoYWRlclN0YWdlLlZFUlRFWCB8IEdQVVNoYWRlclN0YWdlLkZSQUdNRU5UIHwgR1BVU2hhZGVyU3RhZ2UuQ09NUFVURSxcbiAgICAgIGJ1ZmZlcjoge30gLy8gR3JpZCB1bmlmb3JtIGJ1ZmZlclxuICAgIH0sIHtcbiAgICAgIGJpbmRpbmc6IDEsXG4gICAgICB2aXNpYmlsaXR5OiBHUFVTaGFkZXJTdGFnZS5WRVJURVggfCBHUFVTaGFkZXJTdGFnZS5DT01QVVRFLFxuICAgICAgYnVmZmVyOiB7IHR5cGU6IFwicmVhZC1vbmx5LXN0b3JhZ2VcIn0gLy8gQ2VsbCBzdGF0ZSBpbnB1dCBidWZmZXJcbiAgICB9LCB7XG4gICAgICBiaW5kaW5nOiAyLFxuICAgICAgdmlzaWJpbGl0eTogR1BVU2hhZGVyU3RhZ2UuQ09NUFVURSxcbiAgICAgIGJ1ZmZlcjogeyB0eXBlOiBcInN0b3JhZ2VcIn0gLy8gQ2VsbCBzdGF0ZSBvdXRwdXQgYnVmZmVyXG4gICAgfV1cbiAgfSk7XG5cbiAgLy8gQ3JlYXRlIGEgYmluZCBncm91cCB0byBwYXNzIHRoZSBncmlkIHVuaWZvcm1zIGludG8gdGhlIHBpcGVsaW5lXG4gIGNvbnN0IGJpbmRHcm91cHMgPSBbXG4gICAgZGV2aWNlLmNyZWF0ZUJpbmRHcm91cCh7XG4gICAgICBsYWJlbDogXCJDZWxsIHJlbmRlcmVyIGJpbmQgZ3JvdXAgQVwiLFxuICAgICAgbGF5b3V0OiBiaW5kR3JvdXBMYXlvdXQsIC8vIFVwZGF0ZWQgTGluZVxuICAgICAgZW50cmllczogW3tcbiAgICAgICAgYmluZGluZzogMCxcbiAgICAgICAgcmVzb3VyY2U6IHsgYnVmZmVyOiB1bmlmb3JtQnVmZmVyIH1cbiAgICAgIH0sIHtcbiAgICAgICAgYmluZGluZzogMSxcbiAgICAgICAgcmVzb3VyY2U6IHsgYnVmZmVyOiBjZWxsU3RhdGVTdG9yYWdlWzBdIH1cbiAgICAgIH0sIHtcbiAgICAgICAgYmluZGluZzogMiwgLy8gTmV3IEVudHJ5XG4gICAgICAgIHJlc291cmNlOiB7IGJ1ZmZlcjogY2VsbFN0YXRlU3RvcmFnZVsxXSB9XG4gICAgICB9XSxcbiAgICB9KSxcbiAgICBkZXZpY2UuY3JlYXRlQmluZEdyb3VwKHtcbiAgICAgIGxhYmVsOiBcIkNlbGwgcmVuZGVyZXIgYmluZCBncm91cCBCXCIsXG4gICAgICBsYXlvdXQ6IGJpbmRHcm91cExheW91dCwgLy8gVXBkYXRlZCBMaW5lXG5cbiAgICAgIGVudHJpZXM6IFt7XG4gICAgICAgIGJpbmRpbmc6IDAsXG4gICAgICAgIHJlc291cmNlOiB7IGJ1ZmZlcjogdW5pZm9ybUJ1ZmZlciB9XG4gICAgICB9LCB7XG4gICAgICAgIGJpbmRpbmc6IDEsXG4gICAgICAgIHJlc291cmNlOiB7IGJ1ZmZlcjogY2VsbFN0YXRlU3RvcmFnZVsxXSB9XG4gICAgICB9LCB7XG4gICAgICAgIGJpbmRpbmc6IDIsIC8vIE5ldyBFbnRyeVxuICAgICAgICByZXNvdXJjZTogeyBidWZmZXI6IGNlbGxTdGF0ZVN0b3JhZ2VbMF0gfVxuICAgICAgfV0sXG4gICAgfSksXG4gIF07XG5cbiAgY29uc3QgcGlwZWxpbmVMYXlvdXQgPSBkZXZpY2UuY3JlYXRlUGlwZWxpbmVMYXlvdXQoe1xuICAgIGxhYmVsOiBcIkNlbGwgUGlwZWxpbmUgTGF5b3V0XCIsXG4gICAgYmluZEdyb3VwTGF5b3V0czogWyBiaW5kR3JvdXBMYXlvdXQgXSxcbiAgfSk7XG5cbiAgY29uc3QgY2VsbFBpcGVsaW5lID0gZGV2aWNlLmNyZWF0ZVJlbmRlclBpcGVsaW5lKHtcbiAgICBsYWJlbDogXCJDZWxsIHBpcGVsaW5lXCIsXG4gICAgbGF5b3V0OiBwaXBlbGluZUxheW91dCxcbiAgICB2ZXJ0ZXg6IHtcbiAgICAgIG1vZHVsZTogY2VsbFNoYWRlck1vZHVsZSxcbiAgICAgIGVudHJ5UG9pbnQ6IFwidmVydGV4TWFpblwiLFxuICAgICAgYnVmZmVyczogW2NlbGxWZXJ0ZXhCdWZmZXJMYXlvdXRdXG4gICAgfSxcbiAgICBmcmFnbWVudDoge1xuICAgICAgbW9kdWxlOiBjZWxsU2hhZGVyTW9kdWxlLFxuICAgICAgZW50cnlQb2ludDogXCJmcmFnbWVudE1haW5cIixcbiAgICAgIHRhcmdldHM6IFt7IGZvcm1hdDogcHJlc2VudGF0aW9uRm9ybWF0IH1dXG4gICAgfVxuICB9KTtcblxuICAvLyBDcmVhdGUgYSBjb21wdXRlIHBpcGVsaW5lIHRoYXQgdXBkYXRlcyB0aGUgZ2FtZSBzdGF0ZS5cbiAgY29uc3Qgc2ltdWxhdGlvblBpcGVsaW5lID0gZGV2aWNlLmNyZWF0ZUNvbXB1dGVQaXBlbGluZSh7XG4gICAgbGFiZWw6IFwiU2ltdWxhdGlvbiBwaXBlbGluZVwiLFxuICAgIGxheW91dDogcGlwZWxpbmVMYXlvdXQsXG4gICAgY29tcHV0ZToge1xuICAgICAgbW9kdWxlOiBzaW11bGF0aW9uU2hhZGVyTW9kdWxlLFxuICAgICAgZW50cnlQb2ludDogXCJjb21wdXRlTWFpblwiLFxuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgY2FudmFzID0gY3JlYXRlQ2FudmFzKDUxMiwgNTEyKTtcbiAgY29uc3QgY3R4ID0gc2V0dXBDb250ZXh0KGNhbnZhcywgZGV2aWNlLCBwcmVzZW50YXRpb25Gb3JtYXQpO1xuXG4gIGNvbnN0IFVQREFURV9JTlRFUlZBTCA9IDIwMDsgLy8gVXBkYXRlIGV2ZXJ5IDIwMG1zICg1IHRpbWVzL3NlYylcbiAgbGV0IHN0ZXAgPSAwOyAvLyBUcmFjayBob3cgbWFueSBzaW11bGF0aW9uIHN0ZXBzIGhhdmUgYmVlbiBydW5cblxuICAvLyBNb3ZlIGFsbCBvZiBvdXIgcmVuZGVyaW5nIGNvZGUgaW50byBhIGZ1bmN0aW9uXG4gIGZ1bmN0aW9uIHVwZGF0ZUdyaWQoKSB7XG4gICAgXG4gICAgLy8gU3RhcnQgYSByZW5kZXIgcGFzcyBcbiAgICBjb25zdCBlbmNvZGVyID0gZGV2aWNlLmNyZWF0ZUNvbW1hbmRFbmNvZGVyKCk7XG5cbiAgICBjb25zdCBjb21wdXRlUGFzcyA9IGVuY29kZXIuYmVnaW5Db21wdXRlUGFzcygpO1xuXG4gICAgY29tcHV0ZVBhc3Muc2V0UGlwZWxpbmUoc2ltdWxhdGlvblBpcGVsaW5lKTtcbiAgICBjb21wdXRlUGFzcy5zZXRCaW5kR3JvdXAoMCwgYmluZEdyb3Vwc1tzdGVwICUgMl0pO1xuXG4gICAgLy8gTmV3IGxpbmVzXG4gICAgY29uc3Qgd29ya2dyb3VwQ291bnQgPSBNYXRoLmNlaWwoR1JJRF9TSVpFIC8gV09SS0dST1VQX1NJWkUpO1xuICAgIGNvbXB1dGVQYXNzLmRpc3BhdGNoV29ya2dyb3Vwcyh3b3JrZ3JvdXBDb3VudCwgd29ya2dyb3VwQ291bnQpO1xuXG4gICAgY29tcHV0ZVBhc3MuZW5kKCk7XG5cbiAgICBzdGVwKys7IC8vIEluY3JlbWVudCB0aGUgc3RlcCBjb3VudFxuXG4gICAgY29uc3QgdmlldyA9IGN0eC5nZXRDdXJyZW50VGV4dHVyZSgpLmNyZWF0ZVZpZXcoKTtcblxuICAgIGNvbnN0IHBhc3MgPSBlbmNvZGVyLmJlZ2luUmVuZGVyUGFzcyh7XG4gICAgICBjb2xvckF0dGFjaG1lbnRzOiBbe1xuICAgICAgICB2aWV3OiB2aWV3LFxuICAgICAgICBsb2FkT3A6IFwiY2xlYXJcIixcbiAgICAgICAgc3RvcmVPcDogXCJzdG9yZVwiLFxuICAgICAgICBjbGVhclZhbHVlOiB7IHI6IDAuMDIsIGc6IDAuMDYsIGI6IDAuMTUsIGE6IDEgfSwgLy8gPDE+XG4gICAgICB9XSxcbiAgICB9KTtcblxuXG4gICAgLy8gRHJhdyB0aGUgZ3JpZC5cbiAgICBwYXNzLnNldFBpcGVsaW5lKGNlbGxQaXBlbGluZSk7XG4gICAgcGFzcy5zZXRCaW5kR3JvdXAoMCwgYmluZEdyb3Vwc1tzdGVwICUgMl0pOyAvLyBVcGRhdGVkIVxuICAgIHBhc3Muc2V0VmVydGV4QnVmZmVyKDAsIHZlcnRleEJ1ZmZlcik7XG4gICAgcGFzcy5kcmF3KGNlbGxWZXJ0aWNlcy5sZW5ndGggLyAyLCBHUklEX1NJWkUgKiBHUklEX1NJWkUpO1xuXG4gICAgLy8gRW5kIHRoZSByZW5kZXIgcGFzcyBhbmQgc3VibWl0IHRoZSBjb21tYW5kIGJ1ZmZlclxuICAgIHBhc3MuZW5kKCk7XG4gICAgZGV2aWNlLnF1ZXVlLnN1Ym1pdChbZW5jb2Rlci5maW5pc2goKV0pO1xuICB9XG5cbiAgLy8gU2NoZWR1bGUgdXBkYXRlR3JpZCgpIHRvIHJ1biByZXBlYXRlZGx5XG4gIHNldEludGVydmFsKHVwZGF0ZUdyaWQsIFVQREFURV9JTlRFUlZBTCk7XG5cbiAgcmV0dXJuIGNhbnZhcztcblxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcblxuICBjb25zdCBjZWxsU2hhZGVyTW9kdWxlID0gZGV2aWNlLmNyZWF0ZVNoYWRlck1vZHVsZSh7XG4gICAgY29kZTogLyogd2dzbCAqLyBgXG4gICAgICBzdHJ1Y3QgVmVydGV4SW5wdXQge1xuICAgICAgICBAbG9jYXRpb24oMCkgcG9zOiB2ZWMyZixcbiAgICAgICAgQGJ1aWx0aW4oaW5zdGFuY2VfaW5kZXgpIGluc3RhbmNlOiB1MzIsXG4gICAgICB9O1xuXG4gICAgICBzdHJ1Y3QgVmVydGV4T3V0cHV0IHtcbiAgICAgICAgQGJ1aWx0aW4ocG9zaXRpb24pIHBvczogdmVjNGYsXG4gICAgICAgIEBsb2NhdGlvbigwKSBjZWxsOiB2ZWMyZiwgLy8gTmV3IGxpbmUhXG4gICAgICB9O1xuXG4gICAgICBAZ3JvdXAoMCkgQGJpbmRpbmcoMCkgdmFyPHVuaWZvcm0+IGdyaWQ6IHZlYzJmO1xuICAgICAgQGdyb3VwKDApIEBiaW5kaW5nKDEpIHZhcjxzdG9yYWdlPiBjZWxsU3RhdGU6IGFycmF5PHUzMj47IC8vIE5ldyEgICAgICAgICAgXG4gICAgXG4gICAgICBAdmVydGV4XG4gICAgICBmbiB2ZXJ0ZXhNYWluKEBsb2NhdGlvbigwKSBwb3M6IHZlYzJmLFxuICAgICAgICAgICAgICAgICAgICBAYnVpbHRpbihpbnN0YW5jZV9pbmRleCkgaW5zdGFuY2U6IHUzMikgLT4gVmVydGV4T3V0cHV0IHtcbiAgICAgICAgbGV0IGkgPSBmMzIoaW5zdGFuY2UpO1xuICAgICAgICBsZXQgY2VsbCA9IHZlYzJmKGkgJSBncmlkLngsIGZsb29yKGkgLyBncmlkLngpKTtcbiAgICAgICAgbGV0IHN0YXRlID0gZjMyKGNlbGxTdGF0ZVtpbnN0YW5jZV0pOyAvLyBOZXcgbGluZSFcblxuICAgICAgICBsZXQgY2VsbE9mZnNldCA9IGNlbGwgLyBncmlkICogMjtcbiAgICAgICAgLy8gTmV3OiBTY2FsZSB0aGUgcG9zaXRpb24gYnkgdGhlIGNlbGwncyBhY3RpdmUgc3RhdGUuXG4gICAgICAgIGxldCBncmlkUG9zID0gKHBvcypzdGF0ZSsxKSAvIGdyaWQgLSAxICsgY2VsbE9mZnNldDtcblxuICAgICAgICB2YXIgb3V0cHV0OiBWZXJ0ZXhPdXRwdXQ7XG4gICAgICAgIG91dHB1dC5wb3MgPSB2ZWM0ZihncmlkUG9zLCAwLCAxKTtcbiAgICAgICAgb3V0cHV0LmNlbGwgPSBjZWxsO1xuICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgICAgfVxuXG4gICAgICBAZnJhZ21lbnRcbiAgICAgIGZuIGZyYWdtZW50TWFpbihpbnB1dDogVmVydGV4T3V0cHV0KSAtPiBAbG9jYXRpb24oMCkgdmVjNGYge1xuICAgICAgICBsZXQgYyA9IGlucHV0LmNlbGwgLyBncmlkO1xuICAgICAgICByZXR1cm4gdmVjNGYoYywgMS1jLngsIDEpO1xuICAgICAgfVxuICAgIGAsXG4gIH0pO1xuXG5cbiAgLy8gQ3JlYXRlIHRoZSBjb21wdXRlIHNoYWRlciB0aGF0IHdpbGwgcHJvY2VzcyB0aGUgc2ltdWxhdGlvbi5cbiAgY29uc3QgV09SS0dST1VQX1NJWkUgPSA4O1xuICBjb25zdCBzaW11bGF0aW9uU2hhZGVyTW9kdWxlID0gZGV2aWNlLmNyZWF0ZVNoYWRlck1vZHVsZSh7XG4gICAgbGFiZWw6IFwiTGlmZSBzaW11bGF0aW9uIHNoYWRlclwiLFxuICAgIGNvZGU6IGBcbiAgICAgIEBncm91cCgwKSBAYmluZGluZygwKSB2YXI8dW5pZm9ybT4gZ3JpZDogdmVjMmY7XG5cbiAgICAgIEBncm91cCgwKSBAYmluZGluZygxKSB2YXI8c3RvcmFnZT4gY2VsbFN0YXRlSW46IGFycmF5PHUzMj47XG4gICAgICBAZ3JvdXAoMCkgQGJpbmRpbmcoMikgdmFyPHN0b3JhZ2UsIHJlYWRfd3JpdGU+IGNlbGxTdGF0ZU91dDogYXJyYXk8dTMyPjtcblxuICAgICAgZm4gY2VsbEluZGV4KGNlbGw6IHZlYzJ1KSAtPiB1MzIge1xuICAgICAgICByZXR1cm4gKGNlbGwueSAlIHUzMihncmlkLnkpKSAqIHUzMihncmlkLngpICtcbiAgICAgICAgICAgICAgICAoY2VsbC54ICUgdTMyKGdyaWQueCkpO1xuICAgICAgfVxuXG4gICAgICBmbiBjZWxsQWN0aXZlKHg6IHUzMiwgeTogdTMyKSAtPiB1MzIge1xuICAgICAgICByZXR1cm4gY2VsbFN0YXRlSW5bY2VsbEluZGV4KHZlYzIoeCwgeSkpXTtcbiAgICAgIH1cblxuICAgICAgQGNvbXB1dGUgQHdvcmtncm91cF9zaXplKCR7V09SS0dST1VQX1NJWkV9LCAke1dPUktHUk9VUF9TSVpFfSlcbiAgICAgIGZuIGNvbXB1dGVNYWluKEBidWlsdGluKGdsb2JhbF9pbnZvY2F0aW9uX2lkKSBjZWxsOiB2ZWMzdSkge1xuICAgICAgICAvLyBEZXRlcm1pbmUgaG93IG1hbnkgYWN0aXZlIG5laWdoYm9ycyB0aGlzIGNlbGwgaGFzLlxuICAgICAgICBsZXQgYWN0aXZlTmVpZ2hib3JzID0gY2VsbEFjdGl2ZShjZWxsLngrMSwgY2VsbC55KzEpICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxBY3RpdmUoY2VsbC54KzEsIGNlbGwueSkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbEFjdGl2ZShjZWxsLngrMSwgY2VsbC55LTEpICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxBY3RpdmUoY2VsbC54LCBjZWxsLnktMSkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbEFjdGl2ZShjZWxsLngtMSwgY2VsbC55LTEpICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxBY3RpdmUoY2VsbC54LTEsIGNlbGwueSkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbEFjdGl2ZShjZWxsLngtMSwgY2VsbC55KzEpICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxBY3RpdmUoY2VsbC54LCBjZWxsLnkrMSk7XG5cbiAgICAgICAgbGV0IGkgPSBjZWxsSW5kZXgoY2VsbC54eSk7XG5cbiAgICAgICAgLy8gQ29ud2F5J3MgZ2FtZSBvZiBsaWZlIHJ1bGVzOlxuICAgICAgICBzd2l0Y2ggYWN0aXZlTmVpZ2hib3JzIHtcbiAgICAgICAgICBjYXNlIDI6IHtcbiAgICAgICAgICAgIGNlbGxTdGF0ZU91dFtpXSA9IGNlbGxTdGF0ZUluW2ldO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIDM6IHtcbiAgICAgICAgICAgIGNlbGxTdGF0ZU91dFtpXSA9IDE7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgIGNlbGxTdGF0ZU91dFtpXSA9IDA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgYFxuICB9KTtcbiAgY29uc3QgR1JJRF9TSVpFID0gMzI7XG4gIGNvbnN0IHVuaWZvcm1CdWZmZXIgPSBjcmVhdGVVbmlmb3JtQnVmZmVyKEdSSURfU0laRSk7XG5cbiAgLy8gQ3JlYXRlIGFuIGFycmF5IHJlcHJlc2VudGluZyB0aGUgYWN0aXZlIHN0YXRlIG9mIGVhY2ggY2VsbC5cbiAgY29uc3QgY2VsbFN0YXRlQXJyYXkgPSBuZXcgVWludDMyQXJyYXkoR1JJRF9TSVpFICogR1JJRF9TSVpFKTtcblxuICAvLyBDcmVhdGUgdHdvIHN0b3JhZ2UgYnVmZmVycyB0byBob2xkIHRoZSBjZWxsIHN0YXRlLlxuICBjb25zdCBjZWxsU3RhdGVTdG9yYWdlID0gW1xuICAgIGRldmljZS5jcmVhdGVCdWZmZXIoe1xuICAgICAgbGFiZWw6IFwiQ2VsbCBTdGF0ZSBBXCIsXG4gICAgICBzaXplOiBjZWxsU3RhdGVBcnJheS5ieXRlTGVuZ3RoLFxuICAgICAgdXNhZ2U6IEdQVUJ1ZmZlclVzYWdlLlNUT1JBR0UgfCBHUFVCdWZmZXJVc2FnZS5DT1BZX0RTVCxcbiAgICB9KSxcbiAgICBkZXZpY2UuY3JlYXRlQnVmZmVyKHtcbiAgICAgIGxhYmVsOiBcIkNlbGwgU3RhdGUgQlwiLFxuICAgICAgc2l6ZTogY2VsbFN0YXRlQXJyYXkuYnl0ZUxlbmd0aCxcbiAgICAgIHVzYWdlOiBHUFVCdWZmZXJVc2FnZS5TVE9SQUdFIHwgR1BVQnVmZmVyVXNhZ2UuQ09QWV9EU1QsXG4gICAgfSlcbiAgXTtcblxuICAvLyBTZXQgZWFjaCBjZWxsIHRvIGEgcmFuZG9tIHN0YXRlLCB0aGVuIGNvcHkgdGhlIEphdmFTY3JpcHQgYXJyYXkgXG4gIC8vIGludG8gdGhlIHN0b3JhZ2UgYnVmZmVyLlxuICBmb3IgKGxldCBpID0gMDsgaSA8IGNlbGxTdGF0ZUFycmF5Lmxlbmd0aDsgKytpKSB7XG4gICAgY2VsbFN0YXRlQXJyYXlbaV0gPSBNYXRoLnJhbmRvbSgpID4gMC42ID8gMSA6IDA7XG4gIH1cbiAgZGV2aWNlLnF1ZXVlLndyaXRlQnVmZmVyKGNlbGxTdGF0ZVN0b3JhZ2VbMF0sIDAsIGNlbGxTdGF0ZUFycmF5KTtcblxuICAvLyBNYXJrIGV2ZXJ5IG90aGVyIGNlbGwgb2YgdGhlIHNlY29uZCBncmlkIGFzIGFjdGl2ZS5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjZWxsU3RhdGVBcnJheS5sZW5ndGg7IGkrKykge1xuICAgIGNlbGxTdGF0ZUFycmF5W2ldID0gaSAlIDI7XG4gIH1cbiAgZGV2aWNlLnF1ZXVlLndyaXRlQnVmZmVyKGNlbGxTdGF0ZVN0b3JhZ2VbMV0sIDAsIGNlbGxTdGF0ZUFycmF5KTtcblxuXG4gIC8vIENyZWF0ZSB0aGUgYmluZCBncm91cCBsYXlvdXQgYW5kIHBpcGVsaW5lIGxheW91dC5cbiAgY29uc3QgYmluZEdyb3VwTGF5b3V0ID0gZGV2aWNlLmNyZWF0ZUJpbmRHcm91cExheW91dCh7XG4gICAgbGFiZWw6IFwiQ2VsbCBCaW5kIEdyb3VwIExheW91dFwiLFxuICAgIGVudHJpZXM6IFt7XG4gICAgICBiaW5kaW5nOiAwLFxuICAgICAgLy8gRnJhZ21lbnQgc3RhZ2UgaW5jbHVkZWQgYmVjYXVzZSB0aGUgYGdyaWRgIHVuaWZvcm0gaXMgYWxzbyByZWFkIGluIGZyYWdtZW50TWFpbi5cbiAgICAgIHZpc2liaWxpdHk6IEdQVVNoYWRlclN0YWdlLlZFUlRFWCB8IEdQVVNoYWRlclN0YWdlLkZSQUdNRU5UIHwgR1BVU2hhZGVyU3RhZ2UuQ09NUFVURSxcbiAgICAgIGJ1ZmZlcjoge30gLy8gR3JpZCB1bmlmb3JtIGJ1ZmZlclxuICAgIH0sIHtcbiAgICAgIGJpbmRpbmc6IDEsXG4gICAgICB2aXNpYmlsaXR5OiBHUFVTaGFkZXJTdGFnZS5WRVJURVggfCBHUFVTaGFkZXJTdGFnZS5DT01QVVRFLFxuICAgICAgYnVmZmVyOiB7IHR5cGU6IFwicmVhZC1vbmx5LXN0b3JhZ2VcIn0gLy8gQ2VsbCBzdGF0ZSBpbnB1dCBidWZmZXJcbiAgICB9LCB7XG4gICAgICBiaW5kaW5nOiAyLFxuICAgICAgdmlzaWJpbGl0eTogR1BVU2hhZGVyU3RhZ2UuQ09NUFVURSxcbiAgICAgIGJ1ZmZlcjogeyB0eXBlOiBcInN0b3JhZ2VcIn0gLy8gQ2VsbCBzdGF0ZSBvdXRwdXQgYnVmZmVyXG4gICAgfV1cbiAgfSk7XG5cbiAgLy8gQ3JlYXRlIGEgYmluZCBncm91cCB0byBwYXNzIHRoZSBncmlkIHVuaWZvcm1zIGludG8gdGhlIHBpcGVsaW5lXG4gIGNvbnN0IGJpbmRHcm91cHMgPSBbXG4gICAgZGV2aWNlLmNyZWF0ZUJpbmRHcm91cCh7XG4gICAgICBsYWJlbDogXCJDZWxsIHJlbmRlcmVyIGJpbmQgZ3JvdXAgQVwiLFxuICAgICAgbGF5b3V0OiBiaW5kR3JvdXBMYXlvdXQsIC8vIFVwZGF0ZWQgTGluZVxuICAgICAgZW50cmllczogW3tcbiAgICAgICAgYmluZGluZzogMCxcbiAgICAgICAgcmVzb3VyY2U6IHsgYnVmZmVyOiB1bmlmb3JtQnVmZmVyIH1cbiAgICAgIH0sIHtcbiAgICAgICAgYmluZGluZzogMSxcbiAgICAgICAgcmVzb3VyY2U6IHsgYnVmZmVyOiBjZWxsU3RhdGVTdG9yYWdlWzBdIH1cbiAgICAgIH0sIHtcbiAgICAgICAgYmluZGluZzogMiwgLy8gTmV3IEVudHJ5XG4gICAgICAgIHJlc291cmNlOiB7IGJ1ZmZlcjogY2VsbFN0YXRlU3RvcmFnZVsxXSB9XG4gICAgICB9XSxcbiAgICB9KSxcbiAgICBkZXZpY2UuY3JlYXRlQmluZEdyb3VwKHtcbiAgICAgIGxhYmVsOiBcIkNlbGwgcmVuZGVyZXIgYmluZCBncm91cCBCXCIsXG4gICAgICBsYXlvdXQ6IGJpbmRHcm91cExheW91dCwgLy8gVXBkYXRlZCBMaW5lXG5cbiAgICAgIGVudHJpZXM6IFt7XG4gICAgICAgIGJpbmRpbmc6IDAsXG4gICAgICAgIHJlc291cmNlOiB7IGJ1ZmZlcjogdW5pZm9ybUJ1ZmZlciB9XG4gICAgICB9LCB7XG4gICAgICAgIGJpbmRpbmc6IDEsXG4gICAgICAgIHJlc291cmNlOiB7IGJ1ZmZlcjogY2VsbFN0YXRlU3RvcmFnZVsxXSB9XG4gICAgICB9LCB7XG4gICAgICAgIGJpbmRpbmc6IDIsIC8vIE5ldyBFbnRyeVxuICAgICAgICByZXNvdXJjZTogeyBidWZmZXI6IGNlbGxTdGF0ZVN0b3JhZ2VbMF0gfVxuICAgICAgfV0sXG4gICAgfSksXG4gIF07XG5cbiAgY29uc3QgcGlwZWxpbmVMYXlvdXQgPSBkZXZpY2UuY3JlYXRlUGlwZWxpbmVMYXlvdXQoe1xuICAgIGxhYmVsOiBcIkNlbGwgUGlwZWxpbmUgTGF5b3V0XCIsXG4gICAgYmluZEdyb3VwTGF5b3V0czogWyBiaW5kR3JvdXBMYXlvdXQgXSxcbiAgfSk7XG5cbiAgY29uc3QgY2VsbFBpcGVsaW5lID0gZGV2aWNlLmNyZWF0ZVJlbmRlclBpcGVsaW5lKHtcbiAgICBsYWJlbDogXCJDZWxsIHBpcGVsaW5lXCIsXG4gICAgbGF5b3V0OiBwaXBlbGluZUxheW91dCxcbiAgICB2ZXJ0ZXg6IHtcbiAgICAgIG1vZHVsZTogY2VsbFNoYWRlck1vZHVsZSxcbiAgICAgIGVudHJ5UG9pbnQ6IFwidmVydGV4TWFpblwiLFxuICAgICAgYnVmZmVyczogW2NlbGxWZXJ0ZXhCdWZmZXJMYXlvdXRdXG4gICAgfSxcbiAgICBmcmFnbWVudDoge1xuICAgICAgbW9kdWxlOiBjZWxsU2hhZGVyTW9kdWxlLFxuICAgICAgZW50cnlQb2ludDogXCJmcmFnbWVudE1haW5cIixcbiAgICAgIHRhcmdldHM6IFt7IGZvcm1hdDogcHJlc2VudGF0aW9uRm9ybWF0IH1dXG4gICAgfVxuICB9KTtcblxuICAvLyBDcmVhdGUgYSBjb21wdXRlIHBpcGVsaW5lIHRoYXQgdXBkYXRlcyB0aGUgZ2FtZSBzdGF0ZS5cbiAgY29uc3Qgc2ltdWxhdGlvblBpcGVsaW5lID0gZGV2aWNlLmNyZWF0ZUNvbXB1dGVQaXBlbGluZSh7XG4gICAgbGFiZWw6IFwiU2ltdWxhdGlvbiBwaXBlbGluZVwiLFxuICAgIGxheW91dDogcGlwZWxpbmVMYXlvdXQsXG4gICAgY29tcHV0ZToge1xuICAgICAgbW9kdWxlOiBzaW11bGF0aW9uU2hhZGVyTW9kdWxlLFxuICAgICAgZW50cnlQb2ludDogXCJjb21wdXRlTWFpblwiLFxuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgY2FudmFzID0gY3JlYXRlQ2FudmFzKDUxMiwgNTEyKTtcbiAgY29uc3QgY3R4ID0gc2V0dXBDb250ZXh0KGNhbnZhcywgZGV2aWNlLCBwcmVzZW50YXRpb25Gb3JtYXQpO1xuXG4gIGNvbnN0IFVQREFURV9JTlRFUlZBTCA9IDIwMDsgLy8gVXBkYXRlIGV2ZXJ5IDIwMG1zICg1IHRpbWVzL3NlYylcbiAgbGV0IHN0ZXAgPSAwOyAvLyBUcmFjayBob3cgbWFueSBzaW11bGF0aW9uIHN0ZXBzIGhhdmUgYmVlbiBydW5cblxuICAvLyBNb3ZlIGFsbCBvZiBvdXIgcmVuZGVyaW5nIGNvZGUgaW50byBhIGZ1bmN0aW9uXG4gIGZ1bmN0aW9uIHVwZGF0ZUdyaWQoKSB7XG4gICAgXG4gICAgLy8gU3RhcnQgYSByZW5kZXIgcGFzcyBcbiAgICBjb25zdCBlbmNvZGVyID0gZGV2aWNlLmNyZWF0ZUNvbW1hbmRFbmNvZGVyKCk7XG5cbiAgICBjb25zdCBjb21wdXRlUGFzcyA9IGVuY29kZXIuYmVnaW5Db21wdXRlUGFzcygpO1xuXG4gICAgY29tcHV0ZVBhc3Muc2V0UGlwZWxpbmUoc2ltdWxhdGlvblBpcGVsaW5lKTtcbiAgICBjb21wdXRlUGFzcy5zZXRCaW5kR3JvdXAoMCwgYmluZEdyb3Vwc1tzdGVwICUgMl0pO1xuXG4gICAgLy8gTmV3IGxpbmVzXG4gICAgY29uc3Qgd29ya2dyb3VwQ291bnQgPSBNYXRoLmNlaWwoR1JJRF9TSVpFIC8gV09SS0dST1VQX1NJWkUpO1xuICAgIGNvbXB1dGVQYXNzLmRpc3BhdGNoV29ya2dyb3Vwcyh3b3JrZ3JvdXBDb3VudCwgd29ya2dyb3VwQ291bnQpO1xuXG4gICAgY29tcHV0ZVBhc3MuZW5kKCk7XG5cbiAgICBzdGVwKys7IC8vIEluY3JlbWVudCB0aGUgc3RlcCBjb3VudFxuXG4gICAgY29uc3QgdmlldyA9IGN0eC5nZXRDdXJyZW50VGV4dHVyZSgpLmNyZWF0ZVZpZXcoKTtcblxuICAgIGNvbnN0IHBhc3MgPSBlbmNvZGVyLmJlZ2luUmVuZGVyUGFzcyh7XG4gICAgICBjb2xvckF0dGFjaG1lbnRzOiBbe1xuICAgICAgICB2aWV3OiB2aWV3LFxuICAgICAgICBsb2FkT3A6IFwiY2xlYXJcIixcbiAgICAgICAgc3RvcmVPcDogXCJzdG9yZVwiLFxuICAgICAgICBjbGVhclZhbHVlOiB7IHI6IDAuMDIsIGc6IDAuMDYsIGI6IDAuMTUsIGE6IDEgfSwgLy8gPDE+XG4gICAgICB9XSxcbiAgICB9KTtcblxuXG4gICAgLy8gRHJhdyB0aGUgZ3JpZC5cbiAgICBwYXNzLnNldFBpcGVsaW5lKGNlbGxQaXBlbGluZSk7XG4gICAgcGFzcy5zZXRCaW5kR3JvdXAoMCwgYmluZEdyb3Vwc1tzdGVwICUgMl0pOyAvLyBVcGRhdGVkIVxuICAgIHBhc3Muc2V0VmVydGV4QnVmZmVyKDAsIHZlcnRleEJ1ZmZlcik7XG4gICAgcGFzcy5kcmF3KGNlbGxWZXJ0aWNlcy5sZW5ndGggLyAyLCBHUklEX1NJWkUgKiBHUklEX1NJWkUpO1xuXG4gICAgLy8gRW5kIHRoZSByZW5kZXIgcGFzcyBhbmQgc3VibWl0IHRoZSBjb21tYW5kIGJ1ZmZlclxuICAgIHBhc3MuZW5kKCk7XG4gICAgZGV2aWNlLnF1ZXVlLnN1Ym1pdChbZW5jb2Rlci5maW5pc2goKV0pO1xuICB9XG5cbiAgLy8gU2NoZWR1bGUgdXBkYXRlR3JpZCgpIHRvIHJ1biByZXBlYXRlZGx5XG4gIHNldEludGVydmFsKHVwZGF0ZUdyaWQsIFVQREFURV9JTlRFUlZBTCk7XG5cbiAgcmV0dXJuIGNhbnZhcztcblxufVxuIn1dfQ==
    </script>
    <script type="module">
    if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
    window._ojs.paths.runtimeToDoc = "../../..";
    window._ojs.paths.runtimeToRoot = "../../../..";
    window._ojs.paths.docToRoot = "..";
    window._ojs.selfContained = false;
    window._ojs.runtime.interpretFromScriptTags();
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
            let selectedAnnoteEl;
            const selectorForAnnotation = ( cell, annotation) => {
              let cellAttr = 'data-code-cell="' + cell + '"';
              let lineAttr = 'data-code-annotation="' +  annotation + '"';
              const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
              return selector;
            }
            const selectCodeLines = (annoteEl) => {
              const doc = window.document;
              const targetCell = annoteEl.getAttribute("data-target-cell");
              const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
              const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
              const lines = annoteSpan.getAttribute("data-code-lines").split(",");
              const lineIds = lines.map((line) => {
                return targetCell + "-" + line;
              })
              let top = null;
              let height = null;
              let parent = null;
              if (lineIds.length > 0) {
                  //compute the position of the single el (top and bottom and make a div)
                  const el = window.document.getElementById(lineIds[0]);
                  top = el.offsetTop;
                  height = el.offsetHeight;
                  parent = el.parentElement.parentElement;
                if (lineIds.length > 1) {
                  const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                  const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                  height = bottom - top;
                }
                if (top !== null && height !== null && parent !== null) {
                  // cook up a div (if necessary) and position it 
                  let div = window.document.getElementById("code-annotation-line-highlight");
                  if (div === null) {
                    div = window.document.createElement("div");
                    div.setAttribute("id", "code-annotation-line-highlight");
                    div.style.position = 'absolute';
                    parent.appendChild(div);
                  }
                  div.style.top = top - 2 + "px";
                  div.style.height = height + 4 + "px";
                  div.style.left = 0;
                  let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                  if (gutterDiv === null) {
                    gutterDiv = window.document.createElement("div");
                    gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                    gutterDiv.style.position = 'absolute';
                    const codeCell = window.document.getElementById(targetCell);
                    const gutter = codeCell.querySelector('.code-annotation-gutter');
                    gutter.appendChild(gutterDiv);
                  }
                  gutterDiv.style.top = top - 2 + "px";
                  gutterDiv.style.height = height + 4 + "px";
                }
                selectedAnnoteEl = annoteEl;
              }
            };
            const unselectCodeLines = () => {
              const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
              elementsIds.forEach((elId) => {
                const div = window.document.getElementById(elId);
                if (div) {
                  div.remove();
                }
              });
              selectedAnnoteEl = undefined;
            };
              // Handle positioning of the toggle
          window.addEventListener(
            "resize",
            throttle(() => {
              elRect = undefined;
              if (selectedAnnoteEl) {
                selectCodeLines(selectedAnnoteEl);
              }
            }, 10)
          );
          function throttle(fn, ms) {
          let throttle = false;
          let timer;
            return (...args) => {
              if(!throttle) { // first call gets through
                  fn.apply(this, args);
                  throttle = true;
              } else { // all the others get throttled
                  if(timer) clearTimeout(timer); // cancel #2
                  timer = setTimeout(() => {
                    fn.apply(this, args);
                    timer = throttle = false;
                  }, ms);
              }
            };
          }
            // Attach click handler to the DT
            const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
            for (const annoteDlNode of annoteDls) {
              annoteDlNode.addEventListener('click', (event) => {
                const clickedEl = event.target;
                if (clickedEl !== selectedAnnoteEl) {
                  unselectCodeLines();
                  const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
                  if (activeEl) {
                    activeEl.classList.remove('code-annotation-active');
                  }
                  selectCodeLines(clickedEl);
                  clickedEl.classList.add('code-annotation-active');
                } else {
                  // Unselect the line
                  unselectCodeLines();
                  clickedEl.classList.remove('code-annotation-active');
                }
              });
            }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>