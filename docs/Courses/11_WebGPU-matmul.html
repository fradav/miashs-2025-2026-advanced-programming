<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="François-David Collin">
<meta name="description" content="Interactive Observable JS page to experiment with WebGPU matrix multiplication kernels and measure performance in your browser.">

<title>12&nbsp; Exploring WebGPU Matmul Kernels (OJS) – Advanced programming and parallel computing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../summary.html" rel="next">
<link href="../Courses/10_WebGPU-First-App.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-befe23ebd2f54d8af2c8a89d1a1611f1.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5bf65cff8e2448cf29ae73a4ede46762.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-490d64d59165ea7969eaa97e1a43b317.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


</head>

<body class="nav-sidebar floating quarto-dark"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = true;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Courses/11_WebGPU-matmul.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Exploring WebGPU Matmul Kernels (OJS)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Advanced programming and parallel computing</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Software Prerequisites</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/01_Code-Assistant.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Code Assistants</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/02_Parallel-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction to parallel computing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/03_Asynchronous.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Asynchronous Programming with Python</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/04_IPC-and-Locking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">IPC and locking</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/05_Distributed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Distributed Computing models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/06_Dask-Ray.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Dask and Ray</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/07_Dask-delayed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Dask <code>delayed</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/08_SIMD.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Hardware Vectorization with SIMD</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/09_GPU-Caching-etc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">GPU computing, CPU cache, Computing cluster</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/10_WebGPU-First-App.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Your First WebGPU App</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Courses/11_WebGPU-matmul.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Exploring WebGPU Matmul Kernels (OJS)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Projects/list.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">List of projects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../applications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Applications</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Slides in reveal.js</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">12.1</span> Introduction</a></li>
  <li><a href="#webgpu-setup" id="toc-webgpu-setup" class="nav-link" data-scroll-target="#webgpu-setup"><span class="header-section-number">12.2</span> WebGPU setup</a>
  <ul>
  <li><a href="#helpers-buffers-shader-run" id="toc-helpers-buffers-shader-run" class="nav-link" data-scroll-target="#helpers-buffers-shader-run"><span class="header-section-number">12.2.1</span> Helpers (buffers, shader, run)</a></li>
  <li><a href="#wgsl-kernels" id="toc-wgsl-kernels" class="nav-link" data-scroll-target="#wgsl-kernels"><span class="header-section-number">12.2.2</span> WGSL kernels</a></li>
  <li><a href="#kernel-registry-and-dispatch-math" id="toc-kernel-registry-and-dispatch-math" class="nav-link" data-scroll-target="#kernel-registry-and-dispatch-math"><span class="header-section-number">12.2.3</span> Kernel registry and dispatch math</a></li>
  <li><a href="#runner" id="toc-runner" class="nav-link" data-scroll-target="#runner"><span class="header-section-number">12.2.4</span> Runner</a></li>
  </ul></li>
  <li><a href="#notes-and-tips" id="toc-notes-and-tips" class="nav-link" data-scroll-target="#notes-and-tips"><span class="header-section-number">12.3</span> Notes and tips</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Exploring WebGPU Matmul Kernels (OJS)</span></h1>
  <div class="quarto-categories">
    <div class="quarto-category">webgpu</div>
    <div class="quarto-category">wgsl</div>
    <div class="quarto-category">gpu</div>
    <div class="quarto-category">matmul</div>
    <div class="quarto-category">ojs</div>
  </div>
  </div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">François-David Collin <a href="mailto:francois-david.collin@umontpellier.fr" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            CNRS
          </p>
        <p class="affiliation">
            IMAG
          </p>
        <p class="affiliation">
            Paul-Valéry Montpellier 3 University
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p>This interactive page re-creates (in spirit) several matrix-multiply (matmul) kernels discussed by Zach Nussbaum in “Optimizing a WebGPU Matmul Kernel for 1TFLOP+ Performance” and lets you run them live with WebGPU + Observable JS. The write-up here is paraphrased; see the original article for the full narrative: <a href="https://www.nuss-and-bolts.com/p/optimizing-a-webgpu-matmul-kernel">https://www.nuss-and-bolts.com/p/optimizing-a-webgpu-matmul-kernel</a></p>
</blockquote>
<section id="introduction" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">12.1</span> Introduction</h2>
<p>We’ll build up a few compute shaders in WGSL and compare their throughput:</p>
<ul>
<li>Naive 1D kernel (one thread per output element)</li>
<li>1D with many threads per workgroup</li>
<li>2D workgroups (8×8)</li>
<li>Tiled/unrolled kernels (1×4 and 4×4 per thread)</li>
</ul>
<p>You can tweak M, K, N and the kernel, then measure latency and GFLOP/s. This runs entirely in the browser using WebGPU; make sure your browser/device supports it.</p>
</section>
<section id="webgpu-setup" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="webgpu-setup"><span class="header-section-number">12.2</span> WebGPU setup</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="31" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 30;"><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">// Import Plotly for advanced plotting</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>Plotly <span class="op">=</span> <span class="pp">require</span>(<span class="st">"https://cdn.plot.ly/plotly-latest.min.js"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="36" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 35;"><span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>gpu <span class="op">=</span> <span class="bu">navigator</span><span class="op">.</span><span class="at">gpu</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="40" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 39;"><span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>adapter <span class="op">=</span> gpu <span class="op">&amp;&amp;</span> (<span class="cf">await</span> <span class="bu">navigator</span><span class="op">.</span><span class="at">gpu</span><span class="op">.</span><span class="fu">requestAdapter</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="44" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 43;"><span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co">// Try to request a device with higher limits for large matrices</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> adapter <span class="op">&amp;&amp;</span> (<span class="cf">await</span> adapter<span class="op">.</span><span class="fu">requestDevice</span>({</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  <span class="dt">requiredFeatures</span><span class="op">:</span> adapter<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">has</span>(<span class="st">"timestamp-query"</span>) <span class="op">?</span> [<span class="st">"timestamp-query"</span>] <span class="op">:</span> []<span class="op">,</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="dt">requiredLimits</span><span class="op">:</span> {</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxStorageBufferBindingSize</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(adapter<span class="op">.</span><span class="at">limits</span><span class="op">.</span><span class="at">maxStorageBufferBindingSize</span><span class="op">,</span> <span class="dv">2</span> <span class="op">*</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span>)<span class="op">,</span> <span class="co">// 2GB or adapter max</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxBufferSize</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(adapter<span class="op">.</span><span class="at">limits</span><span class="op">.</span><span class="at">maxBufferSize</span><span class="op">,</span> <span class="dv">2</span> <span class="op">*</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span>)<span class="op">,</span> <span class="co">// 2GB or adapter max</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxStorageBuffersPerShaderStage</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(adapter<span class="op">.</span><span class="at">limits</span><span class="op">.</span><span class="at">maxStorageBuffersPerShaderStage</span><span class="op">,</span> <span class="dv">8</span>)<span class="op">,</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxComputeWorkgroupStorageSize</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(adapter<span class="op">.</span><span class="at">limits</span><span class="op">.</span><span class="at">maxComputeWorkgroupStorageSize</span><span class="op">,</span> <span class="dv">32768</span>)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>}))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb5" data-startfrom="58" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 57;"><span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>queue <span class="op">=</span> device <span class="op">&amp;&amp;</span> device<span class="op">.</span><span class="at">queue</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb6" data-startfrom="62" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 61;"><span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>webgpu_ok <span class="op">=</span> <span class="op">!!</span>device</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb7" data-startfrom="66" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 65;"><span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a><span class="co">// A small status banner</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div class="callout </span><span class="sc">${</span>webgpu_ok <span class="op">?</span> <span class="st">'callout-note'</span> <span class="op">:</span> <span class="st">'callout-warning'</span><span class="sc">}</span><span class="vs">"&gt;&lt;strong&gt;WebGPU&lt;/strong&gt;: </span><span class="sc">${</span>webgpu_ok <span class="op">?</span> <span class="st">'OK — device acquired'</span> <span class="op">:</span> <span class="st">'Not available — try Chrome/Edge/Arc, enable WebGPU, or use a recent macOS'</span><span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="expression">

</div>
</div>
</div>
<section id="helpers-buffers-shader-run" class="level3" data-number="12.2.1">
<h3 data-number="12.2.1" class="anchored" data-anchor-id="helpers-buffers-shader-run"><span class="header-section-number">12.2.1</span> Helpers (buffers, shader, run)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" data-startfrom="75" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 74;"><span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a GPU buffer and optionally initialize with data</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createBuffer</span>(device<span class="op">,</span> dataOrSize<span class="op">,</span> usage) {</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="kw">typeof</span> dataOrSize <span class="op">===</span> <span class="st">'number'</span>) {</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> n <span class="op">=</span> dataOrSize</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> size <span class="op">=</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(n) <span class="op">&amp;&amp;</span> n <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> ((<span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(n <span class="op">/</span> <span class="dv">4</span>) <span class="op">*</span> <span class="dv">4</span>) <span class="op">&gt;&gt;&gt;</span> <span class="dv">0</span>) <span class="op">:</span> <span class="dv">0</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(size) <span class="op">||</span> size <span class="op">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>      <span class="cf">throw</span> <span class="kw">new</span> <span class="bu">Error</span>(<span class="vs">`Invalid buffer size: </span><span class="sc">${</span>n<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> device<span class="op">.</span><span class="fu">createBuffer</span>({ size<span class="op">,</span> usage })</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> dataOrSize</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [byteLength<span class="op">,</span> size] <span class="op">=</span> [data<span class="op">.</span><span class="at">byteLength</span><span class="op">,</span> ((data<span class="op">.</span><span class="at">byteLength</span> <span class="op">+</span> <span class="dv">3</span>) <span class="op">&amp;</span> <span class="op">~</span><span class="dv">3</span>)] <span class="co">// 4-byte align</span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> buffer <span class="op">=</span> device<span class="op">.</span><span class="fu">createBuffer</span>({ size<span class="op">,</span> usage<span class="op">,</span> <span class="dt">mappedAtCreation</span><span class="op">:</span> <span class="kw">true</span> })</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>  <span class="kw">new</span> <span class="bu">Uint8Array</span>(buffer<span class="op">.</span><span class="fu">getMappedRange</span>())<span class="op">.</span><span class="fu">set</span>(<span class="kw">new</span> <span class="bu">Uint8Array</span>(data<span class="op">.</span><span class="at">buffer</span><span class="op">,</span> data<span class="op">.</span><span class="at">byteOffset</span><span class="op">,</span> data<span class="op">.</span><span class="at">byteLength</span>))</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>  buffer<span class="op">.</span><span class="fu">unmap</span>()</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> buffer</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" data-startfrom="97" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 96;"><span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a><span class="co">// Compile a WGSL compute pipeline</span></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">makePipeline</span>(device<span class="op">,</span> wgsl) {</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> module <span class="op">=</span> device<span class="op">.</span><span class="fu">createShaderModule</span>({ <span class="dt">code</span><span class="op">:</span> wgsl })</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pipeline <span class="op">=</span> device<span class="op">.</span><span class="fu">createComputePipeline</span>({</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>    <span class="dt">layout</span><span class="op">:</span> <span class="st">'auto'</span><span class="op">,</span></span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>    <span class="dt">compute</span><span class="op">:</span> { module<span class="op">,</span> <span class="dt">entryPoint</span><span class="op">:</span> <span class="st">'main'</span> }</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> pipeline</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb10" data-startfrom="109" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 108;"><span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a><span class="co">// Uniform struct needs 16-byte size; pad after M,K,N</span></span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">makeDimsUniform</span>(device<span class="op">,</span> M<span class="op">,</span> K<span class="op">,</span> N) {</span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> u32 <span class="op">=</span> <span class="kw">new</span> <span class="bu">Uint32Array</span>([M<span class="op">,</span> K<span class="op">,</span> N<span class="op">,</span> <span class="dv">0</span>]) <span class="co">// pad</span></span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">createBuffer</span>(device<span class="op">,</span> u32<span class="op">,</span> GPUBufferUsage<span class="op">.</span><span class="at">UNIFORM</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span>)</span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" data-startfrom="119" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 118;"><span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a><span class="co">// CPU reference (for small sizes) to optionally check correctness</span></span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">cpuMatmul</span>(A<span class="op">,</span> B<span class="op">,</span> M<span class="op">,</span> K<span class="op">,</span> N) {</span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> C <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float32Array</span>(M <span class="op">*</span> N)</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> M<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> N<span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> s <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">let</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> K<span class="op">;</span> k<span class="op">++</span>) s <span class="op">+=</span> A[i<span class="op">*</span>K <span class="op">+</span> k] <span class="op">*</span> B[k<span class="op">*</span>N <span class="op">+</span> j]</span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>      C[i<span class="op">*</span>N <span class="op">+</span> j] <span class="op">=</span> s</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> C</span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="wgsl-kernels" class="level3" data-number="12.2.2">
<h3 data-number="12.2.2" class="anchored" data-anchor-id="wgsl-kernels"><span class="header-section-number">12.2.2</span> WGSL kernels</h3>
<p>Below are WGSL strings (paraphrased from the ideas in the article). All kernels expect the same bindings:</p>
<ol type="1">
<li><code>@group(0) @binding(0)</code> uniform Dimensions { M,K,N,pad }</li>
<li><code>@group(0) @binding(1)</code> storage read A (row-major M×K)</li>
<li><code>@group(0) @binding(2)</code> storage read B (row-major K×N)</li>
<li><code>@group(0) @binding(3)</code> storage read_write C (row-major M×N)</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" data-startfrom="146" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 145;"><span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a>wgsl_naive_1d <span class="op">=</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a><span class="vs">struct Dimensions { M: u32, K: u32, N: u32, _pad: u32 };</span></span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(0) var&lt;uniform&gt; dims: Dimensions;</span></span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(1) var&lt;storage, read&gt; A: array&lt;f32&gt;;</span></span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(2) var&lt;storage, read&gt; B: array&lt;f32&gt;;</span></span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(3) var&lt;storage, read_write&gt; C: array&lt;f32&gt;;</span></span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a><span class="vs">@compute @workgroup_size(1)</span></span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a><span class="vs">fn main(@builtin(global_invocation_id) gid: vec3&lt;u32&gt;) {</span></span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a><span class="vs">  // Handle multi-dimensional dispatch properly</span></span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a><span class="vs">  let idx = gid.x + gid.y * 65535u + gid.z * 65535u * 65535u;</span></span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a><span class="vs">  let M = dims.M; let K = dims.K; let N = dims.N;</span></span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a><span class="vs">  if (idx &gt;= M * N) { return; }</span></span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a><span class="vs">  let row = idx / N;</span></span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a><span class="vs">  let col = idx % N;</span></span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a><span class="vs">  var sum: f32 = 0.0;</span></span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a><span class="vs">  for (var kk: u32 = 0u; kk &lt; K; kk = kk + 1u) {</span></span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a><span class="vs">    sum = sum + A[row * K + kk] * B[kk * N + col];</span></span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a><span class="vs">  C[row * N + col] = sum;</span></span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb12-167"><a href="#cb12-167" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" data-startfrom="173" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 172;"><span id="cb13-173"><a href="#cb13-173" aria-hidden="true" tabindex="-1"></a>wgsl_1d_many_threads <span class="op">=</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="cb13-174"><a href="#cb13-174" aria-hidden="true" tabindex="-1"></a><span class="vs">struct Dimensions { M: u32, K: u32, N: u32, _pad: u32 };</span></span>
<span id="cb13-175"><a href="#cb13-175" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(0) var&lt;uniform&gt; dims: Dimensions;</span></span>
<span id="cb13-176"><a href="#cb13-176" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(1) var&lt;storage, read&gt; A: array&lt;f32&gt;;</span></span>
<span id="cb13-177"><a href="#cb13-177" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(2) var&lt;storage, read&gt; B: array&lt;f32&gt;;</span></span>
<span id="cb13-178"><a href="#cb13-178" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(3) var&lt;storage, read_write&gt; C: array&lt;f32&gt;;</span></span>
<span id="cb13-179"><a href="#cb13-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-180"><a href="#cb13-180" aria-hidden="true" tabindex="-1"></a><span class="vs">@compute @workgroup_size(256)</span></span>
<span id="cb13-181"><a href="#cb13-181" aria-hidden="true" tabindex="-1"></a><span class="vs">fn main(@builtin(global_invocation_id) gid: vec3&lt;u32&gt;) {</span></span>
<span id="cb13-182"><a href="#cb13-182" aria-hidden="true" tabindex="-1"></a><span class="vs">  // Handle multi-dimensional dispatch properly  </span></span>
<span id="cb13-183"><a href="#cb13-183" aria-hidden="true" tabindex="-1"></a><span class="vs">  let idx = gid.x + gid.y * 65535u + gid.z * 65535u * 65535u;</span></span>
<span id="cb13-184"><a href="#cb13-184" aria-hidden="true" tabindex="-1"></a><span class="vs">  let M = dims.M; let K = dims.K; let N = dims.N;</span></span>
<span id="cb13-185"><a href="#cb13-185" aria-hidden="true" tabindex="-1"></a><span class="vs">  if (idx &gt;= M * N) { return; }</span></span>
<span id="cb13-186"><a href="#cb13-186" aria-hidden="true" tabindex="-1"></a><span class="vs">  let row = idx / N;</span></span>
<span id="cb13-187"><a href="#cb13-187" aria-hidden="true" tabindex="-1"></a><span class="vs">  let col = idx % N;</span></span>
<span id="cb13-188"><a href="#cb13-188" aria-hidden="true" tabindex="-1"></a><span class="vs">  var sum: f32 = 0.0;</span></span>
<span id="cb13-189"><a href="#cb13-189" aria-hidden="true" tabindex="-1"></a><span class="vs">  for (var kk: u32 = 0u; kk &lt; K; kk = kk + 1u) {</span></span>
<span id="cb13-190"><a href="#cb13-190" aria-hidden="true" tabindex="-1"></a><span class="vs">    sum = sum + A[row * K + kk] * B[kk * N + col];</span></span>
<span id="cb13-191"><a href="#cb13-191" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb13-192"><a href="#cb13-192" aria-hidden="true" tabindex="-1"></a><span class="vs">  C[row * N + col] = sum;</span></span>
<span id="cb13-193"><a href="#cb13-193" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb13-194"><a href="#cb13-194" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" data-startfrom="200" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 199;"><span id="cb14-200"><a href="#cb14-200" aria-hidden="true" tabindex="-1"></a>wgsl_2d_8x8 <span class="op">=</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="cb14-201"><a href="#cb14-201" aria-hidden="true" tabindex="-1"></a><span class="vs">struct Dimensions { M: u32, K: u32, N: u32, _pad: u32 };</span></span>
<span id="cb14-202"><a href="#cb14-202" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(0) var&lt;uniform&gt; dims: Dimensions;</span></span>
<span id="cb14-203"><a href="#cb14-203" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(1) var&lt;storage, read&gt; A: array&lt;f32&gt;;</span></span>
<span id="cb14-204"><a href="#cb14-204" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(2) var&lt;storage, read&gt; B: array&lt;f32&gt;;</span></span>
<span id="cb14-205"><a href="#cb14-205" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(3) var&lt;storage, read_write&gt; C: array&lt;f32&gt;;</span></span>
<span id="cb14-206"><a href="#cb14-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-207"><a href="#cb14-207" aria-hidden="true" tabindex="-1"></a><span class="vs">@compute @workgroup_size(8, 8)</span></span>
<span id="cb14-208"><a href="#cb14-208" aria-hidden="true" tabindex="-1"></a><span class="vs">fn main(@builtin(global_invocation_id) gid: vec3&lt;u32&gt;) {</span></span>
<span id="cb14-209"><a href="#cb14-209" aria-hidden="true" tabindex="-1"></a><span class="vs">  // Note: swap to favor coalesced access as discussed in the article</span></span>
<span id="cb14-210"><a href="#cb14-210" aria-hidden="true" tabindex="-1"></a><span class="vs">  let row = gid.y; // M</span></span>
<span id="cb14-211"><a href="#cb14-211" aria-hidden="true" tabindex="-1"></a><span class="vs">  let col = gid.x; // N</span></span>
<span id="cb14-212"><a href="#cb14-212" aria-hidden="true" tabindex="-1"></a><span class="vs">  let M = dims.M; let K = dims.K; let N = dims.N;</span></span>
<span id="cb14-213"><a href="#cb14-213" aria-hidden="true" tabindex="-1"></a><span class="vs">  if (row &gt;= M || col &gt;= N) { return; }</span></span>
<span id="cb14-214"><a href="#cb14-214" aria-hidden="true" tabindex="-1"></a><span class="vs">  var sum: f32 = 0.0;</span></span>
<span id="cb14-215"><a href="#cb14-215" aria-hidden="true" tabindex="-1"></a><span class="vs">  for (var kk: u32 = 0u; kk &lt; K; kk = kk + 1u) {</span></span>
<span id="cb14-216"><a href="#cb14-216" aria-hidden="true" tabindex="-1"></a><span class="vs">    sum = sum + A[row * K + kk] * B[kk * N + col];</span></span>
<span id="cb14-217"><a href="#cb14-217" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb14-218"><a href="#cb14-218" aria-hidden="true" tabindex="-1"></a><span class="vs">  C[row * N + col] = sum;</span></span>
<span id="cb14-219"><a href="#cb14-219" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb14-220"><a href="#cb14-220" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" data-startfrom="226" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 225;"><span id="cb15-226"><a href="#cb15-226" aria-hidden="true" tabindex="-1"></a>wgsl_tile_1x4 <span class="op">=</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="cb15-227"><a href="#cb15-227" aria-hidden="true" tabindex="-1"></a><span class="vs">const BLOCKSIZE: u32 = 16u; // 16x16 threads per workgroup</span></span>
<span id="cb15-228"><a href="#cb15-228" aria-hidden="true" tabindex="-1"></a><span class="vs">const TILE_N: u32 = 4u;     // 4 columns per thread</span></span>
<span id="cb15-229"><a href="#cb15-229" aria-hidden="true" tabindex="-1"></a><span class="vs">struct Dimensions { M: u32, K: u32, N: u32, _pad: u32 };</span></span>
<span id="cb15-230"><a href="#cb15-230" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(0) var&lt;uniform&gt; dims: Dimensions;</span></span>
<span id="cb15-231"><a href="#cb15-231" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(1) var&lt;storage, read&gt; A: array&lt;f32&gt;;</span></span>
<span id="cb15-232"><a href="#cb15-232" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(2) var&lt;storage, read&gt; B: array&lt;f32&gt;;</span></span>
<span id="cb15-233"><a href="#cb15-233" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(3) var&lt;storage, read_write&gt; C: array&lt;f32&gt;;</span></span>
<span id="cb15-234"><a href="#cb15-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-235"><a href="#cb15-235" aria-hidden="true" tabindex="-1"></a><span class="vs">@compute @workgroup_size(BLOCKSIZE, BLOCKSIZE)</span></span>
<span id="cb15-236"><a href="#cb15-236" aria-hidden="true" tabindex="-1"></a><span class="vs">fn main(@builtin(global_invocation_id) gid: vec3&lt;u32&gt;) {</span></span>
<span id="cb15-237"><a href="#cb15-237" aria-hidden="true" tabindex="-1"></a><span class="vs">  let M = dims.M; let K = dims.K; let N = dims.N;</span></span>
<span id="cb15-238"><a href="#cb15-238" aria-hidden="true" tabindex="-1"></a><span class="vs">  let row = gid.y;</span></span>
<span id="cb15-239"><a href="#cb15-239" aria-hidden="true" tabindex="-1"></a><span class="vs">  let col0 = gid.x * TILE_N;</span></span>
<span id="cb15-240"><a href="#cb15-240" aria-hidden="true" tabindex="-1"></a><span class="vs">  if (row &gt;= M || col0 &gt;= N) { return; }</span></span>
<span id="cb15-241"><a href="#cb15-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-242"><a href="#cb15-242" aria-hidden="true" tabindex="-1"></a><span class="vs">  var s0: f32 = 0.0;</span></span>
<span id="cb15-243"><a href="#cb15-243" aria-hidden="true" tabindex="-1"></a><span class="vs">  var s1: f32 = 0.0;</span></span>
<span id="cb15-244"><a href="#cb15-244" aria-hidden="true" tabindex="-1"></a><span class="vs">  var s2: f32 = 0.0;</span></span>
<span id="cb15-245"><a href="#cb15-245" aria-hidden="true" tabindex="-1"></a><span class="vs">  var s3: f32 = 0.0;</span></span>
<span id="cb15-246"><a href="#cb15-246" aria-hidden="true" tabindex="-1"></a><span class="vs">  for (var kk: u32 = 0u; kk &lt; K; kk = kk + 1u) {</span></span>
<span id="cb15-247"><a href="#cb15-247" aria-hidden="true" tabindex="-1"></a><span class="vs">    let a = A[row * K + kk];</span></span>
<span id="cb15-248"><a href="#cb15-248" aria-hidden="true" tabindex="-1"></a><span class="vs">    let base = kk * N + col0;</span></span>
<span id="cb15-249"><a href="#cb15-249" aria-hidden="true" tabindex="-1"></a><span class="vs">    s0 = s0 + a * B[base + 0u];</span></span>
<span id="cb15-250"><a href="#cb15-250" aria-hidden="true" tabindex="-1"></a><span class="vs">    s1 = s1 + a * B[base + 1u];</span></span>
<span id="cb15-251"><a href="#cb15-251" aria-hidden="true" tabindex="-1"></a><span class="vs">    s2 = s2 + a * B[base + 2u];</span></span>
<span id="cb15-252"><a href="#cb15-252" aria-hidden="true" tabindex="-1"></a><span class="vs">    s3 = s3 + a * B[base + 3u];</span></span>
<span id="cb15-253"><a href="#cb15-253" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb15-254"><a href="#cb15-254" aria-hidden="true" tabindex="-1"></a><span class="vs">  C[row * N + col0 + 0u] = s0;</span></span>
<span id="cb15-255"><a href="#cb15-255" aria-hidden="true" tabindex="-1"></a><span class="vs">  if (col0 + 1u &lt; N) { C[row * N + col0 + 1u] = s1; }</span></span>
<span id="cb15-256"><a href="#cb15-256" aria-hidden="true" tabindex="-1"></a><span class="vs">  if (col0 + 2u &lt; N) { C[row * N + col0 + 2u] = s2; }</span></span>
<span id="cb15-257"><a href="#cb15-257" aria-hidden="true" tabindex="-1"></a><span class="vs">  if (col0 + 3u &lt; N) { C[row * N + col0 + 3u] = s3; }</span></span>
<span id="cb15-258"><a href="#cb15-258" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb15-259"><a href="#cb15-259" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" data-startfrom="265" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 264;"><span id="cb16-265"><a href="#cb16-265" aria-hidden="true" tabindex="-1"></a>wgsl_tile_4x4 <span class="op">=</span> <span class="co">/* wgsl */</span> <span class="vs">`</span></span>
<span id="cb16-266"><a href="#cb16-266" aria-hidden="true" tabindex="-1"></a><span class="vs">const BLOCKSIZE: u32 = 16u;</span></span>
<span id="cb16-267"><a href="#cb16-267" aria-hidden="true" tabindex="-1"></a><span class="vs">const TILE_M: u32 = 4u; // 4 rows per thread</span></span>
<span id="cb16-268"><a href="#cb16-268" aria-hidden="true" tabindex="-1"></a><span class="vs">const TILE_N: u32 = 4u; // 4 cols per thread</span></span>
<span id="cb16-269"><a href="#cb16-269" aria-hidden="true" tabindex="-1"></a><span class="vs">struct Dimensions { M: u32, K: u32, N: u32, _pad: u32 };</span></span>
<span id="cb16-270"><a href="#cb16-270" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(0) var&lt;uniform&gt; dims: Dimensions;</span></span>
<span id="cb16-271"><a href="#cb16-271" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(1) var&lt;storage, read&gt; A: array&lt;f32&gt;;</span></span>
<span id="cb16-272"><a href="#cb16-272" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(2) var&lt;storage, read&gt; B: array&lt;f32&gt;;</span></span>
<span id="cb16-273"><a href="#cb16-273" aria-hidden="true" tabindex="-1"></a><span class="vs">@group(0) @binding(3) var&lt;storage, read_write&gt; C: array&lt;f32&gt;;</span></span>
<span id="cb16-274"><a href="#cb16-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-275"><a href="#cb16-275" aria-hidden="true" tabindex="-1"></a><span class="vs">@compute @workgroup_size(BLOCKSIZE, BLOCKSIZE)</span></span>
<span id="cb16-276"><a href="#cb16-276" aria-hidden="true" tabindex="-1"></a><span class="vs">fn main(@builtin(global_invocation_id) gid: vec3&lt;u32&gt;) {</span></span>
<span id="cb16-277"><a href="#cb16-277" aria-hidden="true" tabindex="-1"></a><span class="vs">  let M = dims.M; let K = dims.K; let N = dims.N;</span></span>
<span id="cb16-278"><a href="#cb16-278" aria-hidden="true" tabindex="-1"></a><span class="vs">  let row0 = gid.y * TILE_M;</span></span>
<span id="cb16-279"><a href="#cb16-279" aria-hidden="true" tabindex="-1"></a><span class="vs">  let col0 = gid.x * TILE_N;</span></span>
<span id="cb16-280"><a href="#cb16-280" aria-hidden="true" tabindex="-1"></a><span class="vs">  if (row0 &gt;= M || col0 &gt;= N) { return; }</span></span>
<span id="cb16-281"><a href="#cb16-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-282"><a href="#cb16-282" aria-hidden="true" tabindex="-1"></a><span class="vs">  var s: array&lt;array&lt;f32, TILE_N&gt;, TILE_M&gt;;</span></span>
<span id="cb16-283"><a href="#cb16-283" aria-hidden="true" tabindex="-1"></a><span class="vs">  // initialize</span></span>
<span id="cb16-284"><a href="#cb16-284" aria-hidden="true" tabindex="-1"></a><span class="vs">  for (var ii: u32 = 0u; ii &lt; TILE_M; ii = ii + 1u) {</span></span>
<span id="cb16-285"><a href="#cb16-285" aria-hidden="true" tabindex="-1"></a><span class="vs">    for (var jj: u32 = 0u; jj &lt; TILE_N; jj = jj + 1u) {</span></span>
<span id="cb16-286"><a href="#cb16-286" aria-hidden="true" tabindex="-1"></a><span class="vs">      s[ii][jj] = 0.0;</span></span>
<span id="cb16-287"><a href="#cb16-287" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb16-288"><a href="#cb16-288" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb16-289"><a href="#cb16-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-290"><a href="#cb16-290" aria-hidden="true" tabindex="-1"></a><span class="vs">  // unrolled accumulation over K stays as a loop (K unknown at compile time)</span></span>
<span id="cb16-291"><a href="#cb16-291" aria-hidden="true" tabindex="-1"></a><span class="vs">  for (var kk: u32 = 0u; kk &lt; K; kk = kk + 1u) {</span></span>
<span id="cb16-292"><a href="#cb16-292" aria-hidden="true" tabindex="-1"></a><span class="vs">    for (var ii: u32 = 0u; ii &lt; TILE_M; ii = ii + 1u) {</span></span>
<span id="cb16-293"><a href="#cb16-293" aria-hidden="true" tabindex="-1"></a><span class="vs">      let a = A[(row0 + ii) * K + kk];</span></span>
<span id="cb16-294"><a href="#cb16-294" aria-hidden="true" tabindex="-1"></a><span class="vs">      let bbase = kk * N + col0;</span></span>
<span id="cb16-295"><a href="#cb16-295" aria-hidden="true" tabindex="-1"></a><span class="vs">      for (var jj: u32 = 0u; jj &lt; TILE_N; jj = jj + 1u) {</span></span>
<span id="cb16-296"><a href="#cb16-296" aria-hidden="true" tabindex="-1"></a><span class="vs">        s[ii][jj] = s[ii][jj] + a * B[bbase + jj];</span></span>
<span id="cb16-297"><a href="#cb16-297" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb16-298"><a href="#cb16-298" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb16-299"><a href="#cb16-299" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb16-300"><a href="#cb16-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-301"><a href="#cb16-301" aria-hidden="true" tabindex="-1"></a><span class="vs">  for (var ii: u32 = 0u; ii &lt; TILE_M; ii = ii + 1u) {</span></span>
<span id="cb16-302"><a href="#cb16-302" aria-hidden="true" tabindex="-1"></a><span class="vs">    let r = row0 + ii;</span></span>
<span id="cb16-303"><a href="#cb16-303" aria-hidden="true" tabindex="-1"></a><span class="vs">    if (r &lt; M) {</span></span>
<span id="cb16-304"><a href="#cb16-304" aria-hidden="true" tabindex="-1"></a><span class="vs">      for (var jj: u32 = 0u; jj &lt; TILE_N; jj = jj + 1u) {</span></span>
<span id="cb16-305"><a href="#cb16-305" aria-hidden="true" tabindex="-1"></a><span class="vs">        let c = col0 + jj;</span></span>
<span id="cb16-306"><a href="#cb16-306" aria-hidden="true" tabindex="-1"></a><span class="vs">        if (c &lt; N) { C[r * N + c] = s[ii][jj]; }</span></span>
<span id="cb16-307"><a href="#cb16-307" aria-hidden="true" tabindex="-1"></a><span class="vs">      }</span></span>
<span id="cb16-308"><a href="#cb16-308" aria-hidden="true" tabindex="-1"></a><span class="vs">    }</span></span>
<span id="cb16-309"><a href="#cb16-309" aria-hidden="true" tabindex="-1"></a><span class="vs">  }</span></span>
<span id="cb16-310"><a href="#cb16-310" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb16-311"><a href="#cb16-311" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="ojs-cell-16" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="kernel-registry-and-dispatch-math" class="level3" data-number="12.2.3">
<h3 data-number="12.2.3" class="anchored" data-anchor-id="kernel-registry-and-dispatch-math"><span class="header-section-number">12.2.3</span> Kernel registry and dispatch math</h3>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb17" data-startfrom="318" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 317;"><span id="cb17-318"><a href="#cb17-318" aria-hidden="true" tabindex="-1"></a>kernels <span class="op">=</span> [</span>
<span id="cb17-319"><a href="#cb17-319" aria-hidden="true" tabindex="-1"></a>  { </span>
<span id="cb17-320"><a href="#cb17-320" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> <span class="st">'naive1d'</span><span class="op">,</span> </span>
<span id="cb17-321"><a href="#cb17-321" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">'Naive 1D (wg_size=1)'</span><span class="op">,</span> </span>
<span id="cb17-322"><a href="#cb17-322" aria-hidden="true" tabindex="-1"></a>    <span class="dt">wgsl</span><span class="op">:</span> wgsl_naive_1d<span class="op">,</span> </span>
<span id="cb17-323"><a href="#cb17-323" aria-hidden="true" tabindex="-1"></a>    <span class="dt">dispatch</span><span class="op">:</span> ({M<span class="op">,</span>N}) <span class="kw">=&gt;</span> {</span>
<span id="cb17-324"><a href="#cb17-324" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> total <span class="op">=</span> M<span class="op">*</span>N</span>
<span id="cb17-325"><a href="#cb17-325" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Respect 65535 limit per dimension, use 2D dispatch if needed</span></span>
<span id="cb17-326"><a href="#cb17-326" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (total <span class="op">&lt;=</span> <span class="dv">65535</span>) <span class="cf">return</span> [total<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>]</span>
<span id="cb17-327"><a href="#cb17-327" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">65535</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(total)))</span>
<span id="cb17-328"><a href="#cb17-328" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> y <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(total <span class="op">/</span> x)</span>
<span id="cb17-329"><a href="#cb17-329" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> [x<span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">65535</span><span class="op">,</span> y)<span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(y <span class="op">/</span> <span class="dv">65535</span>))]</span>
<span id="cb17-330"><a href="#cb17-330" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> </span>
<span id="cb17-331"><a href="#cb17-331" aria-hidden="true" tabindex="-1"></a>    <span class="dt">limits</span><span class="op">:</span> { <span class="dt">recommendMaxMN</span><span class="op">:</span> <span class="dv">512</span> } </span>
<span id="cb17-332"><a href="#cb17-332" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb17-333"><a href="#cb17-333" aria-hidden="true" tabindex="-1"></a>  { </span>
<span id="cb17-334"><a href="#cb17-334" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> <span class="st">'oneD256'</span><span class="op">,</span> </span>
<span id="cb17-335"><a href="#cb17-335" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">'1D many threads (256)'</span><span class="op">,</span> </span>
<span id="cb17-336"><a href="#cb17-336" aria-hidden="true" tabindex="-1"></a>    <span class="dt">wgsl</span><span class="op">:</span> wgsl_1d_many_threads<span class="op">,</span> </span>
<span id="cb17-337"><a href="#cb17-337" aria-hidden="true" tabindex="-1"></a>    <span class="dt">dispatch</span><span class="op">:</span> ({M<span class="op">,</span>N}) <span class="kw">=&gt;</span> {</span>
<span id="cb17-338"><a href="#cb17-338" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> total <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>((M<span class="op">*</span>N)<span class="op">/</span><span class="dv">256</span>)</span>
<span id="cb17-339"><a href="#cb17-339" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (total <span class="op">&lt;=</span> <span class="dv">65535</span>) <span class="cf">return</span> [total<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>]</span>
<span id="cb17-340"><a href="#cb17-340" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">65535</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(total)))</span>
<span id="cb17-341"><a href="#cb17-341" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> y <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(total <span class="op">/</span> x)</span>
<span id="cb17-342"><a href="#cb17-342" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> [x<span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">65535</span><span class="op">,</span> y)<span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(y <span class="op">/</span> <span class="dv">65535</span>))]</span>
<span id="cb17-343"><a href="#cb17-343" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> </span>
<span id="cb17-344"><a href="#cb17-344" aria-hidden="true" tabindex="-1"></a>    <span class="dt">limits</span><span class="op">:</span> { <span class="dt">recommendMaxMN</span><span class="op">:</span> <span class="dv">1024</span><span class="op">*</span><span class="dv">1024</span> } </span>
<span id="cb17-345"><a href="#cb17-345" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb17-346"><a href="#cb17-346" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> <span class="st">'twoD8x8'</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">'2D 8×8'</span><span class="op">,</span> <span class="dt">wgsl</span><span class="op">:</span> wgsl_2d_8x8<span class="op">,</span> <span class="dt">dispatch</span><span class="op">:</span> ({M<span class="op">,</span>N}) <span class="kw">=&gt;</span> [<span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(N<span class="op">/</span><span class="dv">8</span>)<span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(M<span class="op">/</span><span class="dv">8</span>)<span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> <span class="dt">limits</span><span class="op">:</span> { <span class="dt">recommendMaxMN</span><span class="op">:</span> <span class="dv">4096</span><span class="op">*</span><span class="dv">4096</span> } }<span class="op">,</span></span>
<span id="cb17-347"><a href="#cb17-347" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> <span class="st">'tile1x4'</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">'Tiled 1×4 (16×16 wg)'</span><span class="op">,</span> <span class="dt">wgsl</span><span class="op">:</span> wgsl_tile_1x4<span class="op">,</span> <span class="dt">dispatch</span><span class="op">:</span> ({M<span class="op">,</span>N}) <span class="kw">=&gt;</span> [<span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(N<span class="op">/</span>(<span class="dv">16</span><span class="op">*</span><span class="dv">4</span>))<span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(M<span class="op">/</span><span class="dv">16</span>)<span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> <span class="dt">limits</span><span class="op">:</span> { <span class="dt">recommendMaxMN</span><span class="op">:</span> <span class="dv">4096</span><span class="op">*</span><span class="dv">4096</span> } }<span class="op">,</span></span>
<span id="cb17-348"><a href="#cb17-348" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> <span class="st">'tile4x4'</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">'Tiled 4×4 (16×16 wg)'</span><span class="op">,</span> <span class="dt">wgsl</span><span class="op">:</span> wgsl_tile_4x4<span class="op">,</span> <span class="dt">dispatch</span><span class="op">:</span> ({M<span class="op">,</span>N}) <span class="kw">=&gt;</span> [<span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(N<span class="op">/</span>(<span class="dv">16</span><span class="op">*</span><span class="dv">4</span>))<span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(M<span class="op">/</span>(<span class="dv">16</span><span class="op">*</span><span class="dv">4</span>))<span class="op">,</span> <span class="dv">1</span>]<span class="op">,</span> <span class="dt">limits</span><span class="op">:</span> { <span class="dt">recommendMaxMN</span><span class="op">:</span> <span class="dv">4096</span><span class="op">*</span><span class="dv">4096</span> } }</span>
<span id="cb17-349"><a href="#cb17-349" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb17-350"><a href="#cb17-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-351"><a href="#cb17-351" aria-hidden="true" tabindex="-1"></a>normalizeKernelKey <span class="op">=</span> value <span class="kw">=&gt;</span> {</span>
<span id="cb17-352"><a href="#cb17-352" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="kw">typeof</span> value <span class="op">===</span> <span class="st">'string'</span>) <span class="cf">return</span> value</span>
<span id="cb17-353"><a href="#cb17-353" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">&amp;&amp;</span> <span class="kw">typeof</span> value <span class="op">===</span> <span class="st">'object'</span>) {</span>
<span id="cb17-354"><a href="#cb17-354" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">typeof</span> value<span class="op">.</span><span class="at">value</span> <span class="op">===</span> <span class="st">'string'</span>) <span class="cf">return</span> value<span class="op">.</span><span class="at">value</span></span>
<span id="cb17-355"><a href="#cb17-355" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="kw">typeof</span> value<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">'string'</span>) <span class="cf">return</span> value<span class="op">.</span><span class="at">key</span></span>
<span id="cb17-356"><a href="#cb17-356" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-357"><a href="#cb17-357" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> kernels[<span class="dv">0</span>]<span class="op">?.</span><span class="at">key</span> <span class="op">??</span> <span class="st">'naive1d'</span></span>
<span id="cb17-358"><a href="#cb17-358" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-17-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb18" data-startfrom="361" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 360;"><span id="cb18-361"><a href="#cb18-361" aria-hidden="true" tabindex="-1"></a><span class="co">// Non-reactive input controls (mutable)</span></span>
<span id="cb18-362"><a href="#cb18-362" aria-hidden="true" tabindex="-1"></a>mutable m_value <span class="op">=</span> <span class="dv">512</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb19" data-startfrom="366" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 365;"><span id="cb19-366"><a href="#cb19-366" aria-hidden="true" tabindex="-1"></a>mutable k_value <span class="op">=</span> <span class="dv">512</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb20" data-startfrom="370" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 369;"><span id="cb20-370"><a href="#cb20-370" aria-hidden="true" tabindex="-1"></a>mutable n_value <span class="op">=</span> <span class="dv">512</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb21" data-startfrom="374" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 373;"><span id="cb21-374"><a href="#cb21-374" aria-hidden="true" tabindex="-1"></a>mutable kernel_value <span class="op">=</span> <span class="st">'naive1d'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb22" data-startfrom="378" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 377;"><span id="cb22-378"><a href="#cb22-378" aria-hidden="true" tabindex="-1"></a>mutable verify_value <span class="op">=</span> <span class="kw">false</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb23" data-startfrom="384" data-source-offset="-81"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 383;"><span id="cb23-384"><a href="#cb23-384" aria-hidden="true" tabindex="-1"></a>max_dim <span class="op">=</span> <span class="dv">16384</span></span>
<span id="cb23-385"><a href="#cb23-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-386"><a href="#cb23-386" aria-hidden="true" tabindex="-1"></a>m_input <span class="op">=</span> {</span>
<span id="cb23-387"><a href="#cb23-387" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">64</span><span class="op">,</span> max_dim]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> mutable m_value<span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">'M (rows of A/C)'</span>})</span>
<span id="cb23-388"><a href="#cb23-388" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'input'</span><span class="op">,</span> () <span class="kw">=&gt;</span> mutable m_value <span class="op">=</span> input<span class="op">.</span><span class="at">value</span>)</span>
<span id="cb23-389"><a href="#cb23-389" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> input</span>
<span id="cb23-390"><a href="#cb23-390" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-23-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-23-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb24" data-startfrom="393" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 392;"><span id="cb24-393"><a href="#cb24-393" aria-hidden="true" tabindex="-1"></a>k_input <span class="op">=</span> {</span>
<span id="cb24-394"><a href="#cb24-394" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">64</span><span class="op">,</span> max_dim]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> mutable k_value<span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">'K (cols of A / rows of B)'</span>})</span>
<span id="cb24-395"><a href="#cb24-395" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'input'</span><span class="op">,</span> () <span class="kw">=&gt;</span> mutable k_value <span class="op">=</span> input<span class="op">.</span><span class="at">value</span>)</span>
<span id="cb24-396"><a href="#cb24-396" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> input</span>
<span id="cb24-397"><a href="#cb24-397" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb25" data-startfrom="401" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 400;"><span id="cb25-401"><a href="#cb25-401" aria-hidden="true" tabindex="-1"></a>n_input <span class="op">=</span> {</span>
<span id="cb25-402"><a href="#cb25-402" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">64</span><span class="op">,</span> max_dim]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> mutable n_value<span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">'N (cols of B/C)'</span>})</span>
<span id="cb25-403"><a href="#cb25-403" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'input'</span><span class="op">,</span> () <span class="kw">=&gt;</span> mutable n_value <span class="op">=</span> input<span class="op">.</span><span class="at">value</span>)</span>
<span id="cb25-404"><a href="#cb25-404" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> input</span>
<span id="cb25-405"><a href="#cb25-405" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-25" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb26" data-startfrom="409" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 408;"><span id="cb26-409"><a href="#cb26-409" aria-hidden="true" tabindex="-1"></a>kernel_input <span class="op">=</span> {</span>
<span id="cb26-410"><a href="#cb26-410" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(</span>
<span id="cb26-411"><a href="#cb26-411" aria-hidden="true" tabindex="-1"></a>    kernels<span class="op">,</span></span>
<span id="cb26-412"><a href="#cb26-412" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb26-413"><a href="#cb26-413" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">'Kernel'</span><span class="op">,</span></span>
<span id="cb26-414"><a href="#cb26-414" aria-hidden="true" tabindex="-1"></a>      <span class="dt">format</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb26-415"><a href="#cb26-415" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> mutable kernel_value<span class="op">,</span></span>
<span id="cb26-416"><a href="#cb26-416" aria-hidden="true" tabindex="-1"></a>      <span class="dt">reduce</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span></span>
<span id="cb26-417"><a href="#cb26-417" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-418"><a href="#cb26-418" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-419"><a href="#cb26-419" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'input'</span><span class="op">,</span> () <span class="kw">=&gt;</span> mutable kernel_value <span class="op">=</span> input<span class="op">.</span><span class="at">value</span>)</span>
<span id="cb26-420"><a href="#cb26-420" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> input</span>
<span id="cb26-421"><a href="#cb26-421" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb27" data-startfrom="425" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 424;"><span id="cb27-425"><a href="#cb27-425" aria-hidden="true" tabindex="-1"></a>verify_input <span class="op">=</span> {</span>
<span id="cb27-426"><a href="#cb27-426" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({<span class="dt">label</span><span class="op">:</span> <span class="st">'Verify (CPU check if small)'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> mutable verify_value})</span>
<span id="cb27-427"><a href="#cb27-427" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">'input'</span><span class="op">,</span> () <span class="kw">=&gt;</span> mutable verify_value <span class="op">=</span> input<span class="op">.</span><span class="at">value</span>)</span>
<span id="cb27-428"><a href="#cb27-428" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> input</span>
<span id="cb27-429"><a href="#cb27-429" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb28" data-startfrom="433" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 432;"><span id="cb28-433"><a href="#cb28-433" aria-hidden="true" tabindex="-1"></a><span class="co">// Group all inputs visually</span></span>
<span id="cb28-434"><a href="#cb28-434" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div&gt;</span></span>
<span id="cb28-435"><a href="#cb28-435" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>m_input<span class="sc">}</span></span>
<span id="cb28-436"><a href="#cb28-436" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>k_input<span class="sc">}</span></span>
<span id="cb28-437"><a href="#cb28-437" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>n_input<span class="sc">}</span></span>
<span id="cb28-438"><a href="#cb28-438" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>kernel_input<span class="sc">}</span></span>
<span id="cb28-439"><a href="#cb28-439" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>verify_input<span class="sc">}</span></span>
<span id="cb28-440"><a href="#cb28-440" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-28" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb29" data-startfrom="444" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 443;"><span id="cb29-444"><a href="#cb29-444" aria-hidden="true" tabindex="-1"></a><span class="co">// Control buttons</span></span>
<span id="cb29-445"><a href="#cb29-445" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div style="display: flex; gap: 0.5rem; margin-top: 1rem;"&gt;</span></span>
<span id="cb29-446"><a href="#cb29-446" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>viewof run<span class="sc">}</span></span>
<span id="cb29-447"><a href="#cb29-447" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>viewof sweep<span class="sc">}</span></span>
<span id="cb29-448"><a href="#cb29-448" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>viewof download_results<span class="sc">}</span></span>
<span id="cb29-449"><a href="#cb29-449" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>viewof clear_results<span class="sc">}</span></span>
<span id="cb29-450"><a href="#cb29-450" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-29" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb30" data-startfrom="454" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 453;"><span id="cb30-454"><a href="#cb30-454" aria-hidden="true" tabindex="-1"></a><span class="co">// Internal cache to store history without creating reactive self-dependencies</span></span>
<span id="cb30-455"><a href="#cb30-455" aria-hidden="true" tabindex="-1"></a>results_history_cache <span class="op">=</span> (() <span class="kw">=&gt;</span> {</span>
<span id="cb30-456"><a href="#cb30-456" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []</span>
<span id="cb30-457"><a href="#cb30-457" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb30-458"><a href="#cb30-458" aria-hidden="true" tabindex="-1"></a>    <span class="kw">get</span> <span class="fu">value</span>() {</span>
<span id="cb30-459"><a href="#cb30-459" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> data<span class="op">.</span><span class="fu">slice</span>()</span>
<span id="cb30-460"><a href="#cb30-460" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb30-461"><a href="#cb30-461" aria-hidden="true" tabindex="-1"></a>    <span class="fu">push</span>(item) {</span>
<span id="cb30-462"><a href="#cb30-462" aria-hidden="true" tabindex="-1"></a>      data<span class="op">.</span><span class="fu">push</span>(item)</span>
<span id="cb30-463"><a href="#cb30-463" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> data<span class="op">.</span><span class="fu">slice</span>()</span>
<span id="cb30-464"><a href="#cb30-464" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb30-465"><a href="#cb30-465" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clear</span>() {</span>
<span id="cb30-466"><a href="#cb30-466" aria-hidden="true" tabindex="-1"></a>      data<span class="op">.</span><span class="at">length</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-467"><a href="#cb30-467" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> data<span class="op">.</span><span class="fu">slice</span>()</span>
<span id="cb30-468"><a href="#cb30-468" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb30-469"><a href="#cb30-469" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-470"><a href="#cb30-470" aria-hidden="true" tabindex="-1"></a>})()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-30" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb31" data-startfrom="474" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 473;"><span id="cb31-474"><a href="#cb31-474" aria-hidden="true" tabindex="-1"></a><span class="co">// Mutable array to store all results</span></span>
<span id="cb31-475"><a href="#cb31-475" aria-hidden="true" tabindex="-1"></a>mutable results_history <span class="op">=</span> []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-31" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb32" data-startfrom="479" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 478;"><span id="cb32-479"><a href="#cb32-479" aria-hidden="true" tabindex="-1"></a><span class="co">// Only the submit button triggers computation - increment on each click</span></span>
<span id="cb32-480"><a href="#cb32-480" aria-hidden="true" tabindex="-1"></a>viewof run <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">'Run matmul'</span><span class="op">,</span> { <span class="dt">reduce</span><span class="op">:</span> v <span class="kw">=&gt;</span> (v <span class="op">??</span> <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span> })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-32" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb33" data-startfrom="484" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 483;"><span id="cb33-484"><a href="#cb33-484" aria-hidden="true" tabindex="-1"></a><span class="co">// Sweep button for running all kernels with power-of-2 dimensions</span></span>
<span id="cb33-485"><a href="#cb33-485" aria-hidden="true" tabindex="-1"></a>viewof sweep <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">'Sweep all kernels'</span><span class="op">,</span> { <span class="dt">reduce</span><span class="op">:</span> v <span class="kw">=&gt;</span> (v <span class="op">??</span> <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span> })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-33" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb34" data-startfrom="489" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 488;"><span id="cb34-489"><a href="#cb34-489" aria-hidden="true" tabindex="-1"></a><span class="co">// Download results button</span></span>
<span id="cb34-490"><a href="#cb34-490" aria-hidden="true" tabindex="-1"></a>viewof download_results <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">'Download CSV'</span><span class="op">,</span> { <span class="dt">reduce</span><span class="op">:</span> v <span class="kw">=&gt;</span> (v <span class="op">??</span> <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span> })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-34" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb35" data-startfrom="494" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 493;"><span id="cb35-494"><a href="#cb35-494" aria-hidden="true" tabindex="-1"></a><span class="co">// Clear results button</span></span>
<span id="cb35-495"><a href="#cb35-495" aria-hidden="true" tabindex="-1"></a>viewof clear_results <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">button</span>(<span class="st">'Clear results'</span><span class="op">,</span> { <span class="dt">reduce</span><span class="op">:</span> v <span class="kw">=&gt;</span> (v <span class="op">??</span> <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span> })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-35" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb36" data-startfrom="499" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 498;"><span id="cb36-499"><a href="#cb36-499" aria-hidden="true" tabindex="-1"></a><span class="co">// Handle clear button clicks</span></span>
<span id="cb36-500"><a href="#cb36-500" aria-hidden="true" tabindex="-1"></a>clear_handler <span class="op">=</span> {</span>
<span id="cb36-501"><a href="#cb36-501" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (clear_results <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb36-502"><a href="#cb36-502" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> emptied <span class="op">=</span> results_history_cache<span class="op">.</span><span class="fu">clear</span>()</span>
<span id="cb36-503"><a href="#cb36-503" aria-hidden="true" tabindex="-1"></a>    mutable results_history <span class="op">=</span> emptied</span>
<span id="cb36-504"><a href="#cb36-504" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-505"><a href="#cb36-505" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> clear_results</span>
<span id="cb36-506"><a href="#cb36-506" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-36" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb37" data-startfrom="510" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 509;"><span id="cb37-510"><a href="#cb37-510" aria-hidden="true" tabindex="-1"></a><span class="co">// Handle download button clicks</span></span>
<span id="cb37-511"><a href="#cb37-511" aria-hidden="true" tabindex="-1"></a>download_handler <span class="op">=</span> {</span>
<span id="cb37-512"><a href="#cb37-512" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (download_results <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb37-513"><a href="#cb37-513" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> history <span class="op">=</span> results_history <span class="op">||</span> []</span>
<span id="cb37-514"><a href="#cb37-514" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (history<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb37-515"><a href="#cb37-515" aria-hidden="true" tabindex="-1"></a>      <span class="fu">alert</span>(<span class="st">'No results to download. Run some tests first.'</span>)</span>
<span id="cb37-516"><a href="#cb37-516" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span></span>
<span id="cb37-517"><a href="#cb37-517" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-518"><a href="#cb37-518" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-519"><a href="#cb37-519" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Convert results to CSV format</span></span>
<span id="cb37-520"><a href="#cb37-520" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> csvData <span class="op">=</span> history<span class="op">.</span><span class="fu">map</span>(result <span class="kw">=&gt;</span> ({</span>
<span id="cb37-521"><a href="#cb37-521" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Run'</span><span class="op">:</span> result<span class="op">.</span><span class="at">runNumber</span> <span class="op">??</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-522"><a href="#cb37-522" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Kernel'</span><span class="op">:</span> result<span class="op">.</span><span class="at">kernel</span> <span class="op">??</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-523"><a href="#cb37-523" aria-hidden="true" tabindex="-1"></a>      <span class="st">'M'</span><span class="op">:</span> result<span class="op">.</span><span class="at">M</span> <span class="op">??</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-524"><a href="#cb37-524" aria-hidden="true" tabindex="-1"></a>      <span class="st">'K'</span><span class="op">:</span> result<span class="op">.</span><span class="at">K</span> <span class="op">??</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-525"><a href="#cb37-525" aria-hidden="true" tabindex="-1"></a>      <span class="st">'N'</span><span class="op">:</span> result<span class="op">.</span><span class="at">N</span> <span class="op">??</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-526"><a href="#cb37-526" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Memory_MB'</span><span class="op">:</span> result<span class="op">.</span><span class="at">totalMB</span> <span class="op">?</span> result<span class="op">.</span><span class="at">totalMB</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">:</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-527"><a href="#cb37-527" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Dispatch_X'</span><span class="op">:</span> result<span class="op">.</span><span class="at">dx</span> <span class="op">??</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-528"><a href="#cb37-528" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Dispatch_Y'</span><span class="op">:</span> result<span class="op">.</span><span class="at">dy</span> <span class="op">??</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-529"><a href="#cb37-529" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Dispatch_Z'</span><span class="op">:</span> result<span class="op">.</span><span class="at">dz</span> <span class="op">??</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-530"><a href="#cb37-530" aria-hidden="true" tabindex="-1"></a>      <span class="st">'GPU_Time_ms'</span><span class="op">:</span> result<span class="op">.</span><span class="at">ms</span> <span class="op">?</span> result<span class="op">.</span><span class="at">ms</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">:</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-531"><a href="#cb37-531" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Total_Time_ms'</span><span class="op">:</span> result<span class="op">.</span><span class="at">totalMs</span> <span class="op">?</span> result<span class="op">.</span><span class="at">totalMs</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">:</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-532"><a href="#cb37-532" aria-hidden="true" tabindex="-1"></a>      <span class="st">'GPU_Throughput_GFLOPS'</span><span class="op">:</span> result<span class="op">.</span><span class="at">gflops</span> <span class="op">?</span> result<span class="op">.</span><span class="at">gflops</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">:</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-533"><a href="#cb37-533" aria-hidden="true" tabindex="-1"></a>      <span class="st">'CPU_Time_ms'</span><span class="op">:</span> result<span class="op">.</span><span class="at">cpuTime</span> <span class="op">?</span> result<span class="op">.</span><span class="at">cpuTime</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">:</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-534"><a href="#cb37-534" aria-hidden="true" tabindex="-1"></a>      <span class="st">'CPU_Throughput_GFLOPS'</span><span class="op">:</span> result<span class="op">.</span><span class="at">cpuGflops</span> <span class="op">?</span> result<span class="op">.</span><span class="at">cpuGflops</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>) <span class="op">:</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-535"><a href="#cb37-535" aria-hidden="true" tabindex="-1"></a>      <span class="st">'GPU_Speedup'</span><span class="op">:</span> (result<span class="op">.</span><span class="at">cpuTime</span> <span class="op">&amp;&amp;</span> result<span class="op">.</span><span class="at">ms</span> <span class="op">&amp;&amp;</span> result<span class="op">.</span><span class="at">ms</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">?</span> (result<span class="op">.</span><span class="at">cpuTime</span> <span class="op">/</span> result<span class="op">.</span><span class="at">ms</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>) <span class="op">:</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb37-536"><a href="#cb37-536" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Max_Error_vs_CPU'</span><span class="op">:</span> result<span class="op">.</span><span class="at">check</span><span class="op">?.</span><span class="at">maxAbs</span> <span class="op">?</span> result<span class="op">.</span><span class="at">check</span><span class="op">.</span><span class="at">maxAbs</span><span class="op">.</span><span class="fu">toExponential</span>(<span class="dv">2</span>) <span class="op">:</span> <span class="st">''</span></span>
<span id="cb37-537"><a href="#cb37-537" aria-hidden="true" tabindex="-1"></a>    }))</span>
<span id="cb37-538"><a href="#cb37-538" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-539"><a href="#cb37-539" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Convert to CSV string</span></span>
<span id="cb37-540"><a href="#cb37-540" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> headers <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(csvData[<span class="dv">0</span>])</span>
<span id="cb37-541"><a href="#cb37-541" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> csvContent <span class="op">=</span> [</span>
<span id="cb37-542"><a href="#cb37-542" aria-hidden="true" tabindex="-1"></a>      headers<span class="op">.</span><span class="fu">join</span>(<span class="st">','</span>)<span class="op">,</span></span>
<span id="cb37-543"><a href="#cb37-543" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>csvData<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> headers<span class="op">.</span><span class="fu">map</span>(header <span class="kw">=&gt;</span> row[header])<span class="op">.</span><span class="fu">join</span>(<span class="st">','</span>))</span>
<span id="cb37-544"><a href="#cb37-544" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">.</span><span class="fu">join</span>(<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb37-545"><a href="#cb37-545" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-546"><a href="#cb37-546" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create and trigger download</span></span>
<span id="cb37-547"><a href="#cb37-547" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> blob <span class="op">=</span> <span class="kw">new</span> <span class="bu">Blob</span>([csvContent]<span class="op">,</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">'text/csv;charset=utf-8;'</span> })</span>
<span id="cb37-548"><a href="#cb37-548" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> link <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">'a'</span>)</span>
<span id="cb37-549"><a href="#cb37-549" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> url <span class="op">=</span> URL<span class="op">.</span><span class="fu">createObjectURL</span>(blob)</span>
<span id="cb37-550"><a href="#cb37-550" aria-hidden="true" tabindex="-1"></a>    link<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">'href'</span><span class="op">,</span> url)</span>
<span id="cb37-551"><a href="#cb37-551" aria-hidden="true" tabindex="-1"></a>    link<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">'download'</span><span class="op">,</span> <span class="vs">`webgpu-matmul-results-</span><span class="sc">${</span><span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">toISOString</span>()<span class="op">.</span><span class="fu">split</span>(<span class="st">'T'</span>)[<span class="dv">0</span>]<span class="sc">}</span><span class="vs">.csv`</span>)</span>
<span id="cb37-552"><a href="#cb37-552" aria-hidden="true" tabindex="-1"></a>    link<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">visibility</span> <span class="op">=</span> <span class="st">'hidden'</span></span>
<span id="cb37-553"><a href="#cb37-553" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">appendChild</span>(link)</span>
<span id="cb37-554"><a href="#cb37-554" aria-hidden="true" tabindex="-1"></a>    link<span class="op">.</span><span class="fu">click</span>()</span>
<span id="cb37-555"><a href="#cb37-555" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="fu">removeChild</span>(link)</span>
<span id="cb37-556"><a href="#cb37-556" aria-hidden="true" tabindex="-1"></a>    URL<span class="op">.</span><span class="fu">revokeObjectURL</span>(url)</span>
<span id="cb37-557"><a href="#cb37-557" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-558"><a href="#cb37-558" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> download_results</span>
<span id="cb37-559"><a href="#cb37-559" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-37" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb38" data-startfrom="563" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 562;"><span id="cb38-563"><a href="#cb38-563" aria-hidden="true" tabindex="-1"></a><span class="co">// Sweep runner - runs all kernels with power-of-2 dimensions</span></span>
<span id="cb38-564"><a href="#cb38-564" aria-hidden="true" tabindex="-1"></a>sweep_results <span class="op">=</span> {</span>
<span id="cb38-565"><a href="#cb38-565" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>sweep) <span class="cf">return</span> <span class="kw">null</span></span>
<span id="cb38-566"><a href="#cb38-566" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-567"><a href="#cb38-567" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>webgpu_ok <span class="op">||</span> <span class="op">!</span>device) {</span>
<span id="cb38-568"><a href="#cb38-568" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> error <span class="op">=</span> <span class="st">'WebGPU not available'</span></span>
<span id="cb38-569"><a href="#cb38-569" aria-hidden="true" tabindex="-1"></a>    mutable compute_status <span class="op">=</span> { <span class="dt">state</span><span class="op">:</span> <span class="st">'error'</span><span class="op">,</span> <span class="dt">message</span><span class="op">:</span> error<span class="op">,</span> error }</span>
<span id="cb38-570"><a href="#cb38-570" aria-hidden="true" tabindex="-1"></a>    mutable status_trigger <span class="op">=</span> mutable status_trigger <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb38-571"><a href="#cb38-571" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { error }</span>
<span id="cb38-572"><a href="#cb38-572" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-573"><a href="#cb38-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-574"><a href="#cb38-574" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dimensions <span class="op">=</span> [<span class="dv">512</span><span class="op">,</span> <span class="dv">1024</span><span class="op">,</span> <span class="dv">2048</span><span class="op">,</span> <span class="dv">4096</span><span class="op">,</span> <span class="dv">8192</span>]</span>
<span id="cb38-575"><a href="#cb38-575" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allKernels <span class="op">=</span> kernels<span class="op">.</span><span class="fu">map</span>(k <span class="kw">=&gt;</span> k<span class="op">.</span><span class="at">key</span>)</span>
<span id="cb38-576"><a href="#cb38-576" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalRuns <span class="op">=</span> dimensions<span class="op">.</span><span class="at">length</span> <span class="op">*</span> allKernels<span class="op">.</span><span class="at">length</span></span>
<span id="cb38-577"><a href="#cb38-577" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> completedRuns <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb38-578"><a href="#cb38-578" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-579"><a href="#cb38-579" aria-hidden="true" tabindex="-1"></a>  mutable compute_status <span class="op">=</span> {</span>
<span id="cb38-580"><a href="#cb38-580" aria-hidden="true" tabindex="-1"></a>    <span class="dt">state</span><span class="op">:</span> <span class="st">'running'</span><span class="op">,</span></span>
<span id="cb38-581"><a href="#cb38-581" aria-hidden="true" tabindex="-1"></a>    <span class="dt">message</span><span class="op">:</span> <span class="vs">`Running sweep: 0/</span><span class="sc">${</span>totalRuns<span class="sc">}</span><span class="vs"> completed`</span><span class="op">,</span></span>
<span id="cb38-582"><a href="#cb38-582" aria-hidden="true" tabindex="-1"></a>    <span class="dt">spinner</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb38-583"><a href="#cb38-583" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-584"><a href="#cb38-584" aria-hidden="true" tabindex="-1"></a>  mutable status_trigger <span class="op">=</span> mutable status_trigger <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb38-585"><a href="#cb38-585" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-586"><a href="#cb38-586" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Yield to browser for status update</span></span>
<span id="cb38-587"><a href="#cb38-587" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(requestAnimationFrame)</span>
<span id="cb38-588"><a href="#cb38-588" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-589"><a href="#cb38-589" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb38-590"><a href="#cb38-590" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">const</span> kernelKey <span class="kw">of</span> allKernels) {</span>
<span id="cb38-591"><a href="#cb38-591" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">const</span> dim <span class="kw">of</span> dimensions) {</span>
<span id="cb38-592"><a href="#cb38-592" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> dims <span class="op">=</span> { <span class="dt">M</span><span class="op">:</span> dim<span class="op">,</span> <span class="dt">K</span><span class="op">:</span> dim<span class="op">,</span> <span class="dt">N</span><span class="op">:</span> dim }</span>
<span id="cb38-593"><a href="#cb38-593" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> totalMB <span class="op">=</span> (dim <span class="op">*</span> dim <span class="op">+</span> dim <span class="op">*</span> dim <span class="op">+</span> dim <span class="op">*</span> dim) <span class="op">*</span> <span class="dv">4</span> <span class="op">/</span> <span class="dv">1024</span> <span class="op">/</span> <span class="dv">1024</span></span>
<span id="cb38-594"><a href="#cb38-594" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-595"><a href="#cb38-595" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Update status for current run</span></span>
<span id="cb38-596"><a href="#cb38-596" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> kernelInfo <span class="op">=</span> kernels<span class="op">.</span><span class="fu">find</span>(k <span class="kw">=&gt;</span> k<span class="op">.</span><span class="at">key</span> <span class="op">===</span> kernelKey)</span>
<span id="cb38-597"><a href="#cb38-597" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> kernelLabel <span class="op">=</span> kernelInfo<span class="op">?.</span><span class="at">label</span> <span class="op">??</span> kernelKey</span>
<span id="cb38-598"><a href="#cb38-598" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-599"><a href="#cb38-599" aria-hidden="true" tabindex="-1"></a>        mutable compute_status <span class="op">=</span> {</span>
<span id="cb38-600"><a href="#cb38-600" aria-hidden="true" tabindex="-1"></a>          <span class="dt">state</span><span class="op">:</span> <span class="st">'running'</span><span class="op">,</span></span>
<span id="cb38-601"><a href="#cb38-601" aria-hidden="true" tabindex="-1"></a>          <span class="dt">message</span><span class="op">:</span> <span class="vs">`Running sweep: </span><span class="sc">${</span>completedRuns<span class="sc">}</span><span class="vs">/</span><span class="sc">${</span>totalRuns<span class="sc">}</span><span class="vs"> - </span><span class="sc">${</span>kernelLabel<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>dim<span class="sc">}</span><span class="vs">×</span><span class="sc">${</span>dim<span class="sc">}</span><span class="vs">×</span><span class="sc">${</span>dim<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb38-602"><a href="#cb38-602" aria-hidden="true" tabindex="-1"></a>          <span class="dt">spinner</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb38-603"><a href="#cb38-603" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb38-604"><a href="#cb38-604" aria-hidden="true" tabindex="-1"></a>        mutable status_trigger <span class="op">=</span> mutable status_trigger <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb38-605"><a href="#cb38-605" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-606"><a href="#cb38-606" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Yield to browser for status update</span></span>
<span id="cb38-607"><a href="#cb38-607" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(requestAnimationFrame)</span>
<span id="cb38-608"><a href="#cb38-608" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-609"><a href="#cb38-609" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="fu">runMatmul</span>(dims<span class="op">,</span> kernelKey<span class="op">,</span> <span class="kw">false</span>) <span class="co">// Don't verify during sweep</span></span>
<span id="cb38-610"><a href="#cb38-610" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-611"><a href="#cb38-611" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (result <span class="op">&amp;&amp;</span> <span class="op">!</span>result<span class="op">.</span><span class="at">error</span>) {</span>
<span id="cb38-612"><a href="#cb38-612" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> enriched <span class="op">=</span> { </span>
<span id="cb38-613"><a href="#cb38-613" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span>result<span class="op">,</span> </span>
<span id="cb38-614"><a href="#cb38-614" aria-hidden="true" tabindex="-1"></a>            totalMB<span class="op">,</span></span>
<span id="cb38-615"><a href="#cb38-615" aria-hidden="true" tabindex="-1"></a>            <span class="dt">runNumber</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">+</span> completedRuns <span class="co">// Use timestamp + counter for unique IDs</span></span>
<span id="cb38-616"><a href="#cb38-616" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb38-617"><a href="#cb38-617" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb38-618"><a href="#cb38-618" aria-hidden="true" tabindex="-1"></a>          <span class="co">// Append to history</span></span>
<span id="cb38-619"><a href="#cb38-619" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> updatedHistory <span class="op">=</span> results_history_cache<span class="op">.</span><span class="fu">push</span>(enriched)</span>
<span id="cb38-620"><a href="#cb38-620" aria-hidden="true" tabindex="-1"></a>          mutable results_history <span class="op">=</span> updatedHistory</span>
<span id="cb38-621"><a href="#cb38-621" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb38-622"><a href="#cb38-622" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb38-623"><a href="#cb38-623" aria-hidden="true" tabindex="-1"></a>        completedRuns<span class="op">++</span></span>
<span id="cb38-624"><a href="#cb38-624" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb38-625"><a href="#cb38-625" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-626"><a href="#cb38-626" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-627"><a href="#cb38-627" aria-hidden="true" tabindex="-1"></a>    mutable compute_status <span class="op">=</span> {</span>
<span id="cb38-628"><a href="#cb38-628" aria-hidden="true" tabindex="-1"></a>      <span class="dt">state</span><span class="op">:</span> <span class="st">'done'</span><span class="op">,</span></span>
<span id="cb38-629"><a href="#cb38-629" aria-hidden="true" tabindex="-1"></a>      <span class="dt">message</span><span class="op">:</span> <span class="vs">`Sweep completed: </span><span class="sc">${</span>completedRuns<span class="sc">}</span><span class="vs">/</span><span class="sc">${</span>totalRuns<span class="sc">}</span><span class="vs"> runs finished`</span><span class="op">,</span></span>
<span id="cb38-630"><a href="#cb38-630" aria-hidden="true" tabindex="-1"></a>      <span class="dt">spinner</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb38-631"><a href="#cb38-631" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-632"><a href="#cb38-632" aria-hidden="true" tabindex="-1"></a>    mutable status_trigger <span class="op">=</span> mutable status_trigger <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb38-633"><a href="#cb38-633" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-634"><a href="#cb38-634" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="dt">completed</span><span class="op">:</span> completedRuns<span class="op">,</span> <span class="dt">total</span><span class="op">:</span> totalRuns }</span>
<span id="cb38-635"><a href="#cb38-635" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (e) {</span>
<span id="cb38-636"><a href="#cb38-636" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> error <span class="op">=</span> e<span class="op">.</span><span class="at">message</span> <span class="op">||</span> e<span class="op">.</span><span class="fu">toString</span>()</span>
<span id="cb38-637"><a href="#cb38-637" aria-hidden="true" tabindex="-1"></a>    mutable compute_status <span class="op">=</span> { </span>
<span id="cb38-638"><a href="#cb38-638" aria-hidden="true" tabindex="-1"></a>      <span class="dt">state</span><span class="op">:</span> <span class="st">'error'</span><span class="op">,</span> </span>
<span id="cb38-639"><a href="#cb38-639" aria-hidden="true" tabindex="-1"></a>      <span class="dt">message</span><span class="op">:</span> <span class="vs">`Sweep failed: </span><span class="sc">${</span>error<span class="sc">}</span><span class="vs"> (completed </span><span class="sc">${</span>completedRuns<span class="sc">}</span><span class="vs">/</span><span class="sc">${</span>totalRuns<span class="sc">}</span><span class="vs">)`</span><span class="op">,</span> </span>
<span id="cb38-640"><a href="#cb38-640" aria-hidden="true" tabindex="-1"></a>      error </span>
<span id="cb38-641"><a href="#cb38-641" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-642"><a href="#cb38-642" aria-hidden="true" tabindex="-1"></a>    mutable status_trigger <span class="op">=</span> mutable status_trigger <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb38-643"><a href="#cb38-643" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { error<span class="op">,</span> <span class="dt">completed</span><span class="op">:</span> completedRuns<span class="op">,</span> <span class="dt">total</span><span class="op">:</span> totalRuns }</span>
<span id="cb38-644"><a href="#cb38-644" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-645"><a href="#cb38-645" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-38" data-nodetype="declaration">

</div>
</div>
</div>
</section>
<section id="runner" class="level3" data-number="12.2.4">
<h3 data-number="12.2.4" class="anchored" data-anchor-id="runner"><span class="header-section-number">12.2.4</span> Runner</h3>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb39" data-startfrom="651" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 650;"><span id="cb39-651"><a href="#cb39-651" aria-hidden="true" tabindex="-1"></a><span class="co">// Create typed arrays and buffers, dispatch, read back C if needed, and time it</span></span>
<span id="cb39-652"><a href="#cb39-652" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">runMatmul</span>({M<span class="op">,</span>K<span class="op">,</span>N}<span class="op">,</span> kernelKey<span class="op">,</span> verify<span class="op">,</span> onStatus <span class="op">=</span> <span class="kw">null</span>) {</span>
<span id="cb39-653"><a href="#cb39-653" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>device) <span class="cf">return</span> { <span class="dt">error</span><span class="op">:</span> <span class="st">'No WebGPU device'</span> }</span>
<span id="cb39-654"><a href="#cb39-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-655"><a href="#cb39-655" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalStart <span class="op">=</span> <span class="bu">performance</span><span class="op">.</span><span class="fu">now</span>()</span>
<span id="cb39-656"><a href="#cb39-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-657"><a href="#cb39-657" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> notify <span class="op">=</span> (message<span class="op">,</span> spinning <span class="op">=</span> <span class="kw">true</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb39-658"><a href="#cb39-658" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (onStatus) <span class="fu">onStatus</span>({ message<span class="op">,</span> spinning })</span>
<span id="cb39-659"><a href="#cb39-659" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-660"><a href="#cb39-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-661"><a href="#cb39-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notify</span>(<span class="st">'1/9 Initializing computation...'</span>)</span>
<span id="cb39-662"><a href="#cb39-662" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(requestAnimationFrame)</span>
<span id="cb39-663"><a href="#cb39-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-664"><a href="#cb39-664" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> key <span class="op">=</span> (<span class="kw">typeof</span> kernelKey <span class="op">===</span> <span class="st">'string'</span>)</span>
<span id="cb39-665"><a href="#cb39-665" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> kernelKey</span>
<span id="cb39-666"><a href="#cb39-666" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> (kernelKey <span class="op">&amp;&amp;</span> <span class="kw">typeof</span> kernelKey <span class="op">===</span> <span class="st">'object'</span> <span class="op">&amp;&amp;</span> (<span class="st">'value'</span> <span class="kw">in</span> kernelKey <span class="op">||</span> <span class="st">'key'</span> <span class="kw">in</span> kernelKey))</span>
<span id="cb39-667"><a href="#cb39-667" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> (kernelKey<span class="op">.</span><span class="at">value</span> <span class="op">??</span> kernelKey<span class="op">.</span><span class="at">key</span>)</span>
<span id="cb39-668"><a href="#cb39-668" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> (kernelKey <span class="op">??</span> <span class="st">'twoD8x8'</span>)</span>
<span id="cb39-669"><a href="#cb39-669" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ker <span class="op">=</span> kernels<span class="op">.</span><span class="fu">find</span>(k <span class="kw">=&gt;</span> k<span class="op">.</span><span class="at">key</span> <span class="op">===</span> key)</span>
<span id="cb39-670"><a href="#cb39-670" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>ker) <span class="cf">return</span> { <span class="dt">error</span><span class="op">:</span> <span class="st">'Unknown kernel'</span> }</span>
<span id="cb39-671"><a href="#cb39-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-672"><a href="#cb39-672" aria-hidden="true" tabindex="-1"></a>  M <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="op">+</span>M <span class="op">||</span> <span class="dv">0</span>))</span>
<span id="cb39-673"><a href="#cb39-673" aria-hidden="true" tabindex="-1"></a>  K <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="op">+</span>K <span class="op">||</span> <span class="dv">0</span>))</span>
<span id="cb39-674"><a href="#cb39-674" aria-hidden="true" tabindex="-1"></a>  N <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="op">+</span>N <span class="op">||</span> <span class="dv">0</span>))</span>
<span id="cb39-675"><a href="#cb39-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-676"><a href="#cb39-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notify</span>(<span class="st">'2/9 Creating input matrices...'</span>)</span>
<span id="cb39-677"><a href="#cb39-677" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(requestAnimationFrame)</span>
<span id="cb39-678"><a href="#cb39-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-679"><a href="#cb39-679" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> elemA <span class="op">=</span> M<span class="op">*</span>K<span class="op">,</span> elemB <span class="op">=</span> K<span class="op">*</span>N<span class="op">,</span> elemC <span class="op">=</span> M<span class="op">*</span>N</span>
<span id="cb39-680"><a href="#cb39-680" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> A <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float32Array</span>(elemA)</span>
<span id="cb39-681"><a href="#cb39-681" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> B <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float32Array</span>(elemB)</span>
<span id="cb39-682"><a href="#cb39-682" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> elemA<span class="op">;</span> i<span class="op">++</span>) A[i] <span class="op">=</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(i <span class="op">*</span> <span class="fl">17.13</span>) <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.5</span></span>
<span id="cb39-683"><a href="#cb39-683" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> elemB<span class="op">;</span> i<span class="op">++</span>) B[i] <span class="op">=</span> (<span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(i <span class="op">*</span> <span class="fl">9.97</span>) <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.5</span></span>
<span id="cb39-684"><a href="#cb39-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-685"><a href="#cb39-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notify</span>(<span class="st">'3/9 Creating GPU buffers...'</span>)</span>
<span id="cb39-686"><a href="#cb39-686" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(requestAnimationFrame)</span>
<span id="cb39-687"><a href="#cb39-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-688"><a href="#cb39-688" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> aBuf <span class="op">=</span> <span class="fu">createBuffer</span>(device<span class="op">,</span> A<span class="op">,</span> GPUBufferUsage<span class="op">.</span><span class="at">STORAGE</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span>)</span>
<span id="cb39-689"><a href="#cb39-689" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bBuf <span class="op">=</span> <span class="fu">createBuffer</span>(device<span class="op">,</span> B<span class="op">,</span> GPUBufferUsage<span class="op">.</span><span class="at">STORAGE</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span>)</span>
<span id="cb39-690"><a href="#cb39-690" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bytesC <span class="op">=</span> elemC <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb39-691"><a href="#cb39-691" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sizeBytesC <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(bytesC <span class="op">/</span> <span class="dv">4</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb39-692"><a href="#cb39-692" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cBuf <span class="op">=</span> <span class="fu">createBuffer</span>(device<span class="op">,</span> sizeBytesC<span class="op">,</span> GPUBufferUsage<span class="op">.</span><span class="at">STORAGE</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_SRC</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span>)</span>
<span id="cb39-693"><a href="#cb39-693" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> uBuf <span class="op">=</span> <span class="fu">makeDimsUniform</span>(device<span class="op">,</span> M<span class="op">,</span> K<span class="op">,</span> N)</span>
<span id="cb39-694"><a href="#cb39-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-695"><a href="#cb39-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notify</span>(<span class="st">'4/9 Setting up GPU pipeline...'</span>)</span>
<span id="cb39-696"><a href="#cb39-696" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(requestAnimationFrame)</span>
<span id="cb39-697"><a href="#cb39-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-698"><a href="#cb39-698" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pipeline <span class="op">=</span> <span class="fu">makePipeline</span>(device<span class="op">,</span> ker<span class="op">.</span><span class="at">wgsl</span>)</span>
<span id="cb39-699"><a href="#cb39-699" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> bind <span class="op">=</span> device<span class="op">.</span><span class="fu">createBindGroup</span>({ <span class="dt">layout</span><span class="op">:</span> pipeline<span class="op">.</span><span class="fu">getBindGroupLayout</span>(<span class="dv">0</span>)<span class="op">,</span> <span class="dt">entries</span><span class="op">:</span> [</span>
<span id="cb39-700"><a href="#cb39-700" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">binding</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> uBuf } }<span class="op">,</span></span>
<span id="cb39-701"><a href="#cb39-701" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">binding</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> aBuf } }<span class="op">,</span></span>
<span id="cb39-702"><a href="#cb39-702" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">binding</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> bBuf } }<span class="op">,</span></span>
<span id="cb39-703"><a href="#cb39-703" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">binding</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">resource</span><span class="op">:</span> { <span class="dt">buffer</span><span class="op">:</span> cBuf } }<span class="op">,</span></span>
<span id="cb39-704"><a href="#cb39-704" aria-hidden="true" tabindex="-1"></a>  ]})</span>
<span id="cb39-705"><a href="#cb39-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-706"><a href="#cb39-706" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> encoder <span class="op">=</span> device<span class="op">.</span><span class="fu">createCommandEncoder</span>()</span>
<span id="cb39-707"><a href="#cb39-707" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pass <span class="op">=</span> encoder<span class="op">.</span><span class="fu">beginComputePass</span>()</span>
<span id="cb39-708"><a href="#cb39-708" aria-hidden="true" tabindex="-1"></a>  pass<span class="op">.</span><span class="fu">setPipeline</span>(pipeline)</span>
<span id="cb39-709"><a href="#cb39-709" aria-hidden="true" tabindex="-1"></a>  pass<span class="op">.</span><span class="fu">setBindGroup</span>(<span class="dv">0</span><span class="op">,</span> bind)</span>
<span id="cb39-710"><a href="#cb39-710" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [dx<span class="op">,</span> dy<span class="op">,</span> dz] <span class="op">=</span> ker<span class="op">.</span><span class="fu">dispatch</span>({ M<span class="op">,</span> N })</span>
<span id="cb39-711"><a href="#cb39-711" aria-hidden="true" tabindex="-1"></a>  pass<span class="op">.</span><span class="fu">dispatchWorkgroups</span>(dx<span class="op">,</span> dy<span class="op">,</span> dz)</span>
<span id="cb39-712"><a href="#cb39-712" aria-hidden="true" tabindex="-1"></a>  pass<span class="op">.</span><span class="fu">end</span>()</span>
<span id="cb39-713"><a href="#cb39-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-714"><a href="#cb39-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notify</span>(<span class="st">'5/9 Submitting GPU work...'</span>)</span>
<span id="cb39-715"><a href="#cb39-715" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(requestAnimationFrame)</span>
<span id="cb39-716"><a href="#cb39-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-717"><a href="#cb39-717" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gpuStart <span class="op">=</span> <span class="bu">performance</span><span class="op">.</span><span class="fu">now</span>()</span>
<span id="cb39-718"><a href="#cb39-718" aria-hidden="true" tabindex="-1"></a>  device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">submit</span>([encoder<span class="op">.</span><span class="fu">finish</span>()])</span>
<span id="cb39-719"><a href="#cb39-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-720"><a href="#cb39-720" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notify</span>(<span class="st">'6/9 GPU computing...'</span>)</span>
<span id="cb39-721"><a href="#cb39-721" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">onSubmittedWorkDone</span>()</span>
<span id="cb39-722"><a href="#cb39-722" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gpuEnd <span class="op">=</span> <span class="bu">performance</span><span class="op">.</span><span class="fu">now</span>()</span>
<span id="cb39-723"><a href="#cb39-723" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gpuMs <span class="op">=</span> gpuEnd <span class="op">-</span> gpuStart</span>
<span id="cb39-724"><a href="#cb39-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-725"><a href="#cb39-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notify</span>(<span class="st">'7/9 Reading back results...'</span>)</span>
<span id="cb39-726"><a href="#cb39-726" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(requestAnimationFrame)</span>
<span id="cb39-727"><a href="#cb39-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-728"><a href="#cb39-728" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> readBuf <span class="op">=</span> <span class="fu">createBuffer</span>(device<span class="op">,</span> sizeBytesC<span class="op">,</span> GPUBufferUsage<span class="op">.</span><span class="at">COPY_DST</span> <span class="op">|</span> GPUBufferUsage<span class="op">.</span><span class="at">MAP_READ</span>)</span>
<span id="cb39-729"><a href="#cb39-729" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> enc2 <span class="op">=</span> device<span class="op">.</span><span class="fu">createCommandEncoder</span>()</span>
<span id="cb39-730"><a href="#cb39-730" aria-hidden="true" tabindex="-1"></a>  enc2<span class="op">.</span><span class="fu">copyBufferToBuffer</span>(cBuf<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> readBuf<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> sizeBytesC)</span>
<span id="cb39-731"><a href="#cb39-731" aria-hidden="true" tabindex="-1"></a>  device<span class="op">.</span><span class="at">queue</span><span class="op">.</span><span class="fu">submit</span>([enc2<span class="op">.</span><span class="fu">finish</span>()])</span>
<span id="cb39-732"><a href="#cb39-732" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> readBuf<span class="op">.</span><span class="fu">mapAsync</span>(GPUMapMode<span class="op">.</span><span class="at">READ</span>)</span>
<span id="cb39-733"><a href="#cb39-733" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> C <span class="op">=</span> <span class="kw">new</span> <span class="bu">Float32Array</span>(readBuf<span class="op">.</span><span class="fu">getMappedRange</span>()<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span>))</span>
<span id="cb39-734"><a href="#cb39-734" aria-hidden="true" tabindex="-1"></a>  readBuf<span class="op">.</span><span class="fu">unmap</span>()</span>
<span id="cb39-735"><a href="#cb39-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-736"><a href="#cb39-736" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> check <span class="op">=</span> <span class="kw">null</span></span>
<span id="cb39-737"><a href="#cb39-737" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> cpuTime <span class="op">=</span> <span class="kw">null</span></span>
<span id="cb39-738"><a href="#cb39-738" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (verify <span class="op">&amp;&amp;</span> M <span class="op">*</span> K <span class="op">&lt;=</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span> <span class="op">&amp;&amp;</span> K <span class="op">*</span> N <span class="op">&lt;=</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span>) {</span>
<span id="cb39-739"><a href="#cb39-739" aria-hidden="true" tabindex="-1"></a>    <span class="fu">notify</span>(<span class="st">'8/9 CPU verification...'</span>)</span>
<span id="cb39-740"><a href="#cb39-740" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(requestAnimationFrame)</span>
<span id="cb39-741"><a href="#cb39-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-742"><a href="#cb39-742" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cpuStart <span class="op">=</span> <span class="bu">performance</span><span class="op">.</span><span class="fu">now</span>()</span>
<span id="cb39-743"><a href="#cb39-743" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> ref <span class="op">=</span> <span class="fu">cpuMatmul</span>(A<span class="op">,</span> B<span class="op">,</span> M<span class="op">,</span> K<span class="op">,</span> N)</span>
<span id="cb39-744"><a href="#cb39-744" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cpuEnd <span class="op">=</span> <span class="bu">performance</span><span class="op">.</span><span class="fu">now</span>()</span>
<span id="cb39-745"><a href="#cb39-745" aria-hidden="true" tabindex="-1"></a>    cpuTime <span class="op">=</span> cpuEnd <span class="op">-</span> cpuStart</span>
<span id="cb39-746"><a href="#cb39-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-747"><a href="#cb39-747" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> maxAbs <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb39-748"><a href="#cb39-748" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> elemC<span class="op">;</span> i<span class="op">++</span>) maxAbs <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(maxAbs<span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(ref[i] <span class="op">-</span> C[i]))</span>
<span id="cb39-749"><a href="#cb39-749" aria-hidden="true" tabindex="-1"></a>    check <span class="op">=</span> { maxAbs<span class="op">,</span> cpuTime }</span>
<span id="cb39-750"><a href="#cb39-750" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (verify) {</span>
<span id="cb39-751"><a href="#cb39-751" aria-hidden="true" tabindex="-1"></a>    <span class="fu">notify</span>(<span class="st">'8/9 Skipping CPU verification (too large)...'</span>)</span>
<span id="cb39-752"><a href="#cb39-752" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(requestAnimationFrame)</span>
<span id="cb39-753"><a href="#cb39-753" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb39-754"><a href="#cb39-754" aria-hidden="true" tabindex="-1"></a>    <span class="fu">notify</span>(<span class="st">'8/9 CPU verification disabled'</span>)</span>
<span id="cb39-755"><a href="#cb39-755" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(requestAnimationFrame)</span>
<span id="cb39-756"><a href="#cb39-756" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-757"><a href="#cb39-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-758"><a href="#cb39-758" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalEnd <span class="op">=</span> <span class="bu">performance</span><span class="op">.</span><span class="fu">now</span>()</span>
<span id="cb39-759"><a href="#cb39-759" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalMs <span class="op">=</span> totalEnd <span class="op">-</span> totalStart</span>
<span id="cb39-760"><a href="#cb39-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-761"><a href="#cb39-761" aria-hidden="true" tabindex="-1"></a>  <span class="fu">notify</span>(<span class="st">'9/9 Complete!'</span><span class="op">,</span> <span class="kw">false</span>)</span>
<span id="cb39-762"><a href="#cb39-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-763"><a href="#cb39-763" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> flops <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> M <span class="op">*</span> K <span class="op">*</span> N</span>
<span id="cb39-764"><a href="#cb39-764" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gflops <span class="op">=</span> flops <span class="op">/</span> (gpuMs <span class="op">/</span> <span class="dv">1000</span>) <span class="op">/</span> <span class="fl">1e9</span></span>
<span id="cb39-765"><a href="#cb39-765" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cpuGflops <span class="op">=</span> cpuTime <span class="op">?</span> flops <span class="op">/</span> (cpuTime <span class="op">/</span> <span class="dv">1000</span>) <span class="op">/</span> <span class="fl">1e9</span> <span class="op">:</span> <span class="kw">null</span></span>
<span id="cb39-766"><a href="#cb39-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-767"><a href="#cb39-767" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb39-768"><a href="#cb39-768" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ms</span><span class="op">:</span> gpuMs<span class="op">,</span></span>
<span id="cb39-769"><a href="#cb39-769" aria-hidden="true" tabindex="-1"></a>    totalMs<span class="op">,</span></span>
<span id="cb39-770"><a href="#cb39-770" aria-hidden="true" tabindex="-1"></a>    gflops<span class="op">,</span></span>
<span id="cb39-771"><a href="#cb39-771" aria-hidden="true" tabindex="-1"></a>    M<span class="op">,</span></span>
<span id="cb39-772"><a href="#cb39-772" aria-hidden="true" tabindex="-1"></a>    K<span class="op">,</span></span>
<span id="cb39-773"><a href="#cb39-773" aria-hidden="true" tabindex="-1"></a>    N<span class="op">,</span></span>
<span id="cb39-774"><a href="#cb39-774" aria-hidden="true" tabindex="-1"></a>    <span class="dt">kernel</span><span class="op">:</span> ker<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb39-775"><a href="#cb39-775" aria-hidden="true" tabindex="-1"></a>    <span class="dt">kernelKey</span><span class="op">:</span> ker<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb39-776"><a href="#cb39-776" aria-hidden="true" tabindex="-1"></a>    dx<span class="op">,</span></span>
<span id="cb39-777"><a href="#cb39-777" aria-hidden="true" tabindex="-1"></a>    dy<span class="op">,</span></span>
<span id="cb39-778"><a href="#cb39-778" aria-hidden="true" tabindex="-1"></a>    dz<span class="op">,</span></span>
<span id="cb39-779"><a href="#cb39-779" aria-hidden="true" tabindex="-1"></a>    check<span class="op">,</span></span>
<span id="cb39-780"><a href="#cb39-780" aria-hidden="true" tabindex="-1"></a>    cpuTime<span class="op">,</span></span>
<span id="cb39-781"><a href="#cb39-781" aria-hidden="true" tabindex="-1"></a>    cpuGflops</span>
<span id="cb39-782"><a href="#cb39-782" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-783"><a href="#cb39-783" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-39" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb40" data-startfrom="787" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 786;"><span id="cb40-787"><a href="#cb40-787" aria-hidden="true" tabindex="-1"></a><span class="co">// Wrap runMatmul to surface exceptions as error objects so UI can display them</span></span>
<span id="cb40-788"><a href="#cb40-788" aria-hidden="true" tabindex="-1"></a><span class="kw">async</span> <span class="kw">function</span> <span class="fu">runMatmulSafe</span>(dims<span class="op">,</span> kernel<span class="op">,</span> verify) {</span>
<span id="cb40-789"><a href="#cb40-789" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb40-790"><a href="#cb40-790" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cf">await</span> <span class="fu">runMatmul</span>(dims<span class="op">,</span> kernel<span class="op">,</span> verify)</span>
<span id="cb40-791"><a href="#cb40-791" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (e) {</span>
<span id="cb40-792"><a href="#cb40-792" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { <span class="dt">error</span><span class="op">:</span> (e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="at">message</span>) <span class="op">?</span> e<span class="op">.</span><span class="at">message</span> <span class="op">:</span> <span class="bu">String</span>(e) }</span>
<span id="cb40-793"><a href="#cb40-793" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-794"><a href="#cb40-794" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-40" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb41" data-startfrom="798" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 797;"><span id="cb41-798"><a href="#cb41-798" aria-hidden="true" tabindex="-1"></a>mutable compute_status <span class="op">=</span> ({</span>
<span id="cb41-799"><a href="#cb41-799" aria-hidden="true" tabindex="-1"></a>  <span class="dt">state</span><span class="op">:</span> <span class="st">'idle'</span><span class="op">,</span></span>
<span id="cb41-800"><a href="#cb41-800" aria-hidden="true" tabindex="-1"></a>  <span class="dt">message</span><span class="op">:</span> <span class="st">'Idle — ready'</span></span>
<span id="cb41-801"><a href="#cb41-801" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-41" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb42" data-startfrom="805" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 804;"><span id="cb42-805"><a href="#cb42-805" aria-hidden="true" tabindex="-1"></a>mutable status_trigger <span class="op">=</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-42" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb43" data-startfrom="809" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 808;"><span id="cb43-809"><a href="#cb43-809" aria-hidden="true" tabindex="-1"></a>compute_status_value <span class="op">=</span> {</span>
<span id="cb43-810"><a href="#cb43-810" aria-hidden="true" tabindex="-1"></a>  status_trigger<span class="op">;</span> <span class="co">// Force dependency on trigger</span></span>
<span id="cb43-811"><a href="#cb43-811" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> mutable compute_status<span class="op">;</span></span>
<span id="cb43-812"><a href="#cb43-812" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-43" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb44" data-startfrom="816" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 815;"><span id="cb44-816"><a href="#cb44-816" aria-hidden="true" tabindex="-1"></a><span class="co">// WebGPU Matrix Multiplication Runner - only executes on button click</span></span>
<span id="cb44-817"><a href="#cb44-817" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> {</span>
<span id="cb44-818"><a href="#cb44-818" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>run) {</span>
<span id="cb44-819"><a href="#cb44-819" aria-hidden="true" tabindex="-1"></a>    mutable compute_status <span class="op">=</span> { <span class="dt">state</span><span class="op">:</span> <span class="st">'idle'</span><span class="op">,</span> <span class="dt">message</span><span class="op">:</span> <span class="st">'Idle — ready'</span> }</span>
<span id="cb44-820"><a href="#cb44-820" aria-hidden="true" tabindex="-1"></a>    mutable status_trigger <span class="op">=</span> mutable status_trigger <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb44-821"><a href="#cb44-821" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">null</span></span>
<span id="cb44-822"><a href="#cb44-822" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-823"><a href="#cb44-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-824"><a href="#cb44-824" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Capture current values at button click time</span></span>
<span id="cb44-825"><a href="#cb44-825" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> currentDims <span class="op">=</span> {</span>
<span id="cb44-826"><a href="#cb44-826" aria-hidden="true" tabindex="-1"></a>    <span class="dt">M</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Number</span>(mutable m_value) <span class="op">||</span> <span class="dv">0</span>))<span class="op">,</span></span>
<span id="cb44-827"><a href="#cb44-827" aria-hidden="true" tabindex="-1"></a>    <span class="dt">K</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Number</span>(mutable k_value) <span class="op">||</span> <span class="dv">0</span>))<span class="op">,</span></span>
<span id="cb44-828"><a href="#cb44-828" aria-hidden="true" tabindex="-1"></a>    <span class="dt">N</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">1</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Number</span>(mutable n_value) <span class="op">||</span> <span class="dv">0</span>))</span>
<span id="cb44-829"><a href="#cb44-829" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-830"><a href="#cb44-830" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> currentKernelValue <span class="op">=</span> mutable kernel_value</span>
<span id="cb44-831"><a href="#cb44-831" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> currentKernel <span class="op">=</span> <span class="fu">normalizeKernelKey</span>(currentKernelValue)</span>
<span id="cb44-832"><a href="#cb44-832" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> currentVerify <span class="op">=</span> <span class="op">!!</span>mutable verify_value</span>
<span id="cb44-833"><a href="#cb44-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-834"><a href="#cb44-834" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> kernelInfo <span class="op">=</span> kernels<span class="op">.</span><span class="fu">find</span>(k <span class="kw">=&gt;</span> k<span class="op">.</span><span class="at">key</span> <span class="op">===</span> currentKernel)</span>
<span id="cb44-835"><a href="#cb44-835" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> kernelLabel <span class="op">=</span> kernelInfo<span class="op">?.</span><span class="at">label</span> <span class="op">??</span> <span class="bu">String</span>(currentKernel)</span>
<span id="cb44-836"><a href="#cb44-836" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-837"><a href="#cb44-837" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>webgpu_ok) {</span>
<span id="cb44-838"><a href="#cb44-838" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> error <span class="op">=</span> <span class="st">'WebGPU not available'</span></span>
<span id="cb44-839"><a href="#cb44-839" aria-hidden="true" tabindex="-1"></a>    mutable compute_status <span class="op">=</span> { <span class="dt">state</span><span class="op">:</span> <span class="st">'error'</span><span class="op">,</span> <span class="dt">message</span><span class="op">:</span> error<span class="op">,</span> error<span class="op">,</span> kernelLabel<span class="op">,</span> <span class="dt">dims</span><span class="op">:</span> currentDims }</span>
<span id="cb44-840"><a href="#cb44-840" aria-hidden="true" tabindex="-1"></a>    mutable status_trigger <span class="op">=</span> mutable status_trigger <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb44-841"><a href="#cb44-841" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { error }</span>
<span id="cb44-842"><a href="#cb44-842" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-843"><a href="#cb44-843" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-844"><a href="#cb44-844" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>device) {</span>
<span id="cb44-845"><a href="#cb44-845" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> error <span class="op">=</span> <span class="st">'No WebGPU device'</span></span>
<span id="cb44-846"><a href="#cb44-846" aria-hidden="true" tabindex="-1"></a>    mutable compute_status <span class="op">=</span> { <span class="dt">state</span><span class="op">:</span> <span class="st">'error'</span><span class="op">,</span> <span class="dt">message</span><span class="op">:</span> error<span class="op">,</span> error<span class="op">,</span> kernelLabel<span class="op">,</span> <span class="dt">dims</span><span class="op">:</span> currentDims }</span>
<span id="cb44-847"><a href="#cb44-847" aria-hidden="true" tabindex="-1"></a>    mutable status_trigger <span class="op">=</span> mutable status_trigger <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb44-848"><a href="#cb44-848" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { error }</span>
<span id="cb44-849"><a href="#cb44-849" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-850"><a href="#cb44-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-851"><a href="#cb44-851" aria-hidden="true" tabindex="-1"></a>  mutable compute_status <span class="op">=</span> {</span>
<span id="cb44-852"><a href="#cb44-852" aria-hidden="true" tabindex="-1"></a>    <span class="dt">state</span><span class="op">:</span> <span class="st">'running'</span><span class="op">,</span></span>
<span id="cb44-853"><a href="#cb44-853" aria-hidden="true" tabindex="-1"></a>    <span class="dt">message</span><span class="op">:</span> <span class="vs">`Running </span><span class="sc">${</span>kernelLabel<span class="sc">}</span><span class="vs"> — </span><span class="sc">${</span>currentDims<span class="op">.</span><span class="at">M</span><span class="sc">}</span><span class="vs">×</span><span class="sc">${</span>currentDims<span class="op">.</span><span class="at">K</span><span class="sc">}</span><span class="vs">×</span><span class="sc">${</span>currentDims<span class="op">.</span><span class="at">N</span><span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb44-854"><a href="#cb44-854" aria-hidden="true" tabindex="-1"></a>    <span class="dt">spinner</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb44-855"><a href="#cb44-855" aria-hidden="true" tabindex="-1"></a>    kernelLabel<span class="op">,</span></span>
<span id="cb44-856"><a href="#cb44-856" aria-hidden="true" tabindex="-1"></a>    <span class="dt">dims</span><span class="op">:</span> currentDims</span>
<span id="cb44-857"><a href="#cb44-857" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-858"><a href="#cb44-858" aria-hidden="true" tabindex="-1"></a>  mutable status_trigger <span class="op">=</span> mutable status_trigger <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb44-859"><a href="#cb44-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-860"><a href="#cb44-860" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Yield to the browser so the status panel can refresh before the GPU work finishes.</span></span>
<span id="cb44-861"><a href="#cb44-861" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> <span class="kw">new</span> <span class="bu">Promise</span>(requestAnimationFrame)</span>
<span id="cb44-862"><a href="#cb44-862" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-863"><a href="#cb44-863" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb44-864"><a href="#cb44-864" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { M<span class="op">,</span> K<span class="op">,</span> N } <span class="op">=</span> currentDims</span>
<span id="cb44-865"><a href="#cb44-865" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> totalMB <span class="op">=</span> (M <span class="op">*</span> K <span class="op">+</span> K <span class="op">*</span> N <span class="op">+</span> M <span class="op">*</span> N) <span class="op">*</span> <span class="dv">4</span> <span class="op">/</span> <span class="dv">1024</span> <span class="op">/</span> <span class="dv">1024</span></span>
<span id="cb44-866"><a href="#cb44-866" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-867"><a href="#cb44-867" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Status callback to update phase / spinner state</span></span>
<span id="cb44-868"><a href="#cb44-868" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> updateStatus <span class="op">=</span> (statusUpdate) <span class="kw">=&gt;</span> {</span>
<span id="cb44-869"><a href="#cb44-869" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> { message<span class="op">,</span> spinning <span class="op">=</span> <span class="kw">true</span> } <span class="op">=</span> (<span class="kw">typeof</span> statusUpdate <span class="op">===</span> <span class="st">'string'</span>)</span>
<span id="cb44-870"><a href="#cb44-870" aria-hidden="true" tabindex="-1"></a>        <span class="op">?</span> { <span class="dt">message</span><span class="op">:</span> statusUpdate<span class="op">,</span> <span class="dt">spinning</span><span class="op">:</span> <span class="kw">true</span> }</span>
<span id="cb44-871"><a href="#cb44-871" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span> statusUpdate <span class="op">||</span> {}</span>
<span id="cb44-872"><a href="#cb44-872" aria-hidden="true" tabindex="-1"></a>      mutable compute_status <span class="op">=</span> {</span>
<span id="cb44-873"><a href="#cb44-873" aria-hidden="true" tabindex="-1"></a>        <span class="dt">state</span><span class="op">:</span> <span class="st">'running'</span><span class="op">,</span></span>
<span id="cb44-874"><a href="#cb44-874" aria-hidden="true" tabindex="-1"></a>        <span class="dt">message</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>kernelLabel<span class="sc">}</span><span class="vs"> — </span><span class="sc">${</span>message<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb44-875"><a href="#cb44-875" aria-hidden="true" tabindex="-1"></a>        <span class="dt">spinner</span><span class="op">:</span> <span class="op">!!</span>spinning<span class="op">,</span></span>
<span id="cb44-876"><a href="#cb44-876" aria-hidden="true" tabindex="-1"></a>        kernelLabel<span class="op">,</span></span>
<span id="cb44-877"><a href="#cb44-877" aria-hidden="true" tabindex="-1"></a>        <span class="dt">dims</span><span class="op">:</span> currentDims</span>
<span id="cb44-878"><a href="#cb44-878" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb44-879"><a href="#cb44-879" aria-hidden="true" tabindex="-1"></a>      mutable status_trigger <span class="op">=</span> mutable status_trigger <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb44-880"><a href="#cb44-880" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-881"><a href="#cb44-881" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-882"><a href="#cb44-882" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Call the computation with captured values and status callback</span></span>
<span id="cb44-883"><a href="#cb44-883" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> result <span class="op">=</span> <span class="cf">await</span> <span class="fu">runMatmul</span>(currentDims<span class="op">,</span> currentKernel<span class="op">,</span> currentVerify<span class="op">,</span> updateStatus)</span>
<span id="cb44-884"><a href="#cb44-884" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-885"><a href="#cb44-885" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>result) {</span>
<span id="cb44-886"><a href="#cb44-886" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> error <span class="op">=</span> <span class="st">'runMatmul returned null/undefined'</span></span>
<span id="cb44-887"><a href="#cb44-887" aria-hidden="true" tabindex="-1"></a>      mutable compute_status <span class="op">=</span> { <span class="dt">state</span><span class="op">:</span> <span class="st">'error'</span><span class="op">,</span> <span class="dt">message</span><span class="op">:</span> error<span class="op">,</span> error<span class="op">,</span> kernelLabel<span class="op">,</span> <span class="dt">dims</span><span class="op">:</span> currentDims }</span>
<span id="cb44-888"><a href="#cb44-888" aria-hidden="true" tabindex="-1"></a>      mutable status_trigger <span class="op">=</span> mutable status_trigger <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb44-889"><a href="#cb44-889" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> { error }</span>
<span id="cb44-890"><a href="#cb44-890" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-891"><a href="#cb44-891" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-892"><a href="#cb44-892" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (result<span class="op">.</span><span class="at">error</span>) {</span>
<span id="cb44-893"><a href="#cb44-893" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> error <span class="op">=</span> result<span class="op">.</span><span class="at">error</span></span>
<span id="cb44-894"><a href="#cb44-894" aria-hidden="true" tabindex="-1"></a>      mutable compute_status <span class="op">=</span> { <span class="dt">state</span><span class="op">:</span> <span class="st">'error'</span><span class="op">,</span> <span class="dt">message</span><span class="op">:</span> error<span class="op">,</span> error<span class="op">,</span> kernelLabel<span class="op">,</span> <span class="dt">dims</span><span class="op">:</span> currentDims }</span>
<span id="cb44-895"><a href="#cb44-895" aria-hidden="true" tabindex="-1"></a>      mutable status_trigger <span class="op">=</span> mutable status_trigger <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb44-896"><a href="#cb44-896" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> { error }</span>
<span id="cb44-897"><a href="#cb44-897" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-898"><a href="#cb44-898" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-899"><a href="#cb44-899" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Add metadata for display and append to history</span></span>
<span id="cb44-900"><a href="#cb44-900" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> enriched <span class="op">=</span> { </span>
<span id="cb44-901"><a href="#cb44-901" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>result<span class="op">,</span> </span>
<span id="cb44-902"><a href="#cb44-902" aria-hidden="true" tabindex="-1"></a>      totalMB<span class="op">,</span> </span>
<span id="cb44-903"><a href="#cb44-903" aria-hidden="true" tabindex="-1"></a>      <span class="dt">runNumber</span><span class="op">:</span> run </span>
<span id="cb44-904"><a href="#cb44-904" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-905"><a href="#cb44-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-906"><a href="#cb44-906" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Append to history via cache to avoid self-dependency loops</span></span>
<span id="cb44-907"><a href="#cb44-907" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> updatedHistory <span class="op">=</span> results_history_cache<span class="op">.</span><span class="fu">push</span>(enriched)</span>
<span id="cb44-908"><a href="#cb44-908" aria-hidden="true" tabindex="-1"></a>  mutable results_history <span class="op">=</span> updatedHistory</span>
<span id="cb44-909"><a href="#cb44-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-910"><a href="#cb44-910" aria-hidden="true" tabindex="-1"></a>    mutable compute_status <span class="op">=</span> {</span>
<span id="cb44-911"><a href="#cb44-911" aria-hidden="true" tabindex="-1"></a>      <span class="dt">state</span><span class="op">:</span> <span class="st">'done'</span><span class="op">,</span></span>
<span id="cb44-912"><a href="#cb44-912" aria-hidden="true" tabindex="-1"></a>      <span class="dt">message</span><span class="op">:</span> <span class="vs">`Completed </span><span class="sc">${</span>kernelLabel<span class="sc">}</span><span class="vs"> in </span><span class="sc">${</span>enriched<span class="op">.</span><span class="at">ms</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs"> ms GPU (</span><span class="sc">${</span>enriched<span class="op">.</span><span class="at">totalMs</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs"> ms total)`</span><span class="op">,</span></span>
<span id="cb44-913"><a href="#cb44-913" aria-hidden="true" tabindex="-1"></a>      kernelLabel<span class="op">,</span></span>
<span id="cb44-914"><a href="#cb44-914" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dims</span><span class="op">:</span> currentDims<span class="op">,</span></span>
<span id="cb44-915"><a href="#cb44-915" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gpuTimeMs</span><span class="op">:</span> enriched<span class="op">.</span><span class="at">ms</span><span class="op">,</span></span>
<span id="cb44-916"><a href="#cb44-916" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalTimeMs</span><span class="op">:</span> enriched<span class="op">.</span><span class="at">totalMs</span><span class="op">,</span></span>
<span id="cb44-917"><a href="#cb44-917" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gpuGflops</span><span class="op">:</span> enriched<span class="op">.</span><span class="at">gflops</span><span class="op">,</span></span>
<span id="cb44-918"><a href="#cb44-918" aria-hidden="true" tabindex="-1"></a>      <span class="dt">spinner</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb44-919"><a href="#cb44-919" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-920"><a href="#cb44-920" aria-hidden="true" tabindex="-1"></a>    mutable status_trigger <span class="op">=</span> mutable status_trigger <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb44-921"><a href="#cb44-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-922"><a href="#cb44-922" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> enriched</span>
<span id="cb44-923"><a href="#cb44-923" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (e) {</span>
<span id="cb44-924"><a href="#cb44-924" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> error <span class="op">=</span> e<span class="op">.</span><span class="at">message</span> <span class="op">||</span> e<span class="op">.</span><span class="fu">toString</span>()</span>
<span id="cb44-925"><a href="#cb44-925" aria-hidden="true" tabindex="-1"></a>    mutable compute_status <span class="op">=</span> { <span class="dt">state</span><span class="op">:</span> <span class="st">'error'</span><span class="op">,</span> <span class="dt">message</span><span class="op">:</span> error<span class="op">,</span> error<span class="op">,</span> kernelLabel<span class="op">,</span> <span class="dt">dims</span><span class="op">:</span> currentDims }</span>
<span id="cb44-926"><a href="#cb44-926" aria-hidden="true" tabindex="-1"></a>    mutable status_trigger <span class="op">=</span> mutable status_trigger <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb44-927"><a href="#cb44-927" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { error }</span>
<span id="cb44-928"><a href="#cb44-928" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-929"><a href="#cb44-929" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-44" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb45" data-startfrom="933" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 932;"><span id="cb45-933"><a href="#cb45-933" aria-hidden="true" tabindex="-1"></a>status_panel <span class="op">=</span> {</span>
<span id="cb45-934"><a href="#cb45-934" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> status <span class="op">=</span> compute_status_value <span class="op">||</span> { <span class="dt">state</span><span class="op">:</span> <span class="st">'idle'</span><span class="op">,</span> <span class="dt">message</span><span class="op">:</span> <span class="st">'Idle — ready'</span> }</span>
<span id="cb45-935"><a href="#cb45-935" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div class="callout status-panel"&gt;&lt;/div&gt;`</span></span>
<span id="cb45-936"><a href="#cb45-936" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="at">classList</span><span class="op">.</span><span class="fu">add</span>(status<span class="op">.</span><span class="at">state</span> <span class="op">===</span> <span class="st">'error'</span> <span class="op">?</span> <span class="st">'callout-warning'</span> <span class="op">:</span> <span class="st">'callout-note'</span>)</span>
<span id="cb45-937"><a href="#cb45-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-938"><a href="#cb45-938" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (status<span class="op">.</span><span class="at">state</span> <span class="op">===</span> <span class="st">'running'</span> <span class="op">&amp;&amp;</span> status<span class="op">.</span><span class="at">spinner</span>) {</span>
<span id="cb45-939"><a href="#cb45-939" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span><span class="bu">document</span><span class="op">.</span><span class="fu">getElementById</span>(<span class="st">'status-spinner-style'</span>)) {</span>
<span id="cb45-940"><a href="#cb45-940" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> style <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">'style'</span>)</span>
<span id="cb45-941"><a href="#cb45-941" aria-hidden="true" tabindex="-1"></a>      style<span class="op">.</span><span class="at">id</span> <span class="op">=</span> <span class="st">'status-spinner-style'</span></span>
<span id="cb45-942"><a href="#cb45-942" aria-hidden="true" tabindex="-1"></a>      style<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb45-943"><a href="#cb45-943" aria-hidden="true" tabindex="-1"></a><span class="vs">        .status-spinner {</span></span>
<span id="cb45-944"><a href="#cb45-944" aria-hidden="true" tabindex="-1"></a><span class="vs">          width: 1.25rem;</span></span>
<span id="cb45-945"><a href="#cb45-945" aria-hidden="true" tabindex="-1"></a><span class="vs">          height: 1.25rem;</span></span>
<span id="cb45-946"><a href="#cb45-946" aria-hidden="true" tabindex="-1"></a><span class="vs">          border: 2px solid rgba(0,0,0,0.1);</span></span>
<span id="cb45-947"><a href="#cb45-947" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-top-color: rgba(0,0,0,0.6);</span></span>
<span id="cb45-948"><a href="#cb45-948" aria-hidden="true" tabindex="-1"></a><span class="vs">          border-radius: 9999px;</span></span>
<span id="cb45-949"><a href="#cb45-949" aria-hidden="true" tabindex="-1"></a><span class="vs">          animation: status-spin 0.8s linear infinite;</span></span>
<span id="cb45-950"><a href="#cb45-950" aria-hidden="true" tabindex="-1"></a><span class="vs">          margin-bottom: 0.5rem;</span></span>
<span id="cb45-951"><a href="#cb45-951" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb45-952"><a href="#cb45-952" aria-hidden="true" tabindex="-1"></a><span class="vs">        @keyframes status-spin {</span></span>
<span id="cb45-953"><a href="#cb45-953" aria-hidden="true" tabindex="-1"></a><span class="vs">          to { transform: rotate(360deg); }</span></span>
<span id="cb45-954"><a href="#cb45-954" aria-hidden="true" tabindex="-1"></a><span class="vs">        }</span></span>
<span id="cb45-955"><a href="#cb45-955" aria-hidden="true" tabindex="-1"></a><span class="vs">      `</span></span>
<span id="cb45-956"><a href="#cb45-956" aria-hidden="true" tabindex="-1"></a>      <span class="bu">document</span><span class="op">.</span><span class="at">head</span><span class="op">.</span><span class="fu">append</span>(style)</span>
<span id="cb45-957"><a href="#cb45-957" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-958"><a href="#cb45-958" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> spinner <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">'div'</span>)</span>
<span id="cb45-959"><a href="#cb45-959" aria-hidden="true" tabindex="-1"></a>    spinner<span class="op">.</span><span class="at">className</span> <span class="op">=</span> <span class="st">'status-spinner'</span></span>
<span id="cb45-960"><a href="#cb45-960" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="fu">append</span>(spinner)</span>
<span id="cb45-961"><a href="#cb45-961" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-962"><a href="#cb45-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-963"><a href="#cb45-963" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> heading <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">'div'</span>)</span>
<span id="cb45-964"><a href="#cb45-964" aria-hidden="true" tabindex="-1"></a>  heading<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">fontWeight</span> <span class="op">=</span> <span class="st">'600'</span></span>
<span id="cb45-965"><a href="#cb45-965" aria-hidden="true" tabindex="-1"></a>  heading<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> status<span class="op">.</span><span class="at">message</span> <span class="op">??</span> <span class="st">'Idle — ready'</span></span>
<span id="cb45-966"><a href="#cb45-966" aria-hidden="true" tabindex="-1"></a>  container<span class="op">.</span><span class="fu">append</span>(heading)</span>
<span id="cb45-967"><a href="#cb45-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-968"><a href="#cb45-968" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (status<span class="op">.</span><span class="at">state</span> <span class="op">===</span> <span class="st">'done'</span> <span class="op">&amp;&amp;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(status<span class="op">.</span><span class="at">gpuGflops</span>)) {</span>
<span id="cb45-969"><a href="#cb45-969" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> detail <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">'div'</span>)</span>
<span id="cb45-970"><a href="#cb45-970" aria-hidden="true" tabindex="-1"></a>    detail<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>status<span class="op">.</span><span class="at">kernelLabel</span> <span class="op">??</span> <span class="st">''</span><span class="sc">}</span><span class="vs"> — </span><span class="sc">${</span>status<span class="op">.</span><span class="at">gpuGflops</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs"> GFLOP/s`</span></span>
<span id="cb45-971"><a href="#cb45-971" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="fu">append</span>(detail)</span>
<span id="cb45-972"><a href="#cb45-972" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (status<span class="op">.</span><span class="at">state</span> <span class="op">===</span> <span class="st">'error'</span> <span class="op">&amp;&amp;</span> status<span class="op">.</span><span class="at">error</span>) {</span>
<span id="cb45-973"><a href="#cb45-973" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> detail <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">'div'</span>)</span>
<span id="cb45-974"><a href="#cb45-974" aria-hidden="true" tabindex="-1"></a>    detail<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> status<span class="op">.</span><span class="at">error</span></span>
<span id="cb45-975"><a href="#cb45-975" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="fu">append</span>(detail)</span>
<span id="cb45-976"><a href="#cb45-976" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (status<span class="op">.</span><span class="at">dims</span>) {</span>
<span id="cb45-977"><a href="#cb45-977" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> dims <span class="op">=</span> status<span class="op">.</span><span class="at">dims</span></span>
<span id="cb45-978"><a href="#cb45-978" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> detail <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">'div'</span>)</span>
<span id="cb45-979"><a href="#cb45-979" aria-hidden="true" tabindex="-1"></a>    detail<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="vs">`Dims: </span><span class="sc">${</span>dims<span class="op">.</span><span class="at">M</span><span class="sc">}</span><span class="vs">×</span><span class="sc">${</span>dims<span class="op">.</span><span class="at">K</span><span class="sc">}</span><span class="vs">×</span><span class="sc">${</span>dims<span class="op">.</span><span class="at">N</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb45-980"><a href="#cb45-980" aria-hidden="true" tabindex="-1"></a>    container<span class="op">.</span><span class="fu">append</span>(detail)</span>
<span id="cb45-981"><a href="#cb45-981" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-982"><a href="#cb45-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-983"><a href="#cb45-983" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container</span>
<span id="cb45-984"><a href="#cb45-984" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-45" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb46" data-startfrom="988" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 987;"><span id="cb46-988"><a href="#cb46-988" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span><span class="sc">${</span>status_panel<span class="sc">}</span><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-46" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb47" data-startfrom="992" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 991;"><span id="cb47-992"><a href="#cb47-992" aria-hidden="true" tabindex="-1"></a><span class="co">// Display results - shows all results in history</span></span>
<span id="cb47-993"><a href="#cb47-993" aria-hidden="true" tabindex="-1"></a>results_table <span class="op">=</span> {</span>
<span id="cb47-994"><a href="#cb47-994" aria-hidden="true" tabindex="-1"></a>  clear_handler<span class="op">;</span> <span class="co">// React to clear button</span></span>
<span id="cb47-995"><a href="#cb47-995" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-996"><a href="#cb47-996" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> history <span class="op">=</span> results_history <span class="op">||</span> []</span>
<span id="cb47-997"><a href="#cb47-997" aria-hidden="true" tabindex="-1"></a>  <span class="co">// console.log('[results_table] history length:', history.length, history)</span></span>
<span id="cb47-998"><a href="#cb47-998" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-999"><a href="#cb47-999" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (history<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb47-1000"><a href="#cb47-1000" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;em&gt;Click Run matmul to execute the selected kernel. Results will be added to the table below.&lt;/em&gt;`</span></span>
<span id="cb47-1001"><a href="#cb47-1001" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-1002"><a href="#cb47-1002" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1003"><a href="#cb47-1003" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Convert all results to table rows</span></span>
<span id="cb47-1004"><a href="#cb47-1004" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tableRows <span class="op">=</span> history<span class="op">.</span><span class="fu">map</span>(result <span class="kw">=&gt;</span> {</span>
<span id="cb47-1005"><a href="#cb47-1005" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> tableRow <span class="op">=</span> {</span>
<span id="cb47-1006"><a href="#cb47-1006" aria-hidden="true" tabindex="-1"></a>      <span class="dt">runNumber</span><span class="op">:</span> result<span class="op">.</span><span class="at">runNumber</span><span class="op">,</span></span>
<span id="cb47-1007"><a href="#cb47-1007" aria-hidden="true" tabindex="-1"></a>      <span class="dt">kernel</span><span class="op">:</span> result<span class="op">.</span><span class="at">kernel</span><span class="op">,</span></span>
<span id="cb47-1008"><a href="#cb47-1008" aria-hidden="true" tabindex="-1"></a>      <span class="dt">shape</span><span class="op">:</span> { <span class="dt">M</span><span class="op">:</span> result<span class="op">.</span><span class="at">M</span><span class="op">,</span> <span class="dt">K</span><span class="op">:</span> result<span class="op">.</span><span class="at">K</span><span class="op">,</span> <span class="dt">N</span><span class="op">:</span> result<span class="op">.</span><span class="at">N</span> }<span class="op">,</span></span>
<span id="cb47-1009"><a href="#cb47-1009" aria-hidden="true" tabindex="-1"></a>      <span class="dt">memoryMB</span><span class="op">:</span> result<span class="op">.</span><span class="at">totalMB</span><span class="op">,</span></span>
<span id="cb47-1010"><a href="#cb47-1010" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dispatch</span><span class="op">:</span> [result<span class="op">.</span><span class="at">dx</span><span class="op">,</span> result<span class="op">.</span><span class="at">dy</span><span class="op">,</span> result<span class="op">.</span><span class="at">dz</span>]<span class="op">,</span></span>
<span id="cb47-1011"><a href="#cb47-1011" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gpuTimeMs</span><span class="op">:</span> result<span class="op">.</span><span class="at">ms</span><span class="op">,</span></span>
<span id="cb47-1012"><a href="#cb47-1012" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalTimeMs</span><span class="op">:</span> result<span class="op">.</span><span class="at">totalMs</span><span class="op">,</span></span>
<span id="cb47-1013"><a href="#cb47-1013" aria-hidden="true" tabindex="-1"></a>      <span class="dt">gpuGflops</span><span class="op">:</span> result<span class="op">.</span><span class="at">gflops</span><span class="op">,</span></span>
<span id="cb47-1014"><a href="#cb47-1014" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cpuTimeMs</span><span class="op">:</span> result<span class="op">.</span><span class="at">cpuTime</span><span class="op">,</span></span>
<span id="cb47-1015"><a href="#cb47-1015" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cpuGflops</span><span class="op">:</span> result<span class="op">.</span><span class="at">cpuGflops</span><span class="op">,</span></span>
<span id="cb47-1016"><a href="#cb47-1016" aria-hidden="true" tabindex="-1"></a>      <span class="dt">speedup</span><span class="op">:</span> (<span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(result<span class="op">.</span><span class="at">cpuTime</span>) <span class="op">&amp;&amp;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(result<span class="op">.</span><span class="at">ms</span>) <span class="op">&amp;&amp;</span> result<span class="op">.</span><span class="at">ms</span> <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb47-1017"><a href="#cb47-1017" aria-hidden="true" tabindex="-1"></a>        <span class="op">?</span> result<span class="op">.</span><span class="at">cpuTime</span> <span class="op">/</span> result<span class="op">.</span><span class="at">ms</span></span>
<span id="cb47-1018"><a href="#cb47-1018" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb47-1019"><a href="#cb47-1019" aria-hidden="true" tabindex="-1"></a>      <span class="dt">maxAbs</span><span class="op">:</span> result<span class="op">.</span><span class="at">check</span><span class="op">?.</span><span class="at">maxAbs</span> <span class="op">??</span> <span class="kw">null</span></span>
<span id="cb47-1020"><a href="#cb47-1020" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-1021"><a href="#cb47-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1022"><a href="#cb47-1022" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> dash <span class="op">=</span> <span class="st">'—'</span></span>
<span id="cb47-1023"><a href="#cb47-1023" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb47-1024"><a href="#cb47-1024" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Run'</span><span class="op">:</span> <span class="vs">`#</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">runNumber</span><span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb47-1025"><a href="#cb47-1025" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Kernel'</span><span class="op">:</span> tableRow<span class="op">.</span><span class="at">kernel</span><span class="op">,</span></span>
<span id="cb47-1026"><a href="#cb47-1026" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Shape'</span><span class="op">:</span> <span class="vs">`(</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">shape</span><span class="op">.</span><span class="at">M</span><span class="sc">}</span><span class="vs">×</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">shape</span><span class="op">.</span><span class="at">K</span><span class="sc">}</span><span class="vs">) · (</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">shape</span><span class="op">.</span><span class="at">K</span><span class="sc">}</span><span class="vs">×</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">shape</span><span class="op">.</span><span class="at">N</span><span class="sc">}</span><span class="vs">) → (</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">shape</span><span class="op">.</span><span class="at">M</span><span class="sc">}</span><span class="vs">×</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">shape</span><span class="op">.</span><span class="at">N</span><span class="sc">}</span><span class="vs">)`</span><span class="op">,</span></span>
<span id="cb47-1027"><a href="#cb47-1027" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Memory'</span><span class="op">:</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(tableRow<span class="op">.</span><span class="at">memoryMB</span>) <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">memoryMB</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs"> MB`</span> <span class="op">:</span> dash<span class="op">,</span></span>
<span id="cb47-1028"><a href="#cb47-1028" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Dispatch'</span><span class="op">:</span> <span class="vs">`[</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">dispatch</span>[<span class="dv">0</span>]<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">dispatch</span>[<span class="dv">1</span>]<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">dispatch</span>[<span class="dv">2</span>]<span class="sc">}</span><span class="vs">]`</span><span class="op">,</span></span>
<span id="cb47-1029"><a href="#cb47-1029" aria-hidden="true" tabindex="-1"></a>      <span class="st">'GPU Time'</span><span class="op">:</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(tableRow<span class="op">.</span><span class="at">gpuTimeMs</span>) <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">gpuTimeMs</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs"> ms`</span> <span class="op">:</span> dash<span class="op">,</span></span>
<span id="cb47-1030"><a href="#cb47-1030" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Total Time'</span><span class="op">:</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(tableRow<span class="op">.</span><span class="at">totalTimeMs</span>) <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">totalTimeMs</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs"> ms`</span> <span class="op">:</span> dash<span class="op">,</span></span>
<span id="cb47-1031"><a href="#cb47-1031" aria-hidden="true" tabindex="-1"></a>      <span class="st">'GPU Throughput'</span><span class="op">:</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(tableRow<span class="op">.</span><span class="at">gpuGflops</span>) <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">gpuGflops</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs"> GFLOP/s`</span> <span class="op">:</span> dash<span class="op">,</span></span>
<span id="cb47-1032"><a href="#cb47-1032" aria-hidden="true" tabindex="-1"></a>      <span class="st">'CPU Time'</span><span class="op">:</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(tableRow<span class="op">.</span><span class="at">cpuTimeMs</span>) <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">cpuTimeMs</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs"> ms`</span> <span class="op">:</span> dash<span class="op">,</span></span>
<span id="cb47-1033"><a href="#cb47-1033" aria-hidden="true" tabindex="-1"></a>      <span class="st">'CPU Throughput'</span><span class="op">:</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(tableRow<span class="op">.</span><span class="at">cpuGflops</span>) <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">cpuGflops</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs"> GFLOP/s`</span> <span class="op">:</span> dash<span class="op">,</span></span>
<span id="cb47-1034"><a href="#cb47-1034" aria-hidden="true" tabindex="-1"></a>      <span class="st">'GPU Speedup'</span><span class="op">:</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(tableRow<span class="op">.</span><span class="at">speedup</span>) <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>tableRow<span class="op">.</span><span class="at">speedup</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">×`</span> <span class="op">:</span> dash<span class="op">,</span></span>
<span id="cb47-1035"><a href="#cb47-1035" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Max |Δ| vs CPU'</span><span class="op">:</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(tableRow<span class="op">.</span><span class="at">maxAbs</span>) <span class="op">?</span> tableRow<span class="op">.</span><span class="at">maxAbs</span><span class="op">.</span><span class="fu">toExponential</span>(<span class="dv">2</span>) <span class="op">:</span> dash</span>
<span id="cb47-1036"><a href="#cb47-1036" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-1037"><a href="#cb47-1037" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb47-1038"><a href="#cb47-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1039"><a href="#cb47-1039" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">table</span>(tableRows<span class="op">,</span> {</span>
<span id="cb47-1040"><a href="#cb47-1040" aria-hidden="true" tabindex="-1"></a>    <span class="dt">sort</span><span class="op">:</span> <span class="st">"Run"</span><span class="op">,</span></span>
<span id="cb47-1041"><a href="#cb47-1041" aria-hidden="true" tabindex="-1"></a>    <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span> <span class="co">// Show newest results first</span></span>
<span id="cb47-1042"><a href="#cb47-1042" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb47-1043"><a href="#cb47-1043" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-47" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb48" data-startfrom="1047" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1046;"><span id="cb48-1047"><a href="#cb48-1047" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span><span class="sc">${</span>results_table<span class="sc">}</span><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-48" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb49" data-startfrom="1051" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1050;"><span id="cb49-1051"><a href="#cb49-1051" aria-hidden="true" tabindex="-1"></a>results_plot_data <span class="op">=</span> {</span>
<span id="cb49-1052"><a href="#cb49-1052" aria-hidden="true" tabindex="-1"></a>  clear_handler<span class="op">;</span></span>
<span id="cb49-1053"><a href="#cb49-1053" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> history <span class="op">=</span> results_history <span class="op">||</span> []</span>
<span id="cb49-1054"><a href="#cb49-1054" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> history<span class="op">.</span><span class="fu">map</span>((entry<span class="op">,</span> index) <span class="kw">=&gt;</span> ({</span>
<span id="cb49-1055"><a href="#cb49-1055" aria-hidden="true" tabindex="-1"></a>    <span class="dt">runNumber</span><span class="op">:</span> entry<span class="op">.</span><span class="at">runNumber</span> <span class="op">??</span> (index <span class="op">+</span> <span class="dv">1</span>)<span class="op">,</span></span>
<span id="cb49-1056"><a href="#cb49-1056" aria-hidden="true" tabindex="-1"></a>    <span class="dt">kernel</span><span class="op">:</span> entry<span class="op">.</span><span class="at">kernel</span><span class="op">,</span></span>
<span id="cb49-1057"><a href="#cb49-1057" aria-hidden="true" tabindex="-1"></a>    <span class="dt">kernelKey</span><span class="op">:</span> entry<span class="op">.</span><span class="at">kernelKey</span> <span class="op">??</span> entry<span class="op">.</span><span class="at">kernel</span><span class="op">,</span></span>
<span id="cb49-1058"><a href="#cb49-1058" aria-hidden="true" tabindex="-1"></a>    <span class="dt">totalMs</span><span class="op">:</span> entry<span class="op">.</span><span class="at">totalMs</span> <span class="op">??</span> entry<span class="op">.</span><span class="at">ms</span> <span class="op">??</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb49-1059"><a href="#cb49-1059" aria-hidden="true" tabindex="-1"></a>    <span class="dt">gpuMs</span><span class="op">:</span> entry<span class="op">.</span><span class="at">ms</span> <span class="op">??</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb49-1060"><a href="#cb49-1060" aria-hidden="true" tabindex="-1"></a>    <span class="dt">gpuGflops</span><span class="op">:</span> entry<span class="op">.</span><span class="at">gflops</span> <span class="op">??</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb49-1061"><a href="#cb49-1061" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cpuGflops</span><span class="op">:</span> entry<span class="op">.</span><span class="at">cpuGflops</span> <span class="op">??</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb49-1062"><a href="#cb49-1062" aria-hidden="true" tabindex="-1"></a>    <span class="dt">memoryMB</span><span class="op">:</span> entry<span class="op">.</span><span class="at">totalMB</span> <span class="op">??</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb49-1063"><a href="#cb49-1063" aria-hidden="true" tabindex="-1"></a>    <span class="dt">dims</span><span class="op">:</span> entry<span class="op">.</span><span class="at">dims</span> <span class="op">??</span> { <span class="dt">M</span><span class="op">:</span> entry<span class="op">.</span><span class="at">M</span><span class="op">,</span> <span class="dt">K</span><span class="op">:</span> entry<span class="op">.</span><span class="at">K</span><span class="op">,</span> <span class="dt">N</span><span class="op">:</span> entry<span class="op">.</span><span class="at">N</span> }</span>
<span id="cb49-1064"><a href="#cb49-1064" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb49-1065"><a href="#cb49-1065" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-49" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb50" data-startfrom="1069" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1068;"><span id="cb50-1069"><a href="#cb50-1069" aria-hidden="true" tabindex="-1"></a>plot_kernel_colors <span class="op">=</span> {</span>
<span id="cb50-1070"><a href="#cb50-1070" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> palette <span class="op">=</span> [</span>
<span id="cb50-1071"><a href="#cb50-1071" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#1f77b4"</span><span class="op">,</span></span>
<span id="cb50-1072"><a href="#cb50-1072" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#ff7f0e"</span><span class="op">,</span></span>
<span id="cb50-1073"><a href="#cb50-1073" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#2ca02c"</span><span class="op">,</span></span>
<span id="cb50-1074"><a href="#cb50-1074" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#d62728"</span><span class="op">,</span></span>
<span id="cb50-1075"><a href="#cb50-1075" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#9467bd"</span><span class="op">,</span></span>
<span id="cb50-1076"><a href="#cb50-1076" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#8c564b"</span><span class="op">,</span></span>
<span id="cb50-1077"><a href="#cb50-1077" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#e377c2"</span><span class="op">,</span></span>
<span id="cb50-1078"><a href="#cb50-1078" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#7f7f7f"</span><span class="op">,</span></span>
<span id="cb50-1079"><a href="#cb50-1079" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#bcbd22"</span><span class="op">,</span></span>
<span id="cb50-1080"><a href="#cb50-1080" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#17becf"</span></span>
<span id="cb50-1081"><a href="#cb50-1081" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb50-1082"><a href="#cb50-1082" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> domain <span class="op">=</span> kernels<span class="op">.</span><span class="fu">map</span>(k <span class="kw">=&gt;</span> k<span class="op">.</span><span class="at">label</span>)</span>
<span id="cb50-1083"><a href="#cb50-1083" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> range <span class="op">=</span> domain<span class="op">.</span><span class="fu">map</span>((_<span class="op">,</span> i) <span class="kw">=&gt;</span> palette[i <span class="op">%</span> palette<span class="op">.</span><span class="at">length</span>])</span>
<span id="cb50-1084"><a href="#cb50-1084" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> { domain<span class="op">,</span> range }</span>
<span id="cb50-1085"><a href="#cb50-1085" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-50" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb51" data-startfrom="1089" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1088;"><span id="cb51-1089"><a href="#cb51-1089" aria-hidden="true" tabindex="-1"></a>results_plots <span class="op">=</span> {</span>
<span id="cb51-1090"><a href="#cb51-1090" aria-hidden="true" tabindex="-1"></a>  clear_handler<span class="op">;</span></span>
<span id="cb51-1091"><a href="#cb51-1091" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> results_plot_data <span class="op">??</span> []</span>
<span id="cb51-1092"><a href="#cb51-1092" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>data<span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb51-1093"><a href="#cb51-1093" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;em&gt;Run matmul to populate timing and throughput charts.&lt;/em&gt;`</span></span>
<span id="cb51-1094"><a href="#cb51-1094" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-1095"><a href="#cb51-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1096"><a href="#cb51-1096" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { domain<span class="op">,</span> range } <span class="op">=</span> plot_kernel_colors</span>
<span id="cb51-1097"><a href="#cb51-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1098"><a href="#cb51-1098" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> throughputData <span class="op">=</span> data<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(d<span class="op">.</span><span class="at">gpuGflops</span>))</span>
<span id="cb51-1099"><a href="#cb51-1099" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalTimeData <span class="op">=</span> data<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(d<span class="op">.</span><span class="at">totalMs</span>))</span>
<span id="cb51-1100"><a href="#cb51-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1101"><a href="#cb51-1101" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>throughputData<span class="op">.</span><span class="at">length</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>totalTimeData<span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb51-1102"><a href="#cb51-1102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">html</span><span class="vs">`&lt;em&gt;No results with throughput or total time available yet.&lt;/em&gt;`</span></span>
<span id="cb51-1103"><a href="#cb51-1103" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-1104"><a href="#cb51-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1105"><a href="#cb51-1105" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate dynamic ticks based on data range</span></span>
<span id="cb51-1106"><a href="#cb51-1106" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> memoryData <span class="op">=</span> data<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> <span class="bu">Number</span><span class="op">.</span><span class="fu">isFinite</span>(d<span class="op">.</span><span class="at">memoryMB</span>))</span>
<span id="cb51-1107"><a href="#cb51-1107" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> dynamicTicks <span class="op">=</span> [<span class="dv">8</span><span class="op">,</span> <span class="dv">16</span><span class="op">,</span> <span class="dv">32</span><span class="op">,</span> <span class="dv">64</span><span class="op">,</span> <span class="dv">128</span><span class="op">,</span> <span class="dv">256</span><span class="op">,</span> <span class="dv">512</span><span class="op">,</span> <span class="dv">1024</span><span class="op">,</span> <span class="dv">2048</span><span class="op">,</span> <span class="dv">4096</span><span class="op">,</span> <span class="dv">8192</span><span class="op">,</span> <span class="dv">16384</span>]</span>
<span id="cb51-1108"><a href="#cb51-1108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-1109"><a href="#cb51-1109" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (memoryData<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb51-1110"><a href="#cb51-1110" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> minMemory <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="op">...</span>memoryData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">memoryMB</span>))</span>
<span id="cb51-1111"><a href="#cb51-1111" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> maxMemory <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>memoryData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">memoryMB</span>))</span>
<span id="cb51-1112"><a href="#cb51-1112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-1113"><a href="#cb51-1113" aria-hidden="true" tabindex="-1"></a>    <span class="co">// If there's only one unique value or very close range, show fewer ticks</span></span>
<span id="cb51-1114"><a href="#cb51-1114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (memoryData<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">1</span> <span class="op">||</span> (maxMemory <span class="op">/</span> minMemory) <span class="op">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb51-1115"><a href="#cb51-1115" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Find the closest tick to the actual value</span></span>
<span id="cb51-1116"><a href="#cb51-1116" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> targetMemory <span class="op">=</span> memoryData[<span class="dv">0</span>]<span class="op">.</span><span class="at">memoryMB</span></span>
<span id="cb51-1117"><a href="#cb51-1117" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> closestTick <span class="op">=</span> dynamicTicks<span class="op">.</span><span class="fu">reduce</span>((prev<span class="op">,</span> curr) <span class="kw">=&gt;</span> </span>
<span id="cb51-1118"><a href="#cb51-1118" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(curr <span class="op">-</span> targetMemory) <span class="op">&lt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(prev <span class="op">-</span> targetMemory) <span class="op">?</span> curr <span class="op">:</span> prev</span>
<span id="cb51-1119"><a href="#cb51-1119" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb51-1120"><a href="#cb51-1120" aria-hidden="true" tabindex="-1"></a>      dynamicTicks <span class="op">=</span> [closestTick]</span>
<span id="cb51-1121"><a href="#cb51-1121" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb51-1122"><a href="#cb51-1122" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Filter ticks to only show relevant range</span></span>
<span id="cb51-1123"><a href="#cb51-1123" aria-hidden="true" tabindex="-1"></a>      dynamicTicks <span class="op">=</span> dynamicTicks<span class="op">.</span><span class="fu">filter</span>(tick <span class="kw">=&gt;</span> tick <span class="op">&gt;=</span> minMemory <span class="op">*</span> <span class="fl">0.5</span> <span class="op">&amp;&amp;</span> tick <span class="op">&lt;=</span> maxMemory <span class="op">*</span> <span class="dv">2</span>)</span>
<span id="cb51-1124"><a href="#cb51-1124" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-1125"><a href="#cb51-1125" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-1126"><a href="#cb51-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1127"><a href="#cb51-1127" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Prepare Plotly data</span></span>
<span id="cb51-1128"><a href="#cb51-1128" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> traces <span class="op">=</span> []</span>
<span id="cb51-1129"><a href="#cb51-1129" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-1130"><a href="#cb51-1130" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create color mapping for kernels</span></span>
<span id="cb51-1131"><a href="#cb51-1131" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colorMap <span class="op">=</span> {}</span>
<span id="cb51-1132"><a href="#cb51-1132" aria-hidden="true" tabindex="-1"></a>  domain<span class="op">.</span><span class="fu">forEach</span>((kernel<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb51-1133"><a href="#cb51-1133" aria-hidden="true" tabindex="-1"></a>    colorMap[kernel] <span class="op">=</span> range[i]</span>
<span id="cb51-1134"><a href="#cb51-1134" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb51-1135"><a href="#cb51-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1136"><a href="#cb51-1136" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Group data by kernel for throughput traces</span></span>
<span id="cb51-1137"><a href="#cb51-1137" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> kernelGroups <span class="op">=</span> {}</span>
<span id="cb51-1138"><a href="#cb51-1138" aria-hidden="true" tabindex="-1"></a>  throughputData<span class="op">.</span><span class="fu">forEach</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb51-1139"><a href="#cb51-1139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>kernelGroups[d<span class="op">.</span><span class="at">kernel</span>]) {</span>
<span id="cb51-1140"><a href="#cb51-1140" aria-hidden="true" tabindex="-1"></a>      kernelGroups[d<span class="op">.</span><span class="at">kernel</span>] <span class="op">=</span> { <span class="dt">throughput</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">time</span><span class="op">:</span> [] }</span>
<span id="cb51-1141"><a href="#cb51-1141" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-1142"><a href="#cb51-1142" aria-hidden="true" tabindex="-1"></a>    kernelGroups[d<span class="op">.</span><span class="at">kernel</span>]<span class="op">.</span><span class="at">throughput</span><span class="op">.</span><span class="fu">push</span>(d)</span>
<span id="cb51-1143"><a href="#cb51-1143" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb51-1144"><a href="#cb51-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1145"><a href="#cb51-1145" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Group time data by kernel</span></span>
<span id="cb51-1146"><a href="#cb51-1146" aria-hidden="true" tabindex="-1"></a>  totalTimeData<span class="op">.</span><span class="fu">forEach</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb51-1147"><a href="#cb51-1147" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>kernelGroups[d<span class="op">.</span><span class="at">kernel</span>]) {</span>
<span id="cb51-1148"><a href="#cb51-1148" aria-hidden="true" tabindex="-1"></a>      kernelGroups[d<span class="op">.</span><span class="at">kernel</span>] <span class="op">=</span> { <span class="dt">throughput</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">time</span><span class="op">:</span> [] }</span>
<span id="cb51-1149"><a href="#cb51-1149" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-1150"><a href="#cb51-1150" aria-hidden="true" tabindex="-1"></a>    kernelGroups[d<span class="op">.</span><span class="at">kernel</span>]<span class="op">.</span><span class="at">time</span><span class="op">.</span><span class="fu">push</span>(d)</span>
<span id="cb51-1151"><a href="#cb51-1151" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb51-1152"><a href="#cb51-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1153"><a href="#cb51-1153" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create throughput traces (solid lines)</span></span>
<span id="cb51-1154"><a href="#cb51-1154" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(kernelGroups)<span class="op">.</span><span class="fu">forEach</span>(([kernel<span class="op">,</span> kernelData]) <span class="kw">=&gt;</span> {</span>
<span id="cb51-1155"><a href="#cb51-1155" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (kernelData<span class="op">.</span><span class="at">throughput</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb51-1156"><a href="#cb51-1156" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> sortedData <span class="op">=</span> kernelData<span class="op">.</span><span class="at">throughput</span><span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> a<span class="op">.</span><span class="at">memoryMB</span> <span class="op">-</span> b<span class="op">.</span><span class="at">memoryMB</span>)</span>
<span id="cb51-1157"><a href="#cb51-1157" aria-hidden="true" tabindex="-1"></a>      traces<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb51-1158"><a href="#cb51-1158" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> sortedData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">memoryMB</span>)<span class="op">,</span></span>
<span id="cb51-1159"><a href="#cb51-1159" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> sortedData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">gpuGflops</span>)<span class="op">,</span></span>
<span id="cb51-1160"><a href="#cb51-1160" aria-hidden="true" tabindex="-1"></a>        <span class="dt">mode</span><span class="op">:</span> <span class="st">'lines+markers'</span><span class="op">,</span></span>
<span id="cb51-1161"><a href="#cb51-1161" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">'scatter'</span><span class="op">,</span></span>
<span id="cb51-1162"><a href="#cb51-1162" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> kernel<span class="op">,</span></span>
<span id="cb51-1163"><a href="#cb51-1163" aria-hidden="true" tabindex="-1"></a>        <span class="dt">line</span><span class="op">:</span> { <span class="dt">color</span><span class="op">:</span> colorMap[kernel]<span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb51-1164"><a href="#cb51-1164" aria-hidden="true" tabindex="-1"></a>        <span class="dt">marker</span><span class="op">:</span> { <span class="dt">color</span><span class="op">:</span> colorMap[kernel]<span class="op">,</span> <span class="dt">size</span><span class="op">:</span> <span class="dv">6</span> }<span class="op">,</span></span>
<span id="cb51-1165"><a href="#cb51-1165" aria-hidden="true" tabindex="-1"></a>        <span class="dt">hovertemplate</span><span class="op">:</span> sortedData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb51-1166"><a href="#cb51-1166" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> dims <span class="op">=</span> d<span class="op">.</span><span class="at">dims</span> <span class="op">||</span> { <span class="dt">M</span><span class="op">:</span> <span class="st">'?'</span><span class="op">,</span> <span class="dt">K</span><span class="op">:</span> <span class="st">'?'</span><span class="op">,</span> <span class="dt">N</span><span class="op">:</span> <span class="st">'?'</span> }</span>
<span id="cb51-1167"><a href="#cb51-1167" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> <span class="vs">`&lt;b&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">kernel</span><span class="sc">}</span><span class="vs">&lt;/b&gt;&lt;br&gt;`</span> <span class="op">+</span></span>
<span id="cb51-1168"><a href="#cb51-1168" aria-hidden="true" tabindex="-1"></a>                 <span class="vs">`Run: #</span><span class="sc">${</span>d<span class="op">.</span><span class="at">runNumber</span><span class="sc">}</span><span class="vs">&lt;br&gt;`</span> <span class="op">+</span></span>
<span id="cb51-1169"><a href="#cb51-1169" aria-hidden="true" tabindex="-1"></a>                 <span class="vs">`Dims: </span><span class="sc">${</span>dims<span class="op">.</span><span class="at">M</span><span class="sc">}</span><span class="vs">×</span><span class="sc">${</span>dims<span class="op">.</span><span class="at">K</span><span class="sc">}</span><span class="vs">×</span><span class="sc">${</span>dims<span class="op">.</span><span class="at">N</span><span class="sc">}</span><span class="vs">&lt;br&gt;`</span> <span class="op">+</span></span>
<span id="cb51-1170"><a href="#cb51-1170" aria-hidden="true" tabindex="-1"></a>                 <span class="vs">`Memory: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">memoryMB</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs"> MB&lt;br&gt;`</span> <span class="op">+</span></span>
<span id="cb51-1171"><a href="#cb51-1171" aria-hidden="true" tabindex="-1"></a>                 <span class="vs">`GPU Throughput: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">gpuGflops</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs"> GFLOP/s&lt;extra&gt;&lt;/extra&gt;`</span></span>
<span id="cb51-1172"><a href="#cb51-1172" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb51-1173"><a href="#cb51-1173" aria-hidden="true" tabindex="-1"></a>        <span class="dt">yaxis</span><span class="op">:</span> <span class="st">'y1'</span></span>
<span id="cb51-1174"><a href="#cb51-1174" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb51-1175"><a href="#cb51-1175" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-1176"><a href="#cb51-1176" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb51-1177"><a href="#cb51-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1178"><a href="#cb51-1178" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate scaling for secondary y-axis</span></span>
<span id="cb51-1179"><a href="#cb51-1179" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> baseThroughputMax <span class="op">=</span> throughputData<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> d) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(acc<span class="op">,</span> d<span class="op">.</span><span class="at">gpuGflops</span>)<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb51-1180"><a href="#cb51-1180" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> baseTimeMax <span class="op">=</span> totalTimeData<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> d) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(acc<span class="op">,</span> d<span class="op">.</span><span class="at">totalMs</span>)<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb51-1181"><a href="#cb51-1181" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yMax <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(baseThroughputMax<span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb51-1182"><a href="#cb51-1182" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> timeScaleFactor <span class="op">=</span> baseTimeMax <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> yMax <span class="op">/</span> baseTimeMax <span class="op">:</span> <span class="dv">1</span></span>
<span id="cb51-1183"><a href="#cb51-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1184"><a href="#cb51-1184" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create time traces (dashed lines) on secondary y-axis</span></span>
<span id="cb51-1185"><a href="#cb51-1185" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(kernelGroups)<span class="op">.</span><span class="fu">forEach</span>(([kernel<span class="op">,</span> kernelData]) <span class="kw">=&gt;</span> {</span>
<span id="cb51-1186"><a href="#cb51-1186" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (kernelData<span class="op">.</span><span class="at">time</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb51-1187"><a href="#cb51-1187" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> sortedData <span class="op">=</span> kernelData<span class="op">.</span><span class="at">time</span><span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> a<span class="op">.</span><span class="at">memoryMB</span> <span class="op">-</span> b<span class="op">.</span><span class="at">memoryMB</span>)</span>
<span id="cb51-1188"><a href="#cb51-1188" aria-hidden="true" tabindex="-1"></a>      traces<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb51-1189"><a href="#cb51-1189" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> sortedData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">memoryMB</span>)<span class="op">,</span></span>
<span id="cb51-1190"><a href="#cb51-1190" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> sortedData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">totalMs</span>)<span class="op">,</span></span>
<span id="cb51-1191"><a href="#cb51-1191" aria-hidden="true" tabindex="-1"></a>        <span class="dt">mode</span><span class="op">:</span> <span class="st">'lines+markers'</span><span class="op">,</span></span>
<span id="cb51-1192"><a href="#cb51-1192" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">'scatter'</span><span class="op">,</span></span>
<span id="cb51-1193"><a href="#cb51-1193" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>kernel<span class="sc">}</span><span class="vs"> (time)`</span><span class="op">,</span></span>
<span id="cb51-1194"><a href="#cb51-1194" aria-hidden="true" tabindex="-1"></a>        <span class="dt">line</span><span class="op">:</span> { <span class="dt">color</span><span class="op">:</span> colorMap[kernel]<span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">dash</span><span class="op">:</span> <span class="st">'dash'</span> }<span class="op">,</span></span>
<span id="cb51-1195"><a href="#cb51-1195" aria-hidden="true" tabindex="-1"></a>        <span class="dt">marker</span><span class="op">:</span> { </span>
<span id="cb51-1196"><a href="#cb51-1196" aria-hidden="true" tabindex="-1"></a>          <span class="dt">color</span><span class="op">:</span> <span class="st">'white'</span><span class="op">,</span> </span>
<span id="cb51-1197"><a href="#cb51-1197" aria-hidden="true" tabindex="-1"></a>          <span class="dt">size</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span> </span>
<span id="cb51-1198"><a href="#cb51-1198" aria-hidden="true" tabindex="-1"></a>          <span class="dt">line</span><span class="op">:</span> { <span class="dt">color</span><span class="op">:</span> colorMap[kernel]<span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb51-1199"><a href="#cb51-1199" aria-hidden="true" tabindex="-1"></a>          <span class="dt">symbol</span><span class="op">:</span> <span class="st">'cross'</span></span>
<span id="cb51-1200"><a href="#cb51-1200" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb51-1201"><a href="#cb51-1201" aria-hidden="true" tabindex="-1"></a>        <span class="dt">hovertemplate</span><span class="op">:</span> sortedData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb51-1202"><a href="#cb51-1202" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> dims <span class="op">=</span> d<span class="op">.</span><span class="at">dims</span> <span class="op">||</span> { <span class="dt">M</span><span class="op">:</span> <span class="st">'?'</span><span class="op">,</span> <span class="dt">K</span><span class="op">:</span> <span class="st">'?'</span><span class="op">,</span> <span class="dt">N</span><span class="op">:</span> <span class="st">'?'</span> }</span>
<span id="cb51-1203"><a href="#cb51-1203" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> <span class="vs">`&lt;b&gt;</span><span class="sc">${</span>d<span class="op">.</span><span class="at">kernel</span><span class="sc">}</span><span class="vs">&lt;/b&gt;&lt;br&gt;`</span> <span class="op">+</span></span>
<span id="cb51-1204"><a href="#cb51-1204" aria-hidden="true" tabindex="-1"></a>                 <span class="vs">`Run: #</span><span class="sc">${</span>d<span class="op">.</span><span class="at">runNumber</span><span class="sc">}</span><span class="vs">&lt;br&gt;`</span> <span class="op">+</span></span>
<span id="cb51-1205"><a href="#cb51-1205" aria-hidden="true" tabindex="-1"></a>                 <span class="vs">`Dims: </span><span class="sc">${</span>dims<span class="op">.</span><span class="at">M</span><span class="sc">}</span><span class="vs">×</span><span class="sc">${</span>dims<span class="op">.</span><span class="at">K</span><span class="sc">}</span><span class="vs">×</span><span class="sc">${</span>dims<span class="op">.</span><span class="at">N</span><span class="sc">}</span><span class="vs">&lt;br&gt;`</span> <span class="op">+</span></span>
<span id="cb51-1206"><a href="#cb51-1206" aria-hidden="true" tabindex="-1"></a>                 <span class="vs">`Memory: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">memoryMB</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs"> MB&lt;br&gt;`</span> <span class="op">+</span></span>
<span id="cb51-1207"><a href="#cb51-1207" aria-hidden="true" tabindex="-1"></a>                 <span class="vs">`Total Time: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">totalMs</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs"> ms&lt;extra&gt;&lt;/extra&gt;`</span></span>
<span id="cb51-1208"><a href="#cb51-1208" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb51-1209"><a href="#cb51-1209" aria-hidden="true" tabindex="-1"></a>        <span class="dt">yaxis</span><span class="op">:</span> <span class="st">'y2'</span><span class="op">,</span></span>
<span id="cb51-1210"><a href="#cb51-1210" aria-hidden="true" tabindex="-1"></a>        <span class="dt">showlegend</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb51-1211"><a href="#cb51-1211" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb51-1212"><a href="#cb51-1212" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-1213"><a href="#cb51-1213" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb51-1214"><a href="#cb51-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1215"><a href="#cb51-1215" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add dummy traces for series style legend</span></span>
<span id="cb51-1216"><a href="#cb51-1216" aria-hidden="true" tabindex="-1"></a>  traces<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb51-1217"><a href="#cb51-1217" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> [<span class="kw">null</span>]<span class="op">,</span></span>
<span id="cb51-1218"><a href="#cb51-1218" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> [<span class="kw">null</span>]<span class="op">,</span></span>
<span id="cb51-1219"><a href="#cb51-1219" aria-hidden="true" tabindex="-1"></a>    <span class="dt">mode</span><span class="op">:</span> <span class="st">'lines+markers'</span><span class="op">,</span></span>
<span id="cb51-1220"><a href="#cb51-1220" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">'scatter'</span><span class="op">,</span></span>
<span id="cb51-1221"><a href="#cb51-1221" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">'— Throughput (GFLOP/s)'</span><span class="op">,</span></span>
<span id="cb51-1222"><a href="#cb51-1222" aria-hidden="true" tabindex="-1"></a>    <span class="dt">line</span><span class="op">:</span> { <span class="dt">color</span><span class="op">:</span> <span class="st">'#666'</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb51-1223"><a href="#cb51-1223" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marker</span><span class="op">:</span> { <span class="dt">color</span><span class="op">:</span> <span class="st">'#666'</span><span class="op">,</span> <span class="dt">size</span><span class="op">:</span> <span class="dv">6</span> }<span class="op">,</span></span>
<span id="cb51-1224"><a href="#cb51-1224" aria-hidden="true" tabindex="-1"></a>    <span class="dt">showlegend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb51-1225"><a href="#cb51-1225" aria-hidden="true" tabindex="-1"></a>    <span class="dt">yaxis</span><span class="op">:</span> <span class="st">'y1'</span></span>
<span id="cb51-1226"><a href="#cb51-1226" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb51-1227"><a href="#cb51-1227" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-1228"><a href="#cb51-1228" aria-hidden="true" tabindex="-1"></a>  traces<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb51-1229"><a href="#cb51-1229" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> [<span class="kw">null</span>]<span class="op">,</span></span>
<span id="cb51-1230"><a href="#cb51-1230" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> [<span class="kw">null</span>]<span class="op">,</span></span>
<span id="cb51-1231"><a href="#cb51-1231" aria-hidden="true" tabindex="-1"></a>    <span class="dt">mode</span><span class="op">:</span> <span class="st">'lines+markers'</span><span class="op">,</span></span>
<span id="cb51-1232"><a href="#cb51-1232" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">'scatter'</span><span class="op">,</span></span>
<span id="cb51-1233"><a href="#cb51-1233" aria-hidden="true" tabindex="-1"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">'- - Time (ms)'</span><span class="op">,</span></span>
<span id="cb51-1234"><a href="#cb51-1234" aria-hidden="true" tabindex="-1"></a>    <span class="dt">line</span><span class="op">:</span> { <span class="dt">color</span><span class="op">:</span> <span class="st">'#666'</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">dash</span><span class="op">:</span> <span class="st">'dash'</span> }<span class="op">,</span></span>
<span id="cb51-1235"><a href="#cb51-1235" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marker</span><span class="op">:</span> { </span>
<span id="cb51-1236"><a href="#cb51-1236" aria-hidden="true" tabindex="-1"></a>      <span class="dt">color</span><span class="op">:</span> <span class="st">'white'</span><span class="op">,</span> </span>
<span id="cb51-1237"><a href="#cb51-1237" aria-hidden="true" tabindex="-1"></a>      <span class="dt">size</span><span class="op">:</span> <span class="dv">8</span><span class="op">,</span> </span>
<span id="cb51-1238"><a href="#cb51-1238" aria-hidden="true" tabindex="-1"></a>      <span class="dt">line</span><span class="op">:</span> { <span class="dt">color</span><span class="op">:</span> <span class="st">'#666'</span><span class="op">,</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb51-1239"><a href="#cb51-1239" aria-hidden="true" tabindex="-1"></a>      <span class="dt">symbol</span><span class="op">:</span> <span class="st">'cross'</span></span>
<span id="cb51-1240"><a href="#cb51-1240" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb51-1241"><a href="#cb51-1241" aria-hidden="true" tabindex="-1"></a>    <span class="dt">showlegend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb51-1242"><a href="#cb51-1242" aria-hidden="true" tabindex="-1"></a>    <span class="dt">yaxis</span><span class="op">:</span> <span class="st">'y2'</span></span>
<span id="cb51-1243"><a href="#cb51-1243" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb51-1244"><a href="#cb51-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1245"><a href="#cb51-1245" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create the plot container</span></span>
<span id="cb51-1246"><a href="#cb51-1246" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> container <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div style="width: 100%; height: 450px;"&gt;&lt;/div&gt;`</span></span>
<span id="cb51-1247"><a href="#cb51-1247" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-1248"><a href="#cb51-1248" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Plotly layout</span></span>
<span id="cb51-1249"><a href="#cb51-1249" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> layout <span class="op">=</span> {</span>
<span id="cb51-1250"><a href="#cb51-1250" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb51-1251"><a href="#cb51-1251" aria-hidden="true" tabindex="-1"></a>      <span class="dt">text</span><span class="op">:</span> <span class="st">'WebGPU Matrix Multiplication Performance'</span><span class="op">,</span></span>
<span id="cb51-1252"><a href="#cb51-1252" aria-hidden="true" tabindex="-1"></a>      <span class="co">// x: 0.5,</span></span>
<span id="cb51-1253"><a href="#cb51-1253" aria-hidden="true" tabindex="-1"></a>      <span class="co">// y: 1.5,</span></span>
<span id="cb51-1254"><a href="#cb51-1254" aria-hidden="true" tabindex="-1"></a>      <span class="co">// xanchor: 'center',</span></span>
<span id="cb51-1255"><a href="#cb51-1255" aria-hidden="true" tabindex="-1"></a>      <span class="dt">font</span><span class="op">:</span> { <span class="dt">size</span><span class="op">:</span> <span class="dv">16</span> }</span>
<span id="cb51-1256"><a href="#cb51-1256" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb51-1257"><a href="#cb51-1257" aria-hidden="true" tabindex="-1"></a>    <span class="dt">xaxis</span><span class="op">:</span> {</span>
<span id="cb51-1258"><a href="#cb51-1258" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">'log'</span><span class="op">,</span></span>
<span id="cb51-1259"><a href="#cb51-1259" aria-hidden="true" tabindex="-1"></a>      <span class="dt">title</span><span class="op">:</span> <span class="st">'Memory (MB)'</span><span class="op">,</span></span>
<span id="cb51-1260"><a href="#cb51-1260" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickvals</span><span class="op">:</span> dynamicTicks<span class="op">,</span></span>
<span id="cb51-1261"><a href="#cb51-1261" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticktext</span><span class="op">:</span> dynamicTicks<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d <span class="op">&gt;=</span> <span class="dv">1</span> <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>)<span class="sc">}</span><span class="vs">`</span> <span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb51-1262"><a href="#cb51-1262" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb51-1263"><a href="#cb51-1263" aria-hidden="true" tabindex="-1"></a>    <span class="dt">yaxis</span><span class="op">:</span> {</span>
<span id="cb51-1264"><a href="#cb51-1264" aria-hidden="true" tabindex="-1"></a>      <span class="dt">title</span><span class="op">:</span> <span class="st">'GPU Throughput (GFLOP/s)'</span><span class="op">,</span></span>
<span id="cb51-1265"><a href="#cb51-1265" aria-hidden="true" tabindex="-1"></a>      <span class="dt">side</span><span class="op">:</span> <span class="st">'left'</span></span>
<span id="cb51-1266"><a href="#cb51-1266" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb51-1267"><a href="#cb51-1267" aria-hidden="true" tabindex="-1"></a>    <span class="dt">yaxis2</span><span class="op">:</span> {</span>
<span id="cb51-1268"><a href="#cb51-1268" aria-hidden="true" tabindex="-1"></a>      <span class="dt">title</span><span class="op">:</span> <span class="st">'Total Time (ms)'</span><span class="op">,</span></span>
<span id="cb51-1269"><a href="#cb51-1269" aria-hidden="true" tabindex="-1"></a>      <span class="dt">side</span><span class="op">:</span> <span class="st">'right'</span><span class="op">,</span></span>
<span id="cb51-1270"><a href="#cb51-1270" aria-hidden="true" tabindex="-1"></a>      <span class="dt">overlaying</span><span class="op">:</span> <span class="st">'y'</span></span>
<span id="cb51-1271"><a href="#cb51-1271" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb51-1272"><a href="#cb51-1272" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legend</span><span class="op">:</span> {</span>
<span id="cb51-1273"><a href="#cb51-1273" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="fl">1.3</span><span class="op">,</span></span>
<span id="cb51-1274"><a href="#cb51-1274" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="fl">0.8</span><span class="op">,</span></span>
<span id="cb51-1275"><a href="#cb51-1275" aria-hidden="true" tabindex="-1"></a>      <span class="dt">xanchor</span><span class="op">:</span> <span class="st">'left'</span><span class="op">,</span></span>
<span id="cb51-1276"><a href="#cb51-1276" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yanchor</span><span class="op">:</span> <span class="st">'top'</span><span class="op">,</span></span>
<span id="cb51-1277"><a href="#cb51-1277" aria-hidden="true" tabindex="-1"></a>      <span class="dt">bgcolor</span><span class="op">:</span> <span class="st">'rgba(255,255,255,0.8)'</span><span class="op">,</span></span>
<span id="cb51-1278"><a href="#cb51-1278" aria-hidden="true" tabindex="-1"></a>      <span class="dt">bordercolor</span><span class="op">:</span> <span class="st">'#ddd'</span><span class="op">,</span></span>
<span id="cb51-1279"><a href="#cb51-1279" aria-hidden="true" tabindex="-1"></a>      <span class="dt">borderwidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb51-1280"><a href="#cb51-1280" aria-hidden="true" tabindex="-1"></a>      <span class="dt">font</span><span class="op">:</span> { <span class="dt">size</span><span class="op">:</span> <span class="dv">11</span> }</span>
<span id="cb51-1281"><a href="#cb51-1281" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb51-1282"><a href="#cb51-1282" aria-hidden="true" tabindex="-1"></a>    <span class="dt">margin</span><span class="op">:</span> { <span class="dt">l</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span> <span class="dt">r</span><span class="op">:</span> <span class="dv">150</span><span class="op">,</span> <span class="dt">t</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span> <span class="dt">b</span><span class="op">:</span> <span class="dv">80</span> }<span class="op">,</span></span>
<span id="cb51-1283"><a href="#cb51-1283" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hovermode</span><span class="op">:</span> <span class="st">'closest'</span></span>
<span id="cb51-1284"><a href="#cb51-1284" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-1285"><a href="#cb51-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1286"><a href="#cb51-1286" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create the plot</span></span>
<span id="cb51-1287"><a href="#cb51-1287" aria-hidden="true" tabindex="-1"></a>  Plotly<span class="op">.</span><span class="fu">newPlot</span>(container<span class="op">,</span> traces<span class="op">,</span> layout<span class="op">,</span> {</span>
<span id="cb51-1288"><a href="#cb51-1288" aria-hidden="true" tabindex="-1"></a>    <span class="dt">responsive</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb51-1289"><a href="#cb51-1289" aria-hidden="true" tabindex="-1"></a>    <span class="dt">displayModeBar</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb51-1290"><a href="#cb51-1290" aria-hidden="true" tabindex="-1"></a>    <span class="dt">modeBarButtonsToRemove</span><span class="op">:</span> [<span class="st">'pan2d'</span><span class="op">,</span> <span class="st">'lasso2d'</span><span class="op">,</span> <span class="st">'select2d'</span>]</span>
<span id="cb51-1291"><a href="#cb51-1291" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb51-1292"><a href="#cb51-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1293"><a href="#cb51-1293" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> container</span>
<span id="cb51-1294"><a href="#cb51-1294" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-51" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb52" data-startfrom="1298" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1297;"><span id="cb52-1298"><a href="#cb52-1298" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span><span class="sc">${</span>results_plots<span class="sc">}</span><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-52" data-nodetype="expression">

</div>
</div>
</div>
</section>
</section>
<section id="notes-and-tips" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="notes-and-tips"><span class="header-section-number">12.3</span> Notes and tips</h2>
<ul>
<li>This page uses Observable JS cells; code runs reactively in the browser.</li>
<li>Performance varies a lot across browsers/GPUs. Numbers shown include submission/synchronization overhead; GPU timestamp queries can refine timing when supported.</li>
<li>The kernels here don’t use workgroup-shared memory or subgroups; those can yield further gains on some hardware.</li>
<li>Credit: Kernel ideas and the optimization path are inspired by Zach Nussbaum’s article referenced above and by Simon Böhm’s CUDA matmul write-up.</li>
</ul>


</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIEltcG9ydCBQbG90bHkgZm9yIGFkdmFuY2VkIHBsb3R0aW5nXG5QbG90bHkgPSByZXF1aXJlKFwiaHR0cHM6Ly9jZG4ucGxvdC5seS9wbG90bHktbGF0ZXN0Lm1pbi5qc1wiKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZ3B1ID0gbmF2aWdhdG9yLmdwdVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYWRhcHRlciA9IGdwdSAmJiAoYXdhaXQgbmF2aWdhdG9yLmdwdS5yZXF1ZXN0QWRhcHRlcigpKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gVHJ5IHRvIHJlcXVlc3QgYSBkZXZpY2Ugd2l0aCBoaWdoZXIgbGltaXRzIGZvciBsYXJnZSBtYXRyaWNlc1xuZGV2aWNlID0gYWRhcHRlciAmJiAoYXdhaXQgYWRhcHRlci5yZXF1ZXN0RGV2aWNlKHtcbiAgcmVxdWlyZWRGZWF0dXJlczogYWRhcHRlci5mZWF0dXJlcy5oYXMoXCJ0aW1lc3RhbXAtcXVlcnlcIikgPyBbXCJ0aW1lc3RhbXAtcXVlcnlcIl0gOiBbXSxcbiAgcmVxdWlyZWRMaW1pdHM6IHtcbiAgICBtYXhTdG9yYWdlQnVmZmVyQmluZGluZ1NpemU6IE1hdGgubWluKGFkYXB0ZXIubGltaXRzLm1heFN0b3JhZ2VCdWZmZXJCaW5kaW5nU2l6ZSwgMiAqIDEwMjQgKiAxMDI0ICogMTAyNCksIC8vIDJHQiBvciBhZGFwdGVyIG1heFxuICAgIG1heEJ1ZmZlclNpemU6IE1hdGgubWluKGFkYXB0ZXIubGltaXRzLm1heEJ1ZmZlclNpemUsIDIgKiAxMDI0ICogMTAyNCAqIDEwMjQpLCAvLyAyR0Igb3IgYWRhcHRlciBtYXhcbiAgICBtYXhTdG9yYWdlQnVmZmVyc1BlclNoYWRlclN0YWdlOiBNYXRoLm1heChhZGFwdGVyLmxpbWl0cy5tYXhTdG9yYWdlQnVmZmVyc1BlclNoYWRlclN0YWdlLCA4KSxcbiAgICBtYXhDb21wdXRlV29ya2dyb3VwU3RvcmFnZVNpemU6IE1hdGgubWF4KGFkYXB0ZXIubGltaXRzLm1heENvbXB1dGVXb3JrZ3JvdXBTdG9yYWdlU2l6ZSwgMzI3NjgpXG5cbiAgfVxufSkpXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJxdWV1ZSA9IGRldmljZSAmJiBkZXZpY2UucXVldWVcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IndlYmdwdV9vayA9ICEhZGV2aWNlXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBBIHNtYWxsIHN0YXR1cyBiYW5uZXJcbmh0bWxgPGRpdiBjbGFzcz1cImNhbGxvdXQgJHt3ZWJncHVfb2sgPyAnY2FsbG91dC1ub3RlJyA6ICdjYWxsb3V0LXdhcm5pbmcnfVwiPjxzdHJvbmc+V2ViR1BVPC9zdHJvbmc+OiAke3dlYmdwdV9vayA/ICdPSyDigJQgZGV2aWNlIGFjcXVpcmVkJyA6ICdOb3QgYXZhaWxhYmxlIOKAlCB0cnkgQ2hyb21lL0VkZ2UvQXJjLCBlbmFibGUgV2ViR1BVLCBvciB1c2UgYSByZWNlbnQgbWFjT1MnfTwvZGl2PmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIENyZWF0ZSBhIEdQVSBidWZmZXIgYW5kIG9wdGlvbmFsbHkgaW5pdGlhbGl6ZSB3aXRoIGRhdGFcbmZ1bmN0aW9uIGNyZWF0ZUJ1ZmZlcihkZXZpY2UsIGRhdGFPclNpemUsIHVzYWdlKSB7XG4gIGlmICh0eXBlb2YgZGF0YU9yU2l6ZSA9PT0gJ251bWJlcicpIHtcbiAgICBjb25zdCBuID0gZGF0YU9yU2l6ZVxuICAgIGNvbnN0IHNpemUgPSBOdW1iZXIuaXNGaW5pdGUobikgJiYgbiA+IDAgPyAoKE1hdGguY2VpbChuIC8gNCkgKiA0KSA+Pj4gMCkgOiAwXG4gICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUoc2l6ZSkgfHwgc2l6ZSA8PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgYnVmZmVyIHNpemU6ICR7bn1gKVxuICAgIH1cbiAgICByZXR1cm4gZGV2aWNlLmNyZWF0ZUJ1ZmZlcih7IHNpemUsIHVzYWdlIH0pXG4gIH1cbiAgY29uc3QgZGF0YSA9IGRhdGFPclNpemVcbiAgY29uc3QgW2J5dGVMZW5ndGgsIHNpemVdID0gW2RhdGEuYnl0ZUxlbmd0aCwgKChkYXRhLmJ5dGVMZW5ndGggKyAzKSAmIH4zKV0gLy8gNC1ieXRlIGFsaWduXG4gIGNvbnN0IGJ1ZmZlciA9IGRldmljZS5jcmVhdGVCdWZmZXIoeyBzaXplLCB1c2FnZSwgbWFwcGVkQXRDcmVhdGlvbjogdHJ1ZSB9KVxuICBuZXcgVWludDhBcnJheShidWZmZXIuZ2V0TWFwcGVkUmFuZ2UoKSkuc2V0KG5ldyBVaW50OEFycmF5KGRhdGEuYnVmZmVyLCBkYXRhLmJ5dGVPZmZzZXQsIGRhdGEuYnl0ZUxlbmd0aCkpXG4gIGJ1ZmZlci51bm1hcCgpXG4gIHJldHVybiBidWZmZXJcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIENvbXBpbGUgYSBXR1NMIGNvbXB1dGUgcGlwZWxpbmVcbmZ1bmN0aW9uIG1ha2VQaXBlbGluZShkZXZpY2UsIHdnc2wpIHtcbiAgY29uc3QgbW9kdWxlID0gZGV2aWNlLmNyZWF0ZVNoYWRlck1vZHVsZSh7IGNvZGU6IHdnc2wgfSlcbiAgY29uc3QgcGlwZWxpbmUgPSBkZXZpY2UuY3JlYXRlQ29tcHV0ZVBpcGVsaW5lKHtcbiAgICBsYXlvdXQ6ICdhdXRvJyxcbiAgICBjb21wdXRlOiB7IG1vZHVsZSwgZW50cnlQb2ludDogJ21haW4nIH1cbiAgfSlcbiAgcmV0dXJuIHBpcGVsaW5lXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gVW5pZm9ybSBzdHJ1Y3QgbmVlZHMgMTYtYnl0ZSBzaXplOyBwYWQgYWZ0ZXIgTSxLLE5cbmZ1bmN0aW9uIG1ha2VEaW1zVW5pZm9ybShkZXZpY2UsIE0sIEssIE4pIHtcbiAgY29uc3QgdTMyID0gbmV3IFVpbnQzMkFycmF5KFtNLCBLLCBOLCAwXSkgLy8gcGFkXG4gIHJldHVybiBjcmVhdGVCdWZmZXIoZGV2aWNlLCB1MzIsIEdQVUJ1ZmZlclVzYWdlLlVOSUZPUk0gfCBHUFVCdWZmZXJVc2FnZS5DT1BZX0RTVClcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBDUFUgcmVmZXJlbmNlIChmb3Igc21hbGwgc2l6ZXMpIHRvIG9wdGlvbmFsbHkgY2hlY2sgY29ycmVjdG5lc3NcbmZ1bmN0aW9uIGNwdU1hdG11bChBLCBCLCBNLCBLLCBOKSB7XG4gIGNvbnN0IEMgPSBuZXcgRmxvYXQzMkFycmF5KE0gKiBOKVxuICBmb3IgKGxldCBpID0gMDsgaSA8IE07IGkrKykge1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgTjsgaisrKSB7XG4gICAgICBsZXQgcyA9IDBcbiAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgSzsgaysrKSBzICs9IEFbaSpLICsga10gKiBCW2sqTiArIGpdXG4gICAgICBDW2kqTiArIGpdID0gc1xuICAgIH1cbiAgfVxuICByZXR1cm4gQ1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Indnc2xfbmFpdmVfMWQgPSAvKiB3Z3NsICovIGBcbnN0cnVjdCBEaW1lbnNpb25zIHsgTTogdTMyLCBLOiB1MzIsIE46IHUzMiwgX3BhZDogdTMyIH07XG5AZ3JvdXAoMCkgQGJpbmRpbmcoMCkgdmFyPHVuaWZvcm0+IGRpbXM6IERpbWVuc2lvbnM7XG5AZ3JvdXAoMCkgQGJpbmRpbmcoMSkgdmFyPHN0b3JhZ2UsIHJlYWQ+IEE6IGFycmF5PGYzMj47XG5AZ3JvdXAoMCkgQGJpbmRpbmcoMikgdmFyPHN0b3JhZ2UsIHJlYWQ+IEI6IGFycmF5PGYzMj47XG5AZ3JvdXAoMCkgQGJpbmRpbmcoMykgdmFyPHN0b3JhZ2UsIHJlYWRfd3JpdGU+IEM6IGFycmF5PGYzMj47XG5cbkBjb21wdXRlIEB3b3JrZ3JvdXBfc2l6ZSgxKVxuZm4gbWFpbihAYnVpbHRpbihnbG9iYWxfaW52b2NhdGlvbl9pZCkgZ2lkOiB2ZWMzPHUzMj4pIHtcbiAgLy8gSGFuZGxlIG11bHRpLWRpbWVuc2lvbmFsIGRpc3BhdGNoIHByb3Blcmx5XG4gIGxldCBpZHggPSBnaWQueCArIGdpZC55ICogNjU1MzV1ICsgZ2lkLnogKiA2NTUzNXUgKiA2NTUzNXU7XG4gIGxldCBNID0gZGltcy5NOyBsZXQgSyA9IGRpbXMuSzsgbGV0IE4gPSBkaW1zLk47XG4gIGlmIChpZHggPj0gTSAqIE4pIHsgcmV0dXJuOyB9XG4gIGxldCByb3cgPSBpZHggLyBOO1xuICBsZXQgY29sID0gaWR4ICUgTjtcbiAgdmFyIHN1bTogZjMyID0gMC4wO1xuICBmb3IgKHZhciBrazogdTMyID0gMHU7IGtrIDwgSzsga2sgPSBrayArIDF1KSB7XG4gICAgc3VtID0gc3VtICsgQVtyb3cgKiBLICsga2tdICogQltrayAqIE4gKyBjb2xdO1xuICB9XG4gIENbcm93ICogTiArIGNvbF0gPSBzdW07XG59XG5gXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoid2dzbF8xZF9tYW55X3RocmVhZHMgPSAvKiB3Z3NsICovIGBcbnN0cnVjdCBEaW1lbnNpb25zIHsgTTogdTMyLCBLOiB1MzIsIE46IHUzMiwgX3BhZDogdTMyIH07XG5AZ3JvdXAoMCkgQGJpbmRpbmcoMCkgdmFyPHVuaWZvcm0+IGRpbXM6IERpbWVuc2lvbnM7XG5AZ3JvdXAoMCkgQGJpbmRpbmcoMSkgdmFyPHN0b3JhZ2UsIHJlYWQ+IEE6IGFycmF5PGYzMj47XG5AZ3JvdXAoMCkgQGJpbmRpbmcoMikgdmFyPHN0b3JhZ2UsIHJlYWQ+IEI6IGFycmF5PGYzMj47XG5AZ3JvdXAoMCkgQGJpbmRpbmcoMykgdmFyPHN0b3JhZ2UsIHJlYWRfd3JpdGU+IEM6IGFycmF5PGYzMj47XG5cbkBjb21wdXRlIEB3b3JrZ3JvdXBfc2l6ZSgyNTYpXG5mbiBtYWluKEBidWlsdGluKGdsb2JhbF9pbnZvY2F0aW9uX2lkKSBnaWQ6IHZlYzM8dTMyPikge1xuICAvLyBIYW5kbGUgbXVsdGktZGltZW5zaW9uYWwgZGlzcGF0Y2ggcHJvcGVybHkgIFxuICBsZXQgaWR4ID0gZ2lkLnggKyBnaWQueSAqIDY1NTM1dSArIGdpZC56ICogNjU1MzV1ICogNjU1MzV1O1xuICBsZXQgTSA9IGRpbXMuTTsgbGV0IEsgPSBkaW1zLks7IGxldCBOID0gZGltcy5OO1xuICBpZiAoaWR4ID49IE0gKiBOKSB7IHJldHVybjsgfVxuICBsZXQgcm93ID0gaWR4IC8gTjtcbiAgbGV0IGNvbCA9IGlkeCAlIE47XG4gIHZhciBzdW06IGYzMiA9IDAuMDtcbiAgZm9yICh2YXIga2s6IHUzMiA9IDB1OyBrayA8IEs7IGtrID0ga2sgKyAxdSkge1xuICAgIHN1bSA9IHN1bSArIEFbcm93ICogSyArIGtrXSAqIEJba2sgKiBOICsgY29sXTtcbiAgfVxuICBDW3JvdyAqIE4gKyBjb2xdID0gc3VtO1xufVxuYFxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Indnc2xfMmRfOHg4ID0gLyogd2dzbCAqLyBgXG5zdHJ1Y3QgRGltZW5zaW9ucyB7IE06IHUzMiwgSzogdTMyLCBOOiB1MzIsIF9wYWQ6IHUzMiB9O1xuQGdyb3VwKDApIEBiaW5kaW5nKDApIHZhcjx1bmlmb3JtPiBkaW1zOiBEaW1lbnNpb25zO1xuQGdyb3VwKDApIEBiaW5kaW5nKDEpIHZhcjxzdG9yYWdlLCByZWFkPiBBOiBhcnJheTxmMzI+O1xuQGdyb3VwKDApIEBiaW5kaW5nKDIpIHZhcjxzdG9yYWdlLCByZWFkPiBCOiBhcnJheTxmMzI+O1xuQGdyb3VwKDApIEBiaW5kaW5nKDMpIHZhcjxzdG9yYWdlLCByZWFkX3dyaXRlPiBDOiBhcnJheTxmMzI+O1xuXG5AY29tcHV0ZSBAd29ya2dyb3VwX3NpemUoOCwgOClcbmZuIG1haW4oQGJ1aWx0aW4oZ2xvYmFsX2ludm9jYXRpb25faWQpIGdpZDogdmVjMzx1MzI+KSB7XG4gIC8vIE5vdGU6IHN3YXAgdG8gZmF2b3IgY29hbGVzY2VkIGFjY2VzcyBhcyBkaXNjdXNzZWQgaW4gdGhlIGFydGljbGVcbiAgbGV0IHJvdyA9IGdpZC55OyAvLyBNXG4gIGxldCBjb2wgPSBnaWQueDsgLy8gTlxuICBsZXQgTSA9IGRpbXMuTTsgbGV0IEsgPSBkaW1zLks7IGxldCBOID0gZGltcy5OO1xuICBpZiAocm93ID49IE0gfHwgY29sID49IE4pIHsgcmV0dXJuOyB9XG4gIHZhciBzdW06IGYzMiA9IDAuMDtcbiAgZm9yICh2YXIga2s6IHUzMiA9IDB1OyBrayA8IEs7IGtrID0ga2sgKyAxdSkge1xuICAgIHN1bSA9IHN1bSArIEFbcm93ICogSyArIGtrXSAqIEJba2sgKiBOICsgY29sXTtcbiAgfVxuICBDW3JvdyAqIE4gKyBjb2xdID0gc3VtO1xufVxuYFxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Indnc2xfdGlsZV8xeDQgPSAvKiB3Z3NsICovIGBcbmNvbnN0IEJMT0NLU0laRTogdTMyID0gMTZ1OyAvLyAxNngxNiB0aHJlYWRzIHBlciB3b3JrZ3JvdXBcbmNvbnN0IFRJTEVfTjogdTMyID0gNHU7ICAgICAvLyA0IGNvbHVtbnMgcGVyIHRocmVhZFxuc3RydWN0IERpbWVuc2lvbnMgeyBNOiB1MzIsIEs6IHUzMiwgTjogdTMyLCBfcGFkOiB1MzIgfTtcbkBncm91cCgwKSBAYmluZGluZygwKSB2YXI8dW5pZm9ybT4gZGltczogRGltZW5zaW9ucztcbkBncm91cCgwKSBAYmluZGluZygxKSB2YXI8c3RvcmFnZSwgcmVhZD4gQTogYXJyYXk8ZjMyPjtcbkBncm91cCgwKSBAYmluZGluZygyKSB2YXI8c3RvcmFnZSwgcmVhZD4gQjogYXJyYXk8ZjMyPjtcbkBncm91cCgwKSBAYmluZGluZygzKSB2YXI8c3RvcmFnZSwgcmVhZF93cml0ZT4gQzogYXJyYXk8ZjMyPjtcblxuQGNvbXB1dGUgQHdvcmtncm91cF9zaXplKEJMT0NLU0laRSwgQkxPQ0tTSVpFKVxuZm4gbWFpbihAYnVpbHRpbihnbG9iYWxfaW52b2NhdGlvbl9pZCkgZ2lkOiB2ZWMzPHUzMj4pIHtcbiAgbGV0IE0gPSBkaW1zLk07IGxldCBLID0gZGltcy5LOyBsZXQgTiA9IGRpbXMuTjtcbiAgbGV0IHJvdyA9IGdpZC55O1xuICBsZXQgY29sMCA9IGdpZC54ICogVElMRV9OO1xuICBpZiAocm93ID49IE0gfHwgY29sMCA+PSBOKSB7IHJldHVybjsgfVxuXG4gIHZhciBzMDogZjMyID0gMC4wO1xuICB2YXIgczE6IGYzMiA9IDAuMDtcbiAgdmFyIHMyOiBmMzIgPSAwLjA7XG4gIHZhciBzMzogZjMyID0gMC4wO1xuICBmb3IgKHZhciBrazogdTMyID0gMHU7IGtrIDwgSzsga2sgPSBrayArIDF1KSB7XG4gICAgbGV0IGEgPSBBW3JvdyAqIEsgKyBra107XG4gICAgbGV0IGJhc2UgPSBrayAqIE4gKyBjb2wwO1xuICAgIHMwID0gczAgKyBhICogQltiYXNlICsgMHVdO1xuICAgIHMxID0gczEgKyBhICogQltiYXNlICsgMXVdO1xuICAgIHMyID0gczIgKyBhICogQltiYXNlICsgMnVdO1xuICAgIHMzID0gczMgKyBhICogQltiYXNlICsgM3VdO1xuICB9XG4gIENbcm93ICogTiArIGNvbDAgKyAwdV0gPSBzMDtcbiAgaWYgKGNvbDAgKyAxdSA8IE4pIHsgQ1tyb3cgKiBOICsgY29sMCArIDF1XSA9IHMxOyB9XG4gIGlmIChjb2wwICsgMnUgPCBOKSB7IENbcm93ICogTiArIGNvbDAgKyAydV0gPSBzMjsgfVxuICBpZiAoY29sMCArIDN1IDwgTikgeyBDW3JvdyAqIE4gKyBjb2wwICsgM3VdID0gczM7IH1cbn1cbmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ3Z3NsX3RpbGVfNHg0ID0gLyogd2dzbCAqLyBgXG5jb25zdCBCTE9DS1NJWkU6IHUzMiA9IDE2dTtcbmNvbnN0IFRJTEVfTTogdTMyID0gNHU7IC8vIDQgcm93cyBwZXIgdGhyZWFkXG5jb25zdCBUSUxFX046IHUzMiA9IDR1OyAvLyA0IGNvbHMgcGVyIHRocmVhZFxuc3RydWN0IERpbWVuc2lvbnMgeyBNOiB1MzIsIEs6IHUzMiwgTjogdTMyLCBfcGFkOiB1MzIgfTtcbkBncm91cCgwKSBAYmluZGluZygwKSB2YXI8dW5pZm9ybT4gZGltczogRGltZW5zaW9ucztcbkBncm91cCgwKSBAYmluZGluZygxKSB2YXI8c3RvcmFnZSwgcmVhZD4gQTogYXJyYXk8ZjMyPjtcbkBncm91cCgwKSBAYmluZGluZygyKSB2YXI8c3RvcmFnZSwgcmVhZD4gQjogYXJyYXk8ZjMyPjtcbkBncm91cCgwKSBAYmluZGluZygzKSB2YXI8c3RvcmFnZSwgcmVhZF93cml0ZT4gQzogYXJyYXk8ZjMyPjtcblxuQGNvbXB1dGUgQHdvcmtncm91cF9zaXplKEJMT0NLU0laRSwgQkxPQ0tTSVpFKVxuZm4gbWFpbihAYnVpbHRpbihnbG9iYWxfaW52b2NhdGlvbl9pZCkgZ2lkOiB2ZWMzPHUzMj4pIHtcbiAgbGV0IE0gPSBkaW1zLk07IGxldCBLID0gZGltcy5LOyBsZXQgTiA9IGRpbXMuTjtcbiAgbGV0IHJvdzAgPSBnaWQueSAqIFRJTEVfTTtcbiAgbGV0IGNvbDAgPSBnaWQueCAqIFRJTEVfTjtcbiAgaWYgKHJvdzAgPj0gTSB8fCBjb2wwID49IE4pIHsgcmV0dXJuOyB9XG5cbiAgdmFyIHM6IGFycmF5PGFycmF5PGYzMiwgVElMRV9OPiwgVElMRV9NPjtcbiAgLy8gaW5pdGlhbGl6ZVxuICBmb3IgKHZhciBpaTogdTMyID0gMHU7IGlpIDwgVElMRV9NOyBpaSA9IGlpICsgMXUpIHtcbiAgICBmb3IgKHZhciBqajogdTMyID0gMHU7IGpqIDwgVElMRV9OOyBqaiA9IGpqICsgMXUpIHtcbiAgICAgIHNbaWldW2pqXSA9IDAuMDtcbiAgICB9XG4gIH1cblxuICAvLyB1bnJvbGxlZCBhY2N1bXVsYXRpb24gb3ZlciBLIHN0YXlzIGFzIGEgbG9vcCAoSyB1bmtub3duIGF0IGNvbXBpbGUgdGltZSlcbiAgZm9yICh2YXIga2s6IHUzMiA9IDB1OyBrayA8IEs7IGtrID0ga2sgKyAxdSkge1xuICAgIGZvciAodmFyIGlpOiB1MzIgPSAwdTsgaWkgPCBUSUxFX007IGlpID0gaWkgKyAxdSkge1xuICAgICAgbGV0IGEgPSBBWyhyb3cwICsgaWkpICogSyArIGtrXTtcbiAgICAgIGxldCBiYmFzZSA9IGtrICogTiArIGNvbDA7XG4gICAgICBmb3IgKHZhciBqajogdTMyID0gMHU7IGpqIDwgVElMRV9OOyBqaiA9IGpqICsgMXUpIHtcbiAgICAgICAgc1tpaV1bampdID0gc1tpaV1bampdICsgYSAqIEJbYmJhc2UgKyBqal07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZm9yICh2YXIgaWk6IHUzMiA9IDB1OyBpaSA8IFRJTEVfTTsgaWkgPSBpaSArIDF1KSB7XG4gICAgbGV0IHIgPSByb3cwICsgaWk7XG4gICAgaWYgKHIgPCBNKSB7XG4gICAgICBmb3IgKHZhciBqajogdTMyID0gMHU7IGpqIDwgVElMRV9OOyBqaiA9IGpqICsgMXUpIHtcbiAgICAgICAgbGV0IGMgPSBjb2wwICsgamo7XG4gICAgICAgIGlmIChjIDwgTikgeyBDW3IgKiBOICsgY10gPSBzW2lpXVtqal07IH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJrZXJuZWxzID0gW1xuICB7IFxuICAgIGtleTogJ25haXZlMWQnLCBcbiAgICBsYWJlbDogJ05haXZlIDFEICh3Z19zaXplPTEpJywgXG4gICAgd2dzbDogd2dzbF9uYWl2ZV8xZCwgXG4gICAgZGlzcGF0Y2g6ICh7TSxOfSkgPT4ge1xuICAgICAgY29uc3QgdG90YWwgPSBNKk5cbiAgICAgIC8vIFJlc3BlY3QgNjU1MzUgbGltaXQgcGVyIGRpbWVuc2lvbiwgdXNlIDJEIGRpc3BhdGNoIGlmIG5lZWRlZFxuICAgICAgaWYgKHRvdGFsIDw9IDY1NTM1KSByZXR1cm4gW3RvdGFsLCAxLCAxXVxuICAgICAgY29uc3QgeCA9IE1hdGgubWluKDY1NTM1LCBNYXRoLmNlaWwoTWF0aC5zcXJ0KHRvdGFsKSkpXG4gICAgICBjb25zdCB5ID0gTWF0aC5jZWlsKHRvdGFsIC8geClcbiAgICAgIHJldHVybiBbeCwgTWF0aC5taW4oNjU1MzUsIHkpLCBNYXRoLm1heCgxLCBNYXRoLmNlaWwoeSAvIDY1NTM1KSldXG4gICAgfSwgXG4gICAgbGltaXRzOiB7IHJlY29tbWVuZE1heE1OOiA1MTIgfSBcbiAgfSxcbiAgeyBcbiAgICBrZXk6ICdvbmVEMjU2JywgXG4gICAgbGFiZWw6ICcxRCBtYW55IHRocmVhZHMgKDI1NiknLCBcbiAgICB3Z3NsOiB3Z3NsXzFkX21hbnlfdGhyZWFkcywgXG4gICAgZGlzcGF0Y2g6ICh7TSxOfSkgPT4ge1xuICAgICAgY29uc3QgdG90YWwgPSBNYXRoLmNlaWwoKE0qTikvMjU2KVxuICAgICAgaWYgKHRvdGFsIDw9IDY1NTM1KSByZXR1cm4gW3RvdGFsLCAxLCAxXVxuICAgICAgY29uc3QgeCA9IE1hdGgubWluKDY1NTM1LCBNYXRoLmNlaWwoTWF0aC5zcXJ0KHRvdGFsKSkpXG4gICAgICBjb25zdCB5ID0gTWF0aC5jZWlsKHRvdGFsIC8geClcbiAgICAgIHJldHVybiBbeCwgTWF0aC5taW4oNjU1MzUsIHkpLCBNYXRoLm1heCgxLCBNYXRoLmNlaWwoeSAvIDY1NTM1KSldXG4gICAgfSwgXG4gICAgbGltaXRzOiB7IHJlY29tbWVuZE1heE1OOiAxMDI0KjEwMjQgfSBcbiAgfSxcbiAgeyBrZXk6ICd0d29EOHg4JywgbGFiZWw6ICcyRCA4w5c4Jywgd2dzbDogd2dzbF8yZF84eDgsIGRpc3BhdGNoOiAoe00sTn0pID0+IFtNYXRoLmNlaWwoTi84KSwgTWF0aC5jZWlsKE0vOCksIDFdLCBsaW1pdHM6IHsgcmVjb21tZW5kTWF4TU46IDQwOTYqNDA5NiB9IH0sXG4gIHsga2V5OiAndGlsZTF4NCcsIGxhYmVsOiAnVGlsZWQgMcOXNCAoMTbDlzE2IHdnKScsIHdnc2w6IHdnc2xfdGlsZV8xeDQsIGRpc3BhdGNoOiAoe00sTn0pID0+IFtNYXRoLmNlaWwoTi8oMTYqNCkpLCBNYXRoLmNlaWwoTS8xNiksIDFdLCBsaW1pdHM6IHsgcmVjb21tZW5kTWF4TU46IDQwOTYqNDA5NiB9IH0sXG4gIHsga2V5OiAndGlsZTR4NCcsIGxhYmVsOiAnVGlsZWQgNMOXNCAoMTbDlzE2IHdnKScsIHdnc2w6IHdnc2xfdGlsZV80eDQsIGRpc3BhdGNoOiAoe00sTn0pID0+IFtNYXRoLmNlaWwoTi8oMTYqNCkpLCBNYXRoLmNlaWwoTS8oMTYqNCkpLCAxXSwgbGltaXRzOiB7IHJlY29tbWVuZE1heE1OOiA0MDk2KjQwOTYgfSB9XG5dXG5cbm5vcm1hbGl6ZUtlcm5lbEtleSA9IHZhbHVlID0+IHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHJldHVybiB2YWx1ZVxuICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xuICAgIGlmICh0eXBlb2YgdmFsdWUudmFsdWUgPT09ICdzdHJpbmcnKSByZXR1cm4gdmFsdWUudmFsdWVcbiAgICBpZiAodHlwZW9mIHZhbHVlLmtleSA9PT0gJ3N0cmluZycpIHJldHVybiB2YWx1ZS5rZXlcbiAgfVxuICByZXR1cm4ga2VybmVsc1swXT8ua2V5ID8/ICduYWl2ZTFkJ1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIE5vbi1yZWFjdGl2ZSBpbnB1dCBjb250cm9scyAobXV0YWJsZSlcbm11dGFibGUgbV92YWx1ZSA9IDUxMlxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im11dGFibGUga192YWx1ZSA9IDUxMlxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im11dGFibGUgbl92YWx1ZSA9IDUxMlxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im11dGFibGUga2VybmVsX3ZhbHVlID0gJ25haXZlMWQnXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibXV0YWJsZSB2ZXJpZnlfdmFsdWUgPSBmYWxzZVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIFVJIGNvbnRyb2xzIHRoYXQgdXBkYXRlIG11dGFibGUgdmFsdWVzIGJ1dCBkb24ndCB0cmlnZ2VyIHJlYWN0aXZpdHkgZWxzZXdoZXJlXG5tYXhfZGltID0gMTYzODRcblxubV9pbnB1dCA9IHtcbiAgY29uc3QgaW5wdXQgPSBJbnB1dHMucmFuZ2UoWzY0LCBtYXhfZGltXSwge3ZhbHVlOiBtdXRhYmxlIG1fdmFsdWUsIHN0ZXA6IDE2LCBsYWJlbDogJ00gKHJvd3Mgb2YgQS9DKSd9KVxuICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IG11dGFibGUgbV92YWx1ZSA9IGlucHV0LnZhbHVlKVxuICByZXR1cm4gaW5wdXRcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJrX2lucHV0ID0ge1xuICBjb25zdCBpbnB1dCA9IElucHV0cy5yYW5nZShbNjQsIG1heF9kaW1dLCB7dmFsdWU6IG11dGFibGUga192YWx1ZSwgc3RlcDogMTYsIGxhYmVsOiAnSyAoY29scyBvZiBBIC8gcm93cyBvZiBCKSd9KVxuICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IG11dGFibGUga192YWx1ZSA9IGlucHV0LnZhbHVlKVxuICByZXR1cm4gaW5wdXRcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJuX2lucHV0ID0ge1xuICBjb25zdCBpbnB1dCA9IElucHV0cy5yYW5nZShbNjQsIG1heF9kaW1dLCB7dmFsdWU6IG11dGFibGUgbl92YWx1ZSwgc3RlcDogMTYsIGxhYmVsOiAnTiAoY29scyBvZiBCL0MpJ30pXG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4gbXV0YWJsZSBuX3ZhbHVlID0gaW5wdXQudmFsdWUpXG4gIHJldHVybiBpbnB1dFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Imtlcm5lbF9pbnB1dCA9IHtcbiAgY29uc3QgaW5wdXQgPSBJbnB1dHMuc2VsZWN0KFxuICAgIGtlcm5lbHMsXG4gICAge1xuICAgICAgbGFiZWw6ICdLZXJuZWwnLFxuICAgICAgZm9ybWF0OiBkID0+IGQubGFiZWwsXG4gICAgICB2YWx1ZTogbXV0YWJsZSBrZXJuZWxfdmFsdWUsXG4gICAgICByZWR1Y2U6IGQgPT4gZC5rZXlcbiAgICB9XG4gIClcbiAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKSA9PiBtdXRhYmxlIGtlcm5lbF92YWx1ZSA9IGlucHV0LnZhbHVlKVxuICByZXR1cm4gaW5wdXRcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2ZXJpZnlfaW5wdXQgPSB7XG4gIGNvbnN0IGlucHV0ID0gSW5wdXRzLnRvZ2dsZSh7bGFiZWw6ICdWZXJpZnkgKENQVSBjaGVjayBpZiBzbWFsbCknLCB2YWx1ZTogbXV0YWJsZSB2ZXJpZnlfdmFsdWV9KVxuICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IG11dGFibGUgdmVyaWZ5X3ZhbHVlID0gaW5wdXQudmFsdWUpXG4gIHJldHVybiBpbnB1dFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIEdyb3VwIGFsbCBpbnB1dHMgdmlzdWFsbHlcbmh0bWxgPGRpdj5cbiAgJHttX2lucHV0fVxuICAke2tfaW5wdXR9XG4gICR7bl9pbnB1dH1cbiAgJHtrZXJuZWxfaW5wdXR9XG4gICR7dmVyaWZ5X2lucHV0fVxuPC9kaXY+YFxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIENvbnRyb2wgYnV0dG9uc1xuaHRtbGA8ZGl2IHN0eWxlPVwiZGlzcGxheTogZmxleDsgZ2FwOiAwLjVyZW07IG1hcmdpbi10b3A6IDFyZW07XCI+XG4gICR7dmlld29mIHJ1bn1cbiAgJHt2aWV3b2Ygc3dlZXB9XG4gICR7dmlld29mIGRvd25sb2FkX3Jlc3VsdHN9XG4gICR7dmlld29mIGNsZWFyX3Jlc3VsdHN9XG48L2Rpdj5gXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gSW50ZXJuYWwgY2FjaGUgdG8gc3RvcmUgaGlzdG9yeSB3aXRob3V0IGNyZWF0aW5nIHJlYWN0aXZlIHNlbGYtZGVwZW5kZW5jaWVzXG5yZXN1bHRzX2hpc3RvcnlfY2FjaGUgPSAoKCkgPT4ge1xuICBjb25zdCBkYXRhID0gW11cbiAgcmV0dXJuIHtcbiAgICBnZXQgdmFsdWUoKSB7XG4gICAgICByZXR1cm4gZGF0YS5zbGljZSgpXG4gICAgfSxcbiAgICBwdXNoKGl0ZW0pIHtcbiAgICAgIGRhdGEucHVzaChpdGVtKVxuICAgICAgcmV0dXJuIGRhdGEuc2xpY2UoKVxuICAgIH0sXG4gICAgY2xlYXIoKSB7XG4gICAgICBkYXRhLmxlbmd0aCA9IDBcbiAgICAgIHJldHVybiBkYXRhLnNsaWNlKClcbiAgICB9XG4gIH1cbn0pKClcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBNdXRhYmxlIGFycmF5IHRvIHN0b3JlIGFsbCByZXN1bHRzXG5tdXRhYmxlIHJlc3VsdHNfaGlzdG9yeSA9IFtdXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gT25seSB0aGUgc3VibWl0IGJ1dHRvbiB0cmlnZ2VycyBjb21wdXRhdGlvbiAtIGluY3JlbWVudCBvbiBlYWNoIGNsaWNrXG52aWV3b2YgcnVuID0gSW5wdXRzLmJ1dHRvbignUnVuIG1hdG11bCcsIHsgcmVkdWNlOiB2ID0+ICh2ID8/IDApICsgMSB9KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIFN3ZWVwIGJ1dHRvbiBmb3IgcnVubmluZyBhbGwga2VybmVscyB3aXRoIHBvd2VyLW9mLTIgZGltZW5zaW9uc1xudmlld29mIHN3ZWVwID0gSW5wdXRzLmJ1dHRvbignU3dlZXAgYWxsIGtlcm5lbHMnLCB7IHJlZHVjZTogdiA9PiAodiA/PyAwKSArIDEgfSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBEb3dubG9hZCByZXN1bHRzIGJ1dHRvblxudmlld29mIGRvd25sb2FkX3Jlc3VsdHMgPSBJbnB1dHMuYnV0dG9uKCdEb3dubG9hZCBDU1YnLCB7IHJlZHVjZTogdiA9PiAodiA/PyAwKSArIDEgfSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBDbGVhciByZXN1bHRzIGJ1dHRvblxudmlld29mIGNsZWFyX3Jlc3VsdHMgPSBJbnB1dHMuYnV0dG9uKCdDbGVhciByZXN1bHRzJywgeyByZWR1Y2U6IHYgPT4gKHYgPz8gMCkgKyAxIH0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gSGFuZGxlIGNsZWFyIGJ1dHRvbiBjbGlja3NcbmNsZWFyX2hhbmRsZXIgPSB7XG4gIGlmIChjbGVhcl9yZXN1bHRzID4gMCkge1xuICAgIGNvbnN0IGVtcHRpZWQgPSByZXN1bHRzX2hpc3RvcnlfY2FjaGUuY2xlYXIoKVxuICAgIG11dGFibGUgcmVzdWx0c19oaXN0b3J5ID0gZW1wdGllZFxuICB9XG4gIHJldHVybiBjbGVhcl9yZXN1bHRzXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gSGFuZGxlIGRvd25sb2FkIGJ1dHRvbiBjbGlja3NcbmRvd25sb2FkX2hhbmRsZXIgPSB7XG4gIGlmIChkb3dubG9hZF9yZXN1bHRzID4gMCkge1xuICAgIGNvbnN0IGhpc3RvcnkgPSByZXN1bHRzX2hpc3RvcnkgfHwgW11cbiAgICBpZiAoaGlzdG9yeS5sZW5ndGggPT09IDApIHtcbiAgICAgIGFsZXJ0KCdObyByZXN1bHRzIHRvIGRvd25sb2FkLiBSdW4gc29tZSB0ZXN0cyBmaXJzdC4nKVxuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIFxuICAgIC8vIENvbnZlcnQgcmVzdWx0cyB0byBDU1YgZm9ybWF0XG4gICAgY29uc3QgY3N2RGF0YSA9IGhpc3RvcnkubWFwKHJlc3VsdCA9PiAoe1xuICAgICAgJ1J1bic6IHJlc3VsdC5ydW5OdW1iZXIgPz8gJycsXG4gICAgICAnS2VybmVsJzogcmVzdWx0Lmtlcm5lbCA/PyAnJyxcbiAgICAgICdNJzogcmVzdWx0Lk0gPz8gJycsXG4gICAgICAnSyc6IHJlc3VsdC5LID8/ICcnLFxuICAgICAgJ04nOiByZXN1bHQuTiA/PyAnJyxcbiAgICAgICdNZW1vcnlfTUInOiByZXN1bHQudG90YWxNQiA/IHJlc3VsdC50b3RhbE1CLnRvRml4ZWQoMSkgOiAnJyxcbiAgICAgICdEaXNwYXRjaF9YJzogcmVzdWx0LmR4ID8/ICcnLFxuICAgICAgJ0Rpc3BhdGNoX1knOiByZXN1bHQuZHkgPz8gJycsXG4gICAgICAnRGlzcGF0Y2hfWic6IHJlc3VsdC5keiA/PyAnJyxcbiAgICAgICdHUFVfVGltZV9tcyc6IHJlc3VsdC5tcyA/IHJlc3VsdC5tcy50b0ZpeGVkKDIpIDogJycsXG4gICAgICAnVG90YWxfVGltZV9tcyc6IHJlc3VsdC50b3RhbE1zID8gcmVzdWx0LnRvdGFsTXMudG9GaXhlZCgyKSA6ICcnLFxuICAgICAgJ0dQVV9UaHJvdWdocHV0X0dGTE9QUyc6IHJlc3VsdC5nZmxvcHMgPyByZXN1bHQuZ2Zsb3BzLnRvRml4ZWQoMikgOiAnJyxcbiAgICAgICdDUFVfVGltZV9tcyc6IHJlc3VsdC5jcHVUaW1lID8gcmVzdWx0LmNwdVRpbWUudG9GaXhlZCgyKSA6ICcnLFxuICAgICAgJ0NQVV9UaHJvdWdocHV0X0dGTE9QUyc6IHJlc3VsdC5jcHVHZmxvcHMgPyByZXN1bHQuY3B1R2Zsb3BzLnRvRml4ZWQoMikgOiAnJyxcbiAgICAgICdHUFVfU3BlZWR1cCc6IChyZXN1bHQuY3B1VGltZSAmJiByZXN1bHQubXMgJiYgcmVzdWx0Lm1zID4gMCkgPyAocmVzdWx0LmNwdVRpbWUgLyByZXN1bHQubXMpLnRvRml4ZWQoMSkgOiAnJyxcbiAgICAgICdNYXhfRXJyb3JfdnNfQ1BVJzogcmVzdWx0LmNoZWNrPy5tYXhBYnMgPyByZXN1bHQuY2hlY2subWF4QWJzLnRvRXhwb25lbnRpYWwoMikgOiAnJ1xuICAgIH0pKVxuICAgIFxuICAgIC8vIENvbnZlcnQgdG8gQ1NWIHN0cmluZ1xuICAgIGNvbnN0IGhlYWRlcnMgPSBPYmplY3Qua2V5cyhjc3ZEYXRhWzBdKVxuICAgIGNvbnN0IGNzdkNvbnRlbnQgPSBbXG4gICAgICBoZWFkZXJzLmpvaW4oJywnKSxcbiAgICAgIC4uLmNzdkRhdGEubWFwKHJvdyA9PiBoZWFkZXJzLm1hcChoZWFkZXIgPT4gcm93W2hlYWRlcl0pLmpvaW4oJywnKSlcbiAgICBdLmpvaW4oJ1xcbicpXG4gICAgXG4gICAgLy8gQ3JlYXRlIGFuZCB0cmlnZ2VyIGRvd25sb2FkXG4gICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtjc3ZDb250ZW50XSwgeyB0eXBlOiAndGV4dC9jc3Y7Y2hhcnNldD11dGYtODsnIH0pXG4gICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKVxuICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYilcbiAgICBsaW5rLnNldEF0dHJpYnV0ZSgnaHJlZicsIHVybClcbiAgICBsaW5rLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCBgd2ViZ3B1LW1hdG11bC1yZXN1bHRzLSR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF19LmNzdmApXG4gICAgbGluay5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbidcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspXG4gICAgbGluay5jbGljaygpXG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChsaW5rKVxuICAgIFVSTC5yZXZva2VPYmplY3RVUkwodXJsKVxuICB9XG4gIHJldHVybiBkb3dubG9hZF9yZXN1bHRzXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gU3dlZXAgcnVubmVyIC0gcnVucyBhbGwga2VybmVscyB3aXRoIHBvd2VyLW9mLTIgZGltZW5zaW9uc1xuc3dlZXBfcmVzdWx0cyA9IHtcbiAgaWYgKCFzd2VlcCkgcmV0dXJuIG51bGxcbiAgXG4gIGlmICghd2ViZ3B1X29rIHx8ICFkZXZpY2UpIHtcbiAgICBjb25zdCBlcnJvciA9ICdXZWJHUFUgbm90IGF2YWlsYWJsZSdcbiAgICBtdXRhYmxlIGNvbXB1dGVfc3RhdHVzID0geyBzdGF0ZTogJ2Vycm9yJywgbWVzc2FnZTogZXJyb3IsIGVycm9yIH1cbiAgICBtdXRhYmxlIHN0YXR1c190cmlnZ2VyID0gbXV0YWJsZSBzdGF0dXNfdHJpZ2dlciArIDFcbiAgICByZXR1cm4geyBlcnJvciB9XG4gIH1cblxuICBjb25zdCBkaW1lbnNpb25zID0gWzUxMiwgMTAyNCwgMjA0OCwgNDA5NiwgODE5Ml1cbiAgY29uc3QgYWxsS2VybmVscyA9IGtlcm5lbHMubWFwKGsgPT4gay5rZXkpXG4gIGNvbnN0IHRvdGFsUnVucyA9IGRpbWVuc2lvbnMubGVuZ3RoICogYWxsS2VybmVscy5sZW5ndGhcbiAgbGV0IGNvbXBsZXRlZFJ1bnMgPSAwXG4gIFxuICBtdXRhYmxlIGNvbXB1dGVfc3RhdHVzID0ge1xuICAgIHN0YXRlOiAncnVubmluZycsXG4gICAgbWVzc2FnZTogYFJ1bm5pbmcgc3dlZXA6IDAvJHt0b3RhbFJ1bnN9IGNvbXBsZXRlZGAsXG4gICAgc3Bpbm5lcjogdHJ1ZVxuICB9XG4gIG11dGFibGUgc3RhdHVzX3RyaWdnZXIgPSBtdXRhYmxlIHN0YXR1c190cmlnZ2VyICsgMVxuICBcbiAgLy8gWWllbGQgdG8gYnJvd3NlciBmb3Igc3RhdHVzIHVwZGF0ZVxuICBhd2FpdCBuZXcgUHJvbWlzZShyZXF1ZXN0QW5pbWF0aW9uRnJhbWUpXG4gIFxuICB0cnkge1xuICAgIGZvciAoY29uc3Qga2VybmVsS2V5IG9mIGFsbEtlcm5lbHMpIHtcbiAgICAgIGZvciAoY29uc3QgZGltIG9mIGRpbWVuc2lvbnMpIHtcbiAgICAgICAgY29uc3QgZGltcyA9IHsgTTogZGltLCBLOiBkaW0sIE46IGRpbSB9XG4gICAgICAgIGNvbnN0IHRvdGFsTUIgPSAoZGltICogZGltICsgZGltICogZGltICsgZGltICogZGltKSAqIDQgLyAxMDI0IC8gMTAyNFxuICAgICAgICBcbiAgICAgICAgLy8gVXBkYXRlIHN0YXR1cyBmb3IgY3VycmVudCBydW5cbiAgICAgICAgY29uc3Qga2VybmVsSW5mbyA9IGtlcm5lbHMuZmluZChrID0+IGsua2V5ID09PSBrZXJuZWxLZXkpXG4gICAgICAgIGNvbnN0IGtlcm5lbExhYmVsID0ga2VybmVsSW5mbz8ubGFiZWwgPz8ga2VybmVsS2V5XG4gICAgICAgIFxuICAgICAgICBtdXRhYmxlIGNvbXB1dGVfc3RhdHVzID0ge1xuICAgICAgICAgIHN0YXRlOiAncnVubmluZycsXG4gICAgICAgICAgbWVzc2FnZTogYFJ1bm5pbmcgc3dlZXA6ICR7Y29tcGxldGVkUnVuc30vJHt0b3RhbFJ1bnN9IC0gJHtrZXJuZWxMYWJlbH0gJHtkaW19w5cke2RpbX3DlyR7ZGltfWAsXG4gICAgICAgICAgc3Bpbm5lcjogdHJ1ZVxuICAgICAgICB9XG4gICAgICAgIG11dGFibGUgc3RhdHVzX3RyaWdnZXIgPSBtdXRhYmxlIHN0YXR1c190cmlnZ2VyICsgMVxuICAgICAgICBcbiAgICAgICAgLy8gWWllbGQgdG8gYnJvd3NlciBmb3Igc3RhdHVzIHVwZGF0ZVxuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXF1ZXN0QW5pbWF0aW9uRnJhbWUpXG4gICAgICAgIFxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBydW5NYXRtdWwoZGltcywga2VybmVsS2V5LCBmYWxzZSkgLy8gRG9uJ3QgdmVyaWZ5IGR1cmluZyBzd2VlcFxuICAgICAgICBcbiAgICAgICAgaWYgKHJlc3VsdCAmJiAhcmVzdWx0LmVycm9yKSB7XG4gICAgICAgICAgY29uc3QgZW5yaWNoZWQgPSB7IFxuICAgICAgICAgICAgLi4ucmVzdWx0LCBcbiAgICAgICAgICAgIHRvdGFsTUIsXG4gICAgICAgICAgICBydW5OdW1iZXI6IERhdGUubm93KCkgKyBjb21wbGV0ZWRSdW5zIC8vIFVzZSB0aW1lc3RhbXAgKyBjb3VudGVyIGZvciB1bmlxdWUgSURzXG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFwcGVuZCB0byBoaXN0b3J5XG4gICAgICAgICAgY29uc3QgdXBkYXRlZEhpc3RvcnkgPSByZXN1bHRzX2hpc3RvcnlfY2FjaGUucHVzaChlbnJpY2hlZClcbiAgICAgICAgICBtdXRhYmxlIHJlc3VsdHNfaGlzdG9yeSA9IHVwZGF0ZWRIaXN0b3J5XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbXBsZXRlZFJ1bnMrK1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBtdXRhYmxlIGNvbXB1dGVfc3RhdHVzID0ge1xuICAgICAgc3RhdGU6ICdkb25lJyxcbiAgICAgIG1lc3NhZ2U6IGBTd2VlcCBjb21wbGV0ZWQ6ICR7Y29tcGxldGVkUnVuc30vJHt0b3RhbFJ1bnN9IHJ1bnMgZmluaXNoZWRgLFxuICAgICAgc3Bpbm5lcjogZmFsc2VcbiAgICB9XG4gICAgbXV0YWJsZSBzdGF0dXNfdHJpZ2dlciA9IG11dGFibGUgc3RhdHVzX3RyaWdnZXIgKyAxXG4gICAgXG4gICAgcmV0dXJuIHsgY29tcGxldGVkOiBjb21wbGV0ZWRSdW5zLCB0b3RhbDogdG90YWxSdW5zIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnN0IGVycm9yID0gZS5tZXNzYWdlIHx8IGUudG9TdHJpbmcoKVxuICAgIG11dGFibGUgY29tcHV0ZV9zdGF0dXMgPSB7IFxuICAgICAgc3RhdGU6ICdlcnJvcicsIFxuICAgICAgbWVzc2FnZTogYFN3ZWVwIGZhaWxlZDogJHtlcnJvcn0gKGNvbXBsZXRlZCAke2NvbXBsZXRlZFJ1bnN9LyR7dG90YWxSdW5zfSlgLCBcbiAgICAgIGVycm9yIFxuICAgIH1cbiAgICBtdXRhYmxlIHN0YXR1c190cmlnZ2VyID0gbXV0YWJsZSBzdGF0dXNfdHJpZ2dlciArIDFcbiAgICByZXR1cm4geyBlcnJvciwgY29tcGxldGVkOiBjb21wbGV0ZWRSdW5zLCB0b3RhbDogdG90YWxSdW5zIH1cbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIENyZWF0ZSB0eXBlZCBhcnJheXMgYW5kIGJ1ZmZlcnMsIGRpc3BhdGNoLCByZWFkIGJhY2sgQyBpZiBuZWVkZWQsIGFuZCB0aW1lIGl0XG5hc3luYyBmdW5jdGlvbiBydW5NYXRtdWwoe00sSyxOfSwga2VybmVsS2V5LCB2ZXJpZnksIG9uU3RhdHVzID0gbnVsbCkge1xuICBpZiAoIWRldmljZSkgcmV0dXJuIHsgZXJyb3I6ICdObyBXZWJHUFUgZGV2aWNlJyB9XG5cbiAgY29uc3QgdG90YWxTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpXG5cbiAgY29uc3Qgbm90aWZ5ID0gKG1lc3NhZ2UsIHNwaW5uaW5nID0gdHJ1ZSkgPT4ge1xuICAgIGlmIChvblN0YXR1cykgb25TdGF0dXMoeyBtZXNzYWdlLCBzcGlubmluZyB9KVxuICB9XG5cbiAgbm90aWZ5KCcxLzkgSW5pdGlhbGl6aW5nIGNvbXB1dGF0aW9uLi4uJylcbiAgYXdhaXQgbmV3IFByb21pc2UocmVxdWVzdEFuaW1hdGlvbkZyYW1lKVxuXG4gIGNvbnN0IGtleSA9ICh0eXBlb2Yga2VybmVsS2V5ID09PSAnc3RyaW5nJylcbiAgICA/IGtlcm5lbEtleVxuICAgIDogKGtlcm5lbEtleSAmJiB0eXBlb2Yga2VybmVsS2V5ID09PSAnb2JqZWN0JyAmJiAoJ3ZhbHVlJyBpbiBrZXJuZWxLZXkgfHwgJ2tleScgaW4ga2VybmVsS2V5KSlcbiAgICAgID8gKGtlcm5lbEtleS52YWx1ZSA/PyBrZXJuZWxLZXkua2V5KVxuICAgICAgOiAoa2VybmVsS2V5ID8/ICd0d29EOHg4JylcbiAgY29uc3Qga2VyID0ga2VybmVscy5maW5kKGsgPT4gay5rZXkgPT09IGtleSlcbiAgaWYgKCFrZXIpIHJldHVybiB7IGVycm9yOiAnVW5rbm93biBrZXJuZWwnIH1cblxuICBNID0gTWF0aC5tYXgoMSwgTWF0aC5mbG9vcigrTSB8fCAwKSlcbiAgSyA9IE1hdGgubWF4KDEsIE1hdGguZmxvb3IoK0sgfHwgMCkpXG4gIE4gPSBNYXRoLm1heCgxLCBNYXRoLmZsb29yKCtOIHx8IDApKVxuXG4gIG5vdGlmeSgnMi85IENyZWF0aW5nIGlucHV0IG1hdHJpY2VzLi4uJylcbiAgYXdhaXQgbmV3IFByb21pc2UocmVxdWVzdEFuaW1hdGlvbkZyYW1lKVxuXG4gIGNvbnN0IGVsZW1BID0gTSpLLCBlbGVtQiA9IEsqTiwgZWxlbUMgPSBNKk5cbiAgY29uc3QgQSA9IG5ldyBGbG9hdDMyQXJyYXkoZWxlbUEpXG4gIGNvbnN0IEIgPSBuZXcgRmxvYXQzMkFycmF5KGVsZW1CKVxuICBmb3IgKGxldCBpID0gMDsgaSA8IGVsZW1BOyBpKyspIEFbaV0gPSAoTWF0aC5zaW4oaSAqIDE3LjEzKSArIDEpICogMC41XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZWxlbUI7IGkrKykgQltpXSA9IChNYXRoLmNvcyhpICogOS45NykgKyAxKSAqIDAuNVxuXG4gIG5vdGlmeSgnMy85IENyZWF0aW5nIEdQVSBidWZmZXJzLi4uJylcbiAgYXdhaXQgbmV3IFByb21pc2UocmVxdWVzdEFuaW1hdGlvbkZyYW1lKVxuXG4gIGNvbnN0IGFCdWYgPSBjcmVhdGVCdWZmZXIoZGV2aWNlLCBBLCBHUFVCdWZmZXJVc2FnZS5TVE9SQUdFIHwgR1BVQnVmZmVyVXNhZ2UuQ09QWV9EU1QpXG4gIGNvbnN0IGJCdWYgPSBjcmVhdGVCdWZmZXIoZGV2aWNlLCBCLCBHUFVCdWZmZXJVc2FnZS5TVE9SQUdFIHwgR1BVQnVmZmVyVXNhZ2UuQ09QWV9EU1QpXG4gIGNvbnN0IGJ5dGVzQyA9IGVsZW1DICogNFxuICBjb25zdCBzaXplQnl0ZXNDID0gTWF0aC5jZWlsKGJ5dGVzQyAvIDQpICogNFxuICBjb25zdCBjQnVmID0gY3JlYXRlQnVmZmVyKGRldmljZSwgc2l6ZUJ5dGVzQywgR1BVQnVmZmVyVXNhZ2UuU1RPUkFHRSB8IEdQVUJ1ZmZlclVzYWdlLkNPUFlfU1JDIHwgR1BVQnVmZmVyVXNhZ2UuQ09QWV9EU1QpXG4gIGNvbnN0IHVCdWYgPSBtYWtlRGltc1VuaWZvcm0oZGV2aWNlLCBNLCBLLCBOKVxuXG4gIG5vdGlmeSgnNC85IFNldHRpbmcgdXAgR1BVIHBpcGVsaW5lLi4uJylcbiAgYXdhaXQgbmV3IFByb21pc2UocmVxdWVzdEFuaW1hdGlvbkZyYW1lKVxuXG4gIGNvbnN0IHBpcGVsaW5lID0gbWFrZVBpcGVsaW5lKGRldmljZSwga2VyLndnc2wpXG4gIGNvbnN0IGJpbmQgPSBkZXZpY2UuY3JlYXRlQmluZEdyb3VwKHsgbGF5b3V0OiBwaXBlbGluZS5nZXRCaW5kR3JvdXBMYXlvdXQoMCksIGVudHJpZXM6IFtcbiAgICB7IGJpbmRpbmc6IDAsIHJlc291cmNlOiB7IGJ1ZmZlcjogdUJ1ZiB9IH0sXG4gICAgeyBiaW5kaW5nOiAxLCByZXNvdXJjZTogeyBidWZmZXI6IGFCdWYgfSB9LFxuICAgIHsgYmluZGluZzogMiwgcmVzb3VyY2U6IHsgYnVmZmVyOiBiQnVmIH0gfSxcbiAgICB7IGJpbmRpbmc6IDMsIHJlc291cmNlOiB7IGJ1ZmZlcjogY0J1ZiB9IH0sXG4gIF19KVxuXG4gIGNvbnN0IGVuY29kZXIgPSBkZXZpY2UuY3JlYXRlQ29tbWFuZEVuY29kZXIoKVxuICBjb25zdCBwYXNzID0gZW5jb2Rlci5iZWdpbkNvbXB1dGVQYXNzKClcbiAgcGFzcy5zZXRQaXBlbGluZShwaXBlbGluZSlcbiAgcGFzcy5zZXRCaW5kR3JvdXAoMCwgYmluZClcbiAgY29uc3QgW2R4LCBkeSwgZHpdID0ga2VyLmRpc3BhdGNoKHsgTSwgTiB9KVxuICBwYXNzLmRpc3BhdGNoV29ya2dyb3VwcyhkeCwgZHksIGR6KVxuICBwYXNzLmVuZCgpXG5cbiAgbm90aWZ5KCc1LzkgU3VibWl0dGluZyBHUFUgd29yay4uLicpXG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlcXVlc3RBbmltYXRpb25GcmFtZSlcblxuICBjb25zdCBncHVTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpXG4gIGRldmljZS5xdWV1ZS5zdWJtaXQoW2VuY29kZXIuZmluaXNoKCldKVxuXG4gIG5vdGlmeSgnNi85IEdQVSBjb21wdXRpbmcuLi4nKVxuICBhd2FpdCBkZXZpY2UucXVldWUub25TdWJtaXR0ZWRXb3JrRG9uZSgpXG4gIGNvbnN0IGdwdUVuZCA9IHBlcmZvcm1hbmNlLm5vdygpXG4gIGNvbnN0IGdwdU1zID0gZ3B1RW5kIC0gZ3B1U3RhcnRcblxuICBub3RpZnkoJzcvOSBSZWFkaW5nIGJhY2sgcmVzdWx0cy4uLicpXG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlcXVlc3RBbmltYXRpb25GcmFtZSlcblxuICBjb25zdCByZWFkQnVmID0gY3JlYXRlQnVmZmVyKGRldmljZSwgc2l6ZUJ5dGVzQywgR1BVQnVmZmVyVXNhZ2UuQ09QWV9EU1QgfCBHUFVCdWZmZXJVc2FnZS5NQVBfUkVBRClcbiAgY29uc3QgZW5jMiA9IGRldmljZS5jcmVhdGVDb21tYW5kRW5jb2RlcigpXG4gIGVuYzIuY29weUJ1ZmZlclRvQnVmZmVyKGNCdWYsIDAsIHJlYWRCdWYsIDAsIHNpemVCeXRlc0MpXG4gIGRldmljZS5xdWV1ZS5zdWJtaXQoW2VuYzIuZmluaXNoKCldKVxuICBhd2FpdCByZWFkQnVmLm1hcEFzeW5jKEdQVU1hcE1vZGUuUkVBRClcbiAgY29uc3QgQyA9IG5ldyBGbG9hdDMyQXJyYXkocmVhZEJ1Zi5nZXRNYXBwZWRSYW5nZSgpLnNsaWNlKDApKVxuICByZWFkQnVmLnVubWFwKClcblxuICBsZXQgY2hlY2sgPSBudWxsXG4gIGxldCBjcHVUaW1lID0gbnVsbFxuICBpZiAodmVyaWZ5ICYmIE0gKiBLIDw9IDEwMjQgKiAxMDI0ICYmIEsgKiBOIDw9IDEwMjQgKiAxMDI0KSB7XG4gICAgbm90aWZ5KCc4LzkgQ1BVIHZlcmlmaWNhdGlvbi4uLicpXG4gICAgYXdhaXQgbmV3IFByb21pc2UocmVxdWVzdEFuaW1hdGlvbkZyYW1lKVxuXG4gICAgY29uc3QgY3B1U3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKVxuICAgIGNvbnN0IHJlZiA9IGNwdU1hdG11bChBLCBCLCBNLCBLLCBOKVxuICAgIGNvbnN0IGNwdUVuZCA9IHBlcmZvcm1hbmNlLm5vdygpXG4gICAgY3B1VGltZSA9IGNwdUVuZCAtIGNwdVN0YXJ0XG5cbiAgICBsZXQgbWF4QWJzID0gMFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZWxlbUM7IGkrKykgbWF4QWJzID0gTWF0aC5tYXgobWF4QWJzLCBNYXRoLmFicyhyZWZbaV0gLSBDW2ldKSlcbiAgICBjaGVjayA9IHsgbWF4QWJzLCBjcHVUaW1lIH1cbiAgfSBlbHNlIGlmICh2ZXJpZnkpIHtcbiAgICBub3RpZnkoJzgvOSBTa2lwcGluZyBDUFUgdmVyaWZpY2F0aW9uICh0b28gbGFyZ2UpLi4uJylcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXF1ZXN0QW5pbWF0aW9uRnJhbWUpXG4gIH0gZWxzZSB7XG4gICAgbm90aWZ5KCc4LzkgQ1BVIHZlcmlmaWNhdGlvbiBkaXNhYmxlZCcpXG4gICAgYXdhaXQgbmV3IFByb21pc2UocmVxdWVzdEFuaW1hdGlvbkZyYW1lKVxuICB9XG5cbiAgY29uc3QgdG90YWxFbmQgPSBwZXJmb3JtYW5jZS5ub3coKVxuICBjb25zdCB0b3RhbE1zID0gdG90YWxFbmQgLSB0b3RhbFN0YXJ0XG5cbiAgbm90aWZ5KCc5LzkgQ29tcGxldGUhJywgZmFsc2UpXG5cbiAgY29uc3QgZmxvcHMgPSAyICogTSAqIEsgKiBOXG4gIGNvbnN0IGdmbG9wcyA9IGZsb3BzIC8gKGdwdU1zIC8gMTAwMCkgLyAxZTlcbiAgY29uc3QgY3B1R2Zsb3BzID0gY3B1VGltZSA/IGZsb3BzIC8gKGNwdVRpbWUgLyAxMDAwKSAvIDFlOSA6IG51bGxcblxuICByZXR1cm4ge1xuICAgIG1zOiBncHVNcyxcbiAgICB0b3RhbE1zLFxuICAgIGdmbG9wcyxcbiAgICBNLFxuICAgIEssXG4gICAgTixcbiAgICBrZXJuZWw6IGtlci5sYWJlbCxcbiAgICBrZXJuZWxLZXk6IGtlci5rZXksXG4gICAgZHgsXG4gICAgZHksXG4gICAgZHosXG4gICAgY2hlY2ssXG4gICAgY3B1VGltZSxcbiAgICBjcHVHZmxvcHNcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIFdyYXAgcnVuTWF0bXVsIHRvIHN1cmZhY2UgZXhjZXB0aW9ucyBhcyBlcnJvciBvYmplY3RzIHNvIFVJIGNhbiBkaXNwbGF5IHRoZW1cbmFzeW5jIGZ1bmN0aW9uIHJ1bk1hdG11bFNhZmUoZGltcywga2VybmVsLCB2ZXJpZnkpIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgcnVuTWF0bXVsKGRpbXMsIGtlcm5lbCwgdmVyaWZ5KVxuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIHsgZXJyb3I6IChlICYmIGUubWVzc2FnZSkgPyBlLm1lc3NhZ2UgOiBTdHJpbmcoZSkgfVxuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibXV0YWJsZSBjb21wdXRlX3N0YXR1cyA9ICh7XG4gIHN0YXRlOiAnaWRsZScsXG4gIG1lc3NhZ2U6ICdJZGxlIOKAlCByZWFkeSdcbn0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibXV0YWJsZSBzdGF0dXNfdHJpZ2dlciA9IDBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJjb21wdXRlX3N0YXR1c192YWx1ZSA9IHtcbiAgc3RhdHVzX3RyaWdnZXI7IC8vIEZvcmNlIGRlcGVuZGVuY3kgb24gdHJpZ2dlclxuICByZXR1cm4gbXV0YWJsZSBjb21wdXRlX3N0YXR1cztcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBXZWJHUFUgTWF0cml4IE11bHRpcGxpY2F0aW9uIFJ1bm5lciAtIG9ubHkgZXhlY3V0ZXMgb24gYnV0dG9uIGNsaWNrXG5yZXN1bHRzID0ge1xuICBpZiAoIXJ1bikge1xuICAgIG11dGFibGUgY29tcHV0ZV9zdGF0dXMgPSB7IHN0YXRlOiAnaWRsZScsIG1lc3NhZ2U6ICdJZGxlIOKAlCByZWFkeScgfVxuICAgIG11dGFibGUgc3RhdHVzX3RyaWdnZXIgPSBtdXRhYmxlIHN0YXR1c190cmlnZ2VyICsgMVxuICAgIHJldHVybiBudWxsXG4gIH1cblxuICAvLyBDYXB0dXJlIGN1cnJlbnQgdmFsdWVzIGF0IGJ1dHRvbiBjbGljayB0aW1lXG4gIGNvbnN0IGN1cnJlbnREaW1zID0ge1xuICAgIE06IE1hdGgubWF4KDEsIE1hdGguZmxvb3IoTnVtYmVyKG11dGFibGUgbV92YWx1ZSkgfHwgMCkpLFxuICAgIEs6IE1hdGgubWF4KDEsIE1hdGguZmxvb3IoTnVtYmVyKG11dGFibGUga192YWx1ZSkgfHwgMCkpLFxuICAgIE46IE1hdGgubWF4KDEsIE1hdGguZmxvb3IoTnVtYmVyKG11dGFibGUgbl92YWx1ZSkgfHwgMCkpXG4gIH1cbiAgY29uc3QgY3VycmVudEtlcm5lbFZhbHVlID0gbXV0YWJsZSBrZXJuZWxfdmFsdWVcbiAgY29uc3QgY3VycmVudEtlcm5lbCA9IG5vcm1hbGl6ZUtlcm5lbEtleShjdXJyZW50S2VybmVsVmFsdWUpXG4gIGNvbnN0IGN1cnJlbnRWZXJpZnkgPSAhIW11dGFibGUgdmVyaWZ5X3ZhbHVlXG5cbiAgY29uc3Qga2VybmVsSW5mbyA9IGtlcm5lbHMuZmluZChrID0+IGsua2V5ID09PSBjdXJyZW50S2VybmVsKVxuICBjb25zdCBrZXJuZWxMYWJlbCA9IGtlcm5lbEluZm8/LmxhYmVsID8/IFN0cmluZyhjdXJyZW50S2VybmVsKVxuICBcbiAgaWYgKCF3ZWJncHVfb2spIHtcbiAgICBjb25zdCBlcnJvciA9ICdXZWJHUFUgbm90IGF2YWlsYWJsZSdcbiAgICBtdXRhYmxlIGNvbXB1dGVfc3RhdHVzID0geyBzdGF0ZTogJ2Vycm9yJywgbWVzc2FnZTogZXJyb3IsIGVycm9yLCBrZXJuZWxMYWJlbCwgZGltczogY3VycmVudERpbXMgfVxuICAgIG11dGFibGUgc3RhdHVzX3RyaWdnZXIgPSBtdXRhYmxlIHN0YXR1c190cmlnZ2VyICsgMVxuICAgIHJldHVybiB7IGVycm9yIH1cbiAgfVxuICBcbiAgaWYgKCFkZXZpY2UpIHtcbiAgICBjb25zdCBlcnJvciA9ICdObyBXZWJHUFUgZGV2aWNlJ1xuICAgIG11dGFibGUgY29tcHV0ZV9zdGF0dXMgPSB7IHN0YXRlOiAnZXJyb3InLCBtZXNzYWdlOiBlcnJvciwgZXJyb3IsIGtlcm5lbExhYmVsLCBkaW1zOiBjdXJyZW50RGltcyB9XG4gICAgbXV0YWJsZSBzdGF0dXNfdHJpZ2dlciA9IG11dGFibGUgc3RhdHVzX3RyaWdnZXIgKyAxXG4gICAgcmV0dXJuIHsgZXJyb3IgfVxuICB9XG5cbiAgbXV0YWJsZSBjb21wdXRlX3N0YXR1cyA9IHtcbiAgICBzdGF0ZTogJ3J1bm5pbmcnLFxuICAgIG1lc3NhZ2U6IGBSdW5uaW5nICR7a2VybmVsTGFiZWx9IOKAlCAke2N1cnJlbnREaW1zLk19w5cke2N1cnJlbnREaW1zLkt9w5cke2N1cnJlbnREaW1zLk59YCxcbiAgICBzcGlubmVyOiB0cnVlLFxuICAgIGtlcm5lbExhYmVsLFxuICAgIGRpbXM6IGN1cnJlbnREaW1zXG4gIH1cbiAgbXV0YWJsZSBzdGF0dXNfdHJpZ2dlciA9IG11dGFibGUgc3RhdHVzX3RyaWdnZXIgKyAxXG5cbiAgLy8gWWllbGQgdG8gdGhlIGJyb3dzZXIgc28gdGhlIHN0YXR1cyBwYW5lbCBjYW4gcmVmcmVzaCBiZWZvcmUgdGhlIEdQVSB3b3JrIGZpbmlzaGVzLlxuICBhd2FpdCBuZXcgUHJvbWlzZShyZXF1ZXN0QW5pbWF0aW9uRnJhbWUpXG4gIFxuICB0cnkge1xuICAgIGNvbnN0IHsgTSwgSywgTiB9ID0gY3VycmVudERpbXNcbiAgICBjb25zdCB0b3RhbE1CID0gKE0gKiBLICsgSyAqIE4gKyBNICogTikgKiA0IC8gMTAyNCAvIDEwMjRcbiAgICBcbiAgICAvLyBTdGF0dXMgY2FsbGJhY2sgdG8gdXBkYXRlIHBoYXNlIC8gc3Bpbm5lciBzdGF0ZVxuICAgIGNvbnN0IHVwZGF0ZVN0YXR1cyA9IChzdGF0dXNVcGRhdGUpID0+IHtcbiAgICAgIGNvbnN0IHsgbWVzc2FnZSwgc3Bpbm5pbmcgPSB0cnVlIH0gPSAodHlwZW9mIHN0YXR1c1VwZGF0ZSA9PT0gJ3N0cmluZycpXG4gICAgICAgID8geyBtZXNzYWdlOiBzdGF0dXNVcGRhdGUsIHNwaW5uaW5nOiB0cnVlIH1cbiAgICAgICAgOiBzdGF0dXNVcGRhdGUgfHwge31cbiAgICAgIG11dGFibGUgY29tcHV0ZV9zdGF0dXMgPSB7XG4gICAgICAgIHN0YXRlOiAncnVubmluZycsXG4gICAgICAgIG1lc3NhZ2U6IGAke2tlcm5lbExhYmVsfSDigJQgJHttZXNzYWdlfWAsXG4gICAgICAgIHNwaW5uZXI6ICEhc3Bpbm5pbmcsXG4gICAgICAgIGtlcm5lbExhYmVsLFxuICAgICAgICBkaW1zOiBjdXJyZW50RGltc1xuICAgICAgfVxuICAgICAgbXV0YWJsZSBzdGF0dXNfdHJpZ2dlciA9IG11dGFibGUgc3RhdHVzX3RyaWdnZXIgKyAxXG4gICAgfVxuICAgIFxuICAvLyBDYWxsIHRoZSBjb21wdXRhdGlvbiB3aXRoIGNhcHR1cmVkIHZhbHVlcyBhbmQgc3RhdHVzIGNhbGxiYWNrXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcnVuTWF0bXVsKGN1cnJlbnREaW1zLCBjdXJyZW50S2VybmVsLCBjdXJyZW50VmVyaWZ5LCB1cGRhdGVTdGF0dXMpXG4gICAgXG4gICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgIGNvbnN0IGVycm9yID0gJ3J1bk1hdG11bCByZXR1cm5lZCBudWxsL3VuZGVmaW5lZCdcbiAgICAgIG11dGFibGUgY29tcHV0ZV9zdGF0dXMgPSB7IHN0YXRlOiAnZXJyb3InLCBtZXNzYWdlOiBlcnJvciwgZXJyb3IsIGtlcm5lbExhYmVsLCBkaW1zOiBjdXJyZW50RGltcyB9XG4gICAgICBtdXRhYmxlIHN0YXR1c190cmlnZ2VyID0gbXV0YWJsZSBzdGF0dXNfdHJpZ2dlciArIDFcbiAgICAgIHJldHVybiB7IGVycm9yIH1cbiAgICB9XG4gICAgXG4gICAgaWYgKHJlc3VsdC5lcnJvcikge1xuICAgICAgY29uc3QgZXJyb3IgPSByZXN1bHQuZXJyb3JcbiAgICAgIG11dGFibGUgY29tcHV0ZV9zdGF0dXMgPSB7IHN0YXRlOiAnZXJyb3InLCBtZXNzYWdlOiBlcnJvciwgZXJyb3IsIGtlcm5lbExhYmVsLCBkaW1zOiBjdXJyZW50RGltcyB9XG4gICAgICBtdXRhYmxlIHN0YXR1c190cmlnZ2VyID0gbXV0YWJsZSBzdGF0dXNfdHJpZ2dlciArIDFcbiAgICAgIHJldHVybiB7IGVycm9yIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQWRkIG1ldGFkYXRhIGZvciBkaXNwbGF5IGFuZCBhcHBlbmQgdG8gaGlzdG9yeVxuICAgIGNvbnN0IGVucmljaGVkID0geyBcbiAgICAgIC4uLnJlc3VsdCwgXG4gICAgICB0b3RhbE1CLCBcbiAgICAgIHJ1bk51bWJlcjogcnVuIFxuICAgIH1cblxuICAvLyBBcHBlbmQgdG8gaGlzdG9yeSB2aWEgY2FjaGUgdG8gYXZvaWQgc2VsZi1kZXBlbmRlbmN5IGxvb3BzXG4gIGNvbnN0IHVwZGF0ZWRIaXN0b3J5ID0gcmVzdWx0c19oaXN0b3J5X2NhY2hlLnB1c2goZW5yaWNoZWQpXG4gIG11dGFibGUgcmVzdWx0c19oaXN0b3J5ID0gdXBkYXRlZEhpc3RvcnlcblxuICAgIG11dGFibGUgY29tcHV0ZV9zdGF0dXMgPSB7XG4gICAgICBzdGF0ZTogJ2RvbmUnLFxuICAgICAgbWVzc2FnZTogYENvbXBsZXRlZCAke2tlcm5lbExhYmVsfSBpbiAke2VucmljaGVkLm1zLnRvRml4ZWQoMil9IG1zIEdQVSAoJHtlbnJpY2hlZC50b3RhbE1zLnRvRml4ZWQoMil9IG1zIHRvdGFsKWAsXG4gICAgICBrZXJuZWxMYWJlbCxcbiAgICAgIGRpbXM6IGN1cnJlbnREaW1zLFxuICAgICAgZ3B1VGltZU1zOiBlbnJpY2hlZC5tcyxcbiAgICAgIHRvdGFsVGltZU1zOiBlbnJpY2hlZC50b3RhbE1zLFxuICAgICAgZ3B1R2Zsb3BzOiBlbnJpY2hlZC5nZmxvcHMsXG4gICAgICBzcGlubmVyOiBmYWxzZVxuICAgIH1cbiAgICBtdXRhYmxlIHN0YXR1c190cmlnZ2VyID0gbXV0YWJsZSBzdGF0dXNfdHJpZ2dlciArIDFcblxuICAgIHJldHVybiBlbnJpY2hlZFxuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc3QgZXJyb3IgPSBlLm1lc3NhZ2UgfHwgZS50b1N0cmluZygpXG4gICAgbXV0YWJsZSBjb21wdXRlX3N0YXR1cyA9IHsgc3RhdGU6ICdlcnJvcicsIG1lc3NhZ2U6IGVycm9yLCBlcnJvciwga2VybmVsTGFiZWwsIGRpbXM6IGN1cnJlbnREaW1zIH1cbiAgICBtdXRhYmxlIHN0YXR1c190cmlnZ2VyID0gbXV0YWJsZSBzdGF0dXNfdHJpZ2dlciArIDFcbiAgICByZXR1cm4geyBlcnJvciB9XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJzdGF0dXNfcGFuZWwgPSB7XG4gIGNvbnN0IHN0YXR1cyA9IGNvbXB1dGVfc3RhdHVzX3ZhbHVlIHx8IHsgc3RhdGU6ICdpZGxlJywgbWVzc2FnZTogJ0lkbGUg4oCUIHJlYWR5JyB9XG4gIGNvbnN0IGNvbnRhaW5lciA9IGh0bWxgPGRpdiBjbGFzcz1cImNhbGxvdXQgc3RhdHVzLXBhbmVsXCI+PC9kaXY+YFxuICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChzdGF0dXMuc3RhdGUgPT09ICdlcnJvcicgPyAnY2FsbG91dC13YXJuaW5nJyA6ICdjYWxsb3V0LW5vdGUnKVxuXG4gIGlmIChzdGF0dXMuc3RhdGUgPT09ICdydW5uaW5nJyAmJiBzdGF0dXMuc3Bpbm5lcikge1xuICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXR1cy1zcGlubmVyLXN0eWxlJykpIHtcbiAgICAgIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKVxuICAgICAgc3R5bGUuaWQgPSAnc3RhdHVzLXNwaW5uZXItc3R5bGUnXG4gICAgICBzdHlsZS50ZXh0Q29udGVudCA9IGBcbiAgICAgICAgLnN0YXR1cy1zcGlubmVyIHtcbiAgICAgICAgICB3aWR0aDogMS4yNXJlbTtcbiAgICAgICAgICBoZWlnaHQ6IDEuMjVyZW07XG4gICAgICAgICAgYm9yZGVyOiAycHggc29saWQgcmdiYSgwLDAsMCwwLjEpO1xuICAgICAgICAgIGJvcmRlci10b3AtY29sb3I6IHJnYmEoMCwwLDAsMC42KTtcbiAgICAgICAgICBib3JkZXItcmFkaXVzOiA5OTk5cHg7XG4gICAgICAgICAgYW5pbWF0aW9uOiBzdGF0dXMtc3BpbiAwLjhzIGxpbmVhciBpbmZpbml0ZTtcbiAgICAgICAgICBtYXJnaW4tYm90dG9tOiAwLjVyZW07XG4gICAgICAgIH1cbiAgICAgICAgQGtleWZyYW1lcyBzdGF0dXMtc3BpbiB7XG4gICAgICAgICAgdG8geyB0cmFuc2Zvcm06IHJvdGF0ZSgzNjBkZWcpOyB9XG4gICAgICAgIH1cbiAgICAgIGBcbiAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kKHN0eWxlKVxuICAgIH1cbiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICBzcGlubmVyLmNsYXNzTmFtZSA9ICdzdGF0dXMtc3Bpbm5lcidcbiAgICBjb250YWluZXIuYXBwZW5kKHNwaW5uZXIpXG4gIH1cblxuICBjb25zdCBoZWFkaW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgaGVhZGluZy5zdHlsZS5mb250V2VpZ2h0ID0gJzYwMCdcbiAgaGVhZGluZy50ZXh0Q29udGVudCA9IHN0YXR1cy5tZXNzYWdlID8/ICdJZGxlIOKAlCByZWFkeSdcbiAgY29udGFpbmVyLmFwcGVuZChoZWFkaW5nKVxuXG4gIGlmIChzdGF0dXMuc3RhdGUgPT09ICdkb25lJyAmJiBOdW1iZXIuaXNGaW5pdGUoc3RhdHVzLmdwdUdmbG9wcykpIHtcbiAgICBjb25zdCBkZXRhaWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgIGRldGFpbC50ZXh0Q29udGVudCA9IGAke3N0YXR1cy5rZXJuZWxMYWJlbCA/PyAnJ30g4oCUICR7c3RhdHVzLmdwdUdmbG9wcy50b0ZpeGVkKDIpfSBHRkxPUC9zYFxuICAgIGNvbnRhaW5lci5hcHBlbmQoZGV0YWlsKVxuICB9IGVsc2UgaWYgKHN0YXR1cy5zdGF0ZSA9PT0gJ2Vycm9yJyAmJiBzdGF0dXMuZXJyb3IpIHtcbiAgICBjb25zdCBkZXRhaWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgIGRldGFpbC50ZXh0Q29udGVudCA9IHN0YXR1cy5lcnJvclxuICAgIGNvbnRhaW5lci5hcHBlbmQoZGV0YWlsKVxuICB9IGVsc2UgaWYgKHN0YXR1cy5kaW1zKSB7XG4gICAgY29uc3QgZGltcyA9IHN0YXR1cy5kaW1zXG4gICAgY29uc3QgZGV0YWlsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICBkZXRhaWwudGV4dENvbnRlbnQgPSBgRGltczogJHtkaW1zLk19w5cke2RpbXMuS33DlyR7ZGltcy5OfWBcbiAgICBjb250YWluZXIuYXBwZW5kKGRldGFpbClcbiAgfVxuXG4gIHJldHVybiBjb250YWluZXJcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJodG1sYCR7c3RhdHVzX3BhbmVsfWBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBEaXNwbGF5IHJlc3VsdHMgLSBzaG93cyBhbGwgcmVzdWx0cyBpbiBoaXN0b3J5XG5yZXN1bHRzX3RhYmxlID0ge1xuICBjbGVhcl9oYW5kbGVyOyAvLyBSZWFjdCB0byBjbGVhciBidXR0b25cbiAgXG4gIGNvbnN0IGhpc3RvcnkgPSByZXN1bHRzX2hpc3RvcnkgfHwgW11cbiAgLy8gY29uc29sZS5sb2coJ1tyZXN1bHRzX3RhYmxlXSBoaXN0b3J5IGxlbmd0aDonLCBoaXN0b3J5Lmxlbmd0aCwgaGlzdG9yeSlcbiAgXG4gIGlmIChoaXN0b3J5Lmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBodG1sYDxlbT5DbGljayBSdW4gbWF0bXVsIHRvIGV4ZWN1dGUgdGhlIHNlbGVjdGVkIGtlcm5lbC4gUmVzdWx0cyB3aWxsIGJlIGFkZGVkIHRvIHRoZSB0YWJsZSBiZWxvdy48L2VtPmBcbiAgfVxuICBcbiAgLy8gQ29udmVydCBhbGwgcmVzdWx0cyB0byB0YWJsZSByb3dzXG4gIGNvbnN0IHRhYmxlUm93cyA9IGhpc3RvcnkubWFwKHJlc3VsdCA9PiB7XG4gICAgY29uc3QgdGFibGVSb3cgPSB7XG4gICAgICBydW5OdW1iZXI6IHJlc3VsdC5ydW5OdW1iZXIsXG4gICAgICBrZXJuZWw6IHJlc3VsdC5rZXJuZWwsXG4gICAgICBzaGFwZTogeyBNOiByZXN1bHQuTSwgSzogcmVzdWx0LkssIE46IHJlc3VsdC5OIH0sXG4gICAgICBtZW1vcnlNQjogcmVzdWx0LnRvdGFsTUIsXG4gICAgICBkaXNwYXRjaDogW3Jlc3VsdC5keCwgcmVzdWx0LmR5LCByZXN1bHQuZHpdLFxuICAgICAgZ3B1VGltZU1zOiByZXN1bHQubXMsXG4gICAgICB0b3RhbFRpbWVNczogcmVzdWx0LnRvdGFsTXMsXG4gICAgICBncHVHZmxvcHM6IHJlc3VsdC5nZmxvcHMsXG4gICAgICBjcHVUaW1lTXM6IHJlc3VsdC5jcHVUaW1lLFxuICAgICAgY3B1R2Zsb3BzOiByZXN1bHQuY3B1R2Zsb3BzLFxuICAgICAgc3BlZWR1cDogKE51bWJlci5pc0Zpbml0ZShyZXN1bHQuY3B1VGltZSkgJiYgTnVtYmVyLmlzRmluaXRlKHJlc3VsdC5tcykgJiYgcmVzdWx0Lm1zID4gMClcbiAgICAgICAgPyByZXN1bHQuY3B1VGltZSAvIHJlc3VsdC5tc1xuICAgICAgICA6IG51bGwsXG4gICAgICBtYXhBYnM6IHJlc3VsdC5jaGVjaz8ubWF4QWJzID8/IG51bGxcbiAgICB9XG5cbiAgICBjb25zdCBkYXNoID0gJ+KAlCdcbiAgICByZXR1cm4ge1xuICAgICAgJ1J1bic6IGAjJHt0YWJsZVJvdy5ydW5OdW1iZXJ9YCxcbiAgICAgICdLZXJuZWwnOiB0YWJsZVJvdy5rZXJuZWwsXG4gICAgICAnU2hhcGUnOiBgKCR7dGFibGVSb3cuc2hhcGUuTX3DlyR7dGFibGVSb3cuc2hhcGUuS30pIMK3ICgke3RhYmxlUm93LnNoYXBlLkt9w5cke3RhYmxlUm93LnNoYXBlLk59KSDihpIgKCR7dGFibGVSb3cuc2hhcGUuTX3DlyR7dGFibGVSb3cuc2hhcGUuTn0pYCxcbiAgICAgICdNZW1vcnknOiBOdW1iZXIuaXNGaW5pdGUodGFibGVSb3cubWVtb3J5TUIpID8gYCR7dGFibGVSb3cubWVtb3J5TUIudG9GaXhlZCgxKX0gTUJgIDogZGFzaCxcbiAgICAgICdEaXNwYXRjaCc6IGBbJHt0YWJsZVJvdy5kaXNwYXRjaFswXX0sICR7dGFibGVSb3cuZGlzcGF0Y2hbMV19LCAke3RhYmxlUm93LmRpc3BhdGNoWzJdfV1gLFxuICAgICAgJ0dQVSBUaW1lJzogTnVtYmVyLmlzRmluaXRlKHRhYmxlUm93LmdwdVRpbWVNcykgPyBgJHt0YWJsZVJvdy5ncHVUaW1lTXMudG9GaXhlZCgyKX0gbXNgIDogZGFzaCxcbiAgICAgICdUb3RhbCBUaW1lJzogTnVtYmVyLmlzRmluaXRlKHRhYmxlUm93LnRvdGFsVGltZU1zKSA/IGAke3RhYmxlUm93LnRvdGFsVGltZU1zLnRvRml4ZWQoMil9IG1zYCA6IGRhc2gsXG4gICAgICAnR1BVIFRocm91Z2hwdXQnOiBOdW1iZXIuaXNGaW5pdGUodGFibGVSb3cuZ3B1R2Zsb3BzKSA/IGAke3RhYmxlUm93LmdwdUdmbG9wcy50b0ZpeGVkKDIpfSBHRkxPUC9zYCA6IGRhc2gsXG4gICAgICAnQ1BVIFRpbWUnOiBOdW1iZXIuaXNGaW5pdGUodGFibGVSb3cuY3B1VGltZU1zKSA/IGAke3RhYmxlUm93LmNwdVRpbWVNcy50b0ZpeGVkKDIpfSBtc2AgOiBkYXNoLFxuICAgICAgJ0NQVSBUaHJvdWdocHV0JzogTnVtYmVyLmlzRmluaXRlKHRhYmxlUm93LmNwdUdmbG9wcykgPyBgJHt0YWJsZVJvdy5jcHVHZmxvcHMudG9GaXhlZCgyKX0gR0ZMT1Avc2AgOiBkYXNoLFxuICAgICAgJ0dQVSBTcGVlZHVwJzogTnVtYmVyLmlzRmluaXRlKHRhYmxlUm93LnNwZWVkdXApID8gYCR7dGFibGVSb3cuc3BlZWR1cC50b0ZpeGVkKDEpfcOXYCA6IGRhc2gsXG4gICAgICAnTWF4IHzOlHwgdnMgQ1BVJzogTnVtYmVyLmlzRmluaXRlKHRhYmxlUm93Lm1heEFicykgPyB0YWJsZVJvdy5tYXhBYnMudG9FeHBvbmVudGlhbCgyKSA6IGRhc2hcbiAgICB9XG4gIH0pXG5cbiAgcmV0dXJuIElucHV0cy50YWJsZSh0YWJsZVJvd3MsIHtcbiAgICBzb3J0OiBcIlJ1blwiLFxuICAgIHJldmVyc2U6IHRydWUgLy8gU2hvdyBuZXdlc3QgcmVzdWx0cyBmaXJzdFxuICB9KVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Imh0bWxgJHtyZXN1bHRzX3RhYmxlfWBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJyZXN1bHRzX3Bsb3RfZGF0YSA9IHtcbiAgY2xlYXJfaGFuZGxlcjtcbiAgY29uc3QgaGlzdG9yeSA9IHJlc3VsdHNfaGlzdG9yeSB8fCBbXVxuICByZXR1cm4gaGlzdG9yeS5tYXAoKGVudHJ5LCBpbmRleCkgPT4gKHtcbiAgICBydW5OdW1iZXI6IGVudHJ5LnJ1bk51bWJlciA/PyAoaW5kZXggKyAxKSxcbiAgICBrZXJuZWw6IGVudHJ5Lmtlcm5lbCxcbiAgICBrZXJuZWxLZXk6IGVudHJ5Lmtlcm5lbEtleSA/PyBlbnRyeS5rZXJuZWwsXG4gICAgdG90YWxNczogZW50cnkudG90YWxNcyA/PyBlbnRyeS5tcyA/PyBudWxsLFxuICAgIGdwdU1zOiBlbnRyeS5tcyA/PyBudWxsLFxuICAgIGdwdUdmbG9wczogZW50cnkuZ2Zsb3BzID8/IG51bGwsXG4gICAgY3B1R2Zsb3BzOiBlbnRyeS5jcHVHZmxvcHMgPz8gbnVsbCxcbiAgICBtZW1vcnlNQjogZW50cnkudG90YWxNQiA/PyBudWxsLFxuICAgIGRpbXM6IGVudHJ5LmRpbXMgPz8geyBNOiBlbnRyeS5NLCBLOiBlbnRyeS5LLCBOOiBlbnRyeS5OIH1cbiAgfSkpXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGxvdF9rZXJuZWxfY29sb3JzID0ge1xuICBjb25zdCBwYWxldHRlID0gW1xuICAgIFwiIzFmNzdiNFwiLFxuICAgIFwiI2ZmN2YwZVwiLFxuICAgIFwiIzJjYTAyY1wiLFxuICAgIFwiI2Q2MjcyOFwiLFxuICAgIFwiIzk0NjdiZFwiLFxuICAgIFwiIzhjNTY0YlwiLFxuICAgIFwiI2UzNzdjMlwiLFxuICAgIFwiIzdmN2Y3ZlwiLFxuICAgIFwiI2JjYmQyMlwiLFxuICAgIFwiIzE3YmVjZlwiXG4gIF1cbiAgY29uc3QgZG9tYWluID0ga2VybmVscy5tYXAoayA9PiBrLmxhYmVsKVxuICBjb25zdCByYW5nZSA9IGRvbWFpbi5tYXAoKF8sIGkpID0+IHBhbGV0dGVbaSAlIHBhbGV0dGUubGVuZ3RoXSlcbiAgcmV0dXJuIHsgZG9tYWluLCByYW5nZSB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicmVzdWx0c19wbG90cyA9IHtcbiAgY2xlYXJfaGFuZGxlcjtcbiAgY29uc3QgZGF0YSA9IHJlc3VsdHNfcGxvdF9kYXRhID8/IFtdXG4gIGlmICghZGF0YS5sZW5ndGgpIHtcbiAgICByZXR1cm4gaHRtbGA8ZW0+UnVuIG1hdG11bCB0byBwb3B1bGF0ZSB0aW1pbmcgYW5kIHRocm91Z2hwdXQgY2hhcnRzLjwvZW0+YFxuICB9XG5cbiAgY29uc3QgeyBkb21haW4sIHJhbmdlIH0gPSBwbG90X2tlcm5lbF9jb2xvcnNcblxuICBjb25zdCB0aHJvdWdocHV0RGF0YSA9IGRhdGEuZmlsdGVyKGQgPT4gTnVtYmVyLmlzRmluaXRlKGQuZ3B1R2Zsb3BzKSlcbiAgY29uc3QgdG90YWxUaW1lRGF0YSA9IGRhdGEuZmlsdGVyKGQgPT4gTnVtYmVyLmlzRmluaXRlKGQudG90YWxNcykpXG5cbiAgaWYgKCF0aHJvdWdocHV0RGF0YS5sZW5ndGggJiYgIXRvdGFsVGltZURhdGEubGVuZ3RoKSB7XG4gICAgcmV0dXJuIGh0bWxgPGVtPk5vIHJlc3VsdHMgd2l0aCB0aHJvdWdocHV0IG9yIHRvdGFsIHRpbWUgYXZhaWxhYmxlIHlldC48L2VtPmBcbiAgfVxuXG4gIC8vIENhbGN1bGF0ZSBkeW5hbWljIHRpY2tzIGJhc2VkIG9uIGRhdGEgcmFuZ2VcbiAgY29uc3QgbWVtb3J5RGF0YSA9IGRhdGEuZmlsdGVyKGQgPT4gTnVtYmVyLmlzRmluaXRlKGQubWVtb3J5TUIpKVxuICBsZXQgZHluYW1pY1RpY2tzID0gWzgsIDE2LCAzMiwgNjQsIDEyOCwgMjU2LCA1MTIsIDEwMjQsIDIwNDgsIDQwOTYsIDgxOTIsIDE2Mzg0XVxuICBcbiAgaWYgKG1lbW9yeURhdGEubGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IG1pbk1lbW9yeSA9IE1hdGgubWluKC4uLm1lbW9yeURhdGEubWFwKGQgPT4gZC5tZW1vcnlNQikpXG4gICAgY29uc3QgbWF4TWVtb3J5ID0gTWF0aC5tYXgoLi4ubWVtb3J5RGF0YS5tYXAoZCA9PiBkLm1lbW9yeU1CKSlcbiAgICBcbiAgICAvLyBJZiB0aGVyZSdzIG9ubHkgb25lIHVuaXF1ZSB2YWx1ZSBvciB2ZXJ5IGNsb3NlIHJhbmdlLCBzaG93IGZld2VyIHRpY2tzXG4gICAgaWYgKG1lbW9yeURhdGEubGVuZ3RoID09PSAxIHx8IChtYXhNZW1vcnkgLyBtaW5NZW1vcnkpIDwgMikge1xuICAgICAgLy8gRmluZCB0aGUgY2xvc2VzdCB0aWNrIHRvIHRoZSBhY3R1YWwgdmFsdWVcbiAgICAgIGNvbnN0IHRhcmdldE1lbW9yeSA9IG1lbW9yeURhdGFbMF0ubWVtb3J5TUJcbiAgICAgIGNvbnN0IGNsb3Nlc3RUaWNrID0gZHluYW1pY1RpY2tzLnJlZHVjZSgocHJldiwgY3VycikgPT4gXG4gICAgICAgIE1hdGguYWJzKGN1cnIgLSB0YXJnZXRNZW1vcnkpIDwgTWF0aC5hYnMocHJldiAtIHRhcmdldE1lbW9yeSkgPyBjdXJyIDogcHJldlxuICAgICAgKVxuICAgICAgZHluYW1pY1RpY2tzID0gW2Nsb3Nlc3RUaWNrXVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBGaWx0ZXIgdGlja3MgdG8gb25seSBzaG93IHJlbGV2YW50IHJhbmdlXG4gICAgICBkeW5hbWljVGlja3MgPSBkeW5hbWljVGlja3MuZmlsdGVyKHRpY2sgPT4gdGljayA+PSBtaW5NZW1vcnkgKiAwLjUgJiYgdGljayA8PSBtYXhNZW1vcnkgKiAyKVxuICAgIH1cbiAgfVxuXG4gIC8vIFByZXBhcmUgUGxvdGx5IGRhdGFcbiAgY29uc3QgdHJhY2VzID0gW11cbiAgXG4gIC8vIENyZWF0ZSBjb2xvciBtYXBwaW5nIGZvciBrZXJuZWxzXG4gIGNvbnN0IGNvbG9yTWFwID0ge31cbiAgZG9tYWluLmZvckVhY2goKGtlcm5lbCwgaSkgPT4ge1xuICAgIGNvbG9yTWFwW2tlcm5lbF0gPSByYW5nZVtpXVxuICB9KVxuXG4gIC8vIEdyb3VwIGRhdGEgYnkga2VybmVsIGZvciB0aHJvdWdocHV0IHRyYWNlc1xuICBjb25zdCBrZXJuZWxHcm91cHMgPSB7fVxuICB0aHJvdWdocHV0RGF0YS5mb3JFYWNoKGQgPT4ge1xuICAgIGlmICgha2VybmVsR3JvdXBzW2Qua2VybmVsXSkge1xuICAgICAga2VybmVsR3JvdXBzW2Qua2VybmVsXSA9IHsgdGhyb3VnaHB1dDogW10sIHRpbWU6IFtdIH1cbiAgICB9XG4gICAga2VybmVsR3JvdXBzW2Qua2VybmVsXS50aHJvdWdocHV0LnB1c2goZClcbiAgfSlcblxuICAvLyBHcm91cCB0aW1lIGRhdGEgYnkga2VybmVsXG4gIHRvdGFsVGltZURhdGEuZm9yRWFjaChkID0+IHtcbiAgICBpZiAoIWtlcm5lbEdyb3Vwc1tkLmtlcm5lbF0pIHtcbiAgICAgIGtlcm5lbEdyb3Vwc1tkLmtlcm5lbF0gPSB7IHRocm91Z2hwdXQ6IFtdLCB0aW1lOiBbXSB9XG4gICAgfVxuICAgIGtlcm5lbEdyb3Vwc1tkLmtlcm5lbF0udGltZS5wdXNoKGQpXG4gIH0pXG5cbiAgLy8gQ3JlYXRlIHRocm91Z2hwdXQgdHJhY2VzIChzb2xpZCBsaW5lcylcbiAgT2JqZWN0LmVudHJpZXMoa2VybmVsR3JvdXBzKS5mb3JFYWNoKChba2VybmVsLCBrZXJuZWxEYXRhXSkgPT4ge1xuICAgIGlmIChrZXJuZWxEYXRhLnRocm91Z2hwdXQubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3Qgc29ydGVkRGF0YSA9IGtlcm5lbERhdGEudGhyb3VnaHB1dC5zb3J0KChhLCBiKSA9PiBhLm1lbW9yeU1CIC0gYi5tZW1vcnlNQilcbiAgICAgIHRyYWNlcy5wdXNoKHtcbiAgICAgICAgeDogc29ydGVkRGF0YS5tYXAoZCA9PiBkLm1lbW9yeU1CKSxcbiAgICAgICAgeTogc29ydGVkRGF0YS5tYXAoZCA9PiBkLmdwdUdmbG9wcyksXG4gICAgICAgIG1vZGU6ICdsaW5lcyttYXJrZXJzJyxcbiAgICAgICAgdHlwZTogJ3NjYXR0ZXInLFxuICAgICAgICBuYW1lOiBrZXJuZWwsXG4gICAgICAgIGxpbmU6IHsgY29sb3I6IGNvbG9yTWFwW2tlcm5lbF0sIHdpZHRoOiAyIH0sXG4gICAgICAgIG1hcmtlcjogeyBjb2xvcjogY29sb3JNYXBba2VybmVsXSwgc2l6ZTogNiB9LFxuICAgICAgICBob3ZlcnRlbXBsYXRlOiBzb3J0ZWREYXRhLm1hcChkID0+IHtcbiAgICAgICAgICBjb25zdCBkaW1zID0gZC5kaW1zIHx8IHsgTTogJz8nLCBLOiAnPycsIE46ICc/JyB9XG4gICAgICAgICAgcmV0dXJuIGA8Yj4ke2Qua2VybmVsfTwvYj48YnI+YCArXG4gICAgICAgICAgICAgICAgIGBSdW46ICMke2QucnVuTnVtYmVyfTxicj5gICtcbiAgICAgICAgICAgICAgICAgYERpbXM6ICR7ZGltcy5NfcOXJHtkaW1zLkt9w5cke2RpbXMuTn08YnI+YCArXG4gICAgICAgICAgICAgICAgIGBNZW1vcnk6ICR7ZC5tZW1vcnlNQi50b0ZpeGVkKDEpfSBNQjxicj5gICtcbiAgICAgICAgICAgICAgICAgYEdQVSBUaHJvdWdocHV0OiAke2QuZ3B1R2Zsb3BzLnRvRml4ZWQoMil9IEdGTE9QL3M8ZXh0cmE+PC9leHRyYT5gXG4gICAgICAgIH0pLFxuICAgICAgICB5YXhpczogJ3kxJ1xuICAgICAgfSlcbiAgICB9XG4gIH0pXG5cbiAgLy8gQ2FsY3VsYXRlIHNjYWxpbmcgZm9yIHNlY29uZGFyeSB5LWF4aXNcbiAgY29uc3QgYmFzZVRocm91Z2hwdXRNYXggPSB0aHJvdWdocHV0RGF0YS5yZWR1Y2UoKGFjYywgZCkgPT4gTWF0aC5tYXgoYWNjLCBkLmdwdUdmbG9wcyksIDApXG4gIGNvbnN0IGJhc2VUaW1lTWF4ID0gdG90YWxUaW1lRGF0YS5yZWR1Y2UoKGFjYywgZCkgPT4gTWF0aC5tYXgoYWNjLCBkLnRvdGFsTXMpLCAwKVxuICBjb25zdCB5TWF4ID0gTWF0aC5tYXgoYmFzZVRocm91Z2hwdXRNYXgsIDEpXG4gIGNvbnN0IHRpbWVTY2FsZUZhY3RvciA9IGJhc2VUaW1lTWF4ID4gMCA/IHlNYXggLyBiYXNlVGltZU1heCA6IDFcblxuICAvLyBDcmVhdGUgdGltZSB0cmFjZXMgKGRhc2hlZCBsaW5lcykgb24gc2Vjb25kYXJ5IHktYXhpc1xuICBPYmplY3QuZW50cmllcyhrZXJuZWxHcm91cHMpLmZvckVhY2goKFtrZXJuZWwsIGtlcm5lbERhdGFdKSA9PiB7XG4gICAgaWYgKGtlcm5lbERhdGEudGltZS5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBzb3J0ZWREYXRhID0ga2VybmVsRGF0YS50aW1lLnNvcnQoKGEsIGIpID0+IGEubWVtb3J5TUIgLSBiLm1lbW9yeU1CKVxuICAgICAgdHJhY2VzLnB1c2goe1xuICAgICAgICB4OiBzb3J0ZWREYXRhLm1hcChkID0+IGQubWVtb3J5TUIpLFxuICAgICAgICB5OiBzb3J0ZWREYXRhLm1hcChkID0+IGQudG90YWxNcyksXG4gICAgICAgIG1vZGU6ICdsaW5lcyttYXJrZXJzJyxcbiAgICAgICAgdHlwZTogJ3NjYXR0ZXInLFxuICAgICAgICBuYW1lOiBgJHtrZXJuZWx9ICh0aW1lKWAsXG4gICAgICAgIGxpbmU6IHsgY29sb3I6IGNvbG9yTWFwW2tlcm5lbF0sIHdpZHRoOiAyLCBkYXNoOiAnZGFzaCcgfSxcbiAgICAgICAgbWFya2VyOiB7IFxuICAgICAgICAgIGNvbG9yOiAnd2hpdGUnLCBcbiAgICAgICAgICBzaXplOiA4LCBcbiAgICAgICAgICBsaW5lOiB7IGNvbG9yOiBjb2xvck1hcFtrZXJuZWxdLCB3aWR0aDogMiB9LFxuICAgICAgICAgIHN5bWJvbDogJ2Nyb3NzJ1xuICAgICAgICB9LFxuICAgICAgICBob3ZlcnRlbXBsYXRlOiBzb3J0ZWREYXRhLm1hcChkID0+IHtcbiAgICAgICAgICBjb25zdCBkaW1zID0gZC5kaW1zIHx8IHsgTTogJz8nLCBLOiAnPycsIE46ICc/JyB9XG4gICAgICAgICAgcmV0dXJuIGA8Yj4ke2Qua2VybmVsfTwvYj48YnI+YCArXG4gICAgICAgICAgICAgICAgIGBSdW46ICMke2QucnVuTnVtYmVyfTxicj5gICtcbiAgICAgICAgICAgICAgICAgYERpbXM6ICR7ZGltcy5NfcOXJHtkaW1zLkt9w5cke2RpbXMuTn08YnI+YCArXG4gICAgICAgICAgICAgICAgIGBNZW1vcnk6ICR7ZC5tZW1vcnlNQi50b0ZpeGVkKDEpfSBNQjxicj5gICtcbiAgICAgICAgICAgICAgICAgYFRvdGFsIFRpbWU6ICR7ZC50b3RhbE1zLnRvRml4ZWQoMil9IG1zPGV4dHJhPjwvZXh0cmE+YFxuICAgICAgICB9KSxcbiAgICAgICAgeWF4aXM6ICd5MicsXG4gICAgICAgIHNob3dsZWdlbmQ6IGZhbHNlXG4gICAgICB9KVxuICAgIH1cbiAgfSlcblxuICAvLyBBZGQgZHVtbXkgdHJhY2VzIGZvciBzZXJpZXMgc3R5bGUgbGVnZW5kXG4gIHRyYWNlcy5wdXNoKHtcbiAgICB4OiBbbnVsbF0sXG4gICAgeTogW251bGxdLFxuICAgIG1vZGU6ICdsaW5lcyttYXJrZXJzJyxcbiAgICB0eXBlOiAnc2NhdHRlcicsXG4gICAgbmFtZTogJ+KAlCBUaHJvdWdocHV0IChHRkxPUC9zKScsXG4gICAgbGluZTogeyBjb2xvcjogJyM2NjYnLCB3aWR0aDogMiB9LFxuICAgIG1hcmtlcjogeyBjb2xvcjogJyM2NjYnLCBzaXplOiA2IH0sXG4gICAgc2hvd2xlZ2VuZDogdHJ1ZSxcbiAgICB5YXhpczogJ3kxJ1xuICB9KVxuICBcbiAgdHJhY2VzLnB1c2goe1xuICAgIHg6IFtudWxsXSxcbiAgICB5OiBbbnVsbF0sXG4gICAgbW9kZTogJ2xpbmVzK21hcmtlcnMnLFxuICAgIHR5cGU6ICdzY2F0dGVyJyxcbiAgICBuYW1lOiAnLSAtIFRpbWUgKG1zKScsXG4gICAgbGluZTogeyBjb2xvcjogJyM2NjYnLCB3aWR0aDogMiwgZGFzaDogJ2Rhc2gnIH0sXG4gICAgbWFya2VyOiB7IFxuICAgICAgY29sb3I6ICd3aGl0ZScsIFxuICAgICAgc2l6ZTogOCwgXG4gICAgICBsaW5lOiB7IGNvbG9yOiAnIzY2NicsIHdpZHRoOiAyIH0sXG4gICAgICBzeW1ib2w6ICdjcm9zcydcbiAgICB9LFxuICAgIHNob3dsZWdlbmQ6IHRydWUsXG4gICAgeWF4aXM6ICd5MidcbiAgfSlcblxuICAvLyBDcmVhdGUgdGhlIHBsb3QgY29udGFpbmVyXG4gIGNvbnN0IGNvbnRhaW5lciA9IGh0bWxgPGRpdiBzdHlsZT1cIndpZHRoOiAxMDAlOyBoZWlnaHQ6IDQ1MHB4O1wiPjwvZGl2PmBcbiAgXG4gIC8vIFBsb3RseSBsYXlvdXRcbiAgY29uc3QgbGF5b3V0ID0ge1xuICAgIHRpdGxlOiB7XG4gICAgICB0ZXh0OiAnV2ViR1BVIE1hdHJpeCBNdWx0aXBsaWNhdGlvbiBQZXJmb3JtYW5jZScsXG4gICAgICAvLyB4OiAwLjUsXG4gICAgICAvLyB5OiAxLjUsXG4gICAgICAvLyB4YW5jaG9yOiAnY2VudGVyJyxcbiAgICAgIGZvbnQ6IHsgc2l6ZTogMTYgfVxuICAgIH0sXG4gICAgeGF4aXM6IHtcbiAgICAgIHR5cGU6ICdsb2cnLFxuICAgICAgdGl0bGU6ICdNZW1vcnkgKE1CKScsXG4gICAgICB0aWNrdmFsczogZHluYW1pY1RpY2tzLFxuICAgICAgdGlja3RleHQ6IGR5bmFtaWNUaWNrcy5tYXAoZCA9PiBkID49IDEgPyBgJHtkLnRvRml4ZWQoMCl9YCA6IGAke2QudG9GaXhlZCgxKX1gKVxuICAgIH0sXG4gICAgeWF4aXM6IHtcbiAgICAgIHRpdGxlOiAnR1BVIFRocm91Z2hwdXQgKEdGTE9QL3MpJyxcbiAgICAgIHNpZGU6ICdsZWZ0J1xuICAgIH0sXG4gICAgeWF4aXMyOiB7XG4gICAgICB0aXRsZTogJ1RvdGFsIFRpbWUgKG1zKScsXG4gICAgICBzaWRlOiAncmlnaHQnLFxuICAgICAgb3ZlcmxheWluZzogJ3knXG4gICAgfSxcbiAgICBsZWdlbmQ6IHtcbiAgICAgIHg6IDEuMyxcbiAgICAgIHk6IDAuOCxcbiAgICAgIHhhbmNob3I6ICdsZWZ0JyxcbiAgICAgIHlhbmNob3I6ICd0b3AnLFxuICAgICAgYmdjb2xvcjogJ3JnYmEoMjU1LDI1NSwyNTUsMC44KScsXG4gICAgICBib3JkZXJjb2xvcjogJyNkZGQnLFxuICAgICAgYm9yZGVyd2lkdGg6IDEsXG4gICAgICBmb250OiB7IHNpemU6IDExIH1cbiAgICB9LFxuICAgIG1hcmdpbjogeyBsOiA4MCwgcjogMTUwLCB0OiA4MCwgYjogODAgfSxcbiAgICBob3Zlcm1vZGU6ICdjbG9zZXN0J1xuICB9XG5cbiAgLy8gQ3JlYXRlIHRoZSBwbG90XG4gIFBsb3RseS5uZXdQbG90KGNvbnRhaW5lciwgdHJhY2VzLCBsYXlvdXQsIHtcbiAgICByZXNwb25zaXZlOiB0cnVlLFxuICAgIGRpc3BsYXlNb2RlQmFyOiBmYWxzZSxcbiAgICBtb2RlQmFyQnV0dG9uc1RvUmVtb3ZlOiBbJ3BhbjJkJywgJ2xhc3NvMmQnLCAnc2VsZWN0MmQnXVxuICB9KVxuXG4gIHJldHVybiBjb250YWluZXJcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJodG1sYCR7cmVzdWx0c19wbG90c31gXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3J1bicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdzd2VlcCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdkb3dubG9hZF9yZXN1bHRzJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2NsZWFyX3Jlc3VsdHMnKSJ9XX0=
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../Courses";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../Courses/10_WebGPU-First-App.html" class="pagination-link" aria-label="Your First WebGPU App">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Your First WebGPU App</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../summary.html" class="pagination-link" aria-label="Summary">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Summary</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Licensed under a <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-SA 4.0</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>